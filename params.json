{
  "name": "index",
  "tagline": "",
  "body": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\" lang=\"en\">\r\n<head>\r\n<script id=\"versionArea\" type=\"text/javascript\">\r\n//<![CDATA[\r\nvar version = {title: \"TiddlyWiki\", major: 2, minor: 8, revision: 1, date: new Date(\"June 23, 2013\"), extensions: {}};\r\n\r\n//]]>\r\n</script>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html;charset=utf-8\" />\r\n<meta name=\"copyright\" content=\"\r\nTiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)\r\n\r\nCopyright (c) Jeremy Ruston 2004-2007\r\nCopyright (c) UnaMesa Association 2007-2012\r\n\r\nRedistribution and use in source and binary forms, with or without modification,\r\nare permitted provided that the following conditions are met:\r\n\r\nRedistributions of source code must retain the above copyright notice, this\r\nlist of conditions and the following disclaimer.\r\n\r\nRedistributions in binary form must reproduce the above copyright notice, this\r\nlist of conditions and the following disclaimer in the documentation and/or other\r\nmaterials provided with the distribution.\r\n\r\nNeither the name of the UnaMesa Association nor the names of its contributors may be\r\nused to endorse or promote products derived from this software without specific\r\nprior written permission.\r\n\r\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND ANY\r\nEXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\r\nOF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT\r\nSHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,\r\nINCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED\r\nTO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR\r\nBUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\r\nCONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN\r\nANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH\r\nDAMAGE.\r\n\r\n\" />\r\n<!--PRE-HEAD-START-->\r\n<!--{{{-->\r\n<link href=\"/bags/pearl_public/tiddlers.atom\" rel=\"alternate\"\r\n\ttype=\"application/atom+xml\" title=\"pearl's public feed\" />\r\n<link rel=\"canonical\" href=\"http://pearl.tiddlyspace.com/\" />\r\n<!--}}}-->\r\n<!--PRE-HEAD-END-->\r\n<title>\r\n迪伦 - 如果命运是条孤独的河流，谁会是你灵魂的摆渡者\r\n</title>\r\n<style id=\"styleArea\" type=\"text/css\">\r\n#saveTest {display:none;}\r\n#messageArea {display:none;}\r\n#copyright {display:none;}\r\n#storeArea {display:none;}\r\n#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}\r\n#shadowArea {display:none;}\r\n#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}\r\n\r\n</style>\r\n<!--POST-HEAD-START-->\r\n\r\n<!--POST-HEAD-END-->\r\n</head>\r\n<body onload=\"main();\" onunload=\"if(window.unload) unload();\">\r\n<!--PRE-BODY-START-->\r\n\r\n<!--PRE-BODY-END-->\r\n<div id=\"copyright\">\r\nWelcome to TiddlyWiki created by Jeremy Ruston; Copyright &copy; 2004-2007 Jeremy Ruston, Copyright &copy; 2007-2011 UnaMesa Association\r\n</div>\r\n<noscript>\r\n\r\n<div id=\"javascriptWarning\">\r\nThis page requires JavaScript to function properly.<br /><br />\r\nIf you do not use JavaScript you may still <a href=\"/tiddlers\">browse\r\nthe content of this wiki</a>.\r\n</div>\r\n\r\n</noscript>\r\n<div id=\"saveTest\"></div>\r\n<div id=\"backstageCloak\"></div>\r\n<div id=\"backstageButton\"></div>\r\n<div id=\"backstageArea\"><div id=\"backstageToolbar\"></div></div>\r\n<div id=\"backstage\">\r\n\t<div id=\"backstagePanel\"></div>\r\n</div>\r\n<div id=\"contentWrapper\"></div>\r\n<div id=\"contentStash\"></div>\r\n<div id=\"shadowArea\">\r\n<div title=\"ColorPalette\">\r\n<pre>Background: #fff\r\nForeground: #000\r\nPrimaryPale: #8cf\r\nPrimaryLight: #18f\r\nPrimaryMid: #04b\r\nPrimaryDark: #014\r\nSecondaryPale: #ffc\r\nSecondaryLight: #fe8\r\nSecondaryMid: #db4\r\nSecondaryDark: #841\r\nTertiaryPale: #eee\r\nTertiaryLight: #ccc\r\nTertiaryMid: #999\r\nTertiaryDark: #666\r\nError: #f88\r\n</pre>\r\n</div>\r\n<div title=\"EditTemplate\">\r\n<pre>&lt;!--{{{--&gt;\r\n&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;\r\n&lt;div class='title' macro='view title'&gt;&lt;/div&gt;\r\n&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;\r\n&lt;div macro='annotations'&gt;&lt;/div&gt;\r\n&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;\r\n&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser excludeLists'&gt;&lt;/span&gt;&lt;/div&gt;\r\n&lt;!--}}}--&gt;\r\n</pre>\r\n</div>\r\n<div title=\"GettingStarted\">\r\n<pre>To get started with this blank [[TiddlyWiki]], you'll need to modify the following tiddlers:\r\n* [[SiteTitle]] &amp; [[SiteSubtitle]]: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)\r\n* [[MainMenu]]: The menu (usually on the left)\r\n* [[DefaultTiddlers]]: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened\r\nYou'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;\r\n</pre>\r\n</div>\r\n<div title=\"ImportTiddlers\">\r\n<pre>&lt;&lt;importTiddlers&gt;&gt;\r\n</pre>\r\n</div>\r\n<div title=\"MarkupPreHead\">\r\n<pre>&lt;!--{{{--&gt;\r\n&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' /&gt;\r\n&lt;!--}}}--&gt;\r\n</pre>\r\n</div>\r\n<div title=\"OptionsPanel\">\r\n<pre>These [[InterfaceOptions]] for customising [[TiddlyWiki]] are saved in your browser\r\n\r\nYour username for signing your edits. Write it as a [[WikiWord]] (eg [[JoeBloggs]])\r\n\r\n&lt;&lt;option txtUserName&gt;&gt;\r\n&lt;&lt;option chkSaveBackups&gt;&gt; [[SaveBackups]]\r\n&lt;&lt;option chkAutoSave&gt;&gt; [[AutoSave]]\r\n&lt;&lt;option chkRegExpSearch&gt;&gt; [[RegExpSearch]]\r\n&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; [[CaseSensitiveSearch]]\r\n&lt;&lt;option chkAnimate&gt;&gt; [[EnableAnimations]]\r\n\r\n----\r\nAlso see [[AdvancedOptions]]\r\n</pre>\r\n</div>\r\n<div title=\"PageTemplate\">\r\n<pre>&lt;!--{{{--&gt;\r\n&lt;div class='header' role='banner' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;\r\n&lt;div class='headerShadow'&gt;\r\n&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;\r\n&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;\r\n&lt;/div&gt;\r\n&lt;div class='headerForeground'&gt;\r\n&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;\r\n&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;\r\n&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;div id='mainMenu' role='navigation' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;\r\n&lt;div id='sidebar'&gt;\r\n&lt;div id='sidebarOptions' role='navigation' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;\r\n&lt;div id='sidebarTabs' role='complementary' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;div id='displayArea' role='main'&gt;\r\n&lt;div id='messageArea'&gt;&lt;/div&gt;\r\n&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;!--}}}--&gt;\r\n</pre>\r\n</div>\r\n<div title=\"StyleSheetColors\">\r\n<pre>/*{{{*/\r\nbody {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}\r\n\r\na {color:[[ColorPalette::PrimaryMid]];}\r\na:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}\r\na img {border:0;}\r\n\r\nh1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}\r\nh1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}\r\nh2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}\r\n\r\n.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}\r\n.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}\r\n.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}\r\n\r\n.header {background:[[ColorPalette::PrimaryMid]];}\r\n.headerShadow {color:[[ColorPalette::Foreground]];}\r\n.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}\r\n.headerForeground {color:[[ColorPalette::Background]];}\r\n.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}\r\n\r\n.tabSelected {color:[[ColorPalette::PrimaryDark]];\r\n\tbackground:[[ColorPalette::TertiaryPale]];\r\n\tborder-left:1px solid [[ColorPalette::TertiaryLight]];\r\n\tborder-top:1px solid [[ColorPalette::TertiaryLight]];\r\n\tborder-right:1px solid [[ColorPalette::TertiaryLight]];\r\n}\r\n.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}\r\n.tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}\r\n.tabContents .button {border:0;}\r\n\r\n#sidebar {}\r\n#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}\r\n#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}\r\n#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}\r\n#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}\r\n#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}\r\n\r\n.wizard {background:[[ColorPalette::PrimaryPale]]; border:1px solid [[ColorPalette::PrimaryMid]];}\r\n.wizard h1 {color:[[ColorPalette::PrimaryDark]]; border:none;}\r\n.wizard h2 {color:[[ColorPalette::Foreground]]; border:none;}\r\n.wizardStep {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];\r\n\tborder:1px solid [[ColorPalette::PrimaryMid]];}\r\n.wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}\r\n.wizardFooter {background:[[ColorPalette::PrimaryPale]];}\r\n.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}\r\n.wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;\r\n\tborder-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}\r\n.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}\r\n.wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;\r\n\tborder-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}\r\n\r\n.wizard .notChanged {background:transparent;}\r\n.wizard .changedLocally {background:#80ff80;}\r\n.wizard .changedServer {background:#8080ff;}\r\n.wizard .changedBoth {background:#ff8080;}\r\n.wizard .notFound {background:#ffff80;}\r\n.wizard .putToServer {background:#ff80ff;}\r\n.wizard .gotFromServer {background:#80ffff;}\r\n\r\n#messageArea {border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]];}\r\n#messageArea .button {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none;}\r\n\r\n.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}\r\n\r\n.popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}\r\n.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}\r\n.popup li.disabled {color:[[ColorPalette::TertiaryMid]];}\r\n.popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}\r\n.popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}\r\n.popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}\r\n.popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}\r\n.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}\r\n\r\n.tiddler .defaultCommand {font-weight:bold;}\r\n\r\n.shadow .title {color:[[ColorPalette::TertiaryDark]];}\r\n\r\n.title {color:[[ColorPalette::SecondaryDark]];}\r\n.subtitle {color:[[ColorPalette::TertiaryDark]];}\r\n\r\n.toolbar {color:[[ColorPalette::PrimaryMid]];}\r\n.toolbar a {color:[[ColorPalette::TertiaryLight]];}\r\n.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}\r\n.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}\r\n\r\n.tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}\r\n.selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}\r\n.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}\r\n.tagging .button, .tagged .button {border:none;}\r\n\r\n.footer {color:[[ColorPalette::TertiaryLight]];}\r\n.selected .footer {color:[[ColorPalette::TertiaryMid]];}\r\n\r\n.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}\r\n.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}\r\n.lowlight {background:[[ColorPalette::TertiaryLight]];}\r\n\r\n.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}\r\n\r\n.imageLink, #displayArea .imageLink {background:transparent;}\r\n\r\n.annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}\r\n\r\n.viewer .listTitle {list-style-type:none; margin-left:-2em;}\r\n.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}\r\n.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}\r\n\r\n.viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}\r\n.viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}\r\n.viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}\r\n\r\n.viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}\r\n.viewer code {color:[[ColorPalette::SecondaryDark]];}\r\n.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}\r\n\r\n.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}\r\n\r\n.editor input {border:1px solid [[ColorPalette::PrimaryMid]];}\r\n.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}\r\n.editorFooter {color:[[ColorPalette::TertiaryMid]];}\r\n.readOnly {background:[[ColorPalette::TertiaryPale]];}\r\n\r\n#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}\r\n#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}\r\n#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }\r\n#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}\r\n#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}\r\n#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}\r\n#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}\r\n.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}\r\n.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}\r\n#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:alpha(opacity=60);}\r\n/*}}}*/\r\n</pre>\r\n</div>\r\n<div title=\"StyleSheetLayout\">\r\n<pre>/*{{{*/\r\n* html .tiddler {height:1%;}\r\n\r\nbody {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}\r\n\r\nh1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}\r\nh1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}\r\nh4,h5,h6 {margin-top:1em;}\r\nh1 {font-size:1.35em;}\r\nh2 {font-size:1.25em;}\r\nh3 {font-size:1.1em;}\r\nh4 {font-size:1em;}\r\nh5 {font-size:.9em;}\r\n\r\nhr {height:1px;}\r\n\r\na {text-decoration:none;}\r\n\r\ndt {font-weight:bold;}\r\n\r\nol {list-style-type:decimal;}\r\nol ol {list-style-type:lower-alpha;}\r\nol ol ol {list-style-type:lower-roman;}\r\nol ol ol ol {list-style-type:decimal;}\r\nol ol ol ol ol {list-style-type:lower-alpha;}\r\nol ol ol ol ol ol {list-style-type:lower-roman;}\r\nol ol ol ol ol ol ol {list-style-type:decimal;}\r\n\r\n.txtOptionInput {width:11em;}\r\n\r\n#contentWrapper .chkOptionInput {border:0;}\r\n\r\n.externalLink {text-decoration:underline;}\r\n\r\n.indent {margin-left:3em;}\r\n.outdent {margin-left:3em; text-indent:-3em;}\r\ncode.escaped {white-space:nowrap;}\r\n\r\n.tiddlyLinkExisting {font-weight:bold;}\r\n.tiddlyLinkNonExisting {font-style:italic;}\r\n\r\n/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */\r\na.tiddlyLinkNonExisting.shadow {font-weight:bold;}\r\n\r\n#mainMenu .tiddlyLinkExisting,\r\n\t#mainMenu .tiddlyLinkNonExisting,\r\n\t#sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}\r\n#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}\r\n\r\n.header {position:relative;}\r\n.header a:hover {background:transparent;}\r\n.headerShadow {position:relative; padding:4.5em 0 1em 1em; left:-1px; top:-1px;}\r\n.headerForeground {position:absolute; padding:4.5em 0 1em 1em; left:0; top:0;}\r\n\r\n.siteTitle {font-size:3em;}\r\n.siteSubtitle {font-size:1.2em;}\r\n\r\n#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}\r\n\r\n#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}\r\n#sidebarOptions {padding-top:0.3em;}\r\n#sidebarOptions a {margin:0 0.2em; padding:0.2em 0.3em; display:block;}\r\n#sidebarOptions input {margin:0.4em 0.5em;}\r\n#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}\r\n#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}\r\n#sidebarOptions .sliderPanel input {margin:0 0 0.3em 0;}\r\n#sidebarTabs .tabContents {width:15em; overflow:hidden;}\r\n\r\n.wizard {padding:0.1em 1em 0 2em;}\r\n.wizard h1 {font-size:2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}\r\n.wizard h2 {font-size:1.2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}\r\n.wizardStep {padding:1em 1em 1em 1em;}\r\n.wizard .button {margin:0.5em 0 0; font-size:1.2em;}\r\n.wizardFooter {padding:0.8em 0.4em 0.8em 0;}\r\n.wizardFooter .status {padding:0 0.4em; margin-left:1em;}\r\n.wizard .button {padding:0.1em 0.2em;}\r\n\r\n#messageArea {position:fixed; top:2em; right:0; margin:0.5em; padding:0.5em; z-index:2000; _position:absolute;}\r\n.messageToolbar {display:block; text-align:right; padding:0.2em;}\r\n#messageArea a {text-decoration:underline;}\r\n\r\n.tiddlerPopupButton {padding:0.2em;}\r\n.popupTiddler {position: absolute; z-index:300; padding:1em; margin:0;}\r\n\r\n.popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}\r\n.popup .popupMessage {padding:0.4em;}\r\n.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0;}\r\n.popup li.disabled {padding:0.4em;}\r\n.popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}\r\n.listBreak {font-size:1px; line-height:1px;}\r\n.listBreak div {margin:2px 0;}\r\n\r\n.tabset {padding:1em 0 0 0.5em;}\r\n.tab {margin:0 0 0 0.25em; padding:2px;}\r\n.tabContents {padding:0.5em;}\r\n.tabContents ul, .tabContents ol {margin:0; padding:0;}\r\n.txtMainTab .tabContents li {list-style:none;}\r\n.tabContents li.listLink { margin-left:.75em;}\r\n\r\n#contentWrapper {display:block;}\r\n#splashScreen {display:none;}\r\n\r\n#displayArea {margin:1em 17em 0 14em;}\r\n\r\n.toolbar {text-align:right; font-size:.9em;}\r\n\r\n.tiddler {padding:1em 1em 0;}\r\n\r\n.missing .viewer,.missing .title {font-style:italic;}\r\n\r\n.title {font-size:1.6em; font-weight:bold;}\r\n\r\n.missing .subtitle {display:none;}\r\n.subtitle {font-size:1.1em;}\r\n\r\n.tiddler .button {padding:0.2em 0.4em;}\r\n\r\n.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}\r\n.isTag .tagging {display:block;}\r\n.tagged {margin:0.5em; float:right;}\r\n.tagging, .tagged {font-size:0.9em; padding:0.25em;}\r\n.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}\r\n.tagClear {clear:both;}\r\n\r\n.footer {font-size:.9em;}\r\n.footer li {display:inline;}\r\n\r\n.annotation {padding:0.5em; margin:0.5em;}\r\n\r\n* html .viewer pre {width:99%; padding:0 0 1em 0;}\r\n.viewer {line-height:1.4em; padding-top:0.5em;}\r\n.viewer .button {margin:0 0.25em; padding:0 0.25em;}\r\n.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}\r\n.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}\r\n\r\n.viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}\r\n.viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}\r\ntable.listView {font-size:0.85em; margin:0.8em 1.0em;}\r\ntable.listView th, table.listView td, table.listView tr {padding:0 3px 0 3px;}\r\n\r\n.viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}\r\n.viewer code {font-size:1.2em; line-height:1.4em;}\r\n\r\n.editor {font-size:1.1em;}\r\n.editor input, .editor textarea {display:block; width:100%; font:inherit;}\r\n.editorFooter {padding:0.25em 0; font-size:.9em;}\r\n.editorFooter .button {padding-top:0; padding-bottom:0;}\r\n\r\n.fieldsetFix {border:0; padding:0; margin:1px 0px;}\r\n\r\n.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}\r\n.zoomer div {padding:1em;}\r\n\r\n* html #backstage {width:99%;}\r\n* html #backstageArea {width:99%;}\r\n#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em;}\r\n#backstageToolbar {position:relative;}\r\n#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em;}\r\n#backstageButton {display:none; position:absolute; z-index:175; top:0; right:0;}\r\n#backstageButton a {padding:0.1em 0.4em; margin:0.1em;}\r\n#backstage {position:relative; width:100%; z-index:50;}\r\n#backstagePanel {display:none; z-index:100; position:absolute; width:90%; margin-left:3em; padding:1em;}\r\n.backstagePanelFooter {padding-top:0.2em; float:right;}\r\n.backstagePanelFooter a {padding:0.2em 0.4em;}\r\n#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}\r\n\r\n.whenBackstage {display:none;}\r\n.backstageVisible .whenBackstage {display:block;}\r\n/*}}}*/\r\n</pre>\r\n</div>\r\n<div title=\"StyleSheetLocale\">\r\n<pre>/***\r\nStyleSheet for use when a translation requires any css style changes.\r\nThis StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which need larger font sizes.\r\n***/\r\n/*{{{*/\r\nbody {font-size:0.8em;}\r\n#sidebarOptions {font-size:1.05em;}\r\n#sidebarOptions a {font-style:normal;}\r\n#sidebarOptions .sliderPanel {font-size:0.95em;}\r\n.subtitle {font-size:0.8em;}\r\n.viewer table.listView {font-size:0.95em;}\r\n/*}}}*/\r\n</pre>\r\n</div>\r\n<div title=\"StyleSheetPrint\">\r\n<pre>/*{{{*/\r\n@media print {\r\n#mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton, #backstageArea {display: none !important;}\r\n#displayArea {margin: 1em 1em 0em;}\r\nnoscript {display:none;} /* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */\r\n}\r\n/*}}}*/\r\n</pre>\r\n</div>\r\n<div title=\"ViewTemplate\">\r\n<pre>&lt;!--{{{--&gt;\r\n&lt;div class='toolbar' role='navigation' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;\r\n&lt;div class='title' macro='view title'&gt;&lt;/div&gt;\r\n&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;\r\n&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;\r\n&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;\r\n&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;\r\n&lt;div class='tagClear'&gt;&lt;/div&gt;\r\n&lt;!--}}}--&gt;\r\n</pre>\r\n</div>\r\n\r\n</div>\r\n<!--POST-SHADOWAREA-->\r\n<div id=\"storeArea\"><div title=\"RefreshTiddlerCommand\" server.title=\"RefreshTiddlerCommand\" server.page.revision=\"1521867\" server.etag=\"&quot;system-plugins_public/RefreshTiddlerCommand/1521867:7c1a3ac2e6567a7fe447db5f62cb5861953d6124&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-plugins_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-plugins_public\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"02e0b362ad77cbb6e902b176a082430649e798ac\">\r\n<pre>/***\r\n|''Name''|RefreshTiddlerCommand|\r\n|''Version''|0.3.0|\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nvar cmd = config.commands.refreshTiddler = {\r\n\ttext: \"refresh\",\r\n\tlocale: {\r\n\t\trefreshing: \"Refreshing tiddler...\"\r\n\t},\r\n\ttooltip: \"refresh this tiddler to be the one on the server\",\r\n\thandler: function(ev, src, title) {\r\n\t\tvar tiddler = store.getTiddler(title);\r\n\t\tif(!tiddler) {\r\n\t\t\ttiddler = new Tiddler(title);\r\n\t\t\tmerge(tiddler.fields, config.defaultCustomFields);\r\n\t\t}\r\n\t\t$(story.getTiddler(title)).find(\".viewer\").\r\n\t\t\tempty().text(cmd.locale.refreshing);\r\n\t\tvar dirtyStatus = store.isDirty();\r\n\t\tstory.loadMissingTiddler(title, {\r\n\t\t\t\"server.workspace\": tiddler.fields[\"server.recipe\"]  ? \"recipes/\" + tiddler.fields[\"server.recipe\"] :\r\n\t\t\t\ttiddler.fields[\"server.workspace\"] || \"bags/\"+tiddler.fields[\"server.bag\"],\r\n\t\t\t\"server.host\": tiddler.fields[\"server.host\"],\r\n\t\t\t\"server.type\": tiddler.fields[\"server.type\"]\r\n\t\t}, function() {\r\n\t\t\tstore.setDirty(dirtyStatus);\r\n\t\t});\r\n\t}\r\n};\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"cancelTiddler\" server.title=\"cancelTiddler\" server.page.revision=\"1521931\" server.etag=\"&quot;system-images_public/cancelTiddler/1521931:ee492740a48546c2bde51cbba46c0256d62ae560&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-images_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-images_public\" server.permissions=\"read\" server.content-type=\"image/svg+xml\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch\" _hash=\"7ec49872e728041385751b4252f6baab334f44ce\">\r\n<pre>&lt;svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xl=\"http://www.w3.org/1999/xlink\" version=\"1.1\" viewBox=\"72 648 70 70\" \r\nwidth=\"30\" height=\"30\"&gt;\r\n&lt;g stroke=\"none\" stroke-opacity=\"1\" stroke-dasharray=\"none\" fill=\"none\" fill-opacity=\"1\"&gt;\r\n\t&lt;g&gt;\r\n\t\t&lt;path d=\"M 77.59005 669.34003 C 71.532745 681.90424 73.714462 697.4441 84.135193 707.86475 \r\n\t\tC 97.315445 721.0451 118.684715 721.0451 131.8649 707.86475 \r\n\t\tC 145.04515 694.68457 145.04515 673.31537 131.8649 660.13513 \r\n\t\tC 121.4441 649.7141 105.90419 647.53253 93.339905 653.5899 L 102.047455 662.2976 \r\n\t\tC 109.58637 660.2373 117.987976 662.16803 123.90997 668.08997 \r\n\t\tC 132.69673 676.8767 132.69673 691.12317 123.90997 699.90985 \r\n\t\tC 115.12313 708.6966 100.87699 708.6966 92.09012 699.90985 \r\n\t\tC 86.168266 693.98804 84.23744 685.58643 86.297653 678.04755 Z M 72 648 L 72 668.25 L 78.75 661.49957 \r\n\t\tL 99.00019 681.7502 L 105.750175 675.00006 L 85.50013 654.75012 L 92.249985 648 Z\" fill=\"black\"\r\n\t\tclass=\"glyph\"/&gt;\r\n\t&lt;/g&gt;\r\n&lt;/g&gt;\r\n&lt;/svg&gt;</pre>\r\n</div>\r\n<div title=\"spaceIcon\" server.title=\"spaceIcon\" server.page.revision=\"1521883\" server.etag=\"&quot;system-info_public/spaceIcon/1521883:37a84070f2fcc9f5c44dd2ae502ca56ced91316a&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-info_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-info_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch\" _hash=\"ef5f983ca36b19ed82d51224aee1c85d8fecb0a5\">\r\n<pre>A [[SiteIcon|SiteIcon tiddler]]@glossary helps provide some identity to your space.  Ideally it'd be a square and a minimum of 48*48 pixels size.  You can upload your site icon using the uploader below.\r\n\r\n&lt;&lt;binaryUploadPublic title:SiteIcon&gt;&gt;</pre>\r\n</div>\r\n<div title=\"privateIcon\" server.title=\"privateIcon\" server.page.revision=\"1521894\" server.etag=\"&quot;tiddlyspace/privateIcon/1521894:8ae9906ce0782dba67e8367fb91f352e6f8bad98&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"image/png\" modified=\"20131111192334\" created=\"20131111192334\" tags=\"excludeLists excludeSearch\" _hash=\"94eabb8c954332020ab12d027656ddc3adb98c63\">\r\n<pre>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</pre>\r\n</div>\r\n<div title=\"TiddlyFileImporter\" server.title=\"TiddlyFileImporter\" server.page.revision=\"1521907\" server.etag=\"&quot;tiddlyspace/TiddlyFileImporter/1521907:2570cea18ad13286b7c593e0449e3864d20d45a0&quot;\" modifier=\"None\" creator=\"None\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"948bb64604a46205267e446af0f638c4e8fc3c8e\">\r\n<pre>/***\r\n|''Name''|TiddlyFileImporter|\r\n|''Version''|0.3.8|\r\n|''Author''|Ben Gillies|\r\n|''Type''|plugin|\r\n|''Description''|Upload a TiddlyWiki file to TiddlyWeb, and import the tiddlers.|\r\n!Usage\r\nUpload a TiddlyWiki file to TiddlyWeb, and import the tiddlers.\r\n!Requires\r\ntiddlyweb\r\ntiddlywebplugins.reflector\r\n!Code\r\n***/\r\n//{{{\r\n(function($){\r\nif(!version.extensions.TiddlyFileImporter)\r\n{ //# ensure that the plugin is only installed once\r\n\tversion.extensions.TiddlyFileImporter = { installed: true };\r\n}\r\n\r\nconfig.macros.fileImport = {\r\n\treflectorURI: '/reflector?csrf_token=%0',\r\n\tincorrectTypeError: 'Incorrect File Type. You must upload a TiddlyWiki',\r\n\tuploadLabel: 'Upload',\r\n\tuploadLabelPrompt: 'Import tiddlers from this TiddlyWiki',\r\n\tstep1FileText: 'File:',\r\n\tstep1PostText: 'In the next screen you will select the tiddlers to import.',\r\n\tstep1Title: 'Step 1: Pick a TiddlyWiki to import',\r\n\tstep1TypeChooser: 'Import From:',\r\n\tstep3Html: ['&lt;input type=\"hidden\" name=\"markList\" /&gt;',\r\n\t\t'&lt;input type=\"hidden\" checked=\"true\" name=\"chkSync\" /&gt;',\r\n\t\t'&lt;input type=\"hidden\" name=\"chkSave\" /&gt;',\r\n\t\t'&lt;input type=\"hidden\" name=\"txtSaveTiddler\" /&gt;'].join(),\r\n\r\n\thandler: function(place, macroName, params, wikifier, paramString) {\r\n\t\tvar wizard = new Wizard();\r\n\t\twizard.createWizard(place, 'Import a TiddlyWiki');\r\n\t\tthis.restart(wizard);\r\n\t},\r\n\r\n\trestart: function(wizard) {\r\n\t\tvar me = config.macros.fileImport;\r\n\t\twizard.addStep(me.step1Title, ['&lt;input type=\"hidden\" ',\r\n\t\t\t'name=\"markList\" /&gt;'].join(\"\"));\r\n\t\tvar markList = wizard.getElement('markList');\r\n\t\tvar uploadWrapper = document.createElement('div');\r\n\t\tmarkList.parentNode.insertBefore(uploadWrapper, markList);\r\n\t\tuploadWrapper.setAttribute('refresh', 'macro');\r\n\t\tuploadWrapper.getAttribute('macroName', 'fileImport');\r\n\t\tvar iframeName = 'reflectorImporter' + Math.random().toString();\r\n\t\tme.createForm(uploadWrapper, wizard, iframeName);\r\n\t\t$(uploadWrapper).append('&lt;p&gt;' + me.step1PostText + '&lt;/p&gt;');\r\n\t\twizard.setValue('serverType', 'tiddlyweb');\r\n\t\twizard.setValue('adaptor', new config.adaptors.file());\r\n\t\twizard.setValue('host', config.defaultCustomFields['server.host']);\r\n\t\twizard.setValue('context', {});\r\n\t\tvar iframe = $(['&lt;iframe name=\"' + iframeName + '\" ',\r\n\t\t\t'style=\"display: none\" /&gt;'].join(\"\")).appendTo(uploadWrapper);\r\n\t\tvar onSubmit = function(ev) {\r\n\t\t\tvar uploadType = $('select[name=uploadtype]', wizard.formElem).val();\r\n\t\t\tif (uploadType == \"file\") {\r\n\t\t\t\t// set an onload ready to hijack the form\r\n\t\t\t\tme.setOnLoad(uploadWrapper, wizard, iframe[0]);\r\n\t\t\t\twizard.importType = 'file';\r\n\t\t\t\twizard.formElem.submit();\r\n\t\t\t} else {\r\n\t\t\t\tvar csrf_token = config.extensions.tiddlyspace.getCSRFToken();\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"%0/reflector?csrf_token=%1\".format(\r\n\t\t\t\t\t\tconfig.defaultCustomFields[\"server.host\"], csrf_token),\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdataType: \"text\",\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\turi: $(\"input\", \".importFrom\", wizard.formElem).val()\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: function(data, txtStatus, xhr) {\r\n\t\t\t\t\t\twizard.POSTResponse = data;\r\n\t\t\t\t\t\tme.importTiddlers(uploadWrapper, wizard);\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror: function(xhr, txtStatus, error) {\r\n\t\t\t\t\t\tdisplayMessage([\"There was an error fetching the \",\r\n\t\t\t\t\t\t\t'url: ', txtStatus].join(\"\"));\r\n\t\t\t\t\t\tme.restart(wizard);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t};\r\n\t\twizard.setButtons([{\r\n\t\t\tcaption: me.uploadLabel,\r\n\t\t\ttooltip: me.uploadLabelPrompt,\r\n\t\t\tonClick: onSubmit\r\n\t\t}]);\r\n\t\t$(wizard.formElem).submit(function(ev) {\r\n\t\t\tonSubmit(ev);\r\n\t\t\tev.preventDefault();\r\n\t\t});\r\n\t},\r\n\r\n\tcreateForm: function(place, wizard, iframeName) {\r\n\t\tvar form = wizard.formElem;\r\n\t\tvar me = config.macros.fileImport;\r\n\t\tform.action = me.reflectorURI.format(\r\n\t\t\tconfig.extensions.tiddlyspace.getCSRFToken());\r\n\t\tform.enctype = 'multipart/form-data';\r\n\t\tform.encoding = 'multipart/form-data';\r\n\t\tform.method = 'POST';\r\n\t\tform.target = iframeName;\r\n\t\tonSelectChange = function(e) {\r\n\t\t\tvar changeTo = $(this).val();\r\n\t\t\tif (changeTo == \"file\") {\r\n\t\t\t\t$(\".importFrom\").html('%0 &lt;input type=\"file\" name=\"file\" /&gt;'.\r\n\t\t\t\t\tformat(me.step1FileText));\r\n\t\t\t} else {\r\n\t\t\t\t$(\".importFrom\").html('URL: &lt;input type=\"text\" name=\"uri\" /&gt;'\r\n\t\t\t\t\t+ ' Do you want &lt;a target=\"_blank\" href=\"http://faq.tiddlyspace.com/How%20do%20I%20include%2Fexclude%20spaces%3F\"&gt;inclusion&lt;/a&gt; instead?');\r\n\t\t\t}\r\n\t\t};\r\n\t\t$(place).append('&lt;span&gt;%0&lt;/span&gt;'.format(me.step1TypeChooser)).\r\n\t\t\tappend($(['&lt;select name=\"uploadtype\"&gt;&lt;option value=\"file\" selected=\"selected\"&gt;file',\r\n\t\t\t\t'&lt;option value=\"uri\"&gt;url&lt;/select&gt;'].join(\"\")).change(onSelectChange)).\r\n\t\t\tappend('&lt;div class=\"importFrom\"&gt;%0&lt;input type=\"file\" name=\"file\" /&gt;&lt;/div&gt;'.\r\n\t\t\t\t\tformat(me.step1FileText));\r\n\t},\r\n\r\n\tsetOnLoad: function(place, wizard, iframe) {\r\n\t\tvar me = config.macros.fileImport;\r\n\t\tvar loadHandler = function() {\r\n\t\t\tme.importTiddlers.apply(this, [place, wizard, iframe]);\r\n\t\t};\r\n\t\tiframe.onload = loadHandler;\r\n\t\tcompleteReadyStateChanges = 0;\r\n\t\tiframe.onreadystatechange = function() {\r\n\t\t\tif (++(completeReadyStateChanges) == 5) {\r\n\t\t\t\tloadHandler();\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\r\n\timportTiddlers: function(place, wizard, iframe) {\r\n\t\tvar tmpStore = new TiddlyWiki();\r\n\t\tvar POSTedWiki = \"\";\r\n\t\tif (wizard.importType == \"file\") {\r\n\t\t\ttry {\r\n\t\t\t\tPOSTedWiki= iframe.contentWindow\r\n\t\t\t\t\t.document.documentElement.innerHTML;\r\n\t\t\t} catch(e) {\r\n\t\t\t\tdisplayMessage(config.macros.fileImport.incorrectTypeError);\r\n\t\t\t\tconfig.macros.fileImport.restart(wizard);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// now we are done, so remove the iframe\r\n\t\t\t$(iframe).remove();\r\n\t\t} else {\r\n\t\t\tPOSTedWiki = wizard.POSTResponse;\r\n\t\t}\r\n\r\n\t\ttmpStore.importTiddlyWiki(POSTedWiki);\r\n\t\tvar newTiddlers = tmpStore.getTiddlers();\r\n\t\tvar workspace = config.defaultCustomFields['server.workspace'];\r\n\t\tvar context = {\r\n\t\t\tstatus: true,\r\n\t\t\tstatusText: 'OK',\r\n\t\t\thttpStatus: 200,\r\n\t\t\tadaptor: wizard.getValue('adaptor'),\r\n\t\t\ttiddlers: newTiddlers\r\n\t\t};\r\n\t\tcontext.adaptor.store = tmpStore;\r\n\t\twizard.setValue('context', context);\r\n\t\twizard.setValue('workspace', workspace);\r\n\t\twizard.setValue('inFileImport', true);\r\n\t\tconfig.macros.importTiddlers.onGetTiddlerList(context, wizard);\r\n\t}\r\n};\r\n\r\nvar _onGetTiddler = config.macros.importTiddlers.onGetTiddler;\r\nconfig.macros.importTiddlers.onGetTiddler = function(context, wizard) {\r\n\tif (wizard.getValue('inFileImport')) {\r\n\t\tvar me = config.macros.importTiddlers;\r\n\t\tif(!context.status)\r\n\t\t\tdisplayMessage(\"Error in importTiddlers.onGetTiddler: \" + context.statusText);\r\n\t\tvar tiddler = context.tiddler;\r\n\t\tvar fields = tiddler.fields;\r\n\t\tmerge(fields, config.defaultCustomFields);\r\n\t\tfields[\"server.workspace\"] = wizard.getValue('workspace');\r\n\t\tdelete fields['server.permissions'];\r\n\t\tdelete fields['server.bag'];\r\n\t\tfields['server.page.revision'] = 'false';\r\n\t\tdelete fields['server.recipe'];\r\n\t\tfields.changecount = 1;\r\n\t\tstore.suspendNotifications();\r\n\t\tstore.saveTiddler(tiddler.title, tiddler.title, tiddler.text,\r\n\t\t\ttiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields,\r\n\t\t\tfalse, tiddler.created);\r\n\t\tstore.resumeNotifications();\r\n\t\tvar remainingImports = wizard.getValue(\"remainingImports\")-1;\r\n\t\twizard.setValue(\"remainingImports\",remainingImports);\r\n\t\tif(remainingImports === 0) {\r\n\t\t\tif(context.isSynchronous) {\r\n\t\t\t\tstore.notifyAll();\r\n\t\t\t\trefreshDisplay();\r\n\t\t\t}\r\n\t\t\twizard.setButtons([\r\n\t\t\t\t\t{caption: me.doneLabel, tooltip: me.donePrompt, onClick: me.onClose}\r\n\t\t\t\t],me.statusDoneImport);\r\n\t\t\tautoSaveChanges();\r\n\t\t}\r\n\t} else {\r\n\t\t_onGetTiddler.apply(this, arguments);\r\n\t}\r\n};\r\n\r\nvar _onCancel = config.macros.importTiddlers.onCancel;\r\nconfig.macros.importTiddlers.onCancel = function(e)\r\n{\r\n\tvar wizard = new Wizard(this);\r\n\tif (!wizard.getValue('inFileImport')) {\r\n\t\treturn _onCancel.apply(this, arguments);\r\n\t}\r\n\tvar place = wizard.clear();\r\n\tconfig.macros.fileImport.restart(wizard);\r\n\treturn false;\r\n};\r\n\r\nvar _step3Html = config.macros.importTiddlers.step3Html;\r\nvar _onGetTiddlerList = config.macros.importTiddlers.onGetTiddlerList;\r\nconfig.macros.importTiddlers.onGetTiddlerList = function(context, wizard) {\r\n\tvar fileImport = config.macros.fileImport;\r\n\tvar importTiddlers = config.macros.importTiddlers;\r\n\tif (wizard.getValue('inFileImport')) {\r\n\t\timportTiddlers.step3Html = fileImport.step3Html;\r\n\t} else {\r\n\t\timportTiddlers.step3Html = _step3Html;\r\n\t}\r\n\t_onGetTiddlerList.apply(this, arguments);\r\n};\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"pearlSetupFlag\" server.title=\"pearlSetupFlag\" server.page.revision=\"2556080\" server.etag=\"&quot;pearl_public/pearlSetupFlag/2556080:6062fdff4a28ea61efe9f5fd4ebc4c0d28a8b41d&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160908133954\" created=\"20160908133954\" tags=\"excludeLists excludePublisher excludeSearch\" _hash=\"378e7c4224d9b9ed97947eefce1fab45a0a71696\" tiddlyspaceinit_version=\"0.6\">\r\n<pre>@@Please do not modify this tiddler; it was created automatically upon space creation.@@</pre>\r\n</div>\r\n<div title=\"文件\" server.title=\"文件\" server.page.revision=\"2564828\" server.etag=\"&quot;pearl_public/%E6%96%87%E4%BB%B6/2564828:5d981dde96fc780eb8353b7adb6298541e432637&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160925051958\" created=\"20160925051943\" tags=\"\" _hash=\"aa2ef549610ae44c44ba533a83cb0abcca4800bd\">\r\n<pre>'文件'\r\n&lt;html&gt;\r\n&lt;head&gt;\r\n      &lt;title&gt;第一个HTML代码&lt;/title&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n&lt;div align=\"center\"&gt;\r\n&lt;img src=\"http://picm.photophoto.cn/005/023/001/0230010072.jpg\" hight=\"500\" width=\"300\" &gt;&lt;br/&gt;\r\n\r\n&lt;/div&gt;\r\n&lt;hr width=\"800\" color=\"pink\" size\"10\"/&gt;\r\n\r\n&lt;/body&gt;\r\n&lt;/html&gt;\r\n</pre>\r\n</div>\r\n<div title=\"_reply\" server.title=\"_reply\" server.page.revision=\"1521889\" server.etag=\"&quot;tiddlyspace/_reply/1521889:d6d1cd50aeec721211859b5882b102c491357e7e&quot;\" modifier=\"bengillies\" creator=\"bengillies\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"text/html\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeMissing excludeSearch\" _hash=\"01c7fff74dd8fd746394153d7c586fee665e4ce6\">\r\n<pre>&lt;!DOCTYPE html&gt;\r\n&lt;html lang=\"en\"&gt;\r\n&lt;head&gt;\r\n\t&lt;meta charset=\"UTF-8\"&gt;\r\n\t&lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\"&gt;\r\n\t&lt;title&gt;Reply&lt;/title&gt;\r\n\t&lt;link rel=\"stylesheet\" href=\"//tiddlyspace.com/bags/benspa_public/tiddlers/bootvelcro.css\"&gt;\r\n\t&lt;style&gt;\r\n\t\thtml,\r\n\t\tbody {\r\n\t\t\toverflow: hidden;\r\n\t\t\tbackground-color: transparent;\r\n\t\t}\r\n\r\n\t\t#container {\r\n\t\t\t/* prevent a fouc if no images present */\r\n\t\t\tdisplay: none;\r\n\t\t}\r\n\r\n\t\t.modal-header {\r\n\t\t\tborder-bottom: none;\r\n\t\t\tpadding: 5px 0 0;\r\n\t\t\tposition: absolute;\r\n\t\t\twidth: 100%;\r\n\t\t\tbackground-color: #e0e0e0;\r\n\t\t\t-webkit-border-radius: 6px 6px 0 0;\r\n\t\t\t-moz-border-radius: 6px 6px 0 0;\r\n\t\t\tborder-radius: 6px 6px 0 0;\r\n\t\t\tcursor: move;\r\n\t\t}\r\n\r\n\t\t.form-actions {\r\n\t\t\tposition: absolute;\r\n\t\t\tbottom: 0;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\t-moz-box-sizing: border-box;\r\n\t\t\twidth: 100%;\r\n\t\t\tmargin: 0;\r\n\t\t\tborder-radius: 0 0 6px 6px;\r\n\t\t\tbackground-color: #e0e0e0;\r\n\t\t\tborder-top: 1px solid gray;\r\n\t\t}\r\n\r\n\t\t.form-actions input.btn {\r\n\t\t\twidth: auto;\r\n\t\t\tfloat: right;\r\n\t\t\tmargin: 0 0.2em;\r\n\t\t}\r\n\r\n\t\t.closeBtn {\r\n\t\t\tbackground-color: #DCE7F1 !important;\r\n\t\t}\r\n\r\n\t\t.primary {\r\n\t\t\tbackground-color: #09F !important;\r\n\t\t}\r\n\r\n\t\th1 {\r\n\t\t\tmargin-bottom: 9px;\r\n\t\t\tmargin-top: 9px;\r\n\t\t}\r\n\r\n\t\tbody {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 100%;\r\n\t\t\tposition: absolute;\r\n\t\t}\r\n\r\n\t\t.modal {\r\n\t\t\tmargin: 10px;\r\n\t\t\ttop: 0;\r\n\t\t\tleft: 0;\r\n\t\t\tbottom: 0;\r\n\t\t\twidth: 510px;\r\n\t\t\tposition: absolute;\r\n\t\t\tbox-shadow: #444 0px 0px 10px 2px;\r\n\t\t\tborder-radius: 6px;\r\n\t\t\tbackground-color: white;\r\n\t\t\tborder: 1px solid gray;\r\n\t\t\tbackground-color: #F0F4F8;\r\n\t\t}\r\n\r\n\t\tlabel em {\r\n\t\t\tcursor: pointer;\r\n\t\t}\r\n\r\n\t\t.modal-body {\r\n\t\t\toverflow: auto;\r\n\t\t\tposition: absolute;\r\n\t\t\ttop: 0;\r\n\t\t\tbottom: 0;\r\n\t\t\tleft: 0;\r\n\t\t\tright: 0;\r\n\t\t\tmargin: 65px 20px 67px;\r\n\t\t\tbackground-color: transparent;\r\n\t\t}\r\n\r\n\t\t.nav-tabs {\r\n\t\t\tpadding-left: 1%;\r\n\t\t\tmargin: 0;\r\n\t\t\twidth: 99%;\r\n\t\t\tborder-color: gray;\r\n\t\t}\r\n\r\n\t\t.nav-tabs &gt; li {\r\n\t\t\tcursor: pointer;\r\n\t\t}\r\n\r\n\t\t.nav-tabs &gt; li &gt; a {\r\n\t\t\tline-height: 2.4em;\r\n\t\t\tfont-weight: bold;\r\n\t\t\tfont-size: 100%;\r\n\t\t}\r\n\r\n\t\t.nav-tabs &gt; li.active &gt; a{\r\n\t\t\tbackground-color: #F0F4F8;\r\n\t\t\tborder-color: gray;\r\n\t\t\tborder-bottom-color: #F0F4F8;\r\n\t\t}\r\n\r\n\t\t.active {\r\n\t\t\tdisplay: block;\r\n\t\t}\r\n\r\n\t\tinput,\r\n\t\ttextarea,\r\n\t\tselect,\r\n\t\t.uneditable-input {\r\n\t\t\tcolor: #606060;\r\n\t\t}\r\n\r\n\t\t.imagePicker {\r\n\t\t\t-moz-box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);\r\n\t\t\t-webkit-box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);\r\n\t\t\tbox-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);\r\n\t\t\tborder: 1px solid #CCC;\r\n\t\t\theight: 110px;\r\n\t\t\toverflow: auto;\r\n\t\t\t-webkit-border-radius: 3px;\r\n\t\t\t-moz-border-radius: 3px;\r\n\t\t\tborder-radius: 3px;\r\n\t\t\tmargin-left: 0;\r\n\t\t}\r\n\r\n\t\t.imagePicker img {\r\n\t\t\tmargin: 5px;\r\n\t\t\tborder: 2px solid transparent;\r\n\t\t}\r\n\r\n\t\t.imagePicker .current {\r\n\t\t\tborder: 2px dotted #555;\r\n\t\t}\r\n\r\n\t\tlabel {\r\n\t\t\tfont-weight: bold;\r\n\t\t}\r\n\r\n\t\t.form-actions label {\r\n\t\t\tfloat: left;\r\n\t\t\tmargin-top: 0.75em;\r\n\t\t}\r\n\r\n\t\tfieldset input,\r\n\t\tfieldset textarea {\r\n\t\t\twidth: 90%;\r\n\t\t\tborder-color: gray;\r\n\t\t}\r\n\r\n\t\t@media all and (max-width: 550px) {\r\n\t\t\t.modal {\r\n\t\t\t\twidth: 95%;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t#help {\r\n\t\t\tposition: absolute;\r\n\t\t\tborder: 0;\r\n\t\t\tright: 4px;\r\n\t\t\ttop: 5px;\r\n\t\t\ttext-indent: -9999px;\r\n\t\t\tcolor: transparent;\r\n\t\t\theight: 16px;\r\n\t\t\twidth: 16px;\r\n\t\t\tbackground: none;\r\n\t\t\tbackground-image: url(/bags/common/tiddlers/help.png);\r\n\t\t\tbackground-repeat: no-repeat;\r\n\t\t\tbackground-color: white;\r\n\t\t\tz-index: 2;\r\n\t\t\tborder-radius: 10px;\r\n\t\t}\r\n\r\n\t\t#help-info {\r\n\t\t\tpadding: 0;\r\n\t\t\tborder: 1px solid gray;\r\n\t\t\twidth: 60%;\r\n\t\t\theight: 50px;\r\n\t\t\tcolor: #404040;\r\n\t\t\tbackground-color: white;\r\n\t\t\tposition: absolute;\r\n\t\t\ttop: 5px;\r\n\t\t\tright: 5px;\r\n\t\t\tz-index: 1;\r\n\t\t\tcursor: auto;\r\n\t\t\tborder-radius: 5px;\r\n\r\n\t\t}\r\n\r\n\t\t#help-info p {\r\n\t\t\tpadding: 10px 25px;\r\n\t\t\tmargin-bottom: 0;\r\n\t\t}\r\n\t&lt;/style&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n\t&lt;div id=\"container\"&gt;\r\n\t\t&lt;form action=\"#\" class=\"modal\"&gt;\r\n\t\t\t&lt;div class=\"modal-header\"&gt;\r\n\t\t\t\t&lt;button id=\"help\"&gt;help&lt;/button&gt;\r\n\t\t\t\t&lt;div id=\"help-info\" style=\"display:none;\"&gt;&lt;p&gt;\r\n\t\t\t\tFound something interesting? Write about it in your own space. &lt;a href=\"//docs.tiddlyspace.com/Reply to this Tiddler\" target=\"_blank\"&gt;Find out more&lt;/a&gt;\r\n\t\t\t\t&lt;/p&gt;&lt;/div&gt;\r\n\t\t\t\t&lt;ul class=\"nav nav-tabs\" data-tabs=\"tabs\"&gt;\r\n\t\t\t\t\t&lt;li class=\"active\" data-tab-name=\"post\"&gt;&lt;a href=\"#postForm\"&gt;Reply&lt;/a&gt;&lt;/li&gt;\r\n\t\t\t\t&lt;/ul&gt;\r\n\t\t\t&lt;/div&gt;\r\n\r\n\r\n\t\t\t&lt;fieldset id=\"postForm\" class=\"modal-body\"&gt;\r\n\t\t\t\t&lt;label&gt;Title\r\n\t\t\t\t\t&lt;input type=\"text\" name=\"title\"&gt;\r\n\t\t\t\t&lt;/label&gt;\r\n\t\t\t\t&lt;input type=\"hidden\" name=\"url\"&gt;\r\n\t\t\t\t&lt;label&gt;Post\r\n\t\t\t\t\t&lt;textarea name=\"text\" rows=\"8\"&gt;&lt;/textarea&gt;\r\n\t\t\t\t&lt;/label&gt;\r\n\t\t\t\t&lt;label&gt;Tags\r\n\t\t\t\t\t&lt;input type=\"text\" name=\"tags\" value=\"\"&gt;\r\n\t\t\t\t&lt;/label&gt;\r\n\t\t\t&lt;/fieldset&gt;\r\n\r\n\r\n\t\t\t&lt;div class=\"form-actions\"&gt;\r\n\t\t\t\t&lt;label class=\"checkbox\"&gt;\r\n\t\t\t\t\t&lt;input type=\"checkbox\" name=\"private\" val=\"private\"&gt;\r\n\t\t\t\t\tkeep private\r\n\t\t\t\t&lt;/label&gt;\r\n\t\t\t\t&lt;input type=\"submit\" class=\"btn primary btn-large\" value=\"Done\"&gt;\r\n\t\t\t\t&lt;input type=\"button\" class=\"btn btn-large closeBtn\" value=\"Cancel\"&gt;\r\n\t\t\t&lt;/div&gt;\r\n\t\t&lt;/form&gt;\r\n\t&lt;/div&gt;\r\n\r\n\t&lt;script type=\"text/javascript\"\r\n            src=\"/bags/common/tiddlers/jquery.js\"&gt;&lt;/script&gt;\r\n\t&lt;script type=\"text/javascript\" src=\"/bags/tiddlyspace/tiddlers/chrjs\"&gt;&lt;/script&gt;\r\n\t&lt;script type=\"text/javascript\" src=\"/bags/common/tiddlers/_reply.js\"&gt;&lt;/script&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;</pre>\r\n</div>\r\n<div title=\"_account\" server.title=\"_account\" server.page.revision=\"1521899\" server.etag=\"&quot;tiddlyspace/_account/1521899:1321dbf06bdd20051d64cc07ce9b5685476123e2&quot;\" modifier=\"None\" creator=\"None\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"text/html\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeMissing excludeSearch\" _hash=\"96201fdb51bfa585c117321c84d64d2fb9a3df71\">\r\n<pre>&lt;!DOCTYPE html&gt;\r\n&lt;html&gt;\r\n&lt;head&gt;\r\n\t&lt;meta http-equiv=\"Content-Type\" content=\"text/html;charset=utf-8\"&gt;\r\n\t&lt;title&gt;Account&lt;/title&gt;\r\n\t&lt;link href=\"/bags/common/tiddlers/profile.css\" type='text/css' rel='stylesheet' &gt;\r\n\t&lt;link href=\"/bags/common/tiddlers/admin.css\" type='text/css' rel='stylesheet' &gt;\r\n\t&lt;link href=\"/bags/common/tiddlers/jquery-ui.custom.css\" type='text/css' rel='stylesheet' &gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n\r\n&lt;div id=\"container\"&gt;\r\n\t&lt;div class=\"main section\"&gt;\r\n\t\t&lt;a class=\"app\" href=\"/\"&gt;home&lt;/a&gt;\r\n\t\t&lt;div class=\"left\"&gt;\r\n\t\t&lt;div id=\"siteiconArea\"&gt;\r\n\t\t&lt;h2&gt;User Icon&lt;/h2&gt;\r\n\t\t&lt;div&gt;\r\n\t\t\t&lt;img id=\"siteicon\" class=\"siteicon\"&gt;\r\n\t\t\t&lt;form id=\"upload\" method=\"POST\" enctype=\"multipart/form-data\"&gt;\r\n\t\t\t\t&lt;input type=\"hidden\" name=\"title\" value=\"SiteIcon\" /&gt;\r\n\t\t\t\t&lt;input type=\"hidden\" name=\"tags\" value=\"excludeLists\"&gt;\r\n\t\t\t\t&lt;input type=\"hidden\" name=\"csrf_token\" class=\"csrf\" /&gt;\r\n\t\t\t\t&lt;input type=\"file\" name=\"file\" accept=\"image/*\" /&gt;\r\n\t\t\t\t&lt;input type=\"submit\" value=\"upload\" /&gt;\r\n\t\t\t&lt;/form&gt;\r\n\t\t\t&lt;div id=\"dropzone\"&gt;Drop file here\r\n\t\t\t\t&lt;img class=\"notloading\" src=\"/bags/common/tiddlers/ajax-loader.gif\" alt=\"submitting SiteIcon\" /&gt;\r\n\t\t\t&lt;/div&gt;\r\n\t\t&lt;/div&gt;\r\n\t\t&lt;/div&gt;\r\n\t\t&lt;h2&gt;Find Space&lt;/h2&gt;\r\n\t\t&lt;form class=\"spaceSearch\"&gt;\r\n\t\t\t&lt;input class=\"inputBox\" type=\"text\" placeholder=\"find space\" /&gt;\r\n\t\t\t&lt;a href=\"http://docs.tiddlyspace.com/What%20is%20a%20Space%3F\" class=\"help\"\r\n\t\t\t\ttitle=\"What is a space?\"&gt;What is a space?&lt;/a&gt;\r\n\t\t\t&lt;button&gt;view all&lt;/button&gt;\r\n\t\t&lt;/form&gt;\r\n\t\t&lt;div class='list-container'&gt;\r\n\t\t\tYou are a member of the following spaces:\r\n\t\t\t&lt;ul class='ts-space-search'&gt;\r\n\t\t\t&lt;/ul&gt;\r\n\t\t&lt;/div&gt;\r\n\t\t&lt;h2&gt;Create New Space&lt;/h2&gt;\r\n\t\t&lt;form class=\"ts-spaces\"&gt;\r\n\t\t\t&lt;input class=\"inputBox\" type=\"text\" name=\"spacename\" placeholder=\"space name\"&gt;&lt;span class=\"hostSuffix\"&gt;.tiddlyspace.com&lt;/span&gt;\r\n\t\t\t&lt;input type=\"submit\" value=\"Create Space\" /&gt;\r\n\t\t&lt;/form&gt;\r\n\t\t&lt;/div&gt;\r\n\t\t&lt;div class=\"right\"&gt;\r\n\t\t&lt;h2&gt;Change Password&lt;/h2&gt;\r\n\t\t&lt;form class=\"ts-password\"&gt;\r\n\t\t\t&lt;input class=\"inputBox\" placeholder=\"existing password\" type=\"password\" name=\"password\"&gt;\r\n\t\t\t&lt;input class=\"inputBox\" placeholder=\"new password\" type=\"password\" name=\"new_password\"&gt;\r\n\t\t\t&lt;input class=\"inputBox\" placeholder=\"new password\"\ttype=\"password\" name=\"new_password_confirm\"&gt;\r\n\t\t\t&lt;input type=\"submit\" value=\"Change password\"&gt;\r\n\t\t&lt;/form&gt;\r\n\t\t&lt;h2&gt;OpenID&lt;/h2&gt;\r\n\t\t&lt;h3&gt;Why OpenID?&lt;/h3&gt;\r\n\t\t&lt;a href=\"http://openid.net/\"&gt;&lt;img src=\"/bags/common/tiddlers/openid.png\" alt=\"openid\" &gt;&lt;/a&gt;&lt;br /&gt;\r\n\t\tUse just one username and password across hundreds of OpenID-enabled sites.&lt;br /&gt;\r\n\t\tIt's an open standard.&lt;br /&gt;\r\n\t\t&lt;a href=\"http://openid.net/what/\"&gt;learn more&lt;/a&gt;\r\n\t\t&lt;ul class=\"ts-identities\"&gt;&lt;/ul&gt;\r\n\t\t&lt;form class=\"ts-openid\" target=\"_top\"&gt;\r\n\t\t\t&lt;div&gt;\r\n\t\t\t\tAdd an openid:\r\n\t\t\t&lt;/div&gt;\r\n\t\t\t&lt;input class=\"inputBox\" type=\"text\" name=\"openid\" placeholder=\"your openid\" /&gt;\r\n\t\t\t&lt;input type=\"submit\" value=\"Register\" /&gt;\r\n\t\t\t&lt;a href=\"http://openid.net/get-an-openid/\" class=\"help\"\r\n\t\t\ttitle=\"What is an open id?\"&gt;What is an open id?&lt;/a&gt;\r\n\t\t&lt;/form&gt;\r\n\t\t&lt;/div&gt;\r\n\t\t&lt;div class=\"clear\"&gt;&lt;/div&gt;\r\n\t&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;script src=\"/bags/common/tiddlers/backstage.js\"&gt;&lt;/script&gt;\r\n&lt;script src='/bags/common/tiddlers/jquery.js'&gt;&lt;/script&gt;\r\n&lt;script src='/bags/tiddlyspace/tiddlers/chrjs'&gt;&lt;/script&gt;\r\n&lt;script src='/bags/common/tiddlers/chrjs.space'&gt;&lt;/script&gt;\r\n&lt;script src='/bags/common/tiddlers/chrjs.users'&gt;&lt;/script&gt;\r\n&lt;script src='/bags/common/tiddlers/chrjs.identities'&gt;&lt;/script&gt;\r\n&lt;script src=\"/bags/common/tiddlers/jquery-ui.custom.js\"&gt;&lt;/script&gt;\r\n&lt;script src='/bags/common/tiddlers/jquery-form.js'&gt;&lt;/script&gt;\r\n&lt;script src=\"/bags/common/tiddlers/siteiconupload.js\"&gt;&lt;/script&gt;\r\n&lt;script src='/bags/common/tiddlers/ts.js'&gt;&lt;/script&gt;\r\n&lt;script src=\"/status.js\"&gt;&lt;/script&gt;\r\n&lt;script type=\"text/javascript\"&gt;\r\n/*\r\n * jQuery UI Autocomplete HTML Extension\r\n *\r\n * Copyright 2010, Scott González (http://scottgonzalez.com)\r\n * Dual licensed under the MIT or GPL Version 2 licenses.\r\n *\r\n * http://github.com/scottgonzalez/jquery-ui-extensions\r\n */\r\n(function( $ ) {\r\n\r\nvar proto = $.ui.autocomplete.prototype,\r\n\tinitSource = proto._initSource;\r\n\r\nfunction filter( array, term ) {\r\n\tvar matcher = new RegExp( $.ui.autocomplete.escapeRegex(term), \"i\" );\r\n\treturn $.grep( array, function(value) {\r\n\t\treturn matcher.test( $( \"&lt;div&gt;\" ).html( value.label || value.value || value ).text() );\r\n\t});\r\n}\r\n\r\n$.extend( proto, {\r\n\t_initSource: function() {\r\n\t\tif ( this.options.html &amp;&amp; $.isArray(this.options.source) ) {\r\n\t\t\tthis.source = function( request, response ) {\r\n\t\t\t\tresponse( filter( this.options.source, request.term ) );\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tinitSource.call( this );\r\n\t\t}\r\n\t},\r\n\r\n\t_renderItem: function( ul, item) {\r\n\t\treturn $( \"&lt;li&gt;&lt;/li&gt;\" )\r\n\t\t\t.data( \"item.autocomplete\", item )\r\n\t\t\t.append( $( \"&lt;a&gt;&lt;/a&gt;\" )[ this.options.html ? \"html\" : \"text\" ]( item.label ) )\r\n\t\t\t.appendTo( ul );\r\n\t}\r\n});\r\n\r\n})( jQuery );\r\n\r\n/***\r\n_accounts application specific javascript\r\n***/\r\nvar link;\r\nts.init(function(ts) {\r\n\tif(ts.user.anon) { // redirect to homepage when user not logged in\r\n\t\twindow.location = ts.getHost();\r\n\t} else if(ts.user.name === ts.currentSpace){\r\n\t\tinitSiteIconUpload(ts.user.name);\r\n\t} else {\r\n\t\tlink = $(\"&lt;a /&gt;\").attr(\"href\", ts.getHost(ts.user.name) + \"/_account\").text(\"Change User Icon\");\r\n\t\t$(\"#siteiconArea div\").empty().append(link);\r\n\t}\r\n\t$(\".hostSuffix\").text(\".\" + ts.getHost(\"\").split(\"//\")[1]);\r\n\tts.getSpaces(function(spaces) {\r\n\t\t$(\"&lt;div class='info' /&gt;\").text(\"You have \" + spaces.length + \" spaces.\").insertBefore($(\".spaceSearch\")[0]);\r\n\t\t$(\"form.spaceSearch input\").autocomplete({\r\n\t\t\thtml: true,\r\n\t\t\tsource: function(req, response) {\r\n\t\t\t\tts.getSpaces(function(spaces) {\r\n\t\t\t\t\tvar selected = [];\r\n\t\t\t\t\tfor(var i = 0; i &lt; spaces.length; i++) {\r\n\t\t\t\t\t\tvar space = spaces[i];\r\n\t\t\t\t\t\tif(space.name.indexOf(req.term) &gt; -1) {\r\n\t\t\t\t\t\t\tvar host = ts.getHost(space.name) ;\r\n\t\t\t\t\t\t\tvar img = host + \"/SiteIcon\";\r\n\t\t\t\t\t\t\tselected.push({\r\n\t\t\t\t\t\t\t\tvalue: space.name,\r\n\t\t\t\t\t\t\t\tlabel: '&lt;a href=\"' + host + '\" target=\"_parent\" class=\"autocompleteLink\"&gt;&lt;img src=\"' + img + '\" style=\"height:24px;width:auto;max-height:24px;max-width:24px;\"/&gt;' + space.name + '&lt;/a&gt;'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresponse(selected);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tselect: function(event, ui) {\r\n\t\t\t\twindow.top.location = ts.getHost(ui.item.value);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar $ul = $('.ts-space-search');\r\n\t\t$.each(spaces, function(i, space) {\r\n\t\t\t$ul.append($('&lt;li/&gt;').html($('&lt;a/&gt;').attr('href', space.uri)\r\n\t\t\t\t.text(space.name)));\r\n\t\t});\r\n\r\n\t\t$('form.spaceSearch button').click(function(ev) {\r\n\t\t\t$('.list-container').slideToggle('fast');\r\n\t\t\tev.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\t});\r\n});\r\n\r\nif(window != window.top) {\r\n\t$(\"html\").addClass(\"iframeMode\");\r\n\t$(\"a\").live(\"click\",function(ev) {\r\n\t\t$(ev.target).attr(\"target\", \"_parent\");\r\n\t});\r\n}\r\n&lt;/script&gt;\r\n&lt;!--[if lt IE 8]&gt;\r\n&lt;script type=\"text/javascript\" src=\"/bags/common/tiddlers/json2.js\"&gt;&lt;/script&gt;\r\n&lt;![endif]--&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;</pre>\r\n</div>\r\n<div title=\"迪伦的荒原世界\" server.title=\"迪伦的荒原世界\" server.page.revision=\"2564804\" server.etag=\"&quot;pearl_public/%E8%BF%AA%E4%BC%A6%E7%9A%84%E8%8D%92%E5%8E%9F%E4%B8%96%E7%95%8C/2564804:e7660a5c8a7d7907066ca9a0e3103ca0d3b92582&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160925051453\" created=\"20160925040615\" tags=\"首页\" _hash=\"a8702ca4226a4d69c592d0271bfd8f0d3296cc20\">\r\n<pre>&lt;html&gt;\r\n&lt;head&gt;\r\n      &lt;title&gt;第一个HTML代码&lt;/title&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n&lt;div align=\"center\"&gt;\r\n&lt;img src=\"http://zw.shangxueba.com/uploadfile/20150901/201509011346492814.jpg\" hight=\"500\" width=\"500\" &gt;&lt;br/&gt;\r\n&lt;a href=\"http:www.Baidu.com\"&gt;百度&lt;/a&gt;\r\n&lt;hr width=\"800\" color=\"pink\" size\"10\"/&gt;\r\n      &lt;h2&gt;&lt;font color=\"purple\" face=\"楷体\" size\"20\"&gt;如果我真的存在，也是因为你需要我。 &lt;br/&gt;\r\n      &lt;h2&gt;I exist because you need me.&lt;/font&gt;&lt;br/&gt;\r\n&lt;/div&gt;\r\n&lt;hr width=\"800\" color=\"pink\" size\"10\"/&gt;\r\n\r\n&lt;/body&gt;\r\n&lt;/html&gt;\r\n\r\n</pre>\r\n</div>\r\n<div title=\"SpaceSettings\" server.title=\"SpaceSettings\" server.page.revision=\"1521882\" server.etag=\"&quot;system-info_public/SpaceSettings/1521882:5e16fc7f81c41fea9894bfb69b5776c9c915a181&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-info_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-info_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeMissing excludeSearch\" _hash=\"59d90cba2585970233eb03744888f06cec46918d\">\r\n<pre>!Upload an icon\r\n&lt;&lt;tiddler spaceIcon&gt;&gt;\r\n!Describe your space\r\nIf you haven't already done so, you should provide a brief decscription of yourself and what you're using this space for. To do this, just edit the [[SiteInfo]] tiddler (keeping the title the same of course).\r\n\r\n!Change the title\r\n&lt;&lt;tiddler spaceTitle&gt;&gt;\r\n!Change the theme\r\n&lt;&lt;tiddler colorScheme&gt;&gt;\r\n!Change the menu\r\nIf you'd like to change the menu items along the top, you can edit the [[MainMenu]] tiddler.\r\n\r\n!Change the default tiddlers\r\n&lt;&lt;tiddler setDefaultTiddlers&gt;&gt;\r\n!More Advanced customisations\r\nIf you know HTML and CSS, you can edit some or all of the following tiddlers to customise your space further:\r\n* PageTemplate\r\n* EditTemplate\r\n* ViewTemplate\r\n* StyleSheet</pre>\r\n</div>\r\n<div title=\"TiddlySpaceConfig\" server.title=\"TiddlySpaceConfig\" server.page.revision=\"1521905\" server.etag=\"&quot;tiddlyspace/TiddlySpaceConfig/1521905:a5936073548901366083bd0d772dcdf0de916760&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"e74aa09eb3a15ff6e90b7de81e4d23168f8a51db\">\r\n<pre>/***\r\n|''Name''|TiddlySpaceConfig|\r\n|''Version''|0.7.7|\r\n|''Description''|TiddlySpace configuration|\r\n|''Status''|stable|\r\n|''Source''|http://github.com/TiddlySpace/tiddlyspace/raw/master/src/plugins/TiddlySpaceConfig.js|\r\n|''CoreVersion''|2.6.1|\r\n|''Requires''|TiddlyWebConfig ServerSideSavingPlugin TiddlyFileImporter|\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nvar tweb = config.extensions.tiddlyweb;\r\n\r\nvar recipe = config.defaultCustomFields[\"server.workspace\"].split(\"recipes/\")[1];\r\nvar currentSpace; // assigned later\r\n\r\nvar disabledTabs = [];\r\n\r\nvar coreBags = [\"system\", \"tiddlyspace\"];\r\nvar systemSpaces = [\"plugins\", \"info\", \"images\", \"theme\"];\r\nsystemSpaces = $.map(systemSpaces, function(item, i) {\r\n\treturn \"system-%0_public\".format(item);\r\n});\r\n\r\n// hijack search macro to add custom attributes for mobile devices\r\nvar _search = config.macros.search.handler;\r\nconfig.macros.search.handler = function(place, macroName, params) {\r\n\t_search.apply(this, arguments);\r\n\t$(\".searchField:input\", place).\r\n\t\tattr({ autocapitalize: \"off\", autocorrect: \"off\" });\r\n};\r\n\r\n// arg is either a container name or a tiddler object\r\n// if fuzzy is truthy, space may be inferred from workspace (for new tiddlers)\r\n// returns space object or false\r\nvar determineSpace = function(arg, fuzzy) {\r\n\tif(typeof arg == \"string\") { // container name\r\n\t\tvar space = split(arg, \"_\", \"r\");\r\n\t\treturn [\"public\", \"private\"].contains(space.type) ? space : false;\r\n\t} else if(arg) { // tiddler\r\n\t\tvar container = determineContainer(arg, fuzzy);\r\n\t\treturn container ? determineSpace(container.name, fuzzy) : false;\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n};\r\n\r\n// if fuzzy is truthy, container may be inferred from workspace for new tiddlers\r\n// returns container object or false\r\nvar determineContainer = function(tiddler, fuzzy) { // TODO: expose?\r\n\tvar bag = tiddler.fields[\"server.bag\"];\r\n\tvar recipe = tiddler.fields[\"server.recipe\"]; // XXX: unused/irrelevant/redundant!?\r\n\tif(bag) {\r\n\t\treturn { type: \"bag\", name: bag };\r\n\t} else if(recipe) {\r\n\t\treturn { type: \"recipe\", name: recipe };\r\n\t} else if(fuzzy) { // new tiddler\r\n\t\tvar workspace = tiddler.fields[\"server.workspace\"];\r\n\t\tif(workspace) {\r\n\t\t\tvar container = split(workspace, \"/\", \"l\");\r\n\t\t\treturn [\"bags\", \"recipes\"].contains(container.type) ? container : false;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n};\r\n\r\n// hijack removeTiddlerCallback to restore tiddler from recipe cascade -- TODO: move into TiddlyWebWiki?\r\nvar sssp = config.extensions.ServerSideSavingPlugin;\r\nvar _removeTiddlerCallback = sssp.removeTiddlerCallback;\r\nsssp.removeTiddlerCallback = function(context, userParams) {\r\n\tvar title = context.tiddler.title;\r\n\tvar recipe = context.tiddler.fields[\"server.recipe\"];\r\n\t_removeTiddlerCallback.apply(this, arguments);\r\n\tif(recipe) {\r\n\t\tcontext.workspace = \"recipes/\" + recipe;\r\n\t\tvar callback = function(context, userParams) {\r\n\t\t\tif(context.status) {\r\n\t\t\t\tvar dirty = store.isDirty();\r\n\t\t\t\tstore.saveTiddler(context.tiddler).clearChangeCount();\r\n\t\t\t\tstore.setDirty(dirty);\r\n\t\t\t} else {\r\n\t\t\t\tstore.notify(title, true);\r\n\t\t\t}\r\n\t\t};\r\n\t\tcontext.adaptor.getTiddler(title, context, null, callback);\r\n\t}\r\n};\r\n\r\n// splits a string once using delimiter\r\n// mode \"l\" splits at the first, \"r\" at the last occurrence\r\n// returns an object with members type and name\r\nvar split = function(str, sep, mode) {\r\n\tmode = mode == \"r\" ? \"pop\" : \"shift\"; // TODO: use +/-1 instead of \"l\"/\"r\"?\r\n\tvar arr = str.split(sep);\r\n\tvar type = arr.length &gt; 1 ? arr[mode]() : null;\r\n\treturn { type: type, name: arr.join(sep) };\r\n};\r\n\r\nvar plugin = config.extensions.tiddlyspace = {\r\n\tcurrentSpace: determineSpace(recipe),\r\n\tcoreBags: coreBags.concat(systemSpaces),\r\n\r\n\tdetermineSpace: determineSpace,\r\n\tisValidSpaceName: function(name) {\r\n\t\treturn name.match(/^[a-z][0-9a-z\\-]*[0-9a-z]$/) ? true : false;\r\n\t},\r\n\tgetCurrentBag: function(type) {\r\n\t\treturn \"%0_%1\".format(currentSpace, type);\r\n\t},\r\n\tgetCurrentWorkspace: function(type) {\r\n\t\treturn \"bags/\" + this.getCurrentBag(type);\r\n\t},\r\n\t// returns the URL for a space's avatar (SiteIcon) based on a server_host\r\n\t// object and an optional space name\r\n\t// optional nocors argument prevents cross-domain URLs from being generated\r\n\tgetAvatar: function(host, space, nocors) {\r\n\t\tif(space &amp;&amp; typeof space != \"string\") { // backwards compatibility -- XXX: deprecated\r\n\t\t\tspace = space.name;\r\n\t\t}\r\n\t\tvar subdomain = nocors ? currentSpace : space;\r\n\t\thost = host ? this.getHost(host, subdomain) : \"\";\r\n\t\tvar bag = space ? \"%0_public\".format(space) : \"tiddlyspace\";\r\n\t\treturn \"%0/bags/%1/tiddlers/SiteIcon\".format(host, bag);\r\n\t},\r\n\t// returns the URL based on a server_host object (scheme, host, port) and an\r\n\t// optional subdomain\r\n\tgetHost: function(host, subdomain) {\r\n\t\tif(host === undefined) { // offline\r\n\t\t\ttweb.status.server_host = {}; // prevents exceptions further down the stack -- XXX: hacky workaround, breaks encapsulation\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tsubdomain = subdomain ? subdomain + \".\" : \"\";\r\n\t\tvar url = \"%0://%1%2\".format(host.scheme, subdomain, host.host);\r\n\t\tvar port = host.port;\r\n\t\tif(port &amp;&amp; ![\"80\", \"443\"].contains(port)) {\r\n\t\t\turl += \":\" + port;\r\n\t\t}\r\n\t\treturn url;\r\n\t},\r\n\tdisableTab: function(tabTiddler) {\r\n\t\tif(typeof(tabTiddler) == \"string\") {\r\n\t\t\tdisabledTabs.push(tabTiddler);\r\n\t\t} else {\r\n\t\t\tfor(var i = 0; i &lt; tabTiddler.length; i++) {\r\n\t\t\t\tplugin.disableTab(tabTiddler[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n    checkSyncStatus: function(tiddler) {\r\n\t\tif(tiddler) {\r\n\t\t\tvar title = typeof(tiddler) === \"string\" ? tiddler : tiddler.title;\r\n\t\t\tvar el = story.getTiddler(title) || false;\r\n\t\t\tif(el) {\r\n\t\t\t\trefreshElements(el);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tisDisabledTab: function(tabTitle) {\r\n\t\tvar match = new RegExp(\"(?:\\\\[\\\\[([^\\\\]]+)\\\\]\\\\])\", \"mg\").exec(tabTitle);\r\n\t\tvar tabIdentifier = match ? match[1] : tabTitle;\r\n\t\treturn disabledTabs.contains(tabIdentifier);\r\n\t},\r\n\tgetCSRFToken: window.getCSRFToken || null // this may not have been processed yet\r\n};\r\n\r\ncurrentSpace = plugin.currentSpace.name;\r\n\r\ntweb.serverPrefix = tweb.host.split(\"/\")[3] || \"\"; // XXX: assumes root handler\r\ntweb.getStatus(function(status) {\r\n\tvar url = plugin.getHost(status.server_host);\r\n\ttweb.status.server_host.url = url;\r\n\tconfig.messages.tsVersion = status.version;\r\n});\r\n\r\nif(window.location.protocol == \"file:\") {\r\n\t// enable AutoSave by default\r\n\tconfig.options.chkAutoSave = config.options.chkAutoSave === undefined ?\r\n\t\ttrue : config.options.chkAutoSave;\r\n} else {\r\n\t// set global read-only mode based on membership heuristics\r\n\tvar indicator = store.getTiddler(\"SiteTitle\") || tiddler;\r\n\treadOnly = !(recipe.split(\"_\").pop() == \"private\" ||\r\n\t\ttweb.hasPermission(\"write\", indicator));\r\n\t// replace TiddlyWiki's ImportTiddlers due to cross-domain restrictions\r\n\tif(config.macros.fileImport) {\r\n\t\t$.extend(config.macros.importTiddlers, config.macros.fileImport);\r\n\t}\r\n}\r\n\r\n// hijack saveChanges to ensure SystemSettings is private by default\r\nvar _saveChanges = saveChanges;\r\nsaveChanges = function(onlyIfDirty, tiddlers) {\r\n\tif(tiddlers &amp;&amp; tiddlers.length == 1 &amp;&amp;\r\n\t\t\ttiddlers[0] &amp;&amp; tiddlers[0].title == \"SystemSettings\") {\r\n\t\tvar fields = tiddlers[0].fields;\r\n\t\tdelete fields[\"server.recipe\"];\r\n\t\tfields[\"server.bag\"] = plugin.getCurrentBag(\"private\");\r\n\t\tfields[\"server.workspace\"] = plugin.getCurrentWorkspace(\"private\");\r\n\t}\r\n\treturn _saveChanges.apply(this, arguments);\r\n};\r\n\r\n// ensure backstage is always initialized\r\n// required to circumvent TiddlyWiki's read-only based handling\r\nconfig.macros.backstageInit = {\r\n\tinit: function() {\r\n\t\tshowBackstage = true;\r\n\t}\r\n};\r\n\r\n// disable evaluated macro parameters for security reasons\r\nconfig.evaluateMacroParameters = \"none\";\r\nvar _parseParams = String.prototype.parseParams;\r\nString.prototype.parseParams = function(defaultName, defaultValue, allowEval,\r\n\t\tnoNames, cascadeDefaults) {\r\n\tif(config.evaluateMacroParameters == \"none\") {\r\n\t\targuments[2] = false;\r\n\t}\r\n\treturn _parseParams.apply(this, arguments);\r\n};\r\n\r\nvar _tabsMacro = config.macros.tabs.handler;\r\nconfig.macros.tabs.handler = function(place, macroName, params) {\r\n\tvar newParams = [params[0]]; // keep cookie name\r\n\tfor(var i = 1; i &lt; params.length; i += 3) {\r\n\t\tvar tabTitle = params[i + 2];\r\n\t\tif(!plugin.isDisabledTab(tabTitle)){\r\n\t\t\tnewParams = newParams.concat(params[i], params[i + 1], tabTitle);\r\n\t\t}\r\n\t}\r\n\t_tabsMacro.apply(this, [place, macroName, newParams]);\r\n};\r\n\r\n// disable ControlView for XHRs by default\r\n$.ajaxSetup({\r\n\tbeforeSend: function(xhr) {\r\n\t\txhr.setRequestHeader(\"X-ControlView\", \"false\");\r\n\t}\r\n});\r\n// TiddlyWeb adaptor currently still uses httpReq, which needs extra magic -- XXX: obsolete this!\r\nvar _httpReq = httpReq;\r\nhttpReq = function(type, url, callback, params, headers, data, contentType,\r\n\t\tusername, password, allowCache) {\r\n\theaders = headers || {};\r\n\theaders[\"X-ControlView\"] = \"false\";\r\n\t_httpReq.apply(this, arguments);\r\n};\r\n\r\n// register style sheet for backstage separately (important)\r\nstore.addNotification(\"StyleSheetBackstage\", refreshStyles);\r\n\r\n// option for default privacy setting\r\nconfig.optionsDesc.chkPrivateMode = \"Set your default privacy mode to private\";\r\nconfig.optionsSource.chkPrivateMode = \"setting\";\r\nconfig.options.chkPrivateMode = config.options.chkPrivateMode || false;\r\nsaveSystemSetting(\"chkPrivateMode\", true);\r\nconfig.defaultCustomFields[\"server.workspace\"] = plugin.\r\n\tgetCurrentWorkspace(config.options.chkPrivateMode ? \"private\" : \"public\");\r\n\r\nconfig.paramifiers.follow = {\r\n\tonstart: function(v) {\r\n\t\tif(!readOnly) {\r\n\t\t\tvar bag = \"%0_public\".format(currentSpace);\r\n\t\t\tstory.displayTiddler(null, v, DEFAULT_EDIT_TEMPLATE, null, null,\r\n\t\t\t\t\"server.bag:%0 server.workspace:bags/%0\".format(bag));\r\n\t\t\tstory.setTiddlerTag(v, \"follow\", 1);\r\n\t\t\tstory.focusTiddler(v, \"text\");\r\n\t\t}\r\n\t}\r\n};\r\n\r\nvar fImport = config.macros.fileImport;\r\nif(fImport) {\r\n\tfImport.uploadTo = \"Upload to: \";\r\n\tvar _createForm = config.macros.fileImport.createForm;\r\n\tconfig.macros.fileImport.createForm = function(place, wizard, iframeName) {\r\n\t\tvar container = $(\"&lt;div /&gt;\").text(fImport.uploadTo).appendTo(place);\r\n\t\tvar select = $('&lt;select name=\"mode\" /&gt;').appendTo(container)[0];\r\n\t\t$('&lt;option value=\"private\" selected&gt;private&lt;/a&gt;').appendTo(select);\r\n\t\t$('&lt;option value=\"public\"&gt;public&lt;/a&gt;').appendTo(select);\r\n\t\twizard.setValue(\"importmode\", select);\r\n\t\t_createForm.apply(this, [place, wizard, iframeName]);\r\n\t};\r\n\r\n\tvar _onGet = config.macros.importTiddlers.onGetTiddler;\r\n\tconfig.macros.importTiddlers.onGetTiddler = function(context, wizard) {\r\n\t\tvar type = $(wizard.getValue(\"importmode\")).val();\r\n\t\tvar ws =  plugin.getCurrentWorkspace(type);\r\n\t\twizard.setValue(\"workspace\", ws);\r\n\t\t_onGet.apply(this, [context, wizard]);\r\n\t};\r\n}\r\n\r\nconfig.extensions.ServerSideSavingPlugin.reportSuccess = function(msg, tiddler) {\r\n\tplugin.checkSyncStatus(tiddler);\r\n\tmsg = config.extensions.ServerSideSavingPlugin.locale[msg];\r\n\tvar link = \"/\" + encodeURIComponent(tiddler.title);\r\n\tdisplayMessage(msg.format([tiddler.title]), link);\r\n};\r\n\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"TiddlyWebAdaptor\" server.title=\"TiddlyWebAdaptor\" server.page.revision=\"1521858\" server.etag=\"&quot;system/TiddlyWebAdaptor/1521858:ce2dfb64d87e3eb7e680263a01452e039b0c41f2&quot;\" modifier=\"FND\" creator=\"FND\" server.workspace=\"bags/system\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"200811260000\" created=\"200811260000\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"487ec1465c11e0798c029b3ed15a2f71ae51ce92\">\r\n<pre>/***\r\n|''Name''|TiddlyWebAdaptor|\r\n|''Description''|adaptor for interacting with TiddlyWeb|\r\n|''Author:''|FND|\r\n|''Contributors''|Chris Dent, Martin Budden|\r\n|''Version''|1.4.10|\r\n|''Status''|stable|\r\n|''Source''|http://svn.tiddlywiki.org/Trunk/association/adaptors/TiddlyWebAdaptor.js|\r\n|''CodeRepository''|http://svn.tiddlywiki.org/Trunk/association/|\r\n|''License''|[[BSD|http://www.opensource.org/licenses/bsd-license.php]]|\r\n|''CoreVersion''|2.5|\r\n|''Keywords''|serverSide TiddlyWeb|\r\n!Notes\r\nThis plugin includes [[jQuery JSON|http://code.google.com/p/jquery-json/]].\r\n!To Do\r\n* createWorkspace\r\n* document custom/optional context attributes (e.g. filters, query, revision) and tiddler fields (e.g. server.title, origin)\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nvar adaptor = config.adaptors.tiddlyweb = function() {};\r\n\r\nadaptor.prototype = new AdaptorBase();\r\nadaptor.serverType = \"tiddlyweb\";\r\nadaptor.serverLabel = \"TiddlyWeb\";\r\nadaptor.mimeType = \"application/json\";\r\n\r\nadaptor.parsingErrorMessage = \"Error parsing result from server\";\r\nadaptor.noBagErrorMessage = \"no bag specified for tiddler\";\r\nadaptor.locationIDErrorMessage = \"no bag or recipe specified for tiddler\"; // TODO: rename\r\n\r\n// retrieve current status (requires TiddlyWeb status plugin)\r\nadaptor.prototype.getStatus = function(context, userParams, callback) {\r\n\tcontext = this.setContext(context, userParams, callback);\r\n\tvar uriTemplate = \"%0/status\";\r\n\tvar uri = uriTemplate.format([context.host]);\r\n\tvar req = httpReq(\"GET\", uri, adaptor.getStatusCallback, context,\r\n\t\tnull, null, null, null, null, true);\r\n\treturn typeof req == \"string\" ? req : true;\r\n};\r\n\r\nadaptor.getStatusCallback = function(status, context, responseText, uri, xhr) {\r\n\tcontext.status = responseText ? status : false;\r\n\ttry {\r\n\t\tcontext.statusText = xhr.statusText;\r\n\t} catch(exc) { // offline (Firefox)\r\n\t\tcontext.status = false;\r\n\t\tcontext.statusText = null;\r\n\t}\r\n\tcontext.httpStatus = xhr.status;\r\n\tif(context.status) {\r\n\t\tcontext.serverStatus = $.evalJSON(responseText); // XXX: error handling!?\r\n\t}\r\n\tif(context.callback) {\r\n\t\tcontext.callback(context, context.userParams);\r\n\t}\r\n};\r\n\r\n// retrieve a list of workspaces\r\nadaptor.prototype.getWorkspaceList = function(context, userParams, callback) {\r\n\tcontext = this.setContext(context, userParams, callback);\r\n\tcontext.workspaces = [];\r\n\tvar uriTemplate = \"%0/recipes\"; // XXX: bags?\r\n\tvar uri = uriTemplate.format([context.host]);\r\n\tvar req = httpReq(\"GET\", uri, adaptor.getWorkspaceListCallback,\r\n\t\tcontext, { accept: adaptor.mimeType }, null, null, null, null, true);\r\n\treturn typeof req == \"string\" ? req : true;\r\n};\r\n\r\nadaptor.getWorkspaceListCallback = function(status, context, responseText, uri, xhr) {\r\n\tcontext.status = status;\r\n\tcontext.statusText = xhr.statusText;\r\n\tcontext.httpStatus = xhr.status;\r\n\tif(status) {\r\n\t\ttry {\r\n\t\t\tvar workspaces = $.evalJSON(responseText);\r\n\t\t} catch(ex) {\r\n\t\t\tcontext.status = false; // XXX: correct?\r\n\t\t\tcontext.statusText = exceptionText(ex, adaptor.parsingErrorMessage);\r\n\t\t\tif(context.callback) {\r\n\t\t\t\tcontext.callback(context, context.userParams);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcontext.workspaces = workspaces.map(function(itm) { return { title: itm }; });\r\n\t}\r\n\tif(context.callback) {\r\n\t\tcontext.callback(context, context.userParams);\r\n\t}\r\n};\r\n\r\n// retrieve a list of tiddlers\r\nadaptor.prototype.getTiddlerList = function(context, userParams, callback) {\r\n\tcontext = this.setContext(context, userParams, callback);\r\n\tvar uriTemplate = \"%0/%1/%2/tiddlers%3\";\r\n\tvar params = context.filters ? \"?\" + context.filters : \"\";\r\n\tif(context.format) {\r\n\t\tparams = context.format + params;\r\n\t}\r\n\tvar workspace = adaptor.resolveWorkspace(context.workspace);\r\n\tvar uri = uriTemplate.format([context.host, workspace.type + \"s\",\r\n\t\tadaptor.normalizeTitle(workspace.name), params]);\r\n\tvar req = httpReq(\"GET\", uri, adaptor.getTiddlerListCallback,\r\n\t\tcontext, merge({ accept: adaptor.mimeType }, context.headers), null, null, null, null, true);\r\n\treturn typeof req == \"string\" ? req : true;\r\n};\r\n\r\nadaptor.getTiddlerListCallback = function(status, context, responseText, uri, xhr) {\r\n\tcontext.status = status;\r\n\tcontext.statusText = xhr.statusText;\r\n\tcontext.httpStatus = xhr.status;\r\n\tif(status) {\r\n\t\tcontext.tiddlers = [];\r\n\t\ttry {\r\n\t\t\tvar tiddlers = $.evalJSON(responseText); //# NB: not actual tiddler instances\r\n\t\t} catch(ex) {\r\n\t\t\tcontext.status = false; // XXX: correct?\r\n\t\t\tcontext.statusText = exceptionText(ex, adaptor.parsingErrorMessage);\r\n\t\t\tif(context.callback) {\r\n\t\t\t\tcontext.callback(context, context.userParams);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor(var i = 0; i &lt; tiddlers.length; i++) {\r\n\t\t\tvar tiddler = adaptor.toTiddler(tiddlers[i], context.host);\r\n\t\t\tcontext.tiddlers.push(tiddler);\r\n\t\t}\r\n\t}\r\n\tif(context.callback) {\r\n\t\tcontext.callback(context, context.userParams);\r\n\t}\r\n};\r\n\r\n// perform global search\r\nadaptor.prototype.getSearchResults = function(context, userParams, callback) {\r\n\tcontext = this.setContext(context, userParams, callback);\r\n\tvar uriTemplate = \"%0/search?q=%1%2\";\r\n\tvar filterString = context.filters ? \";\" + context.filters : \"\";\r\n\tvar uri = uriTemplate.format([context.host, context.query, filterString]); // XXX: parameters need escaping?\r\n\tvar req = httpReq(\"GET\", uri, adaptor.getSearchResultsCallback,\r\n\t\tcontext, { accept: adaptor.mimeType }, null, null, null, null, true);\r\n\treturn typeof req == \"string\" ? req : true;\r\n};\r\n\r\nadaptor.getSearchResultsCallback = function(status, context, responseText, uri, xhr) {\r\n\tadaptor.getTiddlerListCallback(status, context, responseText, uri, xhr); // XXX: use apply?\r\n};\r\n\r\n// retrieve a particular tiddler's revisions\r\nadaptor.prototype.getTiddlerRevisionList = function(title, limit, context, userParams, callback) {\r\n\tcontext = this.setContext(context, userParams, callback);\r\n\tvar uriTemplate = \"%0/%1/%2/tiddlers/%3/revisions\";\r\n\tvar workspace = adaptor.resolveWorkspace(context.workspace);\r\n\tvar uri = uriTemplate.format([context.host, workspace.type + \"s\",\r\n\t\tadaptor.normalizeTitle(workspace.name), adaptor.normalizeTitle(title)]);\r\n\tvar req = httpReq(\"GET\", uri, adaptor.getTiddlerRevisionListCallback,\r\n\t\tcontext, merge({ accept: adaptor.mimeType }, context.headers), null, null, null, null, true);\r\n\treturn typeof req == \"string\" ? req : true;\r\n};\r\n\r\nadaptor.getTiddlerRevisionListCallback = function(status, context, responseText, uri, xhr) {\r\n\tcontext.status = status;\r\n\tcontext.statusText = xhr.statusText;\r\n\tcontext.httpStatus = xhr.status;\r\n\tif(status) {\r\n\t\tcontext.revisions = [];\r\n\t\ttry {\r\n\t\t\tvar tiddlers = $.evalJSON(responseText); //# NB: not actual tiddler instances\r\n\t\t} catch(ex) {\r\n\t\t\tcontext.status = false; // XXX: correct?\r\n\t\t\tcontext.statusText = exceptionText(ex, adaptor.parsingErrorMessage);\r\n\t\t\tif(context.callback) {\r\n\t\t\t\tcontext.callback(context, context.userParams);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor(var i = 0; i &lt; tiddlers.length; i++) {\r\n\t\t\tvar tiddler = adaptor.toTiddler(tiddlers[i], context.host);\r\n\t\t\tcontext.revisions.push(tiddler);\r\n\t\t}\r\n\t\tvar sortField = \"server.page.revision\";\r\n\t\tcontext.revisions.sort(function(a, b) {\r\n\t\t\treturn a.fields[sortField] &lt; b.fields[sortField] ? 1 :\r\n\t\t\t\t(a.fields[sortField] == b.fields[sortField] ? 0 : -1);\r\n\t\t});\r\n\t}\r\n\tif(context.callback) {\r\n\t\tcontext.callback(context, context.userParams);\r\n\t}\r\n};\r\n\r\n// retrieve an individual tiddler revision -- XXX: breaks with standard arguments list -- XXX: convenience function; simply use getTiddler?\r\nadaptor.prototype.getTiddlerRevision = function(title, revision, context, userParams, callback) {\r\n\tcontext = this.setContext(context, userParams, callback);\r\n\tcontext.revision = revision;\r\n\treturn this.getTiddler(title, context, userParams, callback);\r\n};\r\n\r\n// retrieve an individual tiddler\r\n//# context is an object with members host and workspace\r\n//# callback is passed the new context and userParams\r\nadaptor.prototype.getTiddler = function(title, context, userParams, callback) {\r\n\tcontext = this.setContext(context, userParams, callback);\r\n\tcontext.title = title;\r\n\tif(context.revision) {\r\n\t\tvar uriTemplate = \"%0/%1/%2/tiddlers/%3/revisions/%4\";\r\n\t} else {\r\n\t\turiTemplate = \"%0/%1/%2/tiddlers/%3\";\r\n\t}\r\n\tif(!context.tiddler) {\r\n\t\tcontext.tiddler = new Tiddler(title);\r\n\t}\r\n\tcontext.tiddler.fields[\"server.type\"] = adaptor.serverType;\r\n\tcontext.tiddler.fields[\"server.host\"] = AdaptorBase.minHostName(context.host);\r\n\tcontext.tiddler.fields[\"server.workspace\"] = context.workspace;\r\n\tvar workspace = adaptor.resolveWorkspace(context.workspace);\r\n\tvar uri = uriTemplate.format([context.host, workspace.type + \"s\",\r\n\t\tadaptor.normalizeTitle(workspace.name), adaptor.normalizeTitle(title),\r\n\t\tcontext.revision]);\r\n\tvar req = httpReq(\"GET\", uri, adaptor.getTiddlerCallback, context,\r\n\t\tmerge({ accept: adaptor.mimeType }, context.headers), null, null, null, null, true);\r\n\treturn typeof req == \"string\" ? req : true;\r\n};\r\n\r\nadaptor.getTiddlerCallback = function(status, context, responseText, uri, xhr) {\r\n\tcontext.status = status;\r\n\tcontext.statusText = xhr.statusText;\r\n\tcontext.httpStatus = xhr.status;\r\n\tif(status) {\r\n\t\ttry {\r\n\t\t\tvar tid = $.evalJSON(responseText);\r\n\t\t} catch(ex) {\r\n\t\t\tcontext.status = false;\r\n\t\t\tcontext.statusText = exceptionText(ex, adaptor.parsingErrorMessage);\r\n\t\t\tif(context.callback) {\r\n\t\t\t\tcontext.callback(context, context.userParams);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar tiddler = adaptor.toTiddler(tid, context.host);\r\n\t\ttiddler.title = context.tiddler.title;\r\n\t\ttiddler.fields[\"server.etag\"] = xhr.getResponseHeader(\"Etag\");\r\n\t\t// normally we'd assign context.tiddler = tiddler here - but we can't do\r\n\t\t// that because of IE, which triggers getTiddler in putTiddlerCallback,\r\n\t\t// and since ServerSideSavingPlugin foolishly relies on persistent\r\n\t\t// object references, we need to merge the data into the existing object\r\n\t\t$.extend(context.tiddler, tiddler);\r\n\t}\r\n\tif(context.callback) {\r\n\t\tcontext.callback(context, context.userParams);\r\n\t}\r\n};\r\n\r\n// retrieve tiddler chronicle (all revisions)\r\nadaptor.prototype.getTiddlerChronicle = function(title, context, userParams, callback) {\r\n\tcontext = this.setContext(context, userParams, callback);\r\n\tcontext.title = title;\r\n\tvar uriTemplate = \"%0/%1/%2/tiddlers/%3/revisions?fat=1\";\r\n\tvar workspace = adaptor.resolveWorkspace(context.workspace);\r\n\tvar uri = uriTemplate.format([context.host, workspace.type + \"s\",\r\n\t\tadaptor.normalizeTitle(workspace.name), adaptor.normalizeTitle(title)]);\r\n\tvar req = httpReq(\"GET\", uri, adaptor.getTiddlerChronicleCallback,\r\n\t\tcontext, { accept: adaptor.mimeType }, null, null, null, null, true);\r\n\treturn typeof req == \"string\" ? req : true;\r\n};\r\n\r\nadaptor.getTiddlerChronicleCallback = function(status, context, responseText, uri, xhr) {\r\n\tcontext.status = status;\r\n\tcontext.statusText = xhr.statusText;\r\n\tcontext.httpStatus = xhr.status;\r\n\tif(status) {\r\n\t\tcontext.responseText = responseText;\r\n\t}\r\n\tif(context.callback) {\r\n\t\tcontext.callback(context, context.userParams);\r\n\t}\r\n};\r\n\r\n// store an individual tiddler\r\nadaptor.prototype.putTiddler = function(tiddler, context, userParams, callback) {\r\n\tcontext = this.setContext(context, userParams, callback);\r\n\tcontext.title = tiddler.title;\r\n\tcontext.tiddler = tiddler;\r\n\tcontext.host = context.host || this.fullHostName(tiddler.fields[\"server.host\"]);\r\n\tvar uriTemplate = \"%0/%1/%2/tiddlers/%3\";\r\n\ttry {\r\n\t\tcontext.workspace = context.workspace || tiddler.fields[\"server.workspace\"];\r\n\t\tvar workspace = adaptor.resolveWorkspace(context.workspace);\r\n\t} catch(ex) {\r\n\t\treturn adaptor.locationIDErrorMessage;\r\n\t}\r\n\tvar uri = uriTemplate.format([context.host, workspace.type + \"s\",\r\n\t\tadaptor.normalizeTitle(workspace.name),\r\n\t\tadaptor.normalizeTitle(tiddler.title)]);\r\n\tvar etag = adaptor.generateETag(workspace, tiddler);\r\n\tvar headers = etag ? { \"If-Match\": etag } : null;\r\n\tvar payload = {\r\n\t\ttype: tiddler.fields[\"server.content-type\"] || null,\r\n\t\ttext: tiddler.text,\r\n\t\ttags: tiddler.tags,\r\n\t\tfields: $.extend({}, tiddler.fields)\r\n\t};\r\n\tdelete payload.fields.changecount;\r\n\t$.each(payload.fields, function(key, value) {\r\n\t\tif(key.indexOf(\"server.\") == 0) {\r\n\t\t\tdelete payload.fields[key];\r\n\t\t}\r\n\t});\r\n\tpayload = $.toJSON(payload);\r\n\tvar req = httpReq(\"PUT\", uri, adaptor.putTiddlerCallback,\r\n\t\tcontext, headers, payload, adaptor.mimeType, null, null, true);\r\n\treturn typeof req == \"string\" ? req : true;\r\n};\r\n\r\nadaptor.putTiddlerCallback = function(status, context, responseText, uri, xhr) {\r\n\tcontext.status = [204, 1223].contains(xhr.status);\r\n\tcontext.statusText = xhr.statusText;\r\n\tcontext.httpStatus = xhr.status;\r\n\tif(context.status) {\r\n\t\tvar loc = xhr.getResponseHeader(\"Location\");\r\n\t\tvar etag = xhr.getResponseHeader(\"Etag\");\r\n\t\tif(loc &amp;&amp; etag) {\r\n\t\t\tvar bag = loc.split(\"/bags/\").pop().split(\"/\")[0];\r\n\t\t\tcontext.tiddler.fields[\"server.bag\"] = bag;\r\n\t\t\tcontext.tiddler.fields[\"server.workspace\"] = \"bags/\" + bag;\r\n\t\t\tvar rev = etag.split(\"/\").pop().split(/;|:/)[0];\r\n\t\t\tcontext.tiddler.fields[\"server.page.revision\"] = rev;\r\n\t\t\tcontext.tiddler.fields[\"server.etag\"] = etag;\r\n\t\t\tif(context.callback) {\r\n\t\t\t\tcontext.callback(context, context.userParams);\r\n\t\t\t}\r\n\t\t} else { // IE\r\n\t\t\tcontext.adaptor.getTiddler(context.tiddler.title, context,\r\n\t\t\t\tcontext.userParams, context.callback);\r\n\t\t}\r\n\t} else if(context.callback) {\r\n\t\tcontext.callback(context, context.userParams);\r\n\t}\r\n};\r\n\r\n// store a tiddler chronicle\r\nadaptor.prototype.putTiddlerChronicle = function(revisions, context, userParams, callback) {\r\n\tcontext = this.setContext(context, userParams, callback);\r\n\tcontext.title = revisions[0].title;\r\n\tvar headers = null;\r\n\tvar uriTemplate = \"%0/%1/%2/tiddlers/%3/revisions\";\r\n\tvar host = context.host || this.fullHostName(tiddler.fields[\"server.host\"]);\r\n\tvar workspace = adaptor.resolveWorkspace(context.workspace);\r\n\tvar uri = uriTemplate.format([host, workspace.type + \"s\",\r\n\t\tadaptor.normalizeTitle(workspace.name),\r\n\t\tadaptor.normalizeTitle(context.title)]);\r\n\tif(workspace.type == \"bag\") { // generate ETag\r\n\t\tvar etag = [adaptor.normalizeTitle(workspace.name),\r\n\t\t\tadaptor.normalizeTitle(context.title), 0].join(\"/\"); //# zero-revision prevents overwriting existing contents\r\n\t\theaders = { \"If-Match\": '\"' + etag + '\"' };\r\n\t}\r\n\tvar payload = $.toJSON(revisions);\r\n\tvar req = httpReq(\"POST\", uri, adaptor.putTiddlerChronicleCallback,\r\n\t\tcontext, headers, payload, adaptor.mimeType, null, null, true);\r\n\treturn typeof req == \"string\" ? req : true;\r\n};\r\n\r\nadaptor.putTiddlerChronicleCallback = function(status, context, responseText, uri, xhr) {\r\n\tcontext.status = [204, 1223].contains(xhr.status);\r\n\tcontext.statusText = xhr.statusText;\r\n\tcontext.httpStatus = xhr.status;\r\n\tif(context.callback) {\r\n\t\tcontext.callback(context, context.userParams);\r\n\t}\r\n};\r\n\r\n// store a collection of tiddlers (import TiddlyWiki HTML store)\r\nadaptor.prototype.putTiddlerStore = function(store, context, userParams, callback) {\r\n\tcontext = this.setContext(context, userParams, callback);\r\n\tvar uriTemplate = \"%0/%1/%2/tiddlers\";\r\n\tvar host = context.host;\r\n\tvar workspace = adaptor.resolveWorkspace(context.workspace);\r\n\tvar uri = uriTemplate.format([host, workspace.type + \"s\",\r\n\t\tadaptor.normalizeTitle(workspace.name)]);\r\n\tvar req = httpReq(\"POST\", uri, adaptor.putTiddlerStoreCallback,\r\n\t\tcontext, null, store, \"text/x-tiddlywiki\", null, null, true);\r\n\treturn typeof req == \"string\" ? req : true;\r\n};\r\n\r\nadaptor.putTiddlerStoreCallback = function(status, context, responseText, uri, xhr) {\r\n\tcontext.status = [204, 1223].contains(xhr.status);\r\n\tcontext.statusText = xhr.statusText;\r\n\tcontext.httpStatus = xhr.status;\r\n\tif(context.callback) {\r\n\t\tcontext.callback(context, context.userParams);\r\n\t}\r\n};\r\n\r\n// rename an individual tiddler or move it to a different workspace -- TODO: make {from|to}.title optional\r\n//# from and to are objects with members title and workspace (bag; optional),\r\n//# representing source and target tiddler, respectively\r\nadaptor.prototype.moveTiddler = function(from, to, context, userParams, callback) { // XXX: rename parameters (old/new)?\r\n\tvar self = this;\r\n\tvar newTiddler = store.getTiddler(from.title) || store.getTiddler(to.title); //# local rename might already have occurred\r\n\tvar oldTiddler = $.extend(true, {}, newTiddler); //# required for eventual deletion\r\n\toldTiddler.title = from.title; //# required for original tiddler's ETag\r\n\tvar _getTiddlerChronicle = function(title, context, userParams, callback) {\r\n\t\treturn self.getTiddlerChronicle(title, context, userParams, callback);\r\n\t};\r\n\tvar _putTiddlerChronicle = function(context, userParams) {\r\n\t\tif(!context.status) {\r\n\t\t\treturn callback(context, userParams);\r\n\t\t}\r\n\t\tvar revisions = $.evalJSON(context.responseText); // XXX: error handling?\r\n\t\t// change current title while retaining previous location\r\n\t\tfor(var i = 0; i &lt; revisions.length; i++) {\r\n\t\t\tdelete revisions[i].revision;\r\n\t\t\tif(!revisions[i].fields.origin) { // NB: origin = \"&lt;workspace&gt;/&lt;title&gt;\"\r\n\t\t\t\trevisions[i].fields.origin = [\"bags\", revisions[i].bag, revisions[i].title].join(\"/\");\r\n\t\t\t}\r\n\t\t\trevisions[i].title = to.title;\r\n\t\t}\r\n\t\t// add new revision\r\n\t\tvar rev = $.extend({}, revisions[0]);\r\n\t\t$.each(newTiddler, function(i, item) {\r\n\t\t\tif(!$.isFunction(item)) {\r\n\t\t\t\trev[i] = item;\r\n\t\t\t}\r\n\t\t});\r\n\t\trev.title = to.title;\r\n\t\trev.created = rev.created.convertToYYYYMMDDHHMM();\r\n\t\trev.modified = new Date().convertToYYYYMMDDHHMM();\r\n\t\tdelete rev.fields.changecount;\r\n\t\trevisions.unshift(rev);\r\n\t\tif(to.workspace) {\r\n\t\t\tcontext.workspace = to.workspace;\r\n\t\t} else if(context.workspace.substring(0, 4) != \"bags\") { // NB: target workspace must be a bag\r\n\t\t\tcontext.workspace = \"bags/\" + rev.bag;\r\n\t\t}\r\n\t\tvar subCallback = function(context, userParams) {\r\n\t\t\tif(!context.status) {\r\n\t\t\t\treturn callback(context, userParams);\r\n\t\t\t}\r\n\t\t\tcontext.adaptor.getTiddler(newTiddler.title, context, userParams, _deleteTiddler);\r\n\t\t};\r\n\t\treturn self.putTiddlerChronicle(revisions, context, context.userParams, subCallback);\r\n\t};\r\n\tvar _deleteTiddler = function(context, userParams) {\r\n\t\tif(!context.status) {\r\n\t\t\treturn callback(context, userParams);\r\n\t\t}\r\n\t\t$.extend(true, newTiddler, context.tiddler);\r\n\t\tcontext.callback = null;\r\n\t\treturn self.deleteTiddler(oldTiddler, context, context.userParams, callback);\r\n\t};\r\n\tcallback = callback || function() {};\r\n\tcontext = this.setContext(context, userParams);\r\n\tcontext.host = context.host || oldTiddler.fields[\"server.host\"];\r\n\tcontext.workspace = from.workspace || oldTiddler.fields[\"server.workspace\"];\r\n\treturn _getTiddlerChronicle(from.title, context, userParams, _putTiddlerChronicle);\r\n};\r\n\r\n// delete an individual tiddler\r\nadaptor.prototype.deleteTiddler = function(tiddler, context, userParams, callback) {\r\n\tcontext = this.setContext(context, userParams, callback);\r\n\tcontext.title = tiddler.title; // XXX: not required!?\r\n\tvar uriTemplate = \"%0/bags/%1/tiddlers/%2\";\r\n\tvar host = context.host || this.fullHostName(tiddler.fields[\"server.host\"]);\r\n\tvar bag = tiddler.fields[\"server.bag\"];\r\n\tif(!bag) {\r\n\t\treturn adaptor.noBagErrorMessage;\r\n\t}\r\n\tvar uri = uriTemplate.format([host, adaptor.normalizeTitle(bag),\r\n\t\tadaptor.normalizeTitle(tiddler.title)]);\r\n\tvar etag = adaptor.generateETag({ type: \"bag\", name: bag }, tiddler);\r\n\tvar headers = etag ? { \"If-Match\": etag } : null;\r\n\tvar req = httpReq(\"DELETE\", uri, adaptor.deleteTiddlerCallback, context, headers,\r\n\t\tnull, null, null, null, true);\r\n\treturn typeof req == \"string\" ? req : true;\r\n};\r\n\r\nadaptor.deleteTiddlerCallback = function(status, context, responseText, uri, xhr) {\r\n\tcontext.status = [204, 1223].contains(xhr.status);\r\n\tcontext.statusText = xhr.statusText;\r\n\tcontext.httpStatus = xhr.status;\r\n\tif(context.callback) {\r\n\t\tcontext.callback(context, context.userParams);\r\n\t}\r\n};\r\n\r\n// compare two revisions of a tiddler (requires TiddlyWeb differ plugin)\r\n//# if context.rev1 is not specified, the latest revision will be used for comparison\r\n//# if context.rev2 is not specified, the local revision will be sent for comparison\r\n//# context.format is a string as determined by the TiddlyWeb differ plugin\r\nadaptor.prototype.getTiddlerDiff = function(title, context, userParams, callback) {\r\n\tcontext = this.setContext(context, userParams, callback);\r\n\tcontext.title = title;\r\n\r\n\tvar tiddler = store.getTiddler(title);\r\n\ttry {\r\n\t\tvar workspace = adaptor.resolveWorkspace(tiddler.fields[\"server.workspace\"]);\r\n\t} catch(ex) {\r\n\t\treturn adaptor.locationIDErrorMessage;\r\n\t}\r\n\tvar tiddlerRef = [workspace.type + \"s\", workspace.name, tiddler.title].join(\"/\");\r\n\r\n\tvar rev1 = context.rev1 ? [tiddlerRef, context.rev1].join(\"/\") : tiddlerRef;\r\n\tvar rev2 = context.rev2 ? [tiddlerRef, context.rev2].join(\"/\") : null;\r\n\r\n\tvar uriTemplate = \"%0/diff?rev1=%1\";\r\n\tif(rev2) {\r\n\t\turiTemplate += \"&amp;rev2=%2\";\r\n\t}\r\n\tif(context.format) {\r\n\t\turiTemplate += \"&amp;format=%3\";\r\n\t}\r\n\tvar host = context.host || this.fullHostName(tiddler.fields[\"server.host\"]);\r\n\tvar uri = uriTemplate.format([host, adaptor.normalizeTitle(rev1),\r\n\t\tadaptor.normalizeTitle(rev2), context.format]);\r\n\r\n\tif(rev2) {\r\n\t\tvar req = httpReq(\"GET\", uri, adaptor.getTiddlerDiffCallback, context, null,\r\n\t\t\tnull, null, null, null, true);\r\n\t} else {\r\n\t\tvar payload = {\r\n\t\t\ttitle: tiddler.title,\r\n\t\t\ttext: tiddler.text,\r\n\t\t\tmodifier: tiddler.modifier,\r\n\t\t\ttags: tiddler.tags,\r\n\t\t\tfields: $.extend({}, tiddler.fields)\r\n\t\t}; // XXX: missing attributes!?\r\n\t\tpayload = $.toJSON(payload);\r\n\t\treq = httpReq(\"POST\", uri, adaptor.getTiddlerDiffCallback, context,\r\n\t\t\tnull, payload, adaptor.mimeType, null, null, true);\r\n\t}\r\n\treturn typeof req == \"string\" ? req : true;\r\n};\r\n\r\nadaptor.getTiddlerDiffCallback = function(status, context, responseText, uri, xhr) {\r\n\tcontext.status = status;\r\n\tcontext.statusText = xhr.statusText;\r\n\tcontext.httpStatus = xhr.status;\r\n\tcontext.uri = uri;\r\n\tif(status) {\r\n\t\tcontext.diff = responseText;\r\n\t}\r\n\tif(context.callback) {\r\n\t\tcontext.callback(context, context.userParams);\r\n\t}\r\n};\r\n\r\n// generate tiddler information\r\nadaptor.prototype.generateTiddlerInfo = function(tiddler) {\r\n\tvar info = {};\r\n\tvar uriTemplate = \"%0/%1/%2/tiddlers/%3\";\r\n\tvar host = this.host || tiddler.fields[\"server.host\"]; // XXX: this.host obsolete?\r\n\thost = this.fullHostName(host);\r\n\tvar workspace = adaptor.resolveWorkspace(tiddler.fields[\"server.workspace\"]);\r\n\tinfo.uri = uriTemplate.format([host, workspace.type + \"s\",\r\n\t\tadaptor.normalizeTitle(workspace.name),\r\n\t\tadaptor.normalizeTitle(tiddler.title)]);\r\n\treturn info;\r\n};\r\n\r\n// create Tiddler instance from TiddlyWeb tiddler JSON\r\nadaptor.toTiddler = function(json, host) {\r\n\tvar created = Date.convertFromYYYYMMDDHHMM(json.created);\r\n\tvar modified = Date.convertFromYYYYMMDDHHMM(json.modified);\r\n\tvar fields = json.fields;\r\n\tfields[\"server.type\"] = adaptor.serverType;\r\n\tfields[\"server.host\"] = AdaptorBase.minHostName(host);\r\n\tfields[\"server.bag\"] = json.bag;\r\n\tfields[\"server.title\"] = json.title;\r\n\tif(json.recipe) {\r\n\t\tfields[\"server.recipe\"] = json.recipe;\r\n\t}\r\n\tif(json.type &amp;&amp; json.type != \"None\") {\r\n\t\tfields[\"server.content-type\"] = json.type;\r\n\t}\r\n\tfields[\"server.permissions\"] = json.permissions.join(\", \");\r\n\tfields[\"server.page.revision\"] = json.revision;\r\n\tfields[\"server.workspace\"] = \"bags/\" + json.bag;\r\n\tvar tiddler = new Tiddler(json.title);\r\n\ttiddler.assign(tiddler.title, json.text, json.modifier, modified, json.tags,\r\n\t\tcreated, json.fields, json.creator);\r\n\treturn tiddler;\r\n};\r\n\r\nadaptor.resolveWorkspace = function(workspace) {\r\n\tvar components = workspace.split(\"/\");\r\n\treturn {\r\n\t\ttype: components[0] == \"bags\" ? \"bag\" : \"recipe\",\r\n\t\tname: components[1] || components[0]\r\n\t};\r\n};\r\n\r\nadaptor.generateETag = function(workspace, tiddler) {\r\n\tvar revision = tiddler.fields[\"server.page.revision\"];\r\n\tvar etag = revision == \"false\" ? null : tiddler.fields[\"server.etag\"];\r\n\tif(!etag &amp;&amp; workspace.type == \"bag\") {\r\n\t\tif(typeof revision == \"undefined\") {\r\n\t\t\trevision = \"0\";\r\n\t\t} else if(revision == \"false\") {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tetag = [adaptor.normalizeTitle(workspace.name),\r\n\t\t\tadaptor.normalizeTitle(tiddler.title), revision].join(\"/\");\r\n\t\tetag = '\"' + etag + '\"';\r\n\t}\r\n\treturn etag;\r\n};\r\n\r\nadaptor.normalizeTitle = function(title) {\r\n\treturn encodeURIComponent(title);\r\n};\r\n\r\n})(jQuery);\r\n\r\n\r\n/*\r\n * jQuery JSON Plugin\r\n * version: 1.3\r\n * source: http://code.google.com/p/jquery-json/\r\n * license: MIT (http://www.opensource.org/licenses/mit-license.php)\r\n */\r\n(function($){function toIntegersAtLease(n)\r\n{return n&lt;10?'0'+n:n;}\r\nDate.prototype.toJSON=function(date)\r\n{return this.getUTCFullYear()+'-'+\r\ntoIntegersAtLease(this.getUTCMonth())+'-'+\r\ntoIntegersAtLease(this.getUTCDate());};var escapeable=/[\"\\\\\\x00-\\x1f\\x7f-\\x9f]/g;var meta={'\\b':'\\\\b','\\t':'\\\\t','\\n':'\\\\n','\\f':'\\\\f','\\r':'\\\\r','\"':'\\\\\"','\\\\':'\\\\\\\\'};$.quoteString=function(string)\r\n{if(escapeable.test(string))\r\n{return'\"'+string.replace(escapeable,function(a)\r\n{var c=meta[a];if(typeof c==='string'){return c;}\r\nc=a.charCodeAt();return'\\\\u00'+Math.floor(c/16).toString(16)+(c%16).toString(16);})+'\"';}\r\nreturn'\"'+string+'\"';};$.toJSON=function(o,compact)\r\n{var type=typeof(o);if(type==\"undefined\")\r\nreturn\"undefined\";else if(type==\"number\"||type==\"boolean\")\r\nreturn o+\"\";else if(o===null)\r\nreturn\"null\";if(type==\"string\")\r\n{return $.quoteString(o);}\r\nif(type==\"object\"&amp;&amp;typeof o.toJSON==\"function\")\r\nreturn o.toJSON(compact);if(type!=\"function\"&amp;&amp;typeof(o.length)==\"number\")\r\n{var ret=[];for(var i=0;i&lt;o.length;i++){ret.push($.toJSON(o[i],compact));}\r\nif(compact)\r\nreturn\"[\"+ret.join(\",\")+\"]\";else\r\nreturn\"[\"+ret.join(\", \")+\"]\";}\r\nif(type==\"function\"){throw new TypeError(\"Unable to convert object of type 'function' to json.\");}\r\nvar ret=[];for(var k in o){var name;type=typeof(k);if(type==\"number\")\r\nname='\"'+k+'\"';else if(type==\"string\")\r\nname=$.quoteString(k);else\r\ncontinue;var val=$.toJSON(o[k],compact);if(typeof(val)!=\"string\"){continue;}\r\nif(compact)\r\nret.push(name+\":\"+val);else\r\nret.push(name+\": \"+val);}\r\nreturn\"{\"+ret.join(\", \")+\"}\";};$.compactJSON=function(o)\r\n{return $.toJSON(o,true);};$.evalJSON=function(src)\r\n{return eval(\"(\"+src+\")\");};$.secureEvalJSON=function(src)\r\n{var filtered=src;filtered=filtered.replace(/\\\\[\"\\\\\\/bfnrtu]/g,'@');filtered=filtered.replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g,']');filtered=filtered.replace(/(?:^|:|,)(?:\\s*\\[)+/g,'');if(/^[\\],:{}\\s]*$/.test(filtered))\r\nreturn eval(\"(\"+src+\")\");else\r\nthrow new SyntaxError(\"Error parsing JSON, source is not valid.\");};})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"SiteIcon\" server.title=\"SiteIcon\" server.page.revision=\"2566407\" server.etag=\"&quot;pearl_public/SiteIcon/2566407:4273f57d012dd9fcd0e5496ea5539c3bb6288dab&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"image/jpeg\" modified=\"20160927120147\" created=\"20160908133955\" tags=\"图片\" _hash=\"6480ad95cff44c454742fd20f338b9bb35cedd66\">\r\n<pre>htmlimgsrchttp//pearltiddlyspacecom/bags/pearlpublic/tiddlers/SiteIcon//html</pre>\r\n</div>\r\n<div title=\"StyleSheetTiddler\" server.title=\"StyleSheetTiddler\" server.page.revision=\"1521917\" server.etag=\"&quot;system-theme_public/StyleSheetTiddler/1521917:40eabbd2202bbe4d73361c38f2c0e9cef81a3e02&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-theme_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-theme_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch\" _hash=\"1a28a9b1acf2996cdfbb522f52f0e56353d9f883\">\r\n<pre>/*{{{*/\r\n.tiddler .originButton div {\r\n\tdisplay: inline-block;\r\n}\r\n\r\n.tiddler .spaceSiteIcon .siteIcon {\r\n\t_display: inline; /* IE doesn't like inline-block */\r\n}\r\n\r\n.tiddler .originButton {\r\n\tdisplay: block;\r\n}\r\n\r\n.selected .tagging,\r\n.selected .tagging:hover {\r\n\tborder: none;\r\n\tbackground: none;\r\n}\r\n\r\n.tagging {\r\n\tfloat: none;\r\n\tbackground: none;\r\n\tborder: none;\r\n}\r\n\r\n.tagging li.listTitle {\r\n\tmargin-left: 0px;\r\n}\r\n.tagging li {\r\n\tmargin: 0 8px;\r\n}\r\n\r\n.tagging .tiddlyLink {\r\n\t-webkit-border-radius: 3px;\r\n\t-moz-border-radius: 3px;\r\n\t-o-border-radius: 3px;\r\n\tborder-radius: 3px;\r\n\tpadding: 1px 2px;\r\n\tline-height: 1.2em;\r\n}\r\n\r\n/* for following */\r\n#popup .siteIcon {\r\n\tfloat: left;\r\n\theight: 25px;\r\n}\r\n\r\n.content {\r\n\twidth: 100%; /* IE */\r\n\tfont-size: 0.9em;\r\n}\r\n\r\n.editorHeading {\r\n\theight: 48px;\r\n}\r\n\r\n.heading {\r\n\tleft: 0;\r\n\tmargin-bottom: 40px;\r\n\tposition: relative;\r\n\ttop: 32px;\r\n}\r\n\r\n.followButton a {\r\n\tdisplay: block;\r\n\tmargin-top: -20px;\r\n}\r\n\r\n.tiddler .followPlaceHolder {\r\n\tdisplay: block;\r\n\tposition: absolute;\r\n\ttop: 16px;\r\n\tright: 64px;\r\n\t_right: 138px; // add width of modifierIcon\r\n}\r\n\r\n.tiddler .followButton {\r\n\tposition: relative;\r\n\theight: 24px;\r\n\ttext-align: left;\r\n\tcolor: #fff;\r\n\tbackground: [[ColorPalette::PrimaryMid]];\r\n\tpadding: 10px 0px 0px 10px;\r\n\twidth: 38px;\r\n\tmargin: -16px -8px 24px 0;\r\n}\r\n\r\n/* creates the larger triangle */\r\n.followButton:before {\r\n\tcontent: \"\\00a0\";\r\n\tdisplay: block; /* reduce the damage in FF3.0 */\r\n\tposition: relative;\r\n\tbottom: -20px;\r\n\tright: 0;\r\n\twidth: 0;\r\n\theight: 0;\r\n\tborder-width: 0 0 20px 20px;\r\n\tborder-style: solid;\r\n\tborder-color: transparent [[ColorPalette::PrimaryMid]];\r\n}\r\n\r\n.toolbar svg {\r\n\theight: 16px;\r\n\twidth: 16px;\r\n}\r\n\r\n.toolbar svg .glyph {\r\n\tfill: #ccc;\r\n}\r\n\r\n.toolbar a:hover .glyph {\r\n\tfill: black;\r\n}\r\n\r\n.toolbar a:active .glyph {\r\n\tfill: [[ColorPalette::Background]];\r\n}\r\n\r\n.originButton,\r\n.followPlaceHolder,\r\n.tiddler .subtitle {\r\n\tcursor: pointer;\r\n}\r\n\r\n.editSpaceSiteIcon .originButton {\r\n\tcursor: auto;\r\n}\r\n\r\n.tiddler .subtitle:hover {\r\n\tfont-weight: bold;\r\n\tbackground: none;\r\n}\r\n\r\n.originButton img,\r\n.originButton svg {\r\n\tmargin-left: 0px;\r\n}\r\n\r\n.modifierIcon {\r\n\tposition: absolute;\r\n\twidth: 74px;\r\n\ttop: 0px;\r\n\tright: 0px;\r\n\t_right: 74px; /* in IE6 positioning works incorrectly so use -width instead */\r\n\ttext-align: right;\r\n}\r\n\r\n.modifierIcon img,\r\n.modifierIcon svg {\r\n\tmargin-right: 8px;\r\n}\r\n\r\n.tiddler .viewer {\r\n\tpadding-bottom: 16px;\r\n\tmargin: 0 0 0 56px;\r\n\tline-height: 1.4em;\r\n}\r\n\r\n.viewer pre {\r\n\tmargin-left: 0;\r\n}\r\n\r\n.siteIcon .label {\r\n\tcolor: [[ColorPalette::TertiaryDark]];\r\n}\r\n\r\n.tiddler .spaceSiteIcon {\r\n\tfloat: left;\r\n\tmargin-right: 0;\r\n\tmargin-top: 0;\r\n\tposition: relative;\r\n\tdisplay: block;\r\n}\r\n\r\n.tiddler .titleBar {\r\n\tdisplay: block;\r\n\tmargin-right: 136px;\r\n\tmargin-left: 56px;\r\n}\r\n\r\n.followButton a {\r\n\tcolor: [[ColorPalette::Background]];\r\n}\r\n\r\n.tiddler {\r\n\tposition: relative;\r\n\tpadding: 0;\r\n\tmargin-bottom: 3em;\r\n\tborder-top: 3px solid [[ColorPalette::PrimaryMid]];\r\n\tbackground: #fff;\r\n}\r\n\r\n.tiddler .editor {\r\n\tpadding: 0px 8px;\r\n}\r\n\r\n.tiddler .heading .title {\r\n\tposition: relative;\r\n\tdisplay: block;\r\n\tword-wrap: break-word;\r\n\tfont-size: 32px;\r\n\tline-height: 32px;\r\n}\r\n.tiddler .heading .editor.title {\r\n\tfont-size: 1.7em;\r\n\tline-height: normal;\r\n}\r\n\r\n.tiddler .headingClear {\r\n\tclear: both;\r\n}\r\n\r\n.tiddler .subtitle {\r\n\tfont-style: italic;\r\n\tfont-size: 0.9em;\r\n\tcolor: #a6a59e;\r\n\tmargin-top: 0;\r\n}\r\n\r\n.toolbar {\r\n\tposition: absolute;\r\n\tpadding: 0;\r\n\ttop: 8px;\r\n\tright: -8px;\r\n}\r\n\r\n.toolbar .moreCommand.highlight {\r\n\tbackground: none;\r\n}\r\n\r\n.tiddler .toolbar .button {\r\n\tborder: none;\r\n\tdisplay: inline;\r\n\tpadding: 0px;\r\n\tmargin-right: 16px;\r\n}\r\n\r\n.tiddler .toolbar a:hover {\r\n\tbackground: none;\r\n}\r\n\r\n.tiddler .tagged .listTitle {\r\n\tdisplay: none;\r\n}\r\n\r\n.revButton {\r\n\tfloat: right;\r\n}\r\n\r\n/*! EditTemplate specific*/\r\n.tiddler .privacySettings {\r\n\ttext-align: center;\r\n}\r\n.tiddler .privacySettings .originButton {\r\n\tdisplay: inline;\r\n}\r\n\r\n.editSpaceSiteIcon, .privacyEdit {\r\n\tfloat: left;\r\n}\r\n\r\n.editSpaceSiteIcon svg,\r\n.editSpaceSiteIcon img,\r\n.editSpaceSiteIcon .roundelLabel {\r\n\tfloat: left;\r\n}\r\n\r\n.tagTitle {\r\n\tposition: absolute;\r\n\ttext-align: center;\r\n\twidth: 48px;\r\n\ttop: 0px;\r\n\tleft: -56px;\r\n}\r\n\r\n.editSpaceSiteIcon .originButton img,\r\n.editSpaceSiteIcon .originButton svg {\r\n\theight: 16px;\r\n\tmargin-left: 24px;\r\n\tmargin-right: 32px;\r\n\twidth: 16px;\r\n}\r\n\r\n.tagAnnotation {\r\n\tmargin-top: 8px;\r\n\tpadding-bottom: 8px;\r\n}\r\n.annotationsBox {\r\n\tmargin-top: 8px;\r\n}\r\n\r\n.editorFooter {\r\n\tposition: relative;\r\n\tpadding: 0;\r\n\tmargin-top: 16px;\r\n\tmargin-left: 64px;\r\n}\r\n\r\n.tiddler .editorFooter .editor {\r\n\tpadding-left: 0px;\r\n}\r\n\r\n.heading .editor input {\r\n\twidth: 100%;\r\n\tfont-size: 1.5em;\r\n}\r\n\r\n.spaceSiteIcon .externalImage .image a:hover,\r\n.modifierIcon .externalImage .image a:hover {\r\n\tbackground: none;\r\n}\r\n\r\ndiv.toolbar {\r\n\tvisibility:hidden;\r\n\tright:-16px;\r\n}\r\n\r\n.selected div.toolbar {\r\n\tvisibility: visible;\r\n}\r\n\r\n.followButton a:hover {\r\n\tbackground: [[ColorPalette::PrimaryMid]];\r\n\ttext-decoration: underline;\r\n}\r\n\r\na.image:hover {\r\n\tbackground: transparent;\r\n}\r\n\r\n@media all and (max-device-width: 480px) {\r\n\tdiv.toolbar {\r\n\t\tvisibility:visible;\r\n\t}\r\n}\r\n@media only screen and (device-width: 768px) {\r\n\tdiv.toolbar {\r\n\t\tvisibility:visible;\r\n\t}\r\n}\r\n@media all and (max-width: 960px) {\r\n\t.tiddler .titleBar {\r\n\t\tmargin-left: 36px;\r\n\t\tmargin-right: 80px;\r\n\t}\r\n\r\n\t.tiddler .heading {\r\n\t\tmargin-bottom: 48px;\r\n\t}\r\n\r\n\t.tiddler .heading .title {\r\n\t\tfont-size: 32px;\r\n\t\tline-height: 32px;\r\n\t}\r\n\r\n\t.tiddler .modifierIcon img,\r\n\t.tiddler .modifierIcon svg,\r\n\t.tiddler .spaceSiteIcon .originButton img,\r\n\t.originButton svg {\r\n\t\twidth: 32px;\r\n\t\theight: 32px;\r\n\t\tmargin-left: 0px;\r\n\t\tmargin-right: 0px;\r\n\t}\r\n\r\n\t.tiddler .followPlaceHolder {\r\n\t\tright: 48px;\r\n\t}\r\n\r\n\t.tiddler .followButton {\r\n\t\twidth: 24px;\r\n\t}\r\n\r\n\t.tiddler .viewer {\r\n\t\tmargin: 0px 0px 0px 36px;\r\n\t\tpadding-top: 0;\r\n\t}\r\n\r\n\tbr {\r\n\t\tline-height: 0.5em;\r\n\t}\r\n}\r\n/*}}}*/</pre>\r\n</div>\r\n<div title=\"FollowTiddlersBlackList\" server.title=\"FollowTiddlersBlackList\" server.page.revision=\"1521900\" server.etag=\"&quot;tiddlyspace/FollowTiddlersBlackList/1521900:45f0338dfb04eff046c90331b351b668e2a94105&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192334\" created=\"20131111192334\" tags=\"excludeLists excludeMissing excludeSearch\" _hash=\"6fc8ab230a904a71d63a42d97dccd8e135c1ed1c\">\r\n<pre>ColorPalette\r\nStyleSheet\r\nSiteSubtitle\r\nGettingStarted\r\nSiteTitle\r\nMainMenu\r\nSiteIcon\r\nDefaultTiddlers\r\nViewTemplate\r\nPageTemplate\r\nSideBarOptions\r\nEditTemplate\r\nSiteInfo\r\nSideBarTabs\r\nToolbarCommands</pre>\r\n</div>\r\n<div title=\"spaceTitle\" server.title=\"spaceTitle\" server.page.revision=\"1521874\" server.etag=\"&quot;system-info_public/spaceTitle/1521874:5a17c38fe616ba3e9209438b76fde2090c0eba75&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-info_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-info_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch\" _hash=\"fc6cbafbbf1009da659a70f1f400ca4db8ebc84d\">\r\n<pre>The title and subtitle of your space are visible to visitors and are also displayed in your browser's tabs. Click on the SiteTitle and SiteSubtitle tiddler links below to make changes.\r\n* [[SiteTitle]]\r\n* [[SiteSubtitle]]</pre>\r\n</div>\r\n<div title=\"SiteInfo\" server.title=\"SiteInfo\" server.page.revision=\"2566405\" server.etag=\"&quot;pearl_public/SiteInfo/2566405:665a585d4365c662ae37f2d2a0605af76c57714f&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160927115837\" created=\"20160908133935\" tags=\"\" _hash=\"3fa4822da9c30214c8621c58e0baa427bf75aced\">\r\n<pre> pearl</pre>\r\n</div>\r\n<div title=\"DefaultTiddlers\" server.title=\"DefaultTiddlers\" server.page.revision=\"2564766\" server.etag=\"&quot;pearl_public/DefaultTiddlers/2564766:b74f42e93706dadffc50341901fec73fe2ad8f90&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160925044932\" created=\"20160908133954\" tags=\"excludeLists\" _hash=\"8a021b733ac5878ba062bef8b0c57d10d7eb1d23\">\r\n<pre>[[迪伦的荒原世界]]</pre>\r\n</div>\r\n<div title=\"RevisionTemplate\" server.title=\"RevisionTemplate\" server.page.revision=\"1521915\" server.etag=\"&quot;system-theme_public/RevisionTemplate/1521915:492d8c009354904299780b520a6ba5b50b6e3340&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-theme_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-theme_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeMissing excludeSearch\" _hash=\"b182c10523c4d9fe3f622b1529b70d43f5150701\">\r\n<pre>&lt;!--{{{--&gt;\r\n&lt;div macro='slideRevision'&gt;&lt;/div&gt;\r\n&lt;div class='heading'&gt;\r\n\t&lt;span class=\"titleBar\"&gt;\r\n\t\t&lt;div class='title' macro='view title text'&gt;&lt;/div&gt;\r\n\t&lt;/span&gt;\r\n\t&lt;span class='modifierIcon'\r\n\t\tmacro='view modifier SiteIcon label:no height:48 width:48 preserveAspectRatio:yes'&gt;\r\n\t&lt;/span&gt;\r\n\t&lt;div class='toolbar'\r\n\t\tmacro='toolbar [[ToolbarCommands::RevisionToolbar]] icons:yes height:48 width:48 more:popup'&gt;\r\n\t&lt;/div&gt;\r\n\t&lt;div class='tagClear'&gt;&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;div class='content'&gt;\r\n\t&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;div class='tagInfo'&gt;\r\n\t&lt;div class='tidTags' macro='tags'&gt;&lt;/div&gt;\r\n\t&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;!--}}}--&gt;</pre>\r\n</div>\r\n<div title=\"GettingStarted\" server.title=\"GettingStarted\" server.page.revision=\"2564927\" server.etag=\"&quot;pearl_public/GettingStarted/2564927:012c707a3be59f067c6dba3040e10caffcf5534e&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160925061512\" created=\"20160925032542\" tags=\"\" _hash=\"80986d3be60963d0887194a9e51cdee24d678c2e\">\r\n<pre>To get started with this blank [[TiddlyWiki]], you'll need to modify the following tiddlers:\r\n* [[SiteTitle]] &amp; [[SiteSubtitle]]: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)\r\n* [[MainMenu]]: The menu (usually on the left)\r\n* [[DefaultTiddlers]]: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened\r\nYou'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;\r\n</pre>\r\n</div>\r\n<div title=\"TiddlySpacePublishingCommands\" server.title=\"TiddlySpacePublishingCommands\" server.page.revision=\"1521868\" server.etag=\"&quot;system-plugins_public/TiddlySpacePublishingCommands/1521868:b5c37b2db6dd21a144ea77a93801bae592f06fe1&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-plugins_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-plugins_public\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"d38da0ee80a7dc114a17466600f9430fa2a962bb\">\r\n<pre>/***\r\n|''Name''|TiddlySpacePublishingCommands|\r\n|''Version''|0.8.5|\r\n|''Status''|@@beta@@|\r\n|''Description''|toolbar commands for drafting and publishing|\r\n|''Author''|Jon Robson|\r\n|''Source''|http://github.com/TiddlySpace/tiddlyspace/raw/master/src/plugins/TiddlySpacePublishingCommands.js|\r\n|''CoreVersion''|2.6.1|\r\n|''Requires''|TiddlySpaceConfig TiddlySpaceFilters|\r\n!Usage\r\nProvides changeToPrivate, changeToPublic and saveDraft commands\r\nProvides TiddlySpacePublisher macro.\r\n{{{&lt;&lt;TiddlySpacePublisher type:private&gt;&gt;}}} make lots of private tiddlers public.\r\n{{{&lt;&lt;TiddlySpacePublisher type:public&gt;&gt;}}} make lots of public tiddlers public.\r\n!TODO\r\n* add public argument?\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nvar tiddlyspace = config.extensions.tiddlyspace;\r\nvar originMacro = config.macros.tiddlerOrigin;\r\n\r\ntiddlyspace.getTiddlerStatusType = function(tiddler) {\r\n\tvar isShadow = store.isShadowTiddler(tiddler.title);\r\n\tvar exists = store.tiddlerExists(tiddler.title);\r\n\tif(isShadow &amp;&amp; !exists) {\r\n\t\treturn \"shadow\";\r\n\t} else if(!exists) {\r\n\t\treturn \"missing\";\r\n\t} else {\r\n\t\tvar types = [\"private\", \"public\"];\r\n\t\tvar type = \"external\";\r\n\t\tfor(var i = 0; i &lt; types.length; i++) {\r\n\t\t\tvar t = types[i];\r\n\t\t\ttype = config.filterHelpers.is[t](tiddler) ? t : type;\r\n\t\t}\r\n\t\tif(config.filterHelpers.is.unsynced(tiddler)) {\r\n\t\t\ttype = type == \"private\" ? \"unsyncedPrivate\" : \"unsyncedPublic\";\r\n\t\t}\r\n\t\treturn type;\r\n\t}\r\n};\r\n\r\nvar cmd = config.commands.publishTiddler = {\r\n\ttext: \"make public\",\r\n\ttooltip: \"Change this private tiddler into a public tiddler\",\r\n\terrorMsg: \"Error publishing %0: %1\",\r\n\r\n\tisEnabled: function(tiddler) {\r\n\t\treturn !readOnly &amp;&amp; config.filterHelpers.is[\"private\"](tiddler);\r\n\t},\r\n\thandler: function(ev, src, title) {\r\n\t\tvar tiddler = store.getTiddler(title);\r\n\t\tif(tiddler) {\r\n\t\t\tvar newBag = cmd.toggleBag(tiddler.fields[\"server.bag\"]);\r\n\t\t\tthis.moveTiddler(tiddler, {\r\n\t\t\t\ttitle: tiddler.fields[\"publish.name\"] || tiddler.title,\r\n\t\t\t\tfields: { \"server.bag\": newBag }\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\ttoggleBag: function(bag, to) {\r\n\t\tvar newBag;\r\n\t\tif(typeof bag != typeof \"\") {\r\n\t\t\tvar tiddler = bag;\r\n\t\t\tbag = tiddler.fields[\"server.bag\"];\r\n\t\t}\r\n\t\tif(bag.indexOf(\"_private\") &gt; -1) { // should make use of endsWith\r\n\t\t\tto = to ? to : \"public\";\r\n\t\t\tnewBag = bag.replace(\"_private\", \"_\" + to);\r\n\t\t} else {\r\n\t\t\tto = to ? to : \"private\";\r\n\t\t\tnewBag = bag.replace(\"_public\", \"_\" + to);\r\n\t\t}\r\n\t\treturn newBag;\r\n\t},\r\n\tcopyTiddler: function(title, newTitle, newBag, callback) {\r\n\t\tvar original = store.getTiddler(title);\r\n\t\tnewTitle = newTitle ? newTitle : title;\r\n\t\tvar adaptor = original.getAdaptor();\r\n\t\tvar publish = function(original, callback) {\r\n\t\t\tvar tiddler = $.extend(new Tiddler(newTitle), original);\r\n\t\t\ttiddler.fields = $.extend({}, original.fields, {\r\n\t\t\t\t\"server.bag\": newBag,\r\n\t\t\t\t\"server.workspace\": \"bags/%0\".format(newBag),\r\n\t\t\t\t\"server.page.revision\": \"false\"\r\n\t\t\t});\r\n\t\t\tdelete tiddler.fields[\"server.title\"];\r\n\t\t\ttiddler.title = newTitle;\r\n\t\t\tadaptor.putTiddler(tiddler, null, null, callback);\r\n\t\t};\r\n\t\tpublish(original, callback);\r\n\t},\r\n\tmoveTiddler: function(tiddler, newTiddler, callback) {\r\n\t\t\tvar info = {\r\n\t\t\tcopyContext: {},\r\n\t\t\tdeleteContext: {}\r\n\t\t};\r\n\t\tvar _dirty = store.isDirty();\r\n\t\tvar adaptor = tiddler.getAdaptor();\r\n\t\tvar newTitle = newTiddler.title;\r\n\t\tvar oldTitle = tiddler.title;\r\n\t\tdelete tiddler.fields[\"server.workspace\"];\r\n\t\tvar oldBag = tiddler.fields[\"server.bag\"];\r\n\t\tvar newBag = newTiddler.fields[\"server.bag\"];\r\n\t\tvar newWorkspace = \"bags/%0\".format(newBag);\r\n\t\tcmd.copyTiddler(oldTitle, newTitle, newBag, function(ctx) {\r\n\t\t\t\tinfo.copyContext = ctx;\r\n\t\t\t\tvar context = {\r\n\t\t\t\t\ttiddler: tiddler,\r\n\t\t\t\t\tworkspace: newWorkspace\r\n\t\t\t\t};\r\n\t\t\t\tstore.addTiddler(ctx.tiddler);\r\n\t\t\t\ttiddler.title = oldTitle; // for cases where a rename occurs\r\n\t\t\t\tif(ctx.status) { // only do if a success\r\n\t\t\t\t\tif(oldBag != newBag) {\r\n\t\t\t\t\t\tadaptor.deleteTiddler(tiddler, context, {}, function(ctx) {\r\n\t\t\t\t\t\t\tinfo.deleteContext = ctx;\r\n\t\t\t\t\t\t\tvar el;\r\n\t\t\t\t\t\t\tif(tiddler) {\r\n\t\t\t\t\t\t\t\ttiddler.fields[\"server.workspace\"] = newWorkspace;\r\n\t\t\t\t\t\t\t\ttiddler.fields[\"server.bag\"] = newBag;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tel = el ? el : story.refreshTiddler(oldTitle, null, true);\r\n\t\t\t\t\t\t\tif(oldTitle != newTitle) {\r\n\t\t\t\t\t\t\t\tstore.deleteTiddler(oldTitle);\r\n\t\t\t\t\t\t\t\tstore.notify(oldTitle, true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(el) {\r\n\t\t\t\t\t\t\t\tstory.displayTiddler(el, newTitle);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(oldTitle != newTitle) {\r\n\t\t\t\t\t\t\t\tstory.closeTiddler(oldTitle);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(callback) {\r\n\t\t\t\t\t\t\t\tcallback(info);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tstore.setDirty(_dirty);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif(callback) {\r\n\t\t\t\t\t\t\tcallback(info);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\trefreshDisplay();\r\n\t\t\t\t}\r\n\t\t});\r\n\t}\r\n};\r\n\r\nvar changeToPrivate = config.commands.changeToPrivate = {\r\n\ttext: \"make private\",\r\n\ttooltip: \"turn this public tiddler into a private tiddler\",\r\n\tisEnabled: function(tiddler) {\r\n\t\treturn !readOnly &amp;&amp; config.filterHelpers.is[\"public\"](tiddler);\r\n\t},\r\n\thandler: function(event, src, title) {\r\n\t\tvar tiddler = store.getTiddler(title);\r\n\t\tvar newBag = cmd.toggleBag(tiddler, \"private\");\r\n\t\tvar newTiddler = { title: title, fields: { \"server.bag\": newBag }};\r\n\t\tcmd.moveTiddler(tiddler, newTiddler);\r\n\t}\r\n};\r\nconfig.commands.changeToPublic = cmd;\r\n\r\n/* Save as draft command */\r\nvar saveDraftCmd = config.commands.saveDraft = {\r\n\ttext: \"save draft\",\r\n\ttooltip: \"Save as a private draft\",\r\n\tisEnabled: function(tiddler) {\r\n\t\treturn changeToPrivate.isEnabled(tiddler);\r\n\t},\r\n\tgetDraftTitle: function(title) {\r\n\t\tvar draftTitle;\r\n\t\tvar draftNum = \"\";\r\n\t\twhile(!draftTitle) {\r\n\t\t\tvar suggestedTitle = \"%0 [draft%1]\".format(title, draftNum);\r\n\t\t\tif(store.getTiddler(suggestedTitle)) {\r\n\t\t\t\tdraftNum = !draftNum ? 2 : draftNum + 1;\r\n\t\t\t} else {\r\n\t\t\t\tdraftTitle = suggestedTitle;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn draftTitle;\r\n\t},\r\n\tcreateDraftTiddler: function(title, gatheredFields) {\r\n\t\tvar tiddler = store.getTiddler(title);\r\n\t\tvar draftTitle = saveDraftCmd.getDraftTitle(title);\r\n\t\tvar draftTiddler = new Tiddler(draftTitle);\r\n\t\tif(tiddler) {\r\n\t\t\t$.extend(true, draftTiddler, tiddler);\r\n\t\t} else {\r\n\t\t\t$.extend(draftTiddler.fields, config.defaultCustomFields);\r\n\t\t}\r\n\t\tfor(var fieldName in gatheredFields) {\r\n\t\t\tif(TiddlyWiki.isStandardField(fieldName)) {\r\n\t\t\t\tdraftTiddler[fieldName] = gatheredFields[fieldName];\r\n\t\t\t} else {\r\n\t\t\t\tdraftTiddler.fields[fieldName] = gatheredFields[fieldName];\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar privateBag = tiddlyspace.getCurrentBag(\"private\");\r\n\t\tvar privateWorkspace = tiddlyspace.getCurrentWorkspace(\"private\");\r\n\t\tdraftTiddler.title = draftTitle;\r\n\t\tdraftTiddler.fields[\"publish.name\"] = title;\r\n\t\tdraftTiddler.fields[\"server.workspace\"] = privateWorkspace;\r\n\t\tdraftTiddler.fields[\"server.bag\"] = privateBag;\r\n\t\tdraftTiddler.fields[\"server.title\"] = draftTitle;\r\n\t\tdraftTiddler.fields[\"server.page.revision\"] = \"false\";\r\n\t\tdelete draftTiddler.fields[\"server.etag\"];\r\n\t\treturn draftTiddler;\r\n\t},\r\n\thandler: function(ev, src, title) {\r\n\t\tvar tiddler = store.getTiddler(title); // original tiddler\r\n\t\tvar tidEl = story.getTiddler(title);\r\n\t\tvar uiFields = {};\r\n\t\tstory.gatherSaveFields(tidEl, uiFields);\r\n\t\tvar tid = saveDraftCmd.createDraftTiddler(title, uiFields);\r\n\t\ttid = store.saveTiddler(tid.title, tid.title, tid.text, tid.modifier,\r\n\t\t\tnew Date(), tid.tags, tid.fields);\r\n\t\tautoSaveChanges(null, [tid]);\r\n\t\tstory.closeTiddler(title);\r\n\t\tstory.displayTiddler(src, title);\r\n\t\tstory.displayTiddler(src, tid.title);\r\n\t}\r\n};\r\n\r\nvar macro = config.macros.TiddlySpacePublisher = {\r\n\tlocale: {\r\n\t\ttitle: \"Batch Publisher\",\r\n\t\tchangeStatusLabel: \"Make %0\",\r\n\t\tnoTiddlersText: \"No tiddlers to publish\",\r\n\t\tchangeStatusPrompt: \"Make all the selected tiddlers %0.\",\r\n\t\tdescription: \"Change tiddlers from %0 to %1 in this space\"\r\n\t},\r\n\r\n\tlistViewTemplate: {\r\n\t\tcolumns: [\r\n\t\t\t{ name: \"Selected\", field: \"Selected\", rowName: \"title\", type: \"Selector\" },\r\n\t\t\t{ name: \"Tiddler\", field: \"tiddler\", title: \"Tiddler\", type: \"Tiddler\" },\r\n\t\t\t{ name: \"Status\", field: \"status\", title: \"Status\", type: \"WikiText\" }\r\n\t\t],\r\n\t\trowClasses: []\r\n\t},\r\n\r\n\tchangeStatus: function(tiddlers, status, callback) { // this is what is called when you click the publish button\r\n\t\tvar publicBag;\r\n\t\tfor(var i = 0; i &lt; tiddlers.length; i++) {\r\n\t\t\tvar tiddler = tiddlers[i];\r\n\t\t\tvar newTiddler = {\r\n\t\t\t\ttitle: tiddler.title,\r\n\t\t\t\tfields: { \"server.bag\": cmd.toggleBag(tiddler, status) }\r\n\t\t\t};\r\n\t\t\tcmd.moveTiddler(tiddler, newTiddler, callback);\r\n\t\t}\r\n\t},\r\n\tgetMode: function(paramString) {\r\n\t\tvar params = paramString.parseParams(\"anon\")[0];\r\n\t\tvar status = params.type ?\r\n\t\t\t([\"public\", \"private\"].contains(params.type[0]) ? params.type[0] : \"private\") :\r\n\t\t\t\"private\";\r\n\t\tvar newStatus = status == \"public\" ? \"private\" : \"public\";\r\n\t\treturn [status, newStatus];\r\n\t},\r\n\thandler: function(place, macroName, params, wikifier, paramString, tiddler) {\r\n\t\tvar wizard = new Wizard();\r\n\t\tvar locale = macro.locale;\r\n\t\tvar status = macro.getMode(paramString);\r\n\t\twizard.createWizard(place, locale.title);\r\n\t\twizard.addStep(macro.locale.description.format(status[0], status[1]),\r\n\t\t\t'&lt;input type=\"hidden\" name=\"markList\" /&gt;');\r\n\t\tvar markList = wizard.getElement(\"markList\");\r\n\t\tvar listWrapper = $(\"&lt;div /&gt;\").addClass(\"batchPublisher\").\r\n\t\t\tattr(\"refresh\", \"macro\").attr(\"macroName\", macroName).\r\n\t\t\tattr(\"params\", paramString)[0];\r\n\t\tmarkList.parentNode.insertBefore(listWrapper, markList);\r\n\t\t$.data(listWrapper, \"wizard\", wizard);\r\n\t\tmacro.refresh(listWrapper);\r\n\t},\r\n\tgetCheckedTiddlers: function(listWrapper, titlesOnly) {\r\n\t\tvar tiddlers = [];\r\n\t\t$(\".chkOptionInput[rowName]:checked\", listWrapper).each(function(i, el) {\r\n\t\t\tvar title = $(el).attr(\"rowName\");\r\n\t\t\tif(titlesOnly) {\r\n\t\t\t\ttiddlers.push(title);\r\n\t\t\t} else {\r\n\t\t\t\ttiddlers.push(store.getTiddler(title));\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn tiddlers;\r\n\t},\r\n\trefresh: function(listWrapper) {\r\n\t\tvar checked = macro.getCheckedTiddlers(listWrapper, true);\r\n\t\tvar paramString = $(listWrapper).empty().attr(\"params\");\r\n\t\tvar wizard = $.data(listWrapper, \"wizard\");\r\n\t\tvar locale = macro.locale;\r\n\t\tvar params = paramString.parseParams(\"anon\")[0];\r\n\t\tvar publishCandidates = [];\r\n\t\tvar status = macro.getMode(paramString);\r\n\t\tvar pubType = status[0];\r\n\t\tvar newPubType = status[1];\r\n\t\tvar tiddlers = params.filter ? store.filterTiddlers(params.filter[0]) :\r\n\t\t\tstore.filterTiddlers(\"[is[%0]]\".format(pubType));\r\n\t\tvar enabled = [];\r\n\t\tfor(var i = 0; i &lt; tiddlers.length; i++) {\r\n\t\t\tvar tiddler = tiddlers[i];\r\n\t\t\tvar title = tiddler.title;\r\n\t\t\tif(!tiddler.tags.contains(\"excludePublisher\") &amp;&amp; title !== \"SystemSettings\") {\r\n\t\t\t\tpublishCandidates.push({ title: title, tiddler: tiddler, status: pubType});\r\n\t\t\t}\r\n\t\t\tif(checked.contains(title)) {\r\n\t\t\t\tenabled.push(\"[rowname=%0]\".format(title));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(publishCandidates.length === 0) {\r\n\t\t\tcreateTiddlyElement(listWrapper, \"em\", null, null, locale.noTiddlersText);\r\n\t\t} else {\r\n\t\t\tvar listView = ListView.create(listWrapper, publishCandidates, macro.listViewTemplate);\r\n\t\t\twizard.setValue(\"listView\", listView);\r\n\t\t\tvar btnHandler = function(ev) {\r\n\t\t\t\tvar tiddlers = macro.getCheckedTiddlers(listWrapper);\r\n\t\t\t\tvar callback = function(status) {\r\n\t\t\t\t\t$(\".batchPublisher\").each(function(i, el) {\r\n\t\t\t\t\t\tmacro.refresh(el);\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t\tmacro.changeStatus(tiddlers, newPubType, callback);\r\n\t\t\t};\r\n\t\t\twizard.setButtons([{\r\n\t\t\t\tcaption: locale.changeStatusLabel.format(newPubType),\r\n\t\t\t\ttooltip: locale.changeStatusPrompt.format(newPubType),\r\n\t\t\t\tonClick: btnHandler\r\n\t\t\t}]);\r\n\t\t\t$(enabled.join(\",\")).attr(\"checked\", true); // retain what was checked before\r\n\t\t}\r\n\t}\r\n};\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"TiddlySpaceTabs\" server.title=\"TiddlySpaceTabs\" server.page.revision=\"1521916\" server.etag=\"&quot;system-theme_public/TiddlySpaceTabs/1521916:48b36cf300721f83c6d4fc34443dce86dccc59ab&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-theme_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-theme_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch\" _hash=\"7bc357188d6afd65d6724a670b0052c0488766a4\">\r\n<pre>!Spaces\r\n&lt;&lt;groupBy server.bag&gt;&gt;\r\n\r\n!Private\r\n&lt;&lt;list filter [is[private]]&gt;&gt;\r\n\r\n!Public\r\n&lt;&lt;list filter [is[public]]&gt;&gt;\r\n\r\n!Drafts\r\n&lt;&lt;list filter [is[draft]]&gt;&gt;</pre>\r\n</div>\r\n<div title=\"TiddlySpaceBackstage\" server.title=\"TiddlySpaceBackstage\" server.page.revision=\"1521910\" server.etag=\"&quot;tiddlyspace/TiddlySpaceBackstage/1521910:47373b8e4869ea8db8df8d166ad6940099706057&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"390091c823ffd5ec5008f2a8174c3caccfa6302b\">\r\n<pre>/***\r\n|''Name''|TiddlySpaceBackstage|\r\n|''Version''|0.8.0|\r\n|''Description''|Provides a TiddlySpace version of the backstage and a homeLink macro|\r\n|''Status''|@@beta@@|\r\n|''Contributors''|Jon Lister, Jon Robson, Colm Britton|\r\n|''Source''|http://github.com/TiddlySpace/tiddlyspace/raw/master/src/plugins/TiddlySpaceBackstage.js|\r\n|''Requires''|TiddlySpaceConfig ImageMacroPlugin TiddlySpaceViewTypes|\r\n!StyleSheet\r\n.tiddler .error.annotation .button{\r\n\tdisplay: inline-block;\r\n}\r\n\r\n#backstageArea {\r\n\tz-index: 49;\r\n\tcolor: white;\r\n\tbackground-color: black;\r\n\tbackground: -webkit-gradient(linear,left bottom,left top,color-stop(0, #222),color-stop(0.5, #333),color-stop(1, #555));\r\n\tbackground: -moz-linear-gradient(center bottom,#222 0%, #333 50%, #555 100%);\r\n\tfilter: progid:DXImageTransform.Microsoft.gradient(startColorstr=#ff555555, endColorstr=#ff222222);\r\n\t-ms-filter: \"progid:DXImageTransform.Microsoft.gradient(startColorstr=#ff555555, endColorstr=#ff222222)\";\r\n\theight: 25px;\r\n\tpadding: 0;\r\n}\r\n\r\n#backstageButton {\r\n\toverflow: hidden;\r\n}\r\n\r\n#backstageButton #backstageShow,\r\n#backstageButton #backstageHide {\r\n\tmargin: 0px;\r\n\tpadding: 0px;\r\n}\r\n\r\n#backstageButton #backstageShow:hover,\r\n#backstageButton #backstageHide:hover {\r\n\tbackground: none;\r\n\tcolor: none;\r\n}\r\n\r\n#backstageButton img,\r\n#backstageButton svg {\r\n\twidth: 24px;\r\n\theight: 24px;\r\n}\r\n\r\n#messageArea {\r\n\ttop: 50px;\r\n}\r\n\r\n#backstageToolbar {\r\n\tposition: relative;\r\n}\r\n\r\n#backstageArea a {\r\n\tpadding: 0px;\r\n\tmargin-left: 0px;\r\n\tcolor: white;\r\n\tbackground: none;\r\n}\r\n\r\n#backstageArea a:hover {\r\n\tbackground-color: white;\r\n}\r\n\r\n#backstage ol,\r\n#backstage ul {\r\n\tpadding: auto;\r\n}\r\n\r\n#backstageButton a {\r\n\tmargin: 0;\r\n}\r\n\r\n.backstagePanelBody ul {\r\n\tpadding: 5px;\r\n\tmargin: 5px;\r\n}\r\n\r\n#backstage #backstagePanel {\r\n\tmargin-left: 5%;\r\n\tpadding: 0em;\r\n\tmargin-right: 5%;\r\n}\r\n\r\n#backstageToolbar a {\r\n\tposition: relative;\r\n}\r\n\r\n#backstageArea a.backstageSelTab,\r\n#backstageToolbar .backstageTask {\r\n\tline-height: 25px;\r\n\tcolor: #767676;\r\n}\r\n\r\n.backstageTask .externalImage,\r\n.backstageTask .image {\r\n\tdisplay: inline;\r\n}\r\n\r\n#backstageToolbar a span {\r\n\tz-index: 2;\r\n}\r\n\r\na.backstageTask {\r\n\tdisplay: inline;\r\n        margin-left: 1em !important;\r\n}\r\n\r\n.backstagePanelBody .button {\r\n\tdisplay: inline-block;\r\n\tmargin-right: 10px;\r\n}\r\n\r\n.backstagePanelBody {\r\n\tmargin: 0 0 0 0.6em;\r\n\tpadding: 0.4em 0.5em 1px 0.5em;\r\n}\r\n\r\n#backstage table {\r\n\tmargin: auto;\r\n}\r\n\r\n#backstage .wizard table {\r\n\tborder: 0px;\r\n\tmargin: 0;\r\n}\r\n\r\n#backstage div  li.listLink {\r\n\tborder: 0px;\r\n\twidth: 78%;\r\n\tfont-size: 0.7em;\r\n}\r\n\r\n#backstage div li.listTitle {\r\n\tfont-weight: bold;\r\n\ttext-decoration: underline;\r\n\tfont-size: 1em;\r\n\tbackground: #ccc;\r\n\twidth: 100%;\r\n}\r\n\r\n#backstage fieldset {\r\n\tborder: solid 1px [[ColorPalette::Background]];\r\n}\r\n\r\n#backstage .viewer table,#backstage table.twtable {\r\n\tborder: 0px;\r\n}\r\n\r\n#backstageToolbar img {\r\n\tpadding: 0;\r\n}\r\n\r\n#backstage .wizard,\r\n#backstage .wizardFooter {\r\n\tbackground: none;\r\n}\r\n\r\n.viewer td, .viewer tr, .twtable td, .twtable tr {\r\n\tborder: 1px solid #eee;\r\n}\r\n\r\n#backstage .inlineList ul li {\r\n\tbackground-color: [[ColorPalette::Background]];\r\n\tborder: solid 1px [[ColorPalette::TertiaryMid]];\r\n\tdisplay: block;\r\n\tfloat: left;\r\n\tlist-style: none;\r\n\tmargin-right: 1em;\r\n\tpadding: 0.5em;\r\n}\r\n\r\n.backstageClear, .inlineList form {\r\n\tclear: both;\r\n\tdisplay: block;\r\n\tmargin-top: 3em;\r\n}\r\n\r\n.tiddlyspaceMenu {\r\n\ttext-align: center;\r\n}\r\n\r\nspan.chunkyButton {\r\n\tdisplay: inline-block;\r\n\tpadding: 0;\r\n\tmargin: 0;\r\n\tborder: solid 2px #000;\r\n\tbackground-color: #04b;\r\n}\r\n\r\nspan.chunkyButton a.button, span.chunkyButton a:active.button {\r\n\twhite-space: nowrap;\r\n\tfont-weight: bold;\r\n\tfont-size: 1.8em;\r\n\tcolor: #fff;\r\n\ttext-align: center;\r\n\tpadding: 0.5em 0.5em;\r\n\tmargin: 0;\r\n\tborder-style: none;\r\n\tdisplay: block;\r\n}\r\n\r\nspan.chunkyButton:hover {\r\n\tbackground-color: #014;\r\n}\r\n\r\nspan.chunkyButton a.button:hover {\r\n\tborder-style: none;\r\n\tbackground: none;\r\n\tcolor: #fff;\r\n}\r\n\r\n#backstage .unpluggedSpaceTab .wizard,\r\n.unpluggedSpaceTab .wizard {\r\n\tbackground: white;\r\n\tborder: 2px solid #CCC;\r\n\tpadding: 5px;\r\n}\r\n\r\n.syncKey .keyItem {\r\n\tborder: 1px solid black;\r\n\tdisplay: inline-block;\r\n\tmargin: 0.2em;\r\n\tpadding: 0.1em 0.1em 0.1em 0.1em;\r\n}\r\n\r\n.keyHeading {\r\n\tfont-size: 2em;\r\n\tfont-weight: bold;\r\n\tmargin: 0.4em 0em -0.2em;\r\n}\r\n\r\n.unpluggedSpaceTab .putToServer,\r\n.unpluggedSpaceTab .notChanged {\r\n\tdisplay: none;\r\n}\r\n\r\n.tiddlyspaceMenu ul {\r\n\tmargin: 0;\r\n\tpadding: 0;\r\n}\r\n\r\n.tiddlyspaceMenu ul li {\r\n\tlist-style: none;\r\n}\r\n\r\n.unsyncedChanges .unsyncedList {\r\n\tdisplay: block;\r\n}\r\n\r\n.unsyncedList {\r\n\tdisplay: none;\r\n}\r\n!Code\r\n***/\r\n//{{{\r\n(function ($) {\r\n    var name = \"StyleSheet\" + tiddler.title;\r\n    config.shadowTiddlers[name] = \"/*{{{*/\\n%0\\n/*}}}*/\".\r\n        format(store.getTiddlerText(tiddler.title + \"##StyleSheet\")); // this accesses the StyleSheet section of the current tiddler (the plugin that contains it)\r\n    store.addNotification(name, refreshStyles);\r\n\r\n    if (!config.extensions.tiddlyweb.status.tiddlyspace_version) { // unplugged\r\n        config.extensions.tiddlyweb.status.tiddlyspace_version = \"&lt;unknown&gt;\";\r\n        config.extensions.tiddlyweb.status.server_host = {\r\n            url:config.extensions.tiddlyweb.host }; // TiddlySpaceLinkPlugin expects this\r\n    }\r\n    var disabled_tasks_for_nonmembers = [\"tiddlers\", \"plugins\", \"batch\", \"sync\"];\r\n\r\n    var tweb = config.extensions.tiddlyweb;\r\n    var tiddlyspace = config.extensions.tiddlyspace;\r\n    var currentSpace = tiddlyspace.currentSpace.name;\r\n    var imageMacro = config.macros.image;\r\n\r\n    if (config.options.chkBackstage === undefined) {\r\n        config.options.chkBackstage = false;\r\n    }\r\n\r\n// Set up Backstage\r\n    config.tasks = {};\r\n    config.tasks.status = {\r\n        text:\"status\",\r\n        tooltip:\"TiddlySpace Info\",\r\n        content:\"&lt;&lt;tiddler Backstage##Menu&gt;&gt;\"\r\n    };\r\n    config.tasks.tiddlers = {\r\n        text:\"tiddlers\",\r\n        tooltip:\"tiddlers control panel\",\r\n        content:\"&lt;&lt;tiddler Backstage##BackstageTiddlers&gt;&gt;\"\r\n    };\r\n    config.tasks.plugins = {\r\n        text:\"plugins\",\r\n        tooltip:\"Manage installed plugins\",\r\n        content:\"&lt;&lt;tiddler Backstage##Plugins&gt;&gt;\"\r\n    };\r\n    config.tasks.batch = {\r\n        text:\"batch\",\r\n        tooltip:\"Batch manage public/private tiddlers\",\r\n        content:\"&lt;&lt;tiddler Backstage##BatchOps&gt;&gt;\"\r\n    };\r\n    config.tasks.tweaks = {\r\n        text:\"tweaks\",\r\n        tooltip:\"Tweak TiddlyWiki behaviors\",\r\n        content:\"&lt;&lt;tiddler Backstage##Tweaks&gt;&gt;\"\r\n    };\r\n    config.tasks.exportTiddlers = {\r\n        text:\"import/export\",\r\n        tooltip:\"Import/export tiddlers from/to a TiddlyWiki\",\r\n        content:\"&lt;&lt;tiddler Backstage##ImportExport&gt;&gt;\"\r\n    };\r\n    config.tasks.sync = {\r\n        text:\"sync\",\r\n        tooltip:\"Check Sync status\",\r\n        content:\"&lt;&lt;tiddler Backstage##SpaceUnplugged&gt;&gt;\"\r\n    };\r\n\r\n    if (window.location.protocol === \"file:\") {\r\n        config.unplugged = true;\r\n    }\r\n\r\n    config.backstageTasks = [\"status\", \"tiddlers\", \"plugins\",\r\n        \"batch\", \"tweaks\", \"exportTiddlers\", \"sync\"];\r\n\r\n    config.messages.backstage.prompt = \"\";\r\n// initialize state\r\n    var _show = backstage.show;\r\n    backstage.show = function () {\r\n        // selectively hide backstage tasks and tabs based on user status\r\n        var tasks = $(\"#backstageToolbar .backstageTask\").show();\r\n        var bs = backstage.tiddlyspace;\r\n        if (!config.unplugged) {\r\n            tweb.getUserInfo(function (user) {\r\n                if (user.anon) {\r\n                    jQuery.each(disabled_tasks_for_nonmembers, function (i, task) {\r\n                        var taskIndex = config.backstageTasks.indexOf(task);\r\n                        if (taskIndex !== -1) {\r\n                            config.backstageTasks.splice(taskIndex, 1);\r\n                        }\r\n                    });\r\n                    config.messages.memberStatus = bs.locale.loggedout;\r\n                } else {\r\n                    config.messages.memberStatus = readOnly ?\r\n                        bs.locale.nonmember : bs.locale.member;\r\n                }\r\n            });\r\n        } else {\r\n            config.messages.memberStatus = bs.locale.unplugged;\r\n        }\r\n\r\n        // display backstage\r\n        return _show.apply(this, arguments);\r\n    };\r\n    if (readOnly) {\r\n        jQuery.each(disabled_tasks_for_nonmembers, function (i, task) {\r\n            var taskIndex = config.backstageTasks.indexOf(task);\r\n            if (taskIndex !== -1) {\r\n                config.backstageTasks.splice(taskIndex, 1);\r\n            }\r\n        });\r\n    }\r\n\r\n    var tasks = config.tasks;\r\n    var commonUrl = \"/bags/common/tiddlers/%0\";\r\n\r\n    backstage.tiddlyspace = {\r\n        locale:{\r\n            member:\"You are a member of this space.\",\r\n            nonmember:\"You are not a member of this space.\",\r\n            loggedout:\"You are currently logged out of TiddlySpace.\",\r\n            unplugged:\"You are unplugged.\"\r\n        },\r\n        showButton:function () {\r\n            var showBtn = $(\"#backstageShow\")[0];\r\n            var altText = $(showBtn).text();\r\n            $(showBtn).empty();\r\n            imageMacro.renderImage(showBtn, \"backstage.svg\",\r\n                { altImage:commonUrl.format(\"backstage.png\"), alt:altText});\r\n        },\r\n        hideButton:function () {\r\n            var hideBtn = $(\"#backstageHide\")[0];\r\n            var altText = $(hideBtn).text();\r\n            $(hideBtn).empty();\r\n            imageMacro.renderImage(hideBtn, \"close.svg\",\r\n                { altImage:commonUrl.format(\"close.png\"), alt:altText, width:24, height:24 });\r\n        }\r\n    };\r\n\r\n    var _init = backstage.init;\r\n    backstage.init = function () {\r\n        _init.apply(this, arguments);\r\n        var init = function (user) {\r\n            var bs = backstage.tiddlyspace;\r\n            bs.showButton();\r\n            bs.hideButton();\r\n        };\r\n        tweb.getUserInfo(init);\r\n    };\r\n\r\n    var home = config.macros.homeLink = {\r\n        locale:{\r\n            linkText:\"your home space\"\r\n        },\r\n        handler:function (place) {\r\n            var container = $(\"&lt;span /&gt;\").appendTo(place)[0];\r\n            tweb.getUserInfo(function (user) {\r\n                if (!user.anon &amp;&amp; user.name !== currentSpace) {\r\n                    createSpaceLink(container, user.name, null, home.locale.linkText);\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    config.macros.exportSpace = {\r\n        handler:function (place, macroName, params) {\r\n            var filename = params[0] ||\r\n                \"/tiddlers.wiki?download=%0.html\".format(currentSpace);\r\n            $('&lt;a class=\"button\"&gt;download&lt;/a&gt;').// XXX: i18n\r\n                attr(\"href\", filename).appendTo(place);\r\n        }\r\n    };\r\n\r\n}(jQuery));\r\n//}}}</pre>\r\n</div>\r\n<div title=\"RevisionsCommandPlugin\" server.title=\"RevisionsCommandPlugin\" server.page.revision=\"1521856\" server.etag=\"&quot;system/RevisionsCommandPlugin/1521856:46e4b6c33fb159d88305522fe52f0cf080b8cc52&quot;\" modifier=\"FND\" creator=\"FND\" server.workspace=\"bags/system\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20130924180405\" created=\"20130924180405\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"d36d2c8a7f8dd9a59dd54e772114a415b2c22979\">\r\n<pre>/***\r\n|''Name''|RevisionsCommandPlugin|\r\n|''Description''|provides access to tiddler revisions|\r\n|''Author''|FND|\r\n|''Contributors''|Martin Budden|\r\n|''Version''|0.3.3|\r\n|''Status''|@@beta@@|\r\n|''Source''|http://svn.tiddlywiki.org/Trunk/association/plugins/RevisionsCommandPlugin.js|\r\n|''CodeRepository''|http://svn.tiddlywiki.org/Trunk/association/plugins/|\r\n|''License''|[[BSD|http://www.opensource.org/licenses/bsd-license.php]]|\r\n|''CoreVersion''|2.6.0|\r\n|''Keywords''|serverSide|\r\n!Usage\r\nExtend [[ToolbarCommands]] with {{{revisions}}}.\r\n!Revision History\r\n!!v0.1 (2009-07-23)\r\n* initial release (renamed from experimental ServerCommandsPlugin)\r\n!!v0.2 (2010-03-04)\r\n* suppressed wikification in diff view\r\n!!v0.3 (2010-04-07)\r\n* restored wikification in diff view\r\n* added link to side-by-side diff view\r\n!To Do\r\n* strip server.* fields from revision tiddlers\r\n* resolve naming conflicts\r\n* i18n, l10n\r\n* code sanitizing\r\n* documentation\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\njQuery.twStylesheet(\".diff { white-space: pre, font-family: monospace }\",\r\n\t{ id: \"diff\" });\r\n\r\nvar cmd = config.commands.revisions = {\r\n\ttype: \"popup\",\r\n\thideShadow: true,\r\n\ttext: \"revisions\",\r\n\ttooltip: \"display tiddler revisions\",\r\n\trevTooltip: \"\", // TODO: populate dynamically?\r\n\tloadLabel: \"loading...\",\r\n\tloadTooltip: \"loading revision list\",\r\n\tselectLabel: \"select\",\r\n\tselectTooltip: \"select revision for comparison\",\r\n\tselectedLabel: \"selected\",\r\n\tcompareLabel: \"compare\",\r\n\tlinkLabel: \"side-by-side view\",\r\n\trevSuffix: \" [rev. #%0]\",\r\n\tdiffSuffix: \" [diff: #%0 #%1]\",\r\n\tdateFormat: \"YYYY-0MM-0DD 0hh:0mm\",\r\n\tlistError: \"revisions could not be retrieved\",\r\n\r\n\thandlePopup: function(popup, title) {\r\n\t\ttitle = this.stripSuffix(\"rev\", title);\r\n\t\ttitle = this.stripSuffix(\"diff\", title);\r\n\t\tvar tiddler = store.getTiddler(title);\r\n\t\tvar type = _getField(\"server.type\", tiddler);\r\n\t\tvar adaptor = new config.adaptors[type]();\r\n\t\tvar limit = null; // TODO: customizable\r\n\t\tvar context = {\r\n\t\t\thost: _getField(\"server.host\", tiddler),\r\n\t\t\tworkspace: _getField(\"server.workspace\", tiddler)\r\n\t\t};\r\n\t\tvar loading = createTiddlyButton(popup, cmd.loadLabel, cmd.loadTooltip);\r\n\t\tvar params = { popup: popup, loading: loading, origin: title };\r\n\t\tadaptor.getTiddlerRevisionList(title, limit, context, params, this.displayRevisions);\r\n\t},\r\n\r\n\tdisplayRevisions: function(context, userParams) {\r\n\t\tremoveNode(userParams.loading);\r\n\t\tif(context.status) {\r\n\t\t\tvar callback = function(ev) {\r\n\t\t\t\tvar e = ev || window.event;\r\n\t\t\t\tvar revision = resolveTarget(e).getAttribute(\"revision\");\r\n\t\t\t\tcontext.adaptor.getTiddlerRevision(tiddler.title, revision, context,\r\n\t\t\t\t\tuserParams, cmd.displayTiddlerRevision);\r\n\t\t\t};\r\n\t\t\tvar table = createTiddlyElement(userParams.popup, \"table\");\r\n\t\t\tfor(var i = 0; i &lt; context.revisions.length; i++) {\r\n\t\t\t\tvar tiddler = context.revisions[i];\r\n\t\t\t\tvar row = createTiddlyElement(table, \"tr\");\r\n\t\t\t\tvar timestamp = tiddler.modified.formatString(cmd.dateFormat);\r\n\t\t\t\tvar revision = tiddler.fields[\"server.page.revision\"];\r\n\t\t\t\tvar cell = createTiddlyElement(row, \"td\");\r\n\t\t\t\tcreateTiddlyButton(cell, timestamp, cmd.revTooltip, callback, null,\r\n\t\t\t\t\tnull, null, { revision: revision });\r\n\t\t\t\tcell = createTiddlyElement(row, \"td\", null, null, tiddler.modifier);\r\n\t\t\t\tcell = createTiddlyElement(row, \"td\");\r\n\t\t\t\tcreateTiddlyButton(cell, cmd.selectLabel, cmd.selectTooltip,\r\n\t\t\t\t\tcmd.revisionSelected, null, null, null,\r\n\t\t\t\t\t{ index:i, revision: revision, col: 2 });\r\n\t\t\t\tcmd.context = context; // XXX: unsafe (singleton)!?\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t$(\"&lt;li /&gt;\").text(cmd.listError).appendTo(userParams.popup);\r\n\t\t}\r\n\t},\r\n\r\n\trevisionSelected: function(ev) {\r\n\t\tvar e = ev || window.event;\r\n\t\te.cancelBubble = true;\r\n\t\tif(e.stopPropagation) {\r\n\t\t\te.stopPropagation();\r\n\t\t}\r\n\t\tvar n = resolveTarget(e);\r\n\t\tvar index = n.getAttribute(\"index\");\r\n\t\tvar col = n.getAttribute(\"col\");\r\n\t\twhile(!index || !col) {\r\n\t\t\tn = n.parentNode;\r\n\t\t\tindex = n.getAttribute(\"index\");\r\n\t\t\tcol = n.getAttribute(\"col\");\r\n\t\t}\r\n\t\tcmd.revision = n.getAttribute(\"revision\");\r\n\t\tvar table = n.parentNode.parentNode.parentNode;\r\n\t\tvar rows = table.childNodes;\r\n\t\tfor(var i = 0; i &lt; rows.length; i++) {\r\n\t\t\tvar c = rows[i].childNodes[col].firstChild;\r\n\t\t\tif(i == index) {\r\n\t\t\t\tif(c.textContent) {\r\n\t\t\t\t\tc.textContent = cmd.selectedLabel;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tc.text = cmd.selectedLabel;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(c.textContent) {\r\n\t\t\t\t\tc.textContent = cmd.compareLabel;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tc.text = cmd.compareLabel;\r\n\t\t\t\t}\r\n\t\t\t\tc.onclick = cmd.compareSelected;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tcompareSelected: function(ev) {\r\n\t\tvar e = ev || window.event;\r\n\t\tvar n = resolveTarget(e);\r\n\t\tvar context = cmd.context;\r\n\t\tcontext.rev1 = n.getAttribute(\"revision\");\r\n\t\tcontext.rev2 = cmd.revision;\r\n\t\tcontext.tiddler = context.revisions[n.getAttribute(\"index\")];\r\n\t\tcontext.format = \"unified\";\r\n\t\tcontext.adaptor.getTiddlerDiff(context.tiddler.title, context,\r\n\t\t\tcontext.userParams, cmd.displayTiddlerDiffs);\r\n\t},\r\n\r\n\tdisplayTiddlerDiffs: function(context, userParams) {\r\n\t\tvar tiddler = context.tiddler;\r\n\t\ttiddler.title += cmd.diffSuffix.format([context.rev1, context.rev2]);\r\n\t\ttiddler.text = \"{{diff{\\n\" + context.diff + \"\\n}}}\";\r\n\t\ttiddler.tags = [\"diff\"];\r\n\t\ttiddler.fields.doNotSave = \"true\"; // XXX: correct?\r\n\t\tif(!store.getTiddler(tiddler.title)) {\r\n\t\t\tstore.addTiddler(tiddler);\r\n\t\t}\r\n\t\tvar src = story.getTiddler(userParams.origin);\r\n\t\tvar tiddlerEl = story.displayTiddler(src, tiddler);\r\n\t\tvar uri = context.uri.replace(\"format=unified\", \"format=horizontal\");\r\n\t\tvar link = $('&lt;a target=\"_blank\" /&gt;').attr(\"href\", uri).text(cmd.linkLabel);\r\n\t\t$(\".viewer\", tiddlerEl).prepend(link);\r\n\t},\r\n\r\n\tdisplayTiddlerRevision: function(context, userParams) {\r\n\t\tvar tiddler = context.tiddler;\r\n\t\ttiddler.title += cmd.revSuffix.format([tiddler.fields[\"server.page.revision\"]]);\r\n\t\ttiddler.fields.doNotSave = \"true\"; // XXX: correct?\r\n\t\tif(!store.getTiddler(tiddler.title)) {\r\n\t\t\tstore.addTiddler(tiddler);\r\n\t\t}\r\n\t\tvar src = story.getTiddler(userParams.origin);\r\n\t\tstory.displayTiddler(src, tiddler);\r\n\t},\r\n\r\n\tstripSuffix: function(type, title) {\r\n\t\tvar str = cmd[type + \"Suffix\"];\r\n\t\tvar i = str.indexOf(\"%0\");\r\n\t\ti = title.indexOf(str.substr(0, i));\r\n\t\tif(i != -1) {\r\n\t\t\ttitle = title.substr(0, i);\r\n\t\t}\r\n\t\treturn title;\r\n\t}\r\n};\r\n\r\nvar _getField = function(name, tiddler) {\r\n\treturn tiddler.fields[name] || config.defaultCustomFields[name];\r\n};\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"TiddlySpaceSanitizer\" server.title=\"TiddlySpaceSanitizer\" server.page.revision=\"1521866\" server.etag=\"&quot;system-plugins_public/TiddlySpaceSanitizer/1521866:40eb048664269cb8278a8b84db27a88d522943da&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-plugins_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-plugins_public\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"4e7490026802a699cc23155cd88b09a2cce3fb87\">\r\n<pre>/***\r\n|''Description''|Sanitisation for dynamically pulling tiddlers into your space and displaying them|\r\n!Notes\r\nWorks both inside and outside TiddlyWiki. Uses the HTML Sanitizer provided by the Google Caja project\r\n(see http://code.google.com/p/google-caja/wiki/JsHtmlSanitizer for more on this), which is licensed under\r\nan Apache License (see http://www.apache.org/licenses/LICENSE-2.0).\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nvar cleanURL = function(url) {\r\n\tvar regexp = /^(?:http|https|mailto|ftp|irc|news):\\/\\//;\r\n\treturn (regexp.test(url)) ? url : null;\r\n};\r\n\r\n$.sanitize = function(html) {\r\n\treturn html_sanitize(html, cleanURL);\r\n};\r\n\r\n/*\r\n * HTML Sanitizer, provided by Google Caja\r\n */\r\n\r\n/* Copyright Google Inc.\r\n * Licensed under the Apache Licence Version 2.0\r\n * Autogenerated at Tue May 17 17:39:24 BST 2011\r\n * @provides html4\r\n */var html4={};html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10},html4.ATTRIBS={\"*::class\":9,\"*::dir\":0,\"*::id\":4,\"*::lang\":0,\"*::onclick\":2,\"*::ondblclick\":2,\"*::onkeydown\":2,\"*::onkeypress\":2,\"*::onkeyup\":2,\"*::onload\":2,\"*::onmousedown\":2,\"*::onmousemove\":2,\"*::onmouseout\":2,\"*::onmouseover\":2,\"*::onmouseup\":2,\"*::style\":3,\"*::title\":0,\"a::accesskey\":0,\"a::coords\":0,\"a::href\":1,\"a::hreflang\":0,\"a::name\":7,\"a::onblur\":2,\"a::onfocus\":2,\"a::rel\":0,\"a::rev\":0,\"a::shape\":0,\"a::tabindex\":0,\"a::target\":10,\"a::type\":0,\"area::accesskey\":0,\"area::alt\":0,\"area::coords\":0,\"area::href\":1,\"area::nohref\":0,\"area::onblur\":2,\"area::onfocus\":2,\"area::shape\":0,\"area::tabindex\":0,\"area::target\":10,\"bdo::dir\":0,\"blockquote::cite\":1,\"br::clear\":0,\"button::accesskey\":0,\"button::disabled\":0,\"button::name\":8,\"button::onblur\":2,\"button::onfocus\":2,\"button::tabindex\":0,\"button::type\":0,\"button::value\":0,\"canvas::height\":0,\"canvas::width\":0,\"caption::align\":0,\"col::align\":0,\"col::char\":0,\"col::charoff\":0,\"col::span\":0,\"col::valign\":0,\"col::width\":0,\"colgroup::align\":0,\"colgroup::char\":0,\"colgroup::charoff\":0,\"colgroup::span\":0,\"colgroup::valign\":0,\"colgroup::width\":0,\"del::cite\":1,\"del::datetime\":0,\"dir::compact\":0,\"div::align\":0,\"dl::compact\":0,\"font::color\":0,\"font::face\":0,\"font::size\":0,\"form::accept\":0,\"form::action\":1,\"form::autocomplete\":0,\"form::enctype\":0,\"form::method\":0,\"form::name\":7,\"form::onreset\":2,\"form::onsubmit\":2,\"form::target\":10,\"h1::align\":0,\"h2::align\":0,\"h3::align\":0,\"h4::align\":0,\"h5::align\":0,\"h6::align\":0,\"hr::align\":0,\"hr::noshade\":0,\"hr::size\":0,\"hr::width\":0,\"iframe::align\":0,\"iframe::frameborder\":0,\"iframe::height\":0,\"iframe::marginheight\":0,\"iframe::marginwidth\":0,\"iframe::width\":0,\"img::align\":0,\"img::alt\":0,\"img::border\":0,\"img::height\":0,\"img::hspace\":0,\"img::ismap\":0,\"img::name\":7,\"img::src\":1,\"img::usemap\":11,\"img::vspace\":0,\"img::width\":0,\"input::accept\":0,\"input::accesskey\":0,\"input::align\":0,\"input::alt\":0,\"input::autocomplete\":0,\"input::checked\":0,\"input::disabled\":0,\"input::ismap\":0,\"input::maxlength\":0,\"input::name\":8,\"input::onblur\":2,\"input::onchange\":2,\"input::onfocus\":2,\"input::onselect\":2,\"input::readonly\":0,\"input::size\":0,\"input::src\":1,\"input::tabindex\":0,\"input::type\":0,\"input::usemap\":11,\"input::value\":0,\"ins::cite\":1,\"ins::datetime\":0,\"label::accesskey\":0,\"label::for\":5,\"label::onblur\":2,\"label::onfocus\":2,\"legend::accesskey\":0,\"legend::align\":0,\"li::type\":0,\"li::value\":0,\"map::name\":7,\"menu::compact\":0,\"ol::compact\":0,\"ol::start\":0,\"ol::type\":0,\"optgroup::disabled\":0,\"optgroup::label\":0,\"option::disabled\":0,\"option::label\":0,\"option::selected\":0,\"option::value\":0,\"p::align\":0,\"pre::width\":0,\"q::cite\":1,\"select::disabled\":0,\"select::multiple\":0,\"select::name\":8,\"select::onblur\":2,\"select::onchange\":2,\"select::onfocus\":2,\"select::size\":0,\"select::tabindex\":0,\"table::align\":0,\"table::bgcolor\":0,\"table::border\":0,\"table::cellpadding\":0,\"table::cellspacing\":0,\"table::frame\":0,\"table::rules\":0,\"table::summary\":0,\"table::width\":0,\"tbody::align\":0,\"tbody::char\":0,\"tbody::charoff\":0,\"tbody::valign\":0,\"td::abbr\":0,\"td::align\":0,\"td::axis\":0,\"td::bgcolor\":0,\"td::char\":0,\"td::charoff\":0,\"td::colspan\":0,\"td::headers\":6,\"td::height\":0,\"td::nowrap\":0,\"td::rowspan\":0,\"td::scope\":0,\"td::valign\":0,\"td::width\":0,\"textarea::accesskey\":0,\"textarea::cols\":0,\"textarea::disabled\":0,\"textarea::name\":8,\"textarea::onblur\":2,\"textarea::onchange\":2,\"textarea::onfocus\":2,\"textarea::onselect\":2,\"textarea::readonly\":0,\"textarea::rows\":0,\"textarea::tabindex\":0,\"tfoot::align\":0,\"tfoot::char\":0,\"tfoot::charoff\":0,\"tfoot::valign\":0,\"th::abbr\":0,\"th::align\":0,\"th::axis\":0,\"th::bgcolor\":0,\"th::char\":0,\"th::charoff\":0,\"th::colspan\":0,\"th::headers\":6,\"th::height\":0,\"th::nowrap\":0,\"th::rowspan\":0,\"th::scope\":0,\"th::valign\":0,\"th::width\":0,\"thead::align\":0,\"thead::char\":0,\"thead::charoff\":0,\"thead::valign\":0,\"tr::align\":0,\"tr::bgcolor\":0,\"tr::char\":0,\"tr::charoff\":0,\"tr::valign\":0,\"ul::compact\":0,\"ul::type\":0},html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128},html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:16,area:2,b:0,base:18,basefont:18,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,dd:1,del:0,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,font:0,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,menu:0,meta:18,nobr:0,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,p:1,param:18,pre:0,q:0,s:0,samp:0,script:84,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,title:24,tr:1,tt:0,u:0,ul:0,\"var\":0},html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},html4.URIEFFECTS={\"a::href\":2,\"area::href\":2,\"blockquote::cite\":0,\"body::background\":1,\"del::cite\":0,\"form::action\":2,\"img::src\":1,\"input::src\":1,\"ins::cite\":0,\"q::cite\":0},html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},html4.LOADERTYPES={\"a::href\":2,\"area::href\":2,\"blockquote::cite\":2,\"body::background\":1,\"del::cite\":2,\"form::action\":2,\"img::src\":1,\"input::src\":1,\"ins::cite\":2,\"q::cite\":2};var html=function(a){function x(b,c,d){var e=[];w(function(b,e){for(var f=0;f&lt;e.length;f+=2){var g=e[f],h=e[f+1],i=null,j;if((j=b+\"::\"+g,a.ATTRIBS.hasOwnProperty(j))||(j=\"*::\"+g,a.ATTRIBS.hasOwnProperty(j)))i=a.ATTRIBS[j];if(i!==null)switch(i){case a.atype.NONE:break;case a.atype.SCRIPT:case a.atype.STYLE:h=null;break;case a.atype.ID:case a.atype.IDREF:case a.atype.IDREFS:case a.atype.GLOBAL_NAME:case a.atype.LOCAL_NAME:case a.atype.CLASSES:h=d?d(h):h;break;case a.atype.URI:h=c&amp;&amp;c(h);break;case a.atype.URI_FRAGMENT:h&amp;&amp;\"#\"===h.charAt(0)?(h=d?d(h):h,h&amp;&amp;(h=\"#\"+h)):h=null;break;default:h=null}else h=null;e[f+1]=h}return e})(b,e);return e.join(\"\")}function w(b){var c,d;return v({startDoc:function(a){c=[],d=!1},startTag:function(e,f,g){if(!d){if(!a.ELEMENTS.hasOwnProperty(e))return;var h=a.ELEMENTS[e];if(h&amp;a.eflags.FOLDABLE)return;if(h&amp;a.eflags.UNSAFE){d=!(h&amp;a.eflags.EMPTY);return}f=b(e,f);if(f){h&amp;a.eflags.EMPTY||c.push(e),g.push(\"&lt;\",e);for(var i=0,j=f.length;i&lt;j;i+=2){var k=f[i],l=f[i+1];l!==null&amp;&amp;l!==void 0&amp;&amp;g.push(\" \",k,'=\"',r(l),'\"')}g.push(\"&gt;\")}}},endTag:function(b,e){if(d)d=!1;else{if(!a.ELEMENTS.hasOwnProperty(b))return;var f=a.ELEMENTS[b];if(!(f&amp;(a.eflags.UNSAFE|a.eflags.EMPTY|a.eflags.FOLDABLE))){var g;if(f&amp;a.eflags.OPTIONAL_ENDTAG)for(g=c.length;--g&gt;=0;){var h=c[g];if(h===b)break;if(!(a.ELEMENTS[h]&amp;a.eflags.OPTIONAL_ENDTAG))return}else for(g=c.length;--g&gt;=0;)if(c[g]===b)break;if(g&lt;0)return;for(var i=c.length;--i&gt;g;){var h=c[i];a.ELEMENTS[h]&amp;a.eflags.OPTIONAL_ENDTAG||e.push(\"&lt;/\",h,\"&gt;\")}c.length=g,e.push(\"&lt;/\",b,\"&gt;\")}}},pcdata:function(a,b){d||b.push(a)},rcdata:function(a,b){d||b.push(a)},cdata:function(a,b){d||b.push(a)},endDoc:function(a){for(var b=c.length;--b&gt;=0;)a.push(\"&lt;/\",c[b],\"&gt;\");c.length=0}})}function v(c){return function(d,e){d=String(d);var f=null,g=!1,h=[],j=void 0,l=void 0,m=void 0;c.startDoc&amp;&amp;c.startDoc(e);while(d){var n=d.match(g?t:u);d=d.substring(n[0].length);if(g){if(n[1]){var o=b(n[1]),p;if(n[2]){var q=n[3];switch(q.charCodeAt(0)){case 34:case 39:q=q.substring(1,q.length-1)}p=k(i(q))}else p=o;h.push(o,p)}else if(n[4]){l!==void 0&amp;&amp;(m?c.startTag&amp;&amp;c.startTag(j,h,e):c.endTag&amp;&amp;c.endTag(j,e));if(m&amp;&amp;l&amp;(a.eflags.CDATA|a.eflags.RCDATA)){f===null?f=b(d):f=f.substring(f.length-d.length);var r=f.indexOf(\"&lt;/\"+j);r&lt;0&amp;&amp;(r=d.length),l&amp;a.eflags.CDATA?c.cdata&amp;&amp;c.cdata(d.substring(0,r),e):c.rcdata&amp;&amp;c.rcdata(s(d.substring(0,r)),e),d=d.substring(r)}j=l=m=void 0,h.length=0,g=!1}}else if(n[1])c.pcdata&amp;&amp;c.pcdata(n[0],e);else if(n[3])m=!n[2],g=!0,j=b(n[3]),l=a.ELEMENTS.hasOwnProperty(j)?a.ELEMENTS[j]:void 0;else if(n[4])c.pcdata&amp;&amp;c.pcdata(n[4],e);else if(n[5]&amp;&amp;c.pcdata)switch(n[5]){case\"&lt;\":c.pcdata(\"&amp;lt;\",e);break;case\"&gt;\":c.pcdata(\"&amp;gt;\",e);break;default:c.pcdata(\"&amp;amp;\",e)}}c.endDoc&amp;&amp;c.endDoc(e)}}function s(a){return a.replace(m,\"&amp;amp;$1\").replace(n,\"&amp;lt;\").replace(o,\"&amp;gt;\")}function r(a){return a.replace(l,\"&amp;amp;\").replace(n,\"&amp;lt;\").replace(o,\"&amp;gt;\").replace(p,\"&amp;#34;\").replace(q,\"&amp;#61;\")}function k(a){return a.replace(j,g)}function i(a){return a.replace(h,\"\")}function g(a,b){return f(b)}function f(a){a=b(a);if(c.hasOwnProperty(a))return c[a];var f=a.match(d);if(f)return String.fromCharCode(parseInt(f[1],10));if(!!(f=a.match(e)))return String.fromCharCode(parseInt(f[1],16));return\"\"}var b;\"script\"===\"SCRIPT\".toLowerCase()?b=function(a){return a.toLowerCase()}:b=function(a){return a.replace(/[A-Z]/g,function(a){return String.fromCharCode(a.charCodeAt(0)|32)})};var c={lt:\"&lt;\",gt:\"&gt;\",amp:\"&amp;\",nbsp:\"240\",quot:'\"',apos:\"'\"},d=/^#(\\d+)$/,e=/^#x([0-9A-Fa-f]+)$/,h=/\\0/g,j=/&amp;(#\\d+|#x[0-9A-Fa-f]+|\\w+);/g,l=/&amp;/g,m=/&amp;([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,n=/&lt;/g,o=/&gt;/g,p=/\\\"/g,q=/\\=/g,t=new RegExp(\"^\\\\s*(?:(?:([a-z][a-z-]*)(\\\\s*=\\\\s*(\\\"[^\\\"]*\\\"|'[^']*'|(?=[a-z][a-z-]*\\\\s*=)|[^&gt;\\\"'\\\\s]*))?)|(/?&gt;)|[\\\\s\\\\S][^a-z\\\\s&gt;]*)\",\"i\"),u=new RegExp(\"^(?:&amp;(\\\\#[0-9]+|\\\\#[x][0-9a-f]+|\\\\w+);|&lt;!--[\\\\s\\\\S]*?--&gt;|&lt;!\\\\w[^&gt;]*&gt;|&lt;\\\\?[^&gt;*]*&gt;|&lt;(/)?([a-z][a-z0-9]*)|([^&lt;&amp;&gt;]+)|([&lt;&amp;&gt;]))\",\"i\");return{escapeAttrib:r,makeHtmlSanitizer:w,makeSaxParser:v,normalizeRCData:s,sanitize:x,unescapeEntities:k}}(html4),html_sanitize=html.sanitize\r\n\r\n// stop here if we're not in TiddlyWiki\r\n// XXX: is this the correct way of checking for TiddlyWiki?\r\nif (!window.TiddlyWiki || !window.store || !store instanceof TiddlyWiki) {\r\n\treturn;\r\n}\r\n\r\nvar tiddlyspace = config.extensions.tiddlyspace;\r\n\r\nvar _subWikify = Wikifier.prototype.subWikify;\r\n\r\nvar cleanedTitle = 'This section has been cleaned of any potentially harmful code';\r\n\r\nvar replaceFunctions = {\r\n\thtml: function(w) {\r\n\t\tvar sanitizedHTML, spanEl;\r\n\t\tthis.lookaheadRegExp.lastIndex = w.matchStart;\r\n\t\tvar lookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\tif(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) {\r\n\t\t\tsanitizedHTML = $.sanitize(lookaheadMatch[1]);\r\n\t\t\tspanEl = createTiddlyElement(w.output, 'span', null, 'sanitized');\r\n\t\t\tspanEl.innerHTML = sanitizedHTML;\r\n\t\t\tspanEl.setAttribute('title', cleanedTitle);\r\n\t\t\tw.nextMatch = this.lookaheadRegExp.lastIndex;\r\n\t\t}\r\n\t},\r\n\tcustomFormat: function(w) {\r\n\t\tswitch(w.matchText) {\r\n\t\t\tcase '@@':\r\n\t\t\t\tvar e = createTiddlyElement(w.output, 'span');\r\n\t\t\t\tvar styles = config.formatterHelpers.inlineCssHelper(w);\r\n\t\t\t\tif (styles.length === 0) {\r\n\t\t\t\t\te.className = 'marked';\r\n\t\t\t\t}\r\n\t\t\t\tw.subWikifyTerm(e, /(@@)/mg);\r\n\t\t\t\tbreak;\r\n\t\t\tcase '{{':\r\n\t\t\t\tvar lookaheadRegExp = /\\{\\{[\\s]*([\\w]+[\\s\\w]*)[\\s]*\\{(\\n?)/mg;\r\n\t\t\t\tlookaheadRegExp.lastIndex = w.matchStart;\r\n\t\t\t\tvar lookaheadMatch = lookaheadRegExp.exec(w.source);\r\n\t\t\t\tif(lookaheadMatch) {\r\n\t\t\t\t\tw.nextMatch = lookaheadRegExp.lastIndex;\r\n\t\t\t\t\te = createTiddlyElement(w.output,lookaheadMatch[2] == \"\\n\" ? \"div\" : \"span\",null,lookaheadMatch[1]);\r\n\t\t\t\t\tw.subWikifyTerm(e,/(\\}\\}\\})/mg);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nWikifier.prototype.subWikify = function(output, terminator) {\r\n\tvar tid = this.tiddler,\r\n\t\tspaceName = tiddlyspace.currentSpace.name,\r\n\t\ttidSpace, recipeName, stripped;\r\n\ttry {\r\n\t\trecipeName = tid.fields['server.recipe'] ||\r\n\t\t\ttid.fields['server.workspace'];\r\n\t\ttidSpace = tiddlyspace.resolveSpaceName(recipeName);\r\n\t\tif (tidSpace !== spaceName) {\r\n\t\t\t// external tiddler, so replace dangerous formatters\r\n\t\t\tstripped = stripHTML(tid, this.formatter);\r\n\t\t}\r\n\t} catch(e) {\r\n\t\t// do nothing. There's no tiddler, so assume it's safe (?!?!?)\r\n\t}\r\n\r\n\t_subWikify.apply(this, arguments);\r\n\r\n\tif (stripped) {\r\n\t\t// change back to the original function\r\n\t\tunstripHTML(stripped, this.formatter);\r\n\t}\r\n};\r\n\r\n// replace potentially unsafe formatters with versions that strip bad HTML/CSS\r\nvar stripHTML = function(tid, formatter) {\r\n\tvar popped = {}, _handler;\r\n\tfor (var i = 0; i &lt; formatter.formatters.length; i++) {\r\n\t\tvar f = formatter.formatters[i];\r\n\t\tif (replaceFunctions[f.name]) {\r\n\t\t\t_handler = f.handler;\r\n\t\t\tpopped[f.name] = _handler;\r\n\t\t\tf.handler = replaceFunctions[f.name];\r\n\t\t}\r\n\t};\r\n\r\n\treturn popped;\r\n};\r\n\r\n// put the original formatters back where they belong\r\nvar unstripHTML = function(stripped, formatter) {\r\n\tfor (var i = 0; i &lt; formatter.formatters.length; i++) {\r\n\t\tvar f = formatter.formatters[i];\r\n\t\tif (stripped[f.name]) {\r\n\t\t\tf.handler = stripped[f.name];\r\n\t\t}\r\n\t};\r\n};\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"missingIcon\" server.title=\"missingIcon\" server.page.revision=\"1521928\" server.etag=\"&quot;system-images_public/missingIcon/1521928:e697df6df795da4d4ab2954c380dcd617db7ab13&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-images_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-images_public\" server.permissions=\"read\" server.content-type=\"image/png\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch\" _hash=\"6d8a31e0f98c2550de88c48110ecdceccb686a1e\">\r\n<pre>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</pre>\r\n</div>\r\n<div title=\"MarkupPreHead\" server.title=\"MarkupPreHead\" server.page.revision=\"2556085\" server.etag=\"&quot;pearl_public/MarkupPreHead/2556085:39bb20d96ea822ebd86264b576aefb52e4e97151&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160908133954\" created=\"20160908133954\" tags=\"excludeLists\" _hash=\"def27ad824e2ee0e78c3353ea4817bdf80daed1b\">\r\n<pre>&lt;!--{{{--&gt;\r\n&lt;link href=\"/bags/pearl_public/tiddlers.atom\" rel=\"alternate\"\r\n\ttype=\"application/atom+xml\" title=\"pearl's public feed\" /&gt;\r\n&lt;link rel=\"canonical\" href=\"http://pearl.tiddlyspace.com/\" /&gt;\r\n&lt;!--}}}--&gt;</pre>\r\n</div>\r\n<div title=\"privateAndPublicIcon\" server.title=\"privateAndPublicIcon\" server.page.revision=\"1521887\" server.etag=\"&quot;tiddlyspace/privateAndPublicIcon/1521887:a2963536005cd5440ba727b87b1e5e364d92185a&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"image/png\" modified=\"20131111192334\" created=\"20131111192334\" tags=\"excludeLists excludeSearch\" _cache-max-age=\"43200\" _hash=\"5ae36775b0926a779ae5f5ec4f20d07cd3609b39\">\r\n<pre>iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAABGdBTUEAALGPC/xhBQAACkNpQ0NQSUNDIFByb2ZpbGUAAHgBnZZ3VFNZE8Dvey+90BJCkRJ6DU1KAJESepFeRSUkAUIJGBKwV0QFVxQVaYoiiyIuuLoUWSuiWFgUFLAvyCKgrIuriIplX/QcZf/Y/b6z88ec35s7c+/cmbnnPAAovoFCUSasAECGSCIO8/FgxsTGMfHdAAZEgAPWAHB52VlB4d4RABU/Lw4zG3WSsUygz/p1/xe4xfINYTI/m/5/pcjLEkvQnULQkLl8QTYP5TyU03MlWTL7JMr0xDQZwxgZi9EEUVaVcfIXNv/s84XdZMzPEPFRH1nOWfwMvow7UN6SIxWgjASinJ8jFOSifBtl/XRphhDlNyjTMwTcbAAwFJldIuCloGyFMkUcEcZBeR4ABEryLE6cxRLBMjRPADiZWcvFwuQUCdOYZ8K0dnRkM30FuekCiYQVwuWlccV8JiczI4srWg7AlzvLooCSrLZMtMj21o729iwbC7T8X+VfF796/TvIevvF42Xo555BjK5vtm+x32yZ1QCwp9Da7PhmSywDoGUTAKr3vtn0DwAgnwdA841Z92HI5iVFIslysrTMzc21EAp4FrKCfpX/6fDV859h1nkWsvO+1o7pKUjiStMlTFlReZnpmVIxMzuLyxMwWX8bYnTr/xw4K61ZeZiHCZIEYoEIPSoKnTKhKBltt4gvlAgzRUyh6J86/B/DZuUgwy9zjQKt5iOgL7EACjfoAPm9C2BoZIDE70dXoK99CyRGAdnLi9Ye/TL3KKPrn/XfFFyEfsLZwmSmzMwJi2DypOIcGaNvQqawgATkAR2oAS2gB4wBC9gAB+AM3IAX8AfBIALEgsWAB1JABhCDXLAKrAf5oBDsAHtAOagCNaAONIAToAWcBhfAZXAd3AR94D4YBCPgGZgEr8EMBEF4iArRIDVIGzKAzCAbiA3Nh7ygQCgMioUSoGRIBEmhVdBGqBAqhsqhg1Ad9CN0CroAXYV6oLvQEDQO/Qm9gxGYAtNhTdgQtoTZsDscAEfAi+BkeCm8As6Dt8OlcDV8DG6GL8DX4T54EH4GTyEAISMMRAdhIWyEgwQjcUgSIkbWIAVICVKNNCBtSCdyCxlEJpC3GByGhmFiWBhnjC8mEsPDLMWswWzDlGOOYJoxHZhbmCHMJOYjlorVwJphnbB+2BhsMjYXm48twdZim7CXsH3YEexrHA7HwBnhHHC+uFhcKm4lbhtuH64Rdx7XgxvGTeHxeDW8Gd4FH4zn4iX4fHwZ/hj+HL4XP4J/QyATtAk2BG9CHEFE2EAoIRwlnCX0EkYJM0QFogHRiRhM5BOXE4uINcQ24g3iCHGGpEgyIrmQIkippPWkUlID6RLpAeklmUzWJTuSQ8lC8jpyKfk4+Qp5iPyWokQxpXAo8RQpZTvlMOU85S7lJZVKNaS6UeOoEup2ah31IvUR9Y0cTc5Czk+OL7dWrkKuWa5X7rk8Ud5A3l1+sfwK+RL5k/I35CcUiAqGChwFrsIahQqFUwoDClOKNEVrxWDFDMVtikcVryqOKeGVDJW8lPhKeUqHlC4qDdMQmh6NQ+PRNtJqaJdoI3Qc3YjuR0+lF9J/oHfTJ5WVlG2Vo5SXKVcon1EeZCAMQ4YfI51RxDjB6Ge8U9FUcVcRqGxVaVDpVZlWnaPqpipQLVBtVO1TfafGVPNSS1Pbqdai9lAdo26qHqqeq75f/ZL6xBz6HOc5vDkFc07MuacBa5hqhGms1Dik0aUxpaml6aOZpVmmeVFzQouh5aaVqrVb66zWuDZNe762UHu39jntp0xlpjsznVnK7GBO6mjo+OpIdQ7qdOvM6BrpRupu0G3UfahH0mPrJent1mvXm9TX1g/SX6Vfr3/PgGjANkgx2GvQaTBtaGQYbbjZsMVwzEjVyM9ohVG90QNjqrGr8VLjauPbJjgTtkmayT6Tm6awqZ1pimmF6Q0z2MzeTGi2z6zHHGvuaC4yrzYfYFFY7qwcVj1ryIJhEWixwaLF4rmlvmWc5U7LTsuPVnZW6VY1Vvetlaz9rTdYt1n/aWNqw7OpsLk9lzrXe+7aua1zX9ia2Qps99vesaPZBdlttmu3+2DvYC+2b7Afd9B3SHCodBhg09kh7G3sK45YRw/HtY6nHd862TtJnE44/eHMck5zPuo8Ns9onmBezbxhF10XrstBl8H5zPkJ8w/MH3TVceW6Vrs+dtNz47vVuo26m7inuh9zf+5h5SH2aPKY5jhxVnPOeyKePp4Fnt1eSl6RXuVej7x1vZO9670nfex8Vvqc98X6Bvju9B3w0/Tj+dX5Tfo7+K/27wigBIQHlAc8DjQNFAe2BcFB/kG7gh4sMFggWtASDIL9gncFPwwxClka8nMoLjQktCL0SZh12KqwznBa+JLwo+GvIzwiiiLuRxpHSiPbo+Sj4qPqoqajPaOLowdjLGNWx1yPVY8VxrbG4eOi4mrjphZ6LdyzcCTeLj4/vn+R0aJli64uVl+cvvjMEvkl3CUnE7AJ0QlHE95zg7nV3KlEv8TKxEkeh7eX94zvxt/NHxe4CIoFo0kuScVJY8kuybuSx1NcU0pSJoQcYbnwRapvalXqdFpw2uG0T+nR6Y0ZhIyEjFMiJVGaqCNTK3NZZk+WWVZ+1uBSp6V7lk6KA8S12VD2ouxWCR39meqSGks3SYdy5udU5LzJjco9uUxxmWhZ13LT5VuXj67wXvH9SsxK3sr2VTqr1q8aWu2++uAaaE3imva1emvz1o6s81l3ZD1pfdr6XzZYbSje8Gpj9Ma2PM28dXnDm3w21efL5YvzBzY7b67agtki3NK9de7Wsq0fC/gF1wqtCksK32/jbbv2nfV3pd992p60vbvIvmj/DtwO0Y7+na47jxQrFq8oHt4VtKt5N3N3we5Xe5bsuVpiW1K1l7RXunewNLC0tUy/bEfZ+/KU8r4Kj4rGSo3KrZXT+/j7eve77W+o0qwqrHp3QHjgzkGfg83VhtUlh3CHcg49qYmq6fye/X1drXptYe2Hw6LDg0fCjnTUOdTVHdU4WlQP10vrx4/FH7v5g+cPrQ2shoONjMbC4+C49PjTHxN+7D8RcKL9JPtkw08GP1U20ZoKmqHm5c2TLSktg62xrT2n/E+1tzm3Nf1s8fPh0zqnK84onyk6Szqbd/bTuRXnps5nnZ+4kHxhuH1J+/2LMRdvd4R2dF8KuHTlsvfli53uneeuuFw5fdXp6qlr7Gst1+2vN3fZdTX9YvdLU7d9d/MNhxutNx1vtvXM6znb69p74Zbnrcu3/W5f71vQ19Mf2X9nIH5g8A7/ztjd9Lsv7uXcm7m/7gH2QcFDhYcljzQeVf9q8mvjoP3gmSHPoa7H4Y/vD/OGn/2W/dv7kbwn1Cclo9qjdWM2Y6fHvcdvPl34dORZ1rOZifzfFX+vfG78/Kc/3P7omoyZHHkhfvHpz20v1V4efmX7qn0qZOrR64zXM9MFb9TeHHnLftv5Lvrd6Ezue/z70g8mH9o+Bnx88Cnj06e/AAOb8/zszueKAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAIeUlEQVRYCe1Zb2xb1RU/9/k9O26TJqVpSByn+UNC3JZuQMukaWirBR9BGtJAIAqlEkgg+ABCsLVFWhAU0DRp8IlNYkIskSYhPvKBDxRvKIwVSin9Q9MmTRziJG7aQtrYcWw/v7tzrn1v3nOe/eIC+cKOZN97zz3n3J/vO+/cc48B/k9rswPs+y5z8B+xXZxZd6GdfuDsZmDQhf06m91L2E9wYMMA1iQ3tfde2xeN2+Zr7l4T6IG3Y01Z3XqUAduLK0bwo9e48jD+wL/7O2BoIBo1a9TFfamBBt6N1edz8HvO+dOoVu9QZYw3bWiAYF2A+f0B0A0f5HJ5sKwCLKQWIZ1ehEKh4FQBSALnLxod2lu1gF816BcGY7stxt8GLh6/WFzXdau1pVlrb2uFhoZ68Pl8DlD2Af5QmJ+/ComZGZi9cBGxcjWNID7IM/bYn/ZEE4pZpbMq0PuHDv+BcfYS2hFuQGB7ezq1jvYQaJpWxbz7VDabg6npGRiPf6PAI5Aks9hDL++Nfuiutcz1BH1gKPYmWn5cqoTbQ1akr0ertqtS1qtdSKXg5Omz6D4pJcoZu/fVPdH3FMOlUxW0HTDTNL5jW4S1Xb/Zxcy1s8hNRs9PwMTklDRiIvB7EPj7klHeVgR9YPDwAAD7IymQO+z8+U1aU1Njuf4PNp6cSsDIufPSXgqjyy9feTh6SjLsrSvoYuzln6Kg7tN81q5bdvyogCWgsfE4nJ+YLA45jPjr2G0D90WXfackuOItorDGgQ8SYJLZvq1/TQDTWr09XaDcj0Ekm4VXiV9OK0Bnc9ZTGL3pwICOcGjZSLnmjzTe2t8HgYBfWGfAn6KnXr6U4ySjXc5l+ZMk5DN03t/b4+o+5UbEuGCBPpkEfWoOtMtXgeHBAj4NrOs2gBneDGZPCLjhWM7VjGEYELmxD746ebo0b9F7dbdd2AHq4NDhpzlnfyGBvt5u6OncYpet2DfOTELgszNFoBWkuN+A7G0RyG/rqiDhZB/54jgeRleIidvBIq89FB2TEg73QMAP0gQGYd4ZbpcylVuLQ/DwF1A3fMIBWNN9YAT9QK0k2vm6T06i/FEBQ/IrtX3dXXLKpzF4Vg6oVTv9/FAsrHM+gTw9HGqF7Vv77XKufQKsj8+IOcYYNIY2QRO6grG+DmhMlF/Mwvz0JZhHt5FHt9nTBpnoTtwdtbyQLf/65MhRSKXSxL7sD7AuGUnUThvc+i1OCqcLtbaW668Yk0vYAYdv6YWWyBbw1wcVYFIy1gVgc187hHfeCKyUm+jjs2CMTK6wWc5obVEH2SY8+XfLeQXa4toNxKTjubGxQc67t+hl5MNEtKPhW/sguLG6TrBxPdAP00q7G/h8xOFSbguFWq9XbI3Db+RAgcbM8nZirgsGPZMgfWJGLdjY3gzBJmeWKo2XtwS8Mdwi2OTj+sRsuYhjHAzW0WkseBZwFfoUaJzpotmG+nXUVCUdfVRSE4KuhezyeuKip2pDw3ohg94flsJ20GL1QCAg5yq2FIeJRJTAl64WIh+XUUX7tminmv463O0SdciOHbTgaXggeJE4OFDIh7cTGSW8dOzzpCcI3w0v8hvF0xHl1G6uQGitwhAdFESFfEGFMcFY5RfpCVrFBrltoh30EhnKYpbiRdamDULEMguQTws1LxU1T3Gb9IjoiPcit01cBs0hTgbSGW8Qpu3lo4OjFrLLU07iRTm8SZdoXnYUaAy3cWIuLKTwBl3d18xuTH5KLnIFQWfmU9Je1TZzJQ1XEnNChvTN7raq8jRJN/kSxWVHgcY3CpMCfGQIOL2oBKWcs0VfzP5iq+DR0Zw4NuoJnAAnvhxD+1zoUfIkf7jT+PKIbFPpgahY7CnOKdCsAP8usgAuzHk/8vzWTpFuCoMl4HNnpyCXdr4T+UwOLo5Ow/Sxc8BLdQ/KPfKRTrlcxfbq1QVbrcRS575KcHULhvMaJHEfWmeTc+IWUdFaaSITvRWCuAeUS9CuzONhQR+KwxTWKErIl07aIsBLv77ZM1ki+SmskUjCi7UqLaidHtgXXeKMf0BCi5kMXLr8nZSv3GIekbljFyz9aofjUYuogjtsB0yuQHKU3a3mMmCaJj7xy3Lt4688GD0uB2qnBYNpb+CWPUL9sYk4NG/aKNheX5TY5/u3YC4xA8bURWDfLRRzE3lzCTWDecPyy+tlj+anZ5NAwIkwL3pHdEpfeKQ7af/gRzFk7ibuz27atuZ3RFqXwH78n88gn8crG8C832Td6AkrQx7NEmmcPYeN+Ilnzo7iYaPipJhfi6/R83EJGLAc91c7YFpf+bQEc+jh6FEs4b5OY/qlI+dG5dSatHOXvhV1vtJiY0YdHCpfeAVoEjDCsB+bU9RPYvijIspaENX0Tpz6WuUzuMv75BXLvr4raFEr5uwBFBQBm6o+tlqbXf8H69PN+/NjJ1RcxuzxZXzqw24LuIImQaqjaZYALs7oc2PjQB95OXUzdq08qlcfPX5S+TGef0NGO7xYyd6K6FEuuH8o9jvG+T+RL8JjQ3097Njejzec+nLRmsf0z8DpM2dFkX1Zmb/lD2tPVPtnwBM0GXvhndidlob/ApSuPJT4d20JAxXV6R5XK9HTmp69gO/KhCM6YTx+5tCeO0QQqGZzVaDJANVFDMt6E2vHdymDuEpbSzMLtbXBdRsbPS/EVMNIzCTx5Z5zghX/vbB7K/mwWq/UWTVoqXhgMPYoBs+D9v9eaI6qUuuDQUYXY7pn0o2DEnjKh9OLS0DJj0vKa2KE+DOFNbcoIdcsb2sGTQYGYjE9Nw33Y0l4L+NwZ7lRrzEumsTDeQjvL3+z1+i89OT8NYGWytQKt8HqFBV70FtuR1YXfsTNHluiJXwqcbpk4I88ooH2L92E/1KCVpz+iXz/D36BLy8VVzwEAAAAAElFTkSuQmCC</pre>\r\n</div>\r\n<div title=\"BinaryTiddlersPlugin\" server.title=\"BinaryTiddlersPlugin\" server.page.revision=\"1521855\" server.etag=\"&quot;system/BinaryTiddlersPlugin/1521855:42971f5b042b28749ebb6d7319dfa4807cd7d5cf&quot;\" modifier=\"FND\" creator=\"FND\" server.workspace=\"bags/system\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20130924180405\" created=\"20130924180405\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"bb40914e9b2e79bd868d4c824ef8e42e617f4309\">\r\n<pre>/***\r\n|''Name''|BinaryTiddlersPlugin|\r\n|''Description''|renders base64-encoded binary tiddlers as images or links|\r\n|''Author''|FND|\r\n|''Version''|0.3.2|\r\n|''Status''|@@beta@@|\r\n|''Source''|http://svn.tiddlywiki.org/Trunk/association/plugins/BinaryTiddlersPlugin.js|\r\n|''License''|[[BSD|http://www.opensource.org/licenses/bsd-license.php]]|\r\n|''CoreVersion''|2.5|\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\n\"use strict\";\r\n\r\nvar ctfield = \"server.content-type\";\r\n\r\nvar plugin = config.extensions.BinaryTiddlersPlugin = {\r\n\tisWikiText: function(tiddler) {\r\n\t\tvar ctype = tiddler.fields[ctfield];\r\n\t\tif(ctype) {\r\n\t\t\tif (ctype === 'text/x-tiddlywiki') {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn !this.isBinary(tiddler) &amp;&amp; !this.isTextual(ctype);\r\n\t\t} else {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\t// NB: pseudo-binaries are considered non-binary here\r\n\tisBinary: function(tiddler) {\r\n\t\tvar ctype = tiddler.fields[ctfield];\r\n\t\treturn ctype ? !this.isTextual(ctype) : false;\r\n\t},\r\n\tisTextual: function(ctype) {\r\n\t\treturn ctype.indexOf(\"text/\") === 0\r\n\t\t\t|| this.endsWith(ctype, \"+xml\")\r\n\t\t\t|| ctype === 'application/json'\r\n\t\t\t|| ctype === 'application/javascript';\r\n\t},\r\n\tendsWith: function(str, suffix) {\r\n\t\treturn str.length &gt;= suffix.length &amp;&amp;\r\n\t\t\tstr.substr(str.length - suffix.length) === suffix;\r\n\t},\r\n\tisLink: function(tiddler) {\r\n\t\treturn this.isBinary(tiddler) &amp;&amp; tiddler.text.indexOf(\"&lt;html&gt;\") !== -1;\r\n\t}\r\n};\r\n\r\n// Disable edit for linked tiddlers (for now)\r\n// This will be changed to a GET then PUT\r\nconfig.commands.editTiddler.isEnabled = function(tiddler) {\r\n    var existingTest = config.commands.editTiddler.isEnabled;\r\n    if (existingTest) {\r\n        return existingTest &amp;&amp; !plugin.isLink(tiddler);\r\n    } else {\r\n        return !plugin.isLink(tiddler);\r\n    }\r\n};\r\n\r\n// hijack text viewer to add special handling for binary tiddlers\r\nvar _view = config.macros.view.views.wikified;\r\nconfig.macros.view.views.wikified = function(value, place, params, wikifier,\r\n\t\tparamString, tiddler) {\r\n\tvar ctype = tiddler.fields[\"server.content-type\"];\r\n\tif(params[0] === \"text\" &amp;&amp; ctype &amp;&amp; ctype !== 'text/x-tiddlywiki' &amp;&amp;\r\n\t\t\t!tiddler.tags.contains(\"systemConfig\") &amp;&amp; !plugin.isLink(tiddler)) {\r\n\t\tvar el;\r\n\t\tif(plugin.isBinary(tiddler)) {\r\n\t\t\tvar uri = \"data:%0;base64,%1\".format([ctype, tiddler.text]); // TODO: fallback for legacy browsers\r\n\t\t\tif(ctype.indexOf(\"image/\") === 0) {\r\n\t\t\t\tel = $(\"&lt;img /&gt;\").attr(\"alt\", tiddler.title).attr(\"src\", uri);\r\n\t\t\t} else {\r\n\t\t\t\tel = $(\"&lt;a /&gt;\").attr(\"href\", uri).text(tiddler.title);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tel = $(\"&lt;pre /&gt;\").text(tiddler.text);\r\n\t\t}\r\n\t\tel.appendTo(place);\r\n\t} else {\r\n\t\t_view.apply(this, arguments);\r\n\t}\r\n};\r\n\r\n// hijack edit macro to disable editing of binary tiddlers' body\r\nvar _editHandler = config.macros.edit.handler;\r\nconfig.macros.edit.handler = function(place, macroName, params, wikifier,\r\n\t\tparamString, tiddler) {\r\n\tif(params[0] === \"text\" &amp;&amp; plugin.isBinary(tiddler)) {\r\n\t\treturn false;\r\n\t} else {\r\n\t\t_editHandler.apply(this, arguments);\r\n\t}\r\n};\r\n\r\n// hijack autoLinkWikiWords to ignore binary tiddlers\r\nvar _autoLink = Tiddler.prototype.autoLinkWikiWords;\r\nTiddler.prototype.autoLinkWikiWords = function() {\r\n\treturn plugin.isWikiText(this) ? _autoLink.apply(this, arguments) : false;\r\n};\r\n\r\n}(jQuery));\r\n//}}}</pre>\r\n</div>\r\n<div title=\"ImageMacroPlugin\" server.title=\"ImageMacroPlugin\" server.page.revision=\"1521897\" server.etag=\"&quot;tiddlyspace/ImageMacroPlugin/1521897:36ab1ff7b4ee72dd8587163d5f3a91590b6b3db6&quot;\" modifier=\"jon\" creator=\"jon\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192334\" created=\"20131111192334\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"3f1696962a1dff3028ea1a4307d8b95c3b3ceb65\">\r\n<pre>/***\r\n|''Name''|ImageMacroPlugin|\r\n|''Version''|0.9.4|\r\n|''Description''|Allows the rendering of svg images in a TiddlyWiki|\r\n|''Author''|Osmosoft|\r\n|''License''|[[BSD|http://www.opensource.org/licenses/bsd-license.php]]|\r\n|''Notes''|Currently only works in modern browsers (not IE)|\r\n|''Requires''|BinaryTiddlersPlugin|\r\n!Usage\r\n{{{&lt;&lt;image SVG&gt;&gt;}}} will render the text of the tiddler with title SVG as an SVG image (but not in ie where it will fail silently)\r\n!!Parameters\r\nwidth/height: specify width/height parameters\r\nlink: make the image link to a given location\r\ntiddlyLink: link to a tiddler\r\n\r\n!Notes\r\nBinary tiddlers in TiddlyWeb when passed through the wikifier will be shown as images.\r\neg. {{{&lt;&lt;view text wikified&gt;&gt;}}} on a binary tiddler will show the image.\r\n{{{&lt;&lt;view fieldname image&gt;&gt;}}}\r\nwill render the value of the tiddler field 'fieldname' as an image. This field can contain a tid\r\n{{{&lt;&lt;image SiteIcon&gt;&gt;}}}\r\nwill create an image tag where the tiddler has content type beginning image and not ending +xml\r\nwill attempt to create svg object in other scenarios\r\n{{{&lt;&lt;image /photos/x.jpg&gt;&gt;}}}\r\nwill create an image tag with src /photos/x.jpg as long as there is not a tiddler called /photos/x.jpg in \r\nwhich case it will render that tiddler as an image. Note for the case of svg files it will attempt to render as an svg if possible via the image\r\ntag. It doesn't embed the svg in the dom for security reasons as svg code can contain javascript.\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nvar macro = config.macros.image = {\r\n\tshim: \"/bags/common/tiddlers/shim\",\r\n\tieVersion: config.browser.isIE ? parseInt(config.browser.ieVersion[1], 10) : false,\r\n\tsvgns: \"http://www.w3.org/2000/svg\",\r\n\txlinkns: \"http://www.w3.org/1999/xlink\", \r\n\tsvgAvailable: document.implementation.hasFeature(\"http://www.w3.org/TR/SVG11/feature#BasicStructure\", \"1.1\"),\r\n\t_fixPrefix: 1,\r\n\t_external_cache: {},\r\n\t_image_tag_cache: {},\r\n\t_image_dimensions: {},\r\n\tlocale: {\r\n\t\tbadImage: \"This image cannot be displayed.\"\r\n\t},\r\n\thandler: function(place, macroName, params, wikifier, paramString, tiddler){\r\n\t\tvar imageSource = params[0];\r\n\t\t// collect named arguments\r\n\t\tvar args = macro.getArguments(paramString, params);\r\n\t\tthis.renderImage(place, imageSource, args);\r\n\t},\r\n\tinit: function() {\r\n\t\tvar startupImages = store.getTaggedTiddlers(\"systemImage\");\r\n\t\tvar place = $(\"&lt;div /&gt;\").attr(\"id\", \"systemImageArea\").appendTo(\"body\").hide()[0];\r\n\t\tfor(var i = 0; i &lt; startupImages.length; i++) {\r\n\t\t\tvar image = startupImages[i];\r\n\t\t\tmacro.renderImage(place, image.title, { idPrefix: \"\" });\r\n\t\t}\r\n\t\tvar data = new Image();\r\n\t\tdata.onload = function() {\r\n\t\t\t// note ie 8 only supports data uris up to 32k so cannot be relied on\r\n\t\t\tmacro.supportsDataUris = this.width != 1 || this.height != 1 ? false : true;\r\n\t\t\tmacro.supportsDataUris = macro.ieVersion &amp;&amp; macro.ieVersion &lt; 9 ? false : macro.supportsDataUris;\r\n\t\t};\r\n\t\tdata.onerror = data.onload;\r\n\t\tdata.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==\";\r\n\t},\r\n\trefreshImage: function(src) {\r\n\t\tvar elements = macro._image_tag_cache[src] ? macro._image_tag_cache[src] : [];\r\n\t\tif(macro._image_dimensions[src]) {\r\n\t\t\tmacro._image_dimensions[src] = false;\r\n\t\t}\r\n\t\tfor(var i = 0; i &lt; elements.length; i++) {\r\n\t\t\tvar el = $(elements[i]);\r\n\t\t\tvar newSrc = \"%0?nocache=%1\".format(src, Math.random());\r\n\t\t\tel.attr(\"src\", newSrc); // force reload\r\n\t\t}\r\n\t},\r\n\tisBinaryImageType: function(contentType) {\r\n\t\treturn (contentType &amp;&amp; contentType.indexOf(\"image\") === 0 &amp;&amp;\r\n\t\t\tcontentType.indexOf(\"+xml\") != contentType.length - 4) ? true : false;\r\n\t},\r\n\tisImageTiddler: function(tiddler) {\r\n\t\treturn macro.isSVGTiddler(tiddler) || macro.isBinaryImageTiddler(tiddler);\r\n\t},\r\n\tisSVGTiddler: function(tiddler) {\r\n\t\tvar type = tiddler ? tiddler.fields['server.content-type'] : false;\r\n\t\treturn type == \"image/svg+xml\";\r\n\t},\r\n\tisBinaryImageTiddler: function(tiddler) {\r\n\t\treturn macro.isBinaryImageType(tiddler.fields['server.content-type']);\r\n\t},\r\n\trenderImage: function(place, imageSource, options) {\r\n\t\tvar imageTiddler = store.getTiddler(imageSource);\r\n\t\tvar container;\r\n\t\tvar classes = [\"image\"];\r\n\t\tif(options.link) {\r\n\t\t\tclasses = classes.concat([\"imageLink\", \"externalLink\"]);\r\n\t\t\tcontainer = $(\"&lt;a /&gt;\").attr(\"href\", options.link).appendTo(place)[0];\r\n\t\t} else if(options.tiddlyLink) {\r\n\t\t\tclasses.push(\"imageLink\");\r\n\t\t\tcontainer = createTiddlyLink(place, options.tiddlyLink, false);\r\n\t\t} else {\r\n\t\t\tcontainer = $(\"&lt;span /&gt;\").appendTo(place)[0];\r\n\t\t}\r\n\t\t$(container).addClass(classes.join(\" \"));\r\n\r\n\t\toptions = options ? options : {};\r\n\t\tif(imageTiddler &amp;&amp; macro.isBinaryImageTiddler(imageTiddler)) { // handle the case where we have an image url\r\n\t\t\treturn macro._renderBinaryImageTiddler(container, imageTiddler, options);\r\n\t\t} else if(imageTiddler){ // handle the case where we have a tiddler\r\n\t\t\treturn macro._renderSVGTiddler(container, imageTiddler, options);\r\n\t\t} else { // we have a string representing a url\r\n\t\t\treturn macro._renderBinaryImageUrl(container, imageSource, options);\r\n\t\t}\r\n\t},\r\n\t_renderAlternateText: function(container, options) {\r\n\t\tvar img;\r\n\t\tvar src = options.src || \"\";\r\n\t\tif(options.width &amp;&amp; options.height) {\r\n\t\t\timg = $(\"&lt;img /&gt;\").attr(\"src\", src).addClass(\"svgImageText\").attr(\"width\", options.width).\r\n\t\t\t\tattr(\"height\", options.height).appendTo(container);\r\n\t\t}\r\n\t\tvar alt = options.alt;\r\n\t\tif(img &amp;&amp; alt) {\r\n\t\t\timg.attr(\"alt\", alt).attr(\"title\", alt);\r\n\t\t} else if(alt) {\r\n\t\t\t$(container).addClass(\"svgImageText\").text(alt);\r\n\t\t}\r\n\t\tmacro._image_tag_cache[src] = img;\r\n\t},\r\n\t_renderSVGTiddler: function(place, tiddler, options) {\r\n\t\tif(!options) {\r\n\t\t\toptions = {};\r\n\t\t}\r\n\t\tmerge(options, { tiddler: tiddler, fix: true});\r\n\r\n\t\tif(macro.svgAvailable) {\r\n\t\t\tthis._importSVG(place, options); // display the svg\r\n\t\t} else if(options.altImage) {\r\n\t\t\tvar image = options.altImage;\r\n\t\t\tdelete options.altImage;\r\n\t\t\tthis._renderBinaryImageUrl(place, image, options);\r\n\t\t} else {\r\n\t\t\tthis._renderAlternateText(place, options); // instead of showing the image show the alternate text.\r\n\t\t}\r\n\t},\r\n\t_renderBinaryImageTiddler: function(place, tiddler, options) {\r\n\t\tvar resourceURI;\r\n\t\tvar fields = tiddler.fields;\r\n\t\tif(fields[\"server.type\"] == \"tiddlyweb\") { // construct an accurate url for the resource\r\n\t\t\tresourceURI = \"%0/%1/tiddlers/%2\".format(config.defaultCustomFields[\"server.host\"],\r\n\t\t\t\tfields[\"server.workspace\"], encodeURI(fields[\"server.title\"]));\r\n\t\t} else { // guess the url for the resource\r\n\t\t\tresourceURI = tiddler.title;\r\n\t\t}\r\n\t\tvar ctype = fields[\"server.content-type\"] || tiddler.type;\r\n\t\tvar text = tiddler.text;\r\n\t\tif(macro.supportsDataUris &amp;&amp; ctype &amp;&amp; text.indexOf(\"&lt;html\") == -1) {\r\n\t\t\tvar uri = \"data:%0;base64,%1\".format(ctype, text);\r\n\t\t\toptions.src = resourceURI;\r\n\t\t\treturn macro._renderBinaryImageUrl(place, uri, options);\r\n\t\t} else if(options.src) {\r\n\t\t\treturn macro._renderBinaryImageUrl(place, options.src, options);\r\n\t\t} else {\r\n\t\t\treturn macro._renderBinaryImageUrl(place, resourceURI, options);\r\n\t\t}\r\n\t},\r\n\t_renderImageTag: function(container, src, width, height, options) {\r\n\t\tvar img;\r\n\t\timg = $(\"&lt;img /&gt;\").appendTo(container);\r\n\t\tif(height) {\r\n\t\t\timg.attr(\"height\", height);\r\n\t\t}\r\n\t\tif(width) {\r\n\t\t\timg.attr(\"width\", width);\r\n\t\t}\r\n\t\tif(macro.ieVersion &amp;&amp; macro.ieVersion &lt; 7 &amp;&amp; macro.shim &amp;&amp; options.ie6png) {\r\n\t\t\t$(img).css({width: userW, height: userH,\r\n\t\t\t\t\tfilter: \"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='%0', sizingMethod='scale')\".format(src)\r\n\t\t\t\t}).attr(\"src\", macro.shim);\r\n\t\t} else {\r\n\t\t\timg.attr(\"src\", src);\r\n\t\t}\r\n\t\tif(!macro._image_tag_cache[options.srcUrl]) {\r\n\t\t\tmacro._image_tag_cache[options.srcUrl] = [];\r\n\t\t}\r\n\t\timg = $(img).addClass(options.imageClass)[0];\r\n\t\tmacro._image_tag_cache[options.srcUrl].push(img);\r\n\t\treturn img;\r\n\t},\r\n\t_getDimensions: function(realDimensions, reqDimensions, preserve) {\r\n\t\tvar w = realDimensions.width;\r\n\t\tvar h = realDimensions.height;\r\n\t\tvar reqh = reqDimensions.height;\r\n\t\tvar reqw = reqDimensions.width;\r\n\t\tvar finalw = w, finalh = h;\r\n\t\tvar ratiow = reqw / w, ratioh = reqh / h;\r\n\t\tvar scaledw = ratioh * w;\r\n\t\tvar scaledh = ratiow * h;\r\n\t\tif(!reqw &amp;&amp; reqh) {\r\n\t\t\tfinalw = scaledw;\r\n\t\t\tfinalh = reqh;\r\n\t\t} else if(reqw &amp;&amp; !reqh) {\r\n\t\t\tfinalw = reqw;\r\n\t\t\tfinalh = scaledh;\r\n\t\t} else if(reqh &amp;&amp; reqw) {\r\n\t\t\tvar preserveWidth = w &gt; h ? true : false;\r\n\t\t\tif(preserve) {\r\n\t\t\t\tif(preserveWidth &amp;&amp; scaledh &lt; reqh) {\r\n\t\t\t\t\tfinalh = scaledh;\r\n\t\t\t\t\tfinalw = reqw;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfinalh = reqh;\r\n\t\t\t\t\tfinalw = scaledw;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfinalw = reqw;\r\n\t\t\t\tfinalh = reqh;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn { width: parseInt(finalw, 10), height: parseInt(finalh, 10) };\r\n\t},\r\n\t_renderBinaryImageUrl: function(container, src, options) {\r\n\t\tvar srcUrl = options.src ? options.src : src;\r\n\t\tsrcUrl = srcUrl.indexOf(\"/\") === -1 ? \"/%0\".format(srcUrl) : srcUrl; // for IE. \r\n\t\tvar image_dimensions = macro._image_dimensions[srcUrl];\r\n\t\tvar image = new Image(); // due to weird scaling issues where you use just a width or just a height\r\n\t\tvar createImageTag = function(dimensions, error) {\r\n\t\t\tif(error) {\r\n\t\t\t\tvar altImage = options.altImage;\r\n\t\t\t\tif(altImage) {\r\n\t\t\t\t\tdelete options.altImage;\r\n\t\t\t\t\tmacro._renderBinaryImageUrl(container, altImage, options);\r\n\t\t\t\t} else {\r\n\t\t\t\t\toptions.src = src;\r\n\t\t\t\t\tmacro._renderAlternateText(container, options);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar dim = macro._getDimensions(dimensions, { \r\n\t\t\t\t\twidth: options.width, height: options.height }, options.preserveAspectRatio);\r\n\t\t\t\toptions.srcUrl = srcUrl;\r\n\t\t\t\tmacro._renderImageTag(container, src, dim.width, dim.height, options);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif(!image_dimensions) {\r\n\t\t\timage.onload = function() {\r\n\t\t\t\tvar dimensions = { width: image.width, height: image.height};\r\n\t\t\t\tmacro._image_dimensions[srcUrl] = dimensions;\r\n\t\t\t\tcreateImageTag(dimensions);\r\n\t\t\t};\r\n\t\t\timage.onerror = function() {\r\n\t\t\t\tcreateImageTag(null, true);\r\n\t\t\t};\r\n\t\t\timage.src = src;\r\n\t\t} else {\r\n\t\t\tcreateImageTag(image_dimensions);\r\n\t\t}\r\n\t},\r\n\t_generateIdPrefix: function(){\r\n\t\treturn \"twsvgfix_\" + (this._fixPrefix++).toString() + \"_\";\r\n\t},\r\n\t_fixSVG: function(childNodes, idPrefix) {\r\n\t\tvar urlPattern = /url\\(\\#([^\\)]*)\\)*/ig;\r\n\t\tvar fixes = [\r\n\t\t{ attr: \"id\", pattern: /^(.*)$/ig },\r\n\t\t{ attr: \"href\", namespace: macro.xlinkns, pattern: /^#(.*)$/ig }\r\n\t\t];\r\n\t\tvar url_fixes = [\"filter\", \"fill\", \"mask\", \"stroke\", \"style\"];\r\n\t\tfor(var i = 0; i &lt; url_fixes.length; i++) {\r\n\t\t\tfixes.push({ attr: url_fixes[i], pattern: urlPattern });\r\n\t\t}\r\n\t\tfor(var t = 0; t &lt; childNodes.length; t++) {\r\n\t\t\tvar node = childNodes[t];\r\n\t\t\tfor(var a = 0; a &lt; fixes.length; a++) {\r\n\t\t\t\tvar fix = fixes[a];\r\n\t\t\t\tvar attr = fix.attr;\r\n\t\t\t\tvar ns = fix.namespace || \"\";\r\n\t\t\t\tif(node.hasAttributeNS &amp;&amp; node.hasAttributeNS(ns, attr)) {\r\n\t\t\t\t\tvar v = node.getAttributeNS(ns, attr);\r\n\t\t\t\t\tfix.pattern.lastIndex = 0;\r\n\t\t\t\t\tvar match = fix.pattern.exec(v);\r\n\t\t\t\t\tif(match) {\r\n\t\t\t\t\t\t// Make sure replacement string doesn't contain any single dollar signs\r\n\t\t\t\t\t\tvar toReplace = match[1];\r\n\t\t\t\t\t\tif(toReplace.indexOf(idPrefix) !== 0 &amp;&amp; toReplace.indexOf(\"twglobal_\") !== 0) {\r\n\t\t\t\t\t\t\tvar replacement = (idPrefix + toReplace).replace(\"$\", \"$$$$\"); \r\n\t\t\t\t\t\t\tv = v.replace(match[1], replacement);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tnode.setAttributeNS(ns, attr,v);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar children = node.childNodes;\r\n\t\t\tif(children.length &gt; 0) {\r\n\t\t\t\tthis._fixSVG(children, idPrefix);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t_importSVG: function(place, options){\r\n\t\toptions = options ? options : {};\r\n\t\tvar svgDoc, tiddlerText = options.tiddler.text;\r\n\t\tif (window.DOMParser) {\r\n\t\t\tsvgDoc = new DOMParser().parseFromString(tiddlerText, \"application/xml\").documentElement;\r\n\t\t\tvar idPrefix = options.idPrefix || this._generateIdPrefix();\r\n\t\t\tthis._fixSVG([svgDoc], idPrefix);\r\n\t\t\tvar el = document.importNode(svgDoc, true);\r\n\t\t\tvar svgHolder = document.createElementNS(macro.svgns,\"svg\");\r\n\t\t\tvar width = options.width;\r\n\t\t\tvar height = options.height;\r\n\t\t\tif(width || height) {\r\n\t\t\t\tif(width &amp;&amp; height) { // set view box of containing svg element based on the svg viewbox and width and height.\r\n\t\t\t\t\tvar viewBox = el.getAttribute(\"viewBox\");\r\n\t\t\t\t\tvar topLeft = \"0 0\";\r\n\t\t\t\t\tif(viewBox) {\r\n\t\t\t\t\t\ttopLeft = viewBox.replace(/([0-9]*) +([0-9]*) +([0-9]*) +([0-9]*) */gi,\"$1 $2\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsvgHolder.setAttributeNS(macro.svgns, \"viewBox\", \"0 0 %0 %1\".format(width, height));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(!width) {\r\n\t\t\t\t\t\twidth = el.getAttribute(\"width\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!height) {\r\n\t\t\t\t\t\theight = el.getAttribute(\"height\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tsvgHolder.setAttribute(\"width\", width);\r\n\t\t\t\tsvgHolder.setAttribute(\"height\", height);\r\n\r\n\t\t\t\tel.setAttribute(\"width\", \"100%\");\r\n\t\t\t\tel.setAttribute(\"height\", \"100%\");\r\n\t\t\t\tsvgHolder.setAttribute(\"class\", \"svgImage svgIcon %0\".format(options.imageClass || \"\"));\r\n\t\t\t\tsvgHolder.appendChild(el);\r\n\t\t\t\tplace.appendChild(svgHolder);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar existing = el.className ? el.className.baseVal : \"\";\r\n\t\t\t\tel.setAttribute(\"class\",\"svgImage %0\".format(existing));\r\n\t\t\t\tplace.appendChild(el);\r\n\t\t\t}\r\n\t\t\t// if a tiddler attribute is set this is read as a link\r\n\t\t\t$(\"[tiddler], [tiddlyLink]\", place).attr(\"refresh\", \"link\").click(function(ev) {\r\n\t\t\t\tvar tiddler = $(ev.target).attr(\"tiddlyLink\");\r\n\t\t\t\tif(tiddler) {\r\n\t\t\t\t\tstory.displayTiddler(ev.target, tiddler);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tgetArguments: function(paramString, params) {\r\n\t\tvar args = paramString.parseParams(\"name\", null, true, false, true)[0];\r\n\t\tvar options = {};\r\n\t\tfor(var id in args) {\r\n\t\t\tif(true) {\r\n\t\t\t\tvar p = args[id];\r\n\t\t\t\tif(id == \"def\") {\r\n\t\t\t\t\toptions[id] = p;\r\n\t\t\t\t} else {\r\n\t\t\t\t\toptions[id] = p[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar width = isNaN(params[1]) ? false : parseInt(params[1], 10);\r\n\t\tvar height = isNaN(params[2]) ? false : parseInt(params[2], 10);\r\n\r\n\t\toptions.width = macro.lookupArgument(options, \"width\", width);\r\n\t\toptions.height = macro.lookupArgument(options, \"height\", height);\r\n\t\toptions.preserveAspectRatio = args.preserveAspectRatio &amp;&amp; \r\n\t\t\targs.preserveAspectRatio[0] == \"yes\" ? true : false;\r\n\t\toptions.tiddlyLink = macro.lookupArgument(options, \"tiddlyLink\", false);\r\n\t\toptions.link = macro.lookupArgument(options, \"link\", false);\r\n\t\treturn options;\r\n\t},\r\n\tlookupArgument: function(args, id, ifEmpty) {\r\n\t\treturn args[id] ? args[id] : ifEmpty;\r\n\t}\r\n};\r\n\r\n// update views\r\nvar _oldwikifiedview = config.macros.view.views.wikified;\r\n// update wikifier to check tiddler type before rendering\r\nmerge(config.macros.view.views, {\r\n\twikified: function(value, place, params, wikifier, paramString, tiddler) {\r\n\t\tif(macro.isImageTiddler(tiddler) &amp;&amp; params[0] == \"text\") {\r\n\t\t\tvar newplace = $(\"&lt;div /&gt;\").addClass(\"wikifiedImage\").appendTo(place)[0];\r\n\t\t\tmacro.renderImage(newplace, tiddler.title, { alt: macro.locale.badImage });\r\n\t\t} else {\r\n\t\t\t_oldwikifiedview.apply(this, arguments);\r\n\t\t}\r\n\t},\r\n\timage: function(value, place, params, wikifier, paramString, tiddler) {\r\n\t\t// a field can point to another tiddler whereas text is the current tiddler.\r\n\t\tvar title = params[0] == \"text\" ? tiddler.title : value;\r\n\t\tvar args = macro.getArguments(paramString, params);\r\n\t\tmacro.renderImage(place, title, args);\r\n\t}\r\n});\r\nconfig.shadowTiddlers.StyleSheetImageMacro = [\".wikifiedImage svg, .wikifiedImage .image { width: 80%; }\",\r\n\t\".svgImageText { background-color:[[ColorPalette::Error]]; color:#ddd; display: inline-block; }\",\r\n\t\"span.svgImageText { display: inline-block; overflow: hidden; }\"\r\n].join(\"\");\r\nstore.addNotification(\"StyleSheetImageMacro\", refreshStyles);\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"ColorPalette\" server.title=\"ColorPalette\" server.page.revision=\"2564841\" server.etag=\"&quot;pearl_public/ColorPalette/2564841:56ff66cabaaaee875e5b2fcaeda1df07633f4ca5&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160925052712\" created=\"20160908133954\" tags=\"excludeLists excludeSearch\" _hash=\"1d4a507d8650ef2db7f7701a51d848c61fcf310f\">\r\n<pre>/*{{{*/\r\nBackground: #f8dceb\r\nForeground: #220615\r\nPrimaryPale: #fefafc\r\nPrimaryLight: #edc4da\r\nPrimaryMid: #b64884\r\nPrimaryDark: #534a4f\r\nSecondaryPale: #fafefd\r\nSecondaryLight: #c4ede8\r\nSecondaryMid: #48b6ab\r\nSecondaryDark: #4a5352\r\nTertiaryPale: #fafefa\r\nTertiaryLight: #c4edc4\r\nTertiaryMid: #48b648\r\nTertiaryDark: #4a534a\r\nError: #f88\r\nColorPaletteParameters: HSL([327|27], [0.67|0.53|0.43|0.06],[0.31|0.5|0.85|0.99])\r\n/*}}}*/</pre>\r\n</div>\r\n<div title=\"colorScheme\" server.title=\"colorScheme\" server.page.revision=\"1521879\" server.etag=\"&quot;system-info_public/colorScheme/1521879:449ed84b1ec385607355982b19ef6f7c8c75141b&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-info_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-info_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch\" _hash=\"bfe2408ed9b5cebf918768cae9c9e15bdb8f3309\">\r\n<pre>Unless you're delighted with the default theme you can make some quick changes by generating a new random color palette, hit this button to cycle through some alternatives.\r\n\r\n&lt;&lt;RandomColorPaletteButton saturation_pale:0.67 saturation_light:0.53\r\nsaturation_mid:0.43 saturation_dark:0.06 pale:0.99 light:0.85 mid:0.5 dark:0.31&gt;&gt;\r\n\r\nYou can also change the look and feel completely by installing a new theme. To do this, find one you like in the @themes space, note down the name, and include it in this space by going to the space menu. You can reach the space menu by clicking on the blue and pink circle at the top-right of the page and chooshing \"THIS SPACE\". Here are a few to check out:\r\n* @pip\r\n* @caspian-ii\r\n* @basalt\r\n* @simplicity\r\n* @cheesecake\r\n* @jelly-doughnut\r\n\r\n(//Note that if you are using a custom TiddlySpace install, these themes may not be present.//)</pre>\r\n</div>\r\n<div title=\"谁会是你灵魂的摆渡人\" server.title=\"谁会是你灵魂的摆渡人\" server.page.revision=\"2566406\" server.etag=\"&quot;pearl_public/%E8%B0%81%E4%BC%9A%E6%98%AF%E4%BD%A0%E7%81%B5%E9%AD%82%E7%9A%84%E6%91%86%E6%B8%A1%E4%BA%BA/2566406:557be8fc9180d5cc0f98afb1b49abf816003d700&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160927120001\" created=\"20160908133954\" tags=\"excludeLists excludeSearch\" _hash=\"2514d360080909abb51efd8ad5a1dbbc925d4da9\">\r\n<pre>如果存在，那是需要，谁会是你灵魂的摆渡人</pre>\r\n</div>\r\n<div title=\"close.svg\" server.title=\"close.svg\" server.page.revision=\"1521888\" server.etag=\"&quot;tiddlyspace/close.svg/1521888:2cd77e92869283907e0f5689b7cfa558f4e23f93&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"image/svg+xml\" modified=\"20131111192334\" created=\"20131111192334\" tags=\"excludeLists excludeSearch\" _hash=\"b21fe0ea0a8dba52788155f5ed2188b45210d076\">\r\n<pre>&lt;?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?&gt;\r\n&lt;!-- Created with Inkscape (http://www.inkscape.org/) --&gt;\r\n\r\n&lt;svg\r\n   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\r\n   xmlns:cc=\"http://creativecommons.org/ns#\"\r\n   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\r\n   xmlns:svg=\"http://www.w3.org/2000/svg\"\r\n   xmlns=\"http://www.w3.org/2000/svg\"\r\n   xmlns:xlink=\"http://www.w3.org/1999/xlink\"\r\n   version=\"1.1\"\r\n   width=\"14pt\"\r\n   height=\"14pt\"\r\n   viewBox=\"918 510 14 14\"\r\n   id=\"svg3070\"&gt;\r\n  &lt;metadata\r\n     id=\"metadata3089\"&gt;\r\n    &lt;rdf:RDF&gt;\r\n      &lt;cc:Work\r\n         rdf:about=\"\"&gt;\r\n        &lt;dc:format&gt;image/svg+xml&lt;/dc:format&gt;\r\n        &lt;dc:type\r\n           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" /&gt;\r\n        &lt;dc:title&gt;&lt;/dc:title&gt;\r\n      &lt;/cc:Work&gt;\r\n    &lt;/rdf:RDF&gt;\r\n  &lt;/metadata&gt;\r\n  &lt;defs\r\n     id=\"defs3072\"&gt;\r\n    &lt;radialGradient\r\n       cx=\"0\"\r\n       cy=\"0\"\r\n       r=\"1\"\r\n       id=\"Gradient\"\r\n       gradientUnits=\"userSpaceOnUse\"&gt;\r\n      &lt;stop\r\n         id=\"stop3075\"\r\n         style=\"stop-color:#ffffff;stop-opacity:1\"\r\n         offset=\"0\" /&gt;\r\n      &lt;stop\r\n         id=\"stop3077\"\r\n         style=\"stop-color:#2b2b2b;stop-opacity:1\"\r\n         offset=\"1\" /&gt;\r\n    &lt;/radialGradient&gt;\r\n    &lt;radialGradient\r\n       id=\"Obj_Gradient\"\r\n       xlink:href=\"#Gradient\"\r\n       gradientTransform=\"matrix(11.473944,0,0,11.473944,922.3752,513.7837)\" /&gt;\r\n  &lt;/defs&gt;\r\n  &lt;g\r\n     id=\"g3080\"\r\n     style=\"fill:none;stroke:none\"&gt;\r\n    &lt;g\r\n       id=\"g3082\"&gt;\r\n      &lt;path\r\n         d=\"m 929.6952,512.9018 c -2.5384,-2.53843 -6.654,-2.53843 -9.1924,0 -2.5384,2.5384 -2.5384,6.654 0,9.19238 2.5384,2.53839 6.654,2.53839 9.1924,0 2.5384,-2.53838 2.5384,-6.65398 0,-9.19238 m -4.5962,2.8407 2.07733,-2.07734 1.75547,1.75549 -2.0773,2.07735 2.0773,2.07732 -1.75547,1.75548 -2.07733,-2.07732 -2.07733,2.07732 -1.75547,-1.75548 2.0773,-2.07732 -2.0773,-2.07735 1.75547,-1.75549 z\"\r\n         id=\"path3084\"\r\n         style=\"fill:url(#Obj_Gradient)\" /&gt;\r\n      &lt;path\r\n         d=\"m 927.61447,515.38354 a 4.51205,4.2590378 0 1 1 -9.0241,0 4.51205,4.2590378 0 1 1 9.0241,0 z\"\r\n         transform=\"matrix(1.0218069,0,0,1.0462046,-18.063694,-21.648443)\"\r\n         id=\"path2394\"\r\n         style=\"fill:#000000;fill-opacity:0;fill-rule:evenodd;stroke:none;stroke-width:5;marker:none;visibility:visible;display:inline;overflow:visible;enable-background:accumulate\" /&gt;\r\n    &lt;/g&gt;\r\n  &lt;/g&gt;\r\n&lt;/svg&gt;</pre>\r\n</div>\r\n<div title=\"publicIcon\" server.title=\"publicIcon\" server.page.revision=\"1521911\" server.etag=\"&quot;tiddlyspace/publicIcon/1521911:07ce0a7ec0c1a238dfeee68866fe0fd4b1432e90&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"image/png\" modified=\"20131111192334\" created=\"20131111192334\" tags=\"excludeLists excludeSearch\" _cache-max-age=\"43200\" _hash=\"8e44a24b6d966bfdda2a6cfeb9f141ac3a3892a5\">\r\n<pre>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</pre>\r\n</div>\r\n<div title=\"backstage.svg\" server.title=\"backstage.svg\" server.page.revision=\"1521885\" server.etag=\"&quot;tiddlyspace/backstage.svg/1521885:97eec9aefc1b2533ca128a6403497df18e6f4fe3&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"image/svg+xml\" modified=\"20131111192334\" created=\"20131111192334\" tags=\"excludeLists excludeSearch\" _hash=\"c1cd42462c1b10a4e77a891408b9c2a24da3b2e6\">\r\n<pre>&lt;svg xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\" xmlns=\"http://www.w3.org/2000/svg\" height=\"100%\" width=\"100%\" version=\"1.1\" xmlns:cc=\"http://creativecommons.org/ns#\" xmlns:dc=\"http://purl.org/dc/elements/1.1/\" viewBox=\"0 0 40 40\"&gt;&lt;metadata&gt;&lt;rdf:RDF&gt;&lt;cc:Work rdf:about=\"\"&gt;&lt;dc:format&gt;image/svg+xml&lt;/dc:format&gt;&lt;dc:type rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\"/&gt;&lt;dc:title/&gt;&lt;/cc:Work&gt;&lt;/rdf:RDF&gt;&lt;/metadata&gt;&lt;defs&gt;&lt;linearGradient id=\"lG3826\" x1=\"7.0996\" gradientUnits=\"userSpaceOnUse\" y1=\"18.829\" gradientTransform=\"matrix(1.5858347,0,0,1.8078238,1098.1851,351.13716)\" x2=\"1.5461\" y2=\"-0.95166\"&gt;&lt;stop stop-color=\"#000\" offset=\"0\"/&gt;&lt;stop stop-color=\"#9c9b99\" offset=\"1\"/&gt;&lt;/linearGradient&gt;&lt;linearGradient id=\"lG3828\" y2=\"372.44\" gradientUnits=\"userSpaceOnUse\" y1=\"375.7\" x2=\"1111.7\" x1=\"1097.7\"&gt;&lt;stop style=\"stop-color:#ac9393;\" offset=\"0\"/&gt;&lt;stop style=\"stop-color:#c8b7b7;\" offset=\"1\"/&gt;&lt;/linearGradient&gt;&lt;/defs&gt;&lt;g transform=\"translate(-1080.9375,-357.3329)\"&gt;&lt;path style=\"stroke-width:0;stroke-miterlimit:4;fill:url(#lG3826);\" d=\"m1080.9,357.32,39.996-0.0426-0.01,40.008c-15.507-25.519-15.36-25.95-39.988-39.965z\"/&gt;&lt;path style=\"stroke-dashoffset:0;stroke:#7aa3be;stroke-linecap:round;stroke-miterlimit:4;stroke-width:1.49999988;fill:#c1e6fd;\" d=\"m1091.9,363.55c6.5716-6.4925,16.576-7.3925,23.147-0.90003,6.5717,6.4925,6.5717,17.019,0,23.511-4.4424-8.6113-12.288-15.713-23.147-22.611z\"/&gt;&lt;path style=\"stroke-dashoffset:0;stroke:#ce81b0;stroke-linecap:round;stroke-miterlimit:4;stroke-width:1.5;fill:#f4c4e2;\" d=\"m1110.2,367.62c3.217,3.2168,3.217,8.4323,0,11.649-3.8194-4.2357-8.3307-8.1824-11.649-11.649,3.217-3.2168,8.4325-3.2168,11.649-0.00002z\"/&gt;&lt;path style=\"stroke-linejoin:bevel;stroke:#000000;stroke-linecap:round;stroke-dasharray:none;stroke-miterlimit:4;stroke-width:0.80000001;fill:url(#lG3828);\" d=\"m1081,357.34c18.79,6.4752,32.53,16.56,39.894,39.892-11.19-17.028-14.878-19.19-27.352-14.96,6.2984-12.098,3.9371-13.19-12.542-24.932z\"/&gt;&lt;/g&gt;&lt;/svg&gt;</pre>\r\n</div>\r\n<div title=\"editTiddlerReadOnly\" server.title=\"editTiddlerReadOnly\" server.page.revision=\"1521933\" server.etag=\"&quot;system-images_public/editTiddlerReadOnly/1521933:e8392b32c8e33d39308efa743e57255cf899881e&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-images_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-images_public\" server.permissions=\"read\" server.content-type=\"image/svg+xml\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch\" _hash=\"24d0766e948d10eb5e220d57a8c0d16a194ebe1f\">\r\n<pre>&lt;svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xl=\"http://www.w3.org/1999/xlink\" version=\"1.1\" viewBox=\"506 234 68 36\" width=\"30\" height=\"30\"&gt;&lt;metadata xmlns:dc=\"http://purl.org/dc/elements/1.1/\"&gt;&lt;dc:date&gt;2010-09-16 14:51Z&lt;/dc:date&gt;&lt;!-- Produced by OmniGraffle Professional 5.2.3 --&gt;&lt;/metadata&gt;&lt;defs&gt;&lt;/defs&gt;&lt;g stroke=\"none\" stroke-opacity=\"1\" stroke-dasharray=\"none\" fill=\"none\" fill-opacity=\"1\"&gt;&lt;rect width=\"1118\" height=\"783\"/&gt;&lt;g&gt;&lt;path d=\"M 538.68195 244.31807 C 540.43927 246.07547 540.43927 248.9247 538.68195 250.68204 C 536.92456 252.4394 534.07532 252.4394 532.318 250.68204 C 530.5606 248.9247 530.5606 246.07547 532.318 244.31807 C 534.07532 242.56075 536.92456 242.56075 538.68195 244.31807 M 511.12607 257.99356 C 511.26108 258.13019 511.39728 258.26608 511.53473 258.40121 C 527.2556 273.86606 552.74414 273.86606 568.46515 258.40121 C 568.60248 258.26617 568.73853 258.13037 568.87354 257.9938 C 568.8736 257.99374 568.8736 257.99371 568.8736 257.99362 C 568.87366 257.99371 568.87366 257.9938 568.87372 257.9939 C 570.72504 256.12051 572.35046 254.11153 573.74994 252 C 573.74994 251.99997 573.74994 251.99994 573.74994 251.99992 C 572.35046 249.8884 570.72504 247.87938 568.87372 246.00606 C 568.87366 246.00613 568.87366 246.00621 568.8736 246.00627 C 568.73865 245.86966 568.60254 245.73383 568.46515 245.5987 C 552.74414 230.13387 527.2556 230.13387 511.53473 245.5987 C 511.39728 245.73383 511.26108 245.86974 511.12613 246.00635 C 511.126 246.00624 511.126 246.00616 511.12595 246.00606 C 509.2748 247.87938 507.64954 249.88837 506.24994 251.9998 L 506.24994 251.99983 C 506.24994 251.9999 506.25 251.99992 506.25 251.99997 C 506.25 252 506.24994 252.00005 506.24994 252.00009 L 506.24994 252.00012 C 507.64954 254.11157 509.2748 256.12051 511.12595 257.9939 C 511.126 257.99377 511.126 257.99365 511.12607 257.99359 Z M 515.44916 252 C 515.8548 251.55469 516.27502 251.11778 516.71014 250.68985 C 522.16632 245.32257 529.06055 242.23206 536.17273 241.41824 C 534.6662 241.96199 533.2525 242.83762 532.04498 244.04512 C 527.65155 248.43852 527.65155 255.56163 532.04498 259.95502 C 533.2522 261.16226 534.6656 262.03778 536.17175 262.58154 C 529.05988 261.76761 522.16608 258.6771 516.71014 253.31009 C 516.2751 252.88219 515.85486 252.44528 515.44922 252 Z M 564.55054 251.99995 C 564.14502 252.44525 563.7248 252.88217 563.28973 253.31009 C 557.83368 258.67712 550.93988 261.76764 543.828 262.58157 C 545.33423 262.03781 546.74756 261.1623 547.9549 259.95502 C 552.34833 255.56163 552.34833 248.43852 547.9549 244.04512 C 546.74744 242.83765 545.33374 241.96202 543.82715 241.41824 C 550.9394 242.23206 557.83356 245.3226 563.28973 250.68985 C 563.7248 251.11775 564.14502 251.55467 564.55054 251.99995 Z M 568.8736 257.99362 C 570.7249 256.12033 572.35028 254.11139 573.74988 252.00002\" fill=\"black\" class=\"glyph\"/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;</pre>\r\n</div>\r\n<div title=\"How to socialise\" server.title=\"How to socialise\" server.page.revision=\"1521880\" server.etag=\"&quot;system-info_public/How%20to%20socialise/1521880:1528ec938486ea41364d9ac7201ba66c2092e8f5&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-info_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-info_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeMissing excludeSearch\" _hash=\"e730478f88ff38b560ebde4eaf4267b136bf6584\">\r\n<pre>There are a lot of interesting people using ~TiddlySpace that you might like to keep track of and interact with. There are a number of ways of doing this.\r\n\r\nIf you see a number in the speech bubble in one of your tiddlers, it means that someone is writing about the same thing as you. You can find out what they're saying by clicking on it. Likewise, if you see something interesting in someone else's space, you can respond to it and write up your own thoughts on the subject by clicking \"Reply to this tiddler\".\r\n\r\nAdditionally, if you find anyone interesting, or you find an interesting looking space and you'd like to know when it's changed, you can \"follow\" that space. To do this, simply create a tiddler with the title: {{{@space-name}}} and tag it {{{follow}}}. If you want, you can store some notes about that space in the body of the tiddler.\r\n\r\nIf you then want to know what happening, simply [[include|How do I include/exclude spaces?]]@docs the @tivity space and then visit your activity stream at [[/activity|/activity]], or just visit the @tapas space directly.\r\n\r\n!Not sure who to follow?\r\nHere's a few suggestions:\r\n* @fnd\r\n* @cdent\r\n* @pmario\r\n* @bengillies\r\n* @dickon</pre>\r\n</div>\r\n<div title=\"TiddlySpaceFollowingPlugin\" server.title=\"TiddlySpaceFollowingPlugin\" server.page.revision=\"1521864\" server.etag=\"&quot;system-plugins_public/TiddlySpaceFollowingPlugin/1521864:981a6b8d2c329034ef1f75cd1d570d9cb09ca432&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-plugins_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-plugins_public\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"65a4f81f24d076e5c3fc66d2ff037c994c514bcd\">\r\n<pre>/***\r\n|''Name''|TiddlySpaceFollowingPlugin|\r\n|''Version''|0.7.1|\r\n|''Description''|Provides a following macro|\r\n|''Author''|Jon Robson|\r\n|''Requires''|TiddlySpaceConfig TiddlySpaceTiddlerIconsPlugin ErrorHandler|\r\n|''License''|[[BSD|http://www.opensource.org/licenses/bsd-license.php]]|\r\n!Usage\r\nTag a tiddler with \"follow\" to express a list of followers.\r\nUsing the {{{&lt;&lt;followTiddlers X&gt;&gt;}}}\r\nwill reveal the number of tiddlers with name X in the set of spaces the *current* user viewing your space follows.\r\n{{{&lt;&lt;following jon&gt;&gt;}}} will list all the users following Jon.\r\n{{{&lt;&lt;followers jon&gt;&gt;}}} will list all the followers of jon.\r\n{{{&lt;linkedTiddlers&gt;&gt;}}} will list all tiddlers across TiddlySpace linked to the current tiddler\r\n{{{&lt;linkedTiddlers follow:yes&gt;&gt;}}} will list all tiddlers across TiddlySpace that come from your list of followers\r\nadds spaceLink view type {{{&lt;&lt;view server.bag spaceLink&gt;&gt;}}} creates a link to the space described in server.bag\r\n{{{&lt;&lt;view server.bag spaceLink title&gt;&gt;}}} makes a link to the tiddler with title expressed in the field title in space server.bag\r\nIf no name is given eg. {{{&lt;&lt;following&gt;&gt;}}} or {{{&lt;&lt;follow&gt;&gt;}}} it will default the current user.\r\n!StyleSheet\r\n.followTiddlersList li {\r\n\tlist-style:none;\r\n}\r\n\r\n.followButton {\r\n\twidth: 2em;\r\n}\r\n\r\n.followTiddlersList li .siteIcon {\r\n\theight:48px;\r\n\twidth: 48px;\r\n}\r\n\r\n#sidebarTabs .followers li a,\r\n.followers .siteIcon,\r\n.followers .siteIcon div {\r\n\tdisplay: inline;\r\n}\r\n\r\n.followTiddlersList li .externalImage, .followTiddlersList li .image {\r\n\tdisplay: inline;\r\n}\r\n\r\n.scanResults li {\r\n\tlist-style: none;\r\n}\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\nvar LIMIT_FOLLOWING = 100;\r\n\r\nvar tweb = config.extensions.tiddlyweb;\r\nvar tiddlyspace = config.extensions.tiddlyspace;\r\nvar currentSpace = tiddlyspace.currentSpace.name;\r\n\r\nvar shadows = config.shadowTiddlers;\r\nconfig.annotations.ScanTemplate = \"This tiddler is the default template used in the display of tiddlers founding using the tsScan macro. To access attributes use the view macro e.g. {{{&lt;&lt;view title text&gt;&gt;}}}\";\r\nshadows.ScanTemplate = \"&lt;&lt;view modifier SiteIcon width:24 height:24 spaceLink:yes label:no&gt;&gt; &lt;&lt;view title link&gt;&gt;\";\r\nshadows.FollowersTemplate = \"&lt;&lt;view server.bag SiteIcon width:24 height:24 spaceLink:yes label:no&gt;&gt; &lt;&lt;view server.bag spaceLink&gt;&gt;\";\r\nshadows.FollowingTemplate = \"&lt;&lt;view title SiteIcon width:24 height:24 spaceLink:yes label:no&gt;&gt; &lt;&lt;view title spaceLink&gt;&gt;\";\r\nshadows.FollowTiddlersBlackList = \"\";\r\nshadows.FollowTiddlersHeading = \"There are tiddlers in spaces you follow using the follow tag which use the title &lt;&lt;view title text&gt;&gt;\";\r\nshadows.FollowTiddlersTemplate = [\"* &lt;&lt;view server.space SiteIcon width:24 height:24 spaceLink:yes label:no&gt;&gt; \",\r\n\t\"&lt;&lt;view server.space spaceLink title external:no&gt;&gt; modified by &lt;&lt;view modifier spaceLink&gt;&gt; \",\r\n\t\"in the &lt;&lt;view server.space spaceLink&gt;&gt; space (&lt;&lt;view modified date&gt;&gt; @ &lt;&lt;view modified date 0hh:0mm&gt;&gt;).\\n\"].join(\"\");\r\n\r\nvar name = \"StyleSheetFollowing\";\r\nshadows[name] = \"/*{{{*/\\n%0\\n/*}}}*/\".\r\n\tformat(store.getTiddlerText(tiddler.title + \"##StyleSheet\"));\r\nstore.addNotification(name, refreshStyles);\r\n\r\n// provide support for sucking in tiddlers from the server\r\ntiddlyspace.displayServerTiddler = function(src, title, workspace, callback) {\r\n\tvar adaptor = store.getTiddlers()[0].getAdaptor();\r\n\tvar localTitle = tiddlyspace.getLocalTitle(title, workspace);\r\n\tvar tiddler = new Tiddler(localTitle);\r\n\ttiddler.text = \"Please wait while this tiddler is retrieved...\";\r\n\ttiddler.fields.doNotSave = \"true\";\r\n\tstore.addTiddler(tiddler);\r\n\tsrc = story.displayTiddler(src || null, tiddler.title);\r\n\ttweb.getStatus(function(status) {\r\n\t\tvar context = {\r\n\t\t\thost: tweb.host, // TODO: inherit from source tiddler?\r\n\t\t\tworkspace: workspace,\r\n\t\t\theaders: { \"X-ControlView\": \"false\" }\r\n\t\t};\r\n\t\tvar getCallback = function(context, userParams) {\r\n\t\t\tvar tiddler = context.tiddler;\r\n\t\t\ttiddler.title = localTitle;\r\n\t\t\tstore.addTiddler(tiddler);\r\n\t\t\tstory.refreshTiddler(localTitle, null, true); // overriding existing allows updating\r\n\t\t\tif(callback) {\r\n\t\t\t\tcallback(src, tiddler);\r\n\t\t\t}\r\n\t\t};\r\n\t\tadaptor.getTiddler(title, context, null, getCallback);\r\n\t});\r\n};\r\n\r\ntiddlyspace.scroller = {\r\n\trunHandler: function(title, top, bottom, height) {\r\n\t\tvar i;\r\n\t\tvar handlers = tiddlyspace.scroller.handlers;\r\n\t\tvar tidEl = story.getTiddler(title);\r\n\t\tif(tidEl) {\r\n\t\t\tvar topEl = $(tidEl).offset().top + 20;\r\n\t\t\tif(top === false || (topEl &gt; top &amp;&amp; topEl &lt; bottom)) {\r\n\t\t\t\tvar h = handlers[title];\r\n\t\t\t\tfor(i = 0; i &lt; h.length; i++) {\r\n\t\t\t\t\th[i]();\r\n\t\t\t\t}\r\n\t\t\t\ttiddlyspace.scroller.clearHandlers(title);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\ttiddlyspace.scroller.clearHandlers(title);\r\n\t\t}\r\n\t},\r\n\tclearHandlers: function(title) {\r\n\t\ttiddlyspace.scroller.handlers[title] = [];\r\n\t},\r\n\tregisterIsVisibleEvent: function(title, handler) {\r\n\t\ttiddlyspace.scroller.handlers[title] = tiddlyspace.scroller.handlers[title] || [];\r\n\t\ttiddlyspace.scroller.handlers[title].push(handler);\r\n\t},\r\n\tinit: function() {\r\n\t\tthis.handlers = {};\r\n\t\tthis.interval = window.setInterval(function() {\r\n\t\t\tvar top = $(window).scrollTop();\r\n\t\t\tvar height = $(window).height();\r\n\t\t\tvar bottom = top + height;\r\n\t\t\tvar title;\r\n\t\t\tfor(title in tiddlyspace.scroller.handlers) {\r\n\t\t\t\tif(title) {\r\n\t\t\t\t\ttiddlyspace.scroller.runHandler(title, top, bottom, height);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, 2000); // every 2 seconds check scroll position\r\n\t}\r\n};\r\ntiddlyspace.scroller.init();\r\n\r\nvar followMacro = config.macros.followTiddlers = {\r\n\tlocale: {\r\n\t\tfollowListHeader: \"Here are tiddlers from spaces you follow using the follow tag which use this title.\",\r\n\t\tnoTiddlersFromFollowers: \"None of the spaces you follow contain a tiddler with this name.\",\r\n\t\terrorMessage: \"There was a problem retrieving tiddlers from the server. Please try again later.\"\r\n\t},\r\n\tinit: function() {\r\n\t\tfollowMacro.lookup = {};\r\n\t},\r\n\tfollowTag: \"follow\",\r\n\tgetHosts: function(callback) {\r\n\t\ttweb.getStatus(function(status) {\r\n\t\t\tcallback(tweb.host, tiddlyspace.getHost(status.server_host, \"%0\"));\r\n\t\t});\r\n\t},\r\n\tgetBlacklist: function() {\r\n\t\treturn store.getTiddlerText(\"FollowTiddlersBlackList\").split(\"\\n\");\r\n\t},\r\n\thandler: function(place, macroName, params, wikifier, paramString, tiddler) {\r\n\t\tvar args = paramString.parseParams(\"anon\")[0];\r\n\t\tvar containingTiddler = story.findContainingTiddler(place).getAttribute('tiddler');\r\n\t\tvar title = (args.anon &amp;&amp; args.anon[0]) || tiddler.fields[\"server.title\"] || tiddler.title;\r\n\t\tvar tid = store.getTiddler(title);\r\n\t\tvar user = params[1] || false;\r\n\t\tif(tid) {\r\n\t\t\tfollowMacro.makeButton(place, {\r\n\t\t\t\turl: \"/search?q=title:%22\" + encodeURIComponent(title) + \"%22\",\r\n\t\t\t\tcontainingTiddler: containingTiddler,\r\n\t\t\t\tblacklisted: followMacro.getBlacklist(), title: title, user: user,\r\n\t\t\t\tconsultFollowRelationship: (args.follow &amp;&amp;\r\n\t\t\t\t\targs.follow[0] === 'false') ? false : true });\r\n\t\t}\r\n\t},\r\n\tmakeButton: function(place, options) { // this is essentially the same code in TiddlySpaceFollowingPlugin\r\n\t\tvar title = options.title;\r\n\t\tvar blacklisted = options.blacklisted;\r\n\t\tvar tiddler = store.getTiddler(title);\r\n\t\tvar btn = $('&lt;div class=\"followButton\" /&gt;').addClass(\"notLoaded\").appendTo(place)[0];\r\n\t\tif(blacklisted.contains(title)) {\r\n\t\t\t$(btn).remove();\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tvar user = options.user;\r\n\t\t\twindow.setTimeout(function() { // prevent multiple calls due to refresh\r\n\t\t\t\ttiddlyspace.scroller.registerIsVisibleEvent(options.containingTiddler, function() {\r\n\t\t\t\t\tvar mkButton = function(followers, ignore) {\r\n\t\t\t\t\t\tif(!followers &amp;&amp; !ignore) {\r\n\t\t\t\t\t\t\t$(btn).remove();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$(\"&lt;a /&gt;\").appendTo(btn);\r\n\t\t\t\t\t\t\tvar scanOptions = { url: options.url,\r\n\t\t\t\t\t\t\t\tspaceField: options.spaceField || \"bag\", template: null, sort: \"-modified\",\r\n\t\t\t\t\t\t\t\tcallback: function(tiddlers) {\r\n\t\t\t\t\t\t\t\t\t$(btn).removeClass(\"notLoaded\");\r\n\t\t\t\t\t\t\t\t\tfollowMacro.constructInterface(btn, tiddlers);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tif(!ignore) {\r\n\t\t\t\t\t\t\t\tscanOptions.showBags = followMacro._getFollowerBags(followers);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tscanOptions.hideBags = [tiddler.fields[\"server.bag\"]];\r\n\t\t\t\t\t\t\tscanMacro.scan(null, scanOptions, user);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t\tif(options.consultFollowRelationship) {\r\n\t\t\t\t\t\tfollowMacro.getFollowers(mkButton);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmkButton([], true);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}, 1000);\r\n\t\t}\r\n\t},\r\n\tconstructInterface: function(container, tiddlers) {\r\n\t\tvar txt = tiddlers.length;\r\n\t\tvar className = txt &gt; 0 ? \"hasReplies\" : \"noReplies\";\r\n\t\tvar el = $(story.findContainingTiddler(container));\r\n\t\t$(container).empty().addClass(className);\r\n\t\tvar btn = $(\"&lt;a /&gt;\").addClass(\"followedTiddlers\").text(txt).\r\n\t\t\tclick(function(ev) {\r\n\t\t\t\tfollowMacro.followingOnClick(ev);\r\n\t\t\t}).appendTo('&lt;div class=\"followedTiddlers\" /&gt;').appendTo(container)[0];\r\n\t\t$.data(btn, \"tiddlers\", tiddlers);\r\n\t},\r\n\tfollowingOnClick: function(ev) {\r\n\t\tvar target = ev.target;\r\n\t\tvar locale = followMacro.locale;\r\n\t\tvar el = $('&lt;div class=\"followTiddlersList\" /&gt;')[0];\r\n\t\tvar popup = Popup.create(target,\"div\");\r\n\t\t$(popup).addClass(\"taggedTiddlerList followList\").click(function(ev) { // make it so only clicking on the document outside the popup removes the popup\r\n\t\t\tif(ev.target.parentNode != document) {\r\n\t\t\t\tev.stopPropagation();\r\n\t\t\t}\r\n\t\t}).append(el);\r\n\t\tvar tiddlers = $.data(target, \"tiddlers\") || [];\r\n\t\tscanMacro.template(el, tiddlers.slice(0,1), \"FollowTiddlersHeading\");\r\n\t\tscanMacro.template(el, tiddlers, \"FollowTiddlersTemplate\");\r\n\t\tif(tiddlers.length === 0) {\r\n\t\t\t$(\"&lt;li /&gt;\").text(locale.noTiddlersFromFollowers).appendTo(el);\r\n\t\t}\r\n\t\tPopup.show();\r\n\t\tev.stopPropagation();\r\n\t\treturn popup;\r\n\t},\r\n\t_getFollowerBags: function(followers) { // XXX: private or not?\r\n\t\treturn $.map(followers, function(name, i) {\r\n\t\t\treturn name != currentSpace ? \"%0_public\".format(name) : null;\r\n\t\t});\r\n\t},\r\n\tgetFollowers: function(callback, username) {\r\n\t\t// returns a list of spaces being followed by the existing space\r\n\t\tvar followersCallback = function(user) {\r\n\t\t\tif(!user.anon) {\r\n\t\t\t\tscanMacro.scan(null, { \r\n\t\t\t\t\turl: \"/search?q=bag:%0_public tag:%1 _limit:%2\".format(user.name, followMacro.followTag, LIMIT_FOLLOWING),\r\n\t\t\t\t\tspaceField: \"title\", template: null, cache: true,\r\n\t\t\t\t\tcallback: function(tiddlers) {\r\n\t\t\t\t\t\tvar followers = [];\r\n\t\t\t\t\t\tfor(var i = 0; i &lt; tiddlers.length; i++) {\r\n\t\t\t\t\t\t\tfollowers.push(tiddlyspace.resolveSpaceName(tiddlers[i].title));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcallback(followers);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tcallback(false);\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn !username ? tweb.getUserInfo(followersCallback) : followersCallback({ name: username });\r\n\t}\r\n};\r\n\r\nvar scanMacro = config.macros.tsScan = {\r\n\tinit: function () {\r\n\t\tthis.scanned = {};\r\n\t},\r\n\t_tiddlerfy: function(jsontiddlers, options) {\r\n\t\tvar tiddlers = [];\r\n\t\tvar spaceField = options.spaceField || \"bag\"; // TODO: phase out use view types instead\r\n\t\t$.each(jsontiddlers, function(i, t) {\r\n\t\t\tvar use = false;\r\n\t\t\tif(!options.showBags || (options.showBags &amp;&amp; options.showBags.contains(t.bag))) {\r\n\t\t\t\tuse = true;\r\n\t\t\t}\r\n\t\t\tif(options.hideBags &amp;&amp; options.hideBags.contains(t.bag)) {\r\n\t\t\t\tuse = false;\r\n\t\t\t}\r\n\t\t\tif(use) {\r\n\t\t\t\tvar spaceName = t[spaceField];\r\n\t\t\t\tvar tiddler = config.adaptors.tiddlyweb.toTiddler(t, tweb.host);\r\n\t\t\t\ttiddler.fields[\"server.space\"] = tiddlyspace.resolveSpaceName(spaceName);\r\n\t\t\t\ttiddlers.push(tiddler);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn tiddlers;\r\n\t},\r\n\t_scanCallback: function(place, jsontiddlers, options) {\r\n\t\tvar locale = followersMacro.locale;\r\n\t\tvar tiddlers = scanMacro._tiddlerfy(jsontiddlers, options);\r\n\t\t\r\n\t\tif(options.sort) {\r\n\t\t\ttiddlers = store.sortTiddlers(tiddlers, options.sort);\r\n\t\t}\r\n\t\tif(options.filter) {\r\n\t\t\tvar _store = new TiddlyWiki();\r\n\t\t\tconfig.lastStore = _store;\r\n\t\t\tfor(var i = 0; i &lt; tiddlers.length; i++) {\r\n\t\t\t\tvar clone = tiddlers[i];\r\n\t\t\t\tclone.title = tiddlyspace.getLocalTitle(clone.title, clone.fields['server.workspace']);\r\n\t\t\t\t_store.addTiddler(clone);\r\n\t\t\t}\r\n\t\t\ttiddlers = _store.filterTiddlers(options.filter);\r\n\t\t}\r\n\t\tif(place) {\r\n\t\t\t$(place).empty();\r\n\t\t\tvar list = $(\"&lt;ul /&gt;\").appendTo(place)[0];\r\n\t\t\tscanMacro.template(list, tiddlers, options.template);\r\n\t\t\tif(tiddlers.length === 0) {\r\n\t\t\t\t$(\"&lt;li /&gt;\").text(options.emptyMessage || locale.noone).appendTo(list);\r\n\t\t\t\t$(list).addClass(\"emptyList\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(options.callback) {\r\n\t\t\toptions.callback(tiddlers);\r\n\t\t}\r\n\t},\r\n\tconstructSearchUrl: function(host, options) {\r\n\t\tif(options.url) {\r\n\t\t\treturn options.url;\r\n\t\t}\r\n\t\tvar inputs = options.searchValues;\r\n\t\tvar tag = options.tag;\r\n\t\tvar searchField = options.searchField || \"title\";\r\n\t\tvar searchQuery = [];\r\n\t\tfor(var i = 0; i &lt; inputs.length; i++) {\r\n\t\t\tsearchQuery.push('%0:\"%1\"'.format(searchField, inputs[i]));\r\n\t\t}\r\n\t\tvar query = searchQuery.join(\" OR \");\r\n\t\tquery = tag ? \"(%0) AND tag:%1\".format(query, tag) : query;\r\n\t\tquery = options.query ? \"%0;%1;\".format(query, options.query) : query;\r\n\t\tquery = options.fat ? \"%0&amp;fat=1\".format(query) : query;\r\n\t\treturn '%0/search?q=%1'.format(host, query);\r\n\t},\r\n\tscan: function(place, options) { // TODO: make use of list macro with url filter\r\n\t\tvar locale = followersMacro.locale;\r\n\t\toptions.template = options.template ? options.template : \"ScanTemplate\";\r\n\t\tfollowMacro.getHosts(function(host, tsHost) {\r\n\t\t\t$(place).text(followersMacro.locale.pleaseWait);\r\n\t\t\toptions = options ? options: {};\r\n\t\t\tvar url = scanMacro.constructSearchUrl(host, options);\r\n\t\t\tif(options.cache &amp;&amp; scanMacro.scanned[url]) {\r\n\t\t\t\tvar tiddlers = scanMacro.scanned[url].tiddlers;\r\n\t\t\t\tvar run = function(tiddlers) {\r\n\t\t\t\t\tscanMacro._scanCallback(place, tiddlers, options);\r\n\t\t\t\t};\r\n\t\t\t\tif(tiddlers) {\r\n\t\t\t\t\trun(tiddlers);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tscanMacro.scanned[url].callbacks.push(run);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar callback = function(tiddlers) {\r\n\t\t\t\t\tscanMacro._scanCallback(place, tiddlers, options);\r\n\t\t\t\t};\r\n\t\t\t\tif(scanMacro.scanned[url] &amp;&amp; scanMacro.scanned[url].callbacks) {\r\n\t\t\t\t\tscanMacro.scanned[url].callbacks.push(callback);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tscanMacro.scanned[url] = {\r\n\t\t\t\t\t\tcallbacks: [callback]\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tajaxReq({\r\n\t\t\t\t\turl: url,\r\n\t\t\t\t\tdataType: \"json\",\r\n\t\t\t\t\tsuccess: function(tiddlers) {\r\n\t\t\t\t\t\tscanMacro.scanned[url].tiddlers = tiddlers;\r\n\t\t\t\t\t\tvar callbacks = scanMacro.scanned[url].callbacks;\r\n\t\t\t\t\t\twhile(callbacks.length &gt; 0) {\r\n\t\t\t\t\t\t\tcallbacks.pop()(tiddlers);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror: function(xhr) {\r\n\t\t\t\t\t\t$(place).empty();\r\n\t\t\t\t\t\t$(\"&lt;span /&gt;\").addClass(\"annotation error\").text(locale.error.format(xhr.status)).appendTo(place);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\ttemplate: function(place, tiddlers, template) { // TODO: make use of list macro.\r\n\t\tfor(var i = 0; i &lt; tiddlers.length; i++) {\r\n\t\t\tvar tiddler = tiddlers[i];\r\n\t\t\tvar item = $('&lt;li class=\"spaceName\" /&gt;').appendTo(place)[0];\r\n\t\t\tvar spaceName = tiddler.fields[\"server.space\"] || \"\";\r\n\t\t\tvar templateText = store.getTiddlerText(template).replace(/\\$1/mg, spaceName);\r\n\t\t\twikify(templateText, item, null, tiddler);\r\n\t\t}\r\n\t},\r\n\tgetOptions: function(paramString, tiddler) {\r\n\t\tvar args = paramString.parseParams(\"name\", null, true, false, true)[0];\r\n\t\tvar options = { query: false, sort: false, tag: false, template: false, showBags: args.show || false,\r\n\t\t\thideBags: args.hide || false, filter: false, spaceField: \"bag\", searchField: \"title\", fat: false,\r\n\t\t\temptyMessage: false };\r\n\t\tfor(var name in args) {\r\n\t\t\tif(name != \"name\") {\r\n\t\t\t\tif(name == \"fat\") {\r\n\t\t\t\t\toptions[name] = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\toptions[name] = args[name][0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// if user has set searchField to modifier, then use the modifiers value if available otherwise use searchValues.\r\n\t\tvar searchField = options.searchField;\r\n\t\tvar searchValues = args[searchField] ? args[searchField] : args.searchValues;\r\n\t\t// if neither of those were used use the first parameter\r\n\t\tvar defaultValues = tiddler ? [ tiddler.title ] : [];\r\n\t\toptions.searchValues = searchValues ? searchValues : ( args.name ? [args.name[0]] : defaultValues);\r\n\t\treturn options;\r\n\t},\r\n\thandler: function(place, macroName, params, wikifier, paramString, tiddler) {\r\n\t\tvar container = $(\"&lt;div /&gt;\").addClass(\"scanResults resultsArea\").appendTo(place)[0];\r\n\t\tvar options = scanMacro.getOptions(paramString, tiddler);\r\n\t\tscanMacro.scan(container, options);\r\n\t}\r\n};\r\n\r\nvar followersMacro = config.macros.followers = {\r\n\tlocale: {\r\n\t\tloggedOut: \"Please login to see the list of followers\",\r\n\t\tnoSupport: \"We were unable to retrieve followers as your browser does not support following.\",\r\n\t\tpleaseWait: \"Please wait while we look this up...\",\r\n\t\terror: \"Error %0 occurred whilst retrieving data from server\",\r\n\t\tnoone: \"None.\"\r\n\t},\r\n\thandler: function(place, macroName, params, wikifier, paramString, tiddler) {\r\n\t\tvar locale = followersMacro.locale;\r\n\t\tvar args = paramString.parseParams(\"name\", null, true, false, true)[0];\r\n\t\tvar username = args.name ? args.name[0] : false;\r\n\t\tvar container = $('&lt;div class=\"followers\" /&gt;').text(locale.pleaseWait).\r\n\t\t\tappendTo(place)[0];\r\n\t\tvar followersCallback = function(user) {\r\n\t\t\tif(user.anon) {\r\n\t\t\t\t$(\"&lt;span /&gt;\").text(locale.loggedOut).appendTo(container);\r\n\t\t\t} else {\r\n\t\t\t\tvar options = scanMacro.getOptions(paramString);\r\n\t\t\t\t$.extend(options, {\r\n\t\t\t\t\turl: \"/search?q=title:@%0 OR title:%0 tag:%1 _limit:%2\".\r\n\t\t\t\t\t\tformat(user.name, followMacro.followTag, LIMIT_FOLLOWING),\r\n\t\t\t\t\tspaceField: \"bag\",\r\n\t\t\t\t\ttemplate: options.template ? options.template : \"FollowersTemplate\"\r\n\t\t\t\t});\r\n\t\t\t\tscanMacro.scan(container, options);\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn !username ? followersCallback({ name: currentSpace }) : followersCallback({ name: username });\r\n\t}\r\n};\r\n\r\nvar followingMacro = config.macros.following = {\r\n\tlocale: {\r\n\t\tpleaseWait: followersMacro.locale.pleaseWait,\r\n\t\tloggedOut: \"Please login to see who you are following\",\r\n\t\tnoSupport: followersMacro.locale.noSupport,\r\n\t\terror: followersMacro.locale.error,\r\n\t\tnoone: followersMacro.locale.noone\r\n\t},\r\n\thandler: function(place, macroName, params, wikifier, paramString, tiddler) {\r\n\t\tvar locale = followingMacro.locale;\r\n\t\tvar args = paramString.parseParams(\"name\", null, true, false, true)[0];\r\n\t\tvar fat = args.fat ? true : false;\r\n\t\tvar username = args.name ? args.name[0] : false;\r\n\t\tvar container = $('&lt;div class=\"following\" /&gt;').text(locale.pleaseWait).\r\n\t\t\tappendTo(place)[0];\r\n\t\tvar followingCallback = function(user) {\r\n\t\t\tif(user.anon) {\r\n\t\t\t\t$(\"&lt;span /&gt;\").text(locale.loggedOut).appendTo(container);\r\n\t\t\t} else {\r\n\t\t\t\tvar options = scanMacro.getOptions(paramString);\r\n\t\t\t\t$.extend(options, {\r\n\t\t\t\t\turl: \"/search?q=bag:%0_public tag:%1 _limit:%2\".format(user.name, followMacro.followTag, LIMIT_FOLLOWING),\r\n\t\t\t\t\tspaceField: \"title\",\r\n\t\t\t\t\ttemplate: options.template ? options.template : \"FollowingTemplate\"\r\n\t\t\t\t});\r\n\t\t\t\tscanMacro.scan(container, options);\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn !username ? followingCallback({ name: currentSpace }) : followingCallback({ name: username });\r\n\t}\r\n};\r\n\r\nvar linkedMacro = config.macros.linkedTiddlers = {\r\n\thandler: function(place, macroName, params, wikifier, paramString, tiddler) {\r\n\t\tvar args = paramString.parseParams(\"anon\")[0];\r\n\t\tvar title = params[0] || tiddler.fields[\"server.title\"] || tiddler.title;\r\n\t\tvar tid = store.getTiddler(title);\r\n\t\tvar containingTiddler = story.findContainingTiddler(place).getAttribute('tiddler');\r\n\t\tif(tid) {\r\n\t\t\tfollowMacro.makeButton(place, {\r\n\t\t\t\tspaceField: \"recipe\",\r\n\t\t\t\turl: \"/bags/%0/tiddlers/%1/backlinks\".format(tid.fields['server.bag'],\r\n\t\t\t\t\tencodeURIComponent(tid.title)),\r\n\t\t\t\tblacklisted: followMacro.getBlacklist(),\r\n\t\t\t\ttitle: title,\r\n\t\t\t\tcontainingTiddler: containingTiddler,\r\n\t\t\t\tuser: params[1] || false,\r\n\t\t\t\tconsultFollowRelationship: args.follow ? true : false });\r\n\t\t}\r\n\t}\r\n};\r\n\r\nif(config.options.chkFollowTiddlersIsLinkedTiddlers) {\r\n\tmerge(config.macros.followTiddlers, config.macros.linkedTiddlers);\r\n\tconfig.shadowTiddlers.FollowTiddlersHeading = \"These are the other tiddlers that link to this tiddler.\";\r\n}\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"SystemSettings\" server.title=\"SystemSettings\" server.page.revision=\"2556087\" server.etag=\"&quot;pearl_private/SystemSettings/2556087:245bd0c6c17f9ee05192d3ad660024235bbcbab0&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_private\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_private\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160908133956\" created=\"20160908133956\" tags=\"excludeLists\" _hash=\"1720b805c0408fb371f3e66ca349c2c80a668005\">\r\n<pre>chkPrivateMode: false</pre>\r\n</div>\r\n<div title=\"StyleSheetTiddlySpace\" server.title=\"StyleSheetTiddlySpace\" server.page.revision=\"1521919\" server.etag=\"&quot;system-theme_public/StyleSheetTiddlySpace/1521919:40586e9f57f8c267ce28cccb0e8b67fb94c83dfd&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-theme_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-theme_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch\" _hash=\"3150bd9a2cb78777f61a7b6f6539c5fa646fd7ac\">\r\n<pre>/*{{{*/\r\nbody {\r\n\tfont-size: 1em;\r\n\tfont-family: helvetica, arial, sans-serif;\r\n\tbackground-color: #fff;\r\n\tcolor: [[ColorPalette::Foreground]];\r\n}\r\n\r\nbody ul { margin: 0; }\r\n\r\n#popup {\r\n\tbackground-color: [[ColorPalette::TertiaryPale]];\r\n}\r\n\r\n#popup.confirmationPopup, .followList {\r\n\tfont-size: 0.8em;\r\n\tpadding: 1em;\r\n\tborder: solid 1px [[ColorPalette::SecondaryMid]];\r\n\tbackground-color: [[ColorPalette::SecondaryPale]];\r\n}\r\n\r\n.followList .listTitle {\r\n\ttext-decoration: underline;\r\n}\r\n\r\n#popup .followTiddlersList a {\r\n\tdisplay: inline;\r\n\tpadding: 0;\r\n}\r\n\r\n#popup li a {\r\n\tcolor: [[ColorPalette::PrimaryMid]];\r\n\tfont-weight: bold;\r\n}\r\n\r\n#popup li a:hover {\r\n\tcolor: [[ColorPalette::PrimaryPale]];\r\n\tbackground: [[ColorPalette::PrimaryMid]];\r\n}\r\n\r\n#popup li.listTitle {\r\n\tborder-bottom: 1px solid #000;\r\n\tfont-weight: bold;\r\n\tmargin-bottom: 10px;\r\n}\r\n\r\n#popup.followList {\r\n\tmargin-left: 50px;\r\n\tmargin-top: -30px;\r\n}\r\n\r\n.followTiddlersList .label {\r\n\tdisplay: block;\r\n\tleft: 10px;\r\n\ttop: 0px;\r\n\tline-height: 16px;\r\n\tposition: relative;\r\n}\r\n\r\n#popup .followTiddlersList .siteIcon{\r\n\theight: auto;\r\n}\r\n\r\n#popup .followTiddlersList li{\r\n\tclear: both;\r\n\tdisplay: block;\r\n\theight: 48px;\r\n\tmargin-bottom: 8px;\r\n\tposition: relative;\r\n}\r\n\r\n#popup .followTiddlersList a{\r\n\tdisplay: inline;\r\n}\r\n\r\n#displayArea {\r\n\tmargin: 0;\r\n\ttop: 0px;\r\n\tleft: 0px;\r\n\twidth: 100%;\r\n\tposition: relative;\r\n}\r\n\r\n.revisionCloak {\r\n\tposition: absolute;\r\n\tposition: fixed !important;\r\n\theight: 100%;\r\n\twidth: 100%;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\tborder: 0;\r\n\tmargin: 0;\r\n\tpadding: 0;\r\n\topacity: 0.5;\r\n\tfilter: alpha(opacity=50);\r\n\tbackground-color: #000;\r\n}\r\n\r\n/* *** Header *** */\r\n.header {\r\n\tposition: relative;\r\n\tbackground-color: [[ColorPalette::PrimaryMid]];\r\n\t_width: 100%; /* ie 6 demands */\r\n}\r\n\r\n.headerForeground {\r\n\tbackground-color: [[ColorPalette::PrimaryMid]];\r\n\tfloat: left;\r\n\tmargin: 24px 16px 0px 72px;\r\n\tpadding: 0;\r\n\tposition: relative;\r\n\ttop: 0;\r\n\t_width: 70%; /*ie6: needed for the background to actually be transparent*/\r\n\t_background-color: transparent; /*ie6: needed to show the search box*/\r\n}\r\n\r\n.clearFloat {\r\n\tclear: both;\r\n}\r\n\r\n#contentWrapper {\r\n\tposition: relative;\r\n\tpadding-top: 1px;\r\n\ttop: -1px;\r\n}\r\n\r\n#tiddlerDisplay {\r\n\t_position: relative; /* ie 6*/\r\n}\r\n\r\n.siteTitle {\r\n\tclear: both;\r\n\tdisplay: block;\r\n\tfont-size: 32px;\r\n\tfont-weight: bold;\r\n\tline-height: 32px;\r\n}\r\n\r\n.siteSubtitle {\r\n\tdisplay: block;\r\n\tfont-size: 14px;\r\n\theight: 16px;\r\n\tmargin-bottom: 8px;\r\n}\r\n\r\n#sidebarSearch {\r\n\tpadding: 0;\r\n\tposition: absolute;\r\n\tright: 80px;\r\n\ttop: 8px;\r\n\twidth: 176px;\r\n}\r\n\r\n#sidebarSearch .txtOptionInput {\r\n\twidth: 100%;\r\n\tmargin-top: 5px;\r\n\t_color: #bbb; /* ie6 danger */\r\n}\r\n\r\n#sidebarSearch .txtOptionInput:focus {\r\n\tcolor: #000;\r\n}\r\n\r\n#sidebarSearch .searchButton {\r\n\tdisplay: none;\r\n}\r\n\r\n/* *** Menu Bar *** */\r\n\r\n#mainMenu {\r\n\tposition: static;\r\n\ttext-align: left;\r\n\tmargin-left: 72px;\r\n\tfloat: left;\r\n\twidth: auto;\r\n\tpadding: 0;\r\n\tfont-size: 1em;\r\n\tline-height: normal;\r\n}\r\n\r\n#mainMenu a {\r\n\tcolor: #fff;\r\n\tpadding: 8px;\r\n\tfont-size: 0.9em;\r\n\tmargin-right: 16px;\r\n}\r\n\r\n#mainMenu a:hover {\r\n\tbackground-color: [[ColorPalette::PrimaryMid]];\r\n\tcolor: [[ColorPalette::Background]]\r\n}\r\n\r\n#sidebarOptions {\r\n\tmargin-right: 72px;\r\n\tfloat: right;\r\n\tfont-size: 1.1em;\r\n\tline-height: 1.6em;\r\n\tmin-height: 1em;\r\n\tpadding-top: 0;\r\n}\r\n\r\n#sidebarOptions a {\r\n\tmargin-right: 8px;\r\n}\r\n\r\n.confirmationPopup .button,\r\n#sidebarOptions .button {\r\n\tcursor: pointer;\r\n\tline-height: 1.4em;\r\n\ttext-align: center;\r\n\tmargin-right: 8px;\r\n\tmargin-left:-2px;\r\n}\r\n\r\n.confirmationPopup .button {\r\n\tfont-size: 0.9em;\r\n\tpadding: 2px;\r\n}\r\n\r\n#sidebarOptions .button {\r\n\tfont-size: 0.7em;\r\n\tfloat: left;\r\n\twidth: 80px;\r\n\tpadding: 0px;\r\n        color: #fff;\r\n}\r\n\r\n.confirmationPopup a.button,\r\n#sidebarOptions a {\r\n\tborder: none;\r\n\tmargin: 0 0.2em;\r\n\tpadding: 0.6em 0.25em;\r\n\tdisplay: inline;\r\n\tcolor: #666;\r\n}\r\n\r\n.confirmationPopup a.button:hover,\r\n#sidebarOptions a:hover {\r\n\tcolor: #000;\r\n}\r\n\r\n.confirmationPopup a.button:active,\r\n#sidebarOptions a:active {\r\n\tborder: solid 1px [[ColorPalette::PrimaryMid]];\r\n\tbackground-color: #fff;\r\n\tbackground: -webkit-gradient( linear, left bottom, left top, color-stop(0.1,rgb(200,200,200)), color-stop(1, rgb(100,100,100)));\r\n\tbackground: -moz-linear-gradient(center bottom , rgb(200,200,200) 10%,rgb(100,100,100) 100%) repeat scroll 0 0 transparent;\r\n}\r\n/* *** Sidebar *** */\r\n\r\n#sidebar .wizard table {\r\n\tmargin: 0px;\r\n}\r\n\r\n.tabContents .listTitle:first-child {\r\n\tmargin-top: 0px;\r\n}\r\n\r\n#menuBar {\r\n\tbackground: [[ColorPalette::PrimaryLight]];\r\n\tleft: 0;\r\n\tright: 0;\r\n\tposition: relative;\r\n\tmargin: 0;\r\n\tpadding: 0.5em 0 0.5em 0;\r\n\tmin-height: 1em;\r\n\toverflow: hidden;\r\n\t_width: 100%; /* for ie 6 */\r\n}\r\n\r\n#sidebarOptions a.button:hover {\r\n\tcolor: [[ColorPalette::PrimaryPale]];\r\n    background: [[ColorPalette::PrimaryMid]];\r\n}\r\n\r\n#tiddlerDisplay, #searchResults {\r\n\tmargin: 16px 448px 0 72px;\r\n}\r\n\r\n#sidebarTabs {\r\n\tposition: absolute;\r\n\tright: 72px;\r\n\twidth: 352px;\r\n\ttop: 0;\r\n}\r\n\r\n#sidebarTabs .tabsetWrapper .tabset {\r\n\twidth: 87px;\r\n\tborder-top: 1px solid [[ColorPalette::PrimaryPale]];\r\n\tborder-left: 1px solid [[ColorPalette::PrimaryPale]];\r\n\tborder-bottom: 1px solid [[ColorPalette::PrimaryPale]];\r\n\theight: auto;\r\n\tfloat: left;\r\n\tword-wrap: break-word;\r\n\ttop: 0;\r\n\tpadding: 0;\r\n}\r\n\r\n#sidebarTabs .tabsetWrapper .tabContents {\r\n\tbackground-color: [[ColorPalette::PrimaryPale]];\r\n\tborder: 3px solid [[ColorPalette::PrimaryMid]];\r\n\twidth: 242px;\r\n\t_width: 238px;\r\n\tleft: -3px;\r\n\t_left: -5px;\r\n\tposition: relative;\r\n\tmin-height: 34em;\r\n\tpadding: 8px;\r\n\tfont-size: 0.8em;\r\n}\r\n\r\n/* ---- Side style --- */\r\n\r\n#sidebarTabs .tabsetWrapper .tabset .tab {\r\n\tfont-size: 0.9em;\r\n\tpadding: 0.7em 8px 0.5em;\r\n\tcolor: #fff;\r\n\tbackground: [[ColorPalette::PrimaryLight]];\r\n\tborder: none;\r\n\tline-height: 16px;\r\n\tposition: relative;\r\n\tdisplay: block;\r\n\tmargin: 0;\r\n}\r\n\r\n#sidebarTabs .tabsetWrapper .tabset .tabSelected {\r\n\tcolor: [[ColorPalette::PrimaryMid]];\r\n\tbackground: [[ColorPalette::PrimaryPale]];\r\n\tborder-top: 3px solid [[ColorPalette::PrimaryMid]];\r\n\tborder-bottom: 3px solid [[ColorPalette::PrimaryMid]];\r\n\tborder-left: 3px solid [[ColorPalette::PrimaryMid]];\r\n\tz-index: 10;\r\n\tmargin-top: -1px;\r\n\tfont-weight: bold;\r\n}\r\n\r\n#sidebarTabs .tabContents li {\r\n\tborder: none;\r\n\tmargin-left: 0;\r\n\tword-wrap: break-word;\r\n}\r\n\r\n.tabContents .timeline {\r\n\tbackground: [[ColorPalette::PrimaryPale]];\r\n\tmargin-bottom: 8px;\r\n}\r\n\r\n#sidebarTabs .timeline li.listTitle {\r\n\tcolor: #132E43;\r\n\tmargin-left: 8px 0;\r\n\tpadding: 0.3em 0.11em;\r\n\tfont-size: 1em;\r\n\tborder-bottom: none;\r\n}\r\n\r\n#sidebarTabs .tabContents li a {\r\n\tdisplay: block;\r\n\ttext-align: left;\r\n\tmargin: 0 0 1px 0;\r\n\tpadding: 0.3em 1em;\r\n\tbackground: [[ColorPalette::PrimaryPale]];\r\n}\r\n\r\n#sidebarTabs .tabsetWrapper .tabset a:hover,\r\n#sidebarTabs .tabContents li a:hover {\r\n\tcolor: [[ColorPalette::PrimaryPale]];\r\n\tbackground: [[ColorPalette::PrimaryMid]];\r\n}\r\n\r\n/* Activity Stream */\r\n#sidebarTabs .tabContents .activityStream .feedItem a {\r\n\tdisplay: inline-block;\r\n\tpadding: 0;\r\n\tbackground: none;\r\n}\r\n\r\n/* ---- Tagging box --- */\r\n.tagInfo {\r\n\tborder: 1px solid #cccccc;\r\n\tpadding: 10px 15px;\r\n\t-moz-box-shadow: 0 2px 2px rgba(0, 0, 0, 0.2);\r\n\tbox-shadow: 0 2px 2px rgba(0,0,0,0.2);\r\n\tcolor: [[ColorPalette::TertiaryMid]];\r\n\tbackground: -moz-linear-gradient(100% 100% 90deg, #f4f4f4, #e5e5e5);\r\n\tbackground: -webkit-gradient(linear, left top, right top, from(#e5e5e5), to(#f4f4f4));\r\n\tmargin-top: 1em;\r\n\tfont-size: 13px;\r\n\tmargin: 0 0 0 56px;\r\n}\r\n\r\n.tagInfo ul {\r\n\tlist-style: none;\r\n\tpadding-left: 2.2em;\r\n}\r\n\r\n.tagInfo ul li {\r\n\tdisplay: inline;\r\n}\r\n\r\n.tagInfo ul li.listTitle,\r\n.tagInfo .tagging ul li.listTitle {\r\n\tcolor: [[ColorPalette::PrimaryMid]];\r\n\tfont-size: 13px;\r\n}\r\n\r\n.tagInfo ul li a {\r\n\tborder: none;\r\n}\r\n\r\n.tagInfo .tagging ul li {\r\n\tfloat: none;\r\n\tdisplay: inline-block;\r\n}\r\n\r\n.tagInfo .tagging {\r\n\tpadding: 0;\r\n}\r\n\r\n.viewRevision .toolbar {\r\n\tright: 48px;\r\n\ttop: 8px;\r\n}\r\n\r\n.viewRevision .modifierIcon img,\r\n.viewRevision .modifierIcon svg {\r\n\tmargin-right: 8px;\r\n}\r\n\r\n.viewRevision .toolbar svg {\r\n\twidth: 32px;\r\n\theight: 32px;\r\n}\r\n\r\n/* --- IE hacks from lattice --- */\r\n\r\n/* ie hacks */\r\n* html #menuBar {\r\n\tmargin-bottom: 8px;\r\n}\r\n.toolbar .svgIconText {\r\n\t*display: inline;\r\n}\r\n\r\ndiv.tiddler .toolbar a {\r\n\tcursor: pointer;\r\n\tfloat: left\\9;\r\n\tdisplay: inline\\9;\r\n}\r\n\r\n* html .toolbar {\r\n\tright: 8px;\r\n}\r\n* html .followButton a {\r\n\tmargin-top: 0px;\r\n\tmargin-right: 8px;\r\n}\r\n* html #tiddlerDisplay {\r\n\tmargin-top: 0px;\r\n}\r\n\r\n/* for printing purposes */\r\n@media print {\r\n\t#mainMenu,\r\n\t#sidebar,\r\n\t#messageArea,\r\n\t.toolbar,\r\n\t.followPlaceHolder,\r\n\t#backstageButton,\r\n\t#backstageArea,\r\n\t#sidebarTabs,\r\n\t#sidebarSearch .txtOptionInput,\r\n\t#sidebarOptions {\r\n\t\tdisplay: none !important;\r\n\t}\r\n\t#displayArea {\r\n\t\tmargin: 1em 1em 0em;\r\n\t}\r\n\tnoscript {\r\n\t\tdisplay:none; /* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */\r\n\t}\r\n\t#tiddlerDisplay {\r\n\t\tmargin: 16px 16px;\r\n\t}\r\n}\r\n\r\n@media all and (max-width: 960px){\r\n\t#tiddlerDisplay,\r\n\t#searchResults {\r\n\t\tmargin: 16px 366px 0 16px;\r\n\t}\r\n\r\n\t#mainMenu {\r\n\t\tmargin-left: 16px;\r\n\t}\r\n\r\n\t.headerForeground {\r\n\t\tmargin-left: 16px;\r\n\t}\r\n\r\n\t#sidebarSearch {\r\n\t\tright: 16px;\r\n\t}\r\n\r\n\t#sidebarOptions {\r\n\t\tmargin-right: 16px;\r\n\t}\r\n\r\n\t#sidebarTabs {\r\n\t\tright: 16px;\r\n\t\twidth: 326px;\r\n\t}\r\n\r\n\t#sidebarTabs .tabsetWrapper .tabset {\r\n\t\tfont-size: 0.9em;\r\n\t\twidth: 77px;\r\n\t}\r\n\r\n\t#sidebarTabs .tabsetWrapper .tabContents {\r\n\t\twidth: 226px;\r\n\t\t_width: 222px;\r\n\t}\r\n\r\n\t#sidebarTabs .tabContents li a {\r\n\t\tfont-size: 0.9em;\r\n\t}\r\n}\r\n/*}}}*/\r\n[[StyleSheetTiddler]]</pre>\r\n</div>\r\n<div title=\"ischools中两所大学的对比\" server.title=\"ischools中两所大学的对比\" server.page.revision=\"2576629\" server.etag=\"&quot;pearl_public/ischools%E4%B8%AD%E4%B8%A4%E6%89%80%E5%A4%A7%E5%AD%A6%E7%9A%84%E5%AF%B9%E6%AF%94/2576629:c60d82af397e54ceb252dbe6612fb0bb9c2dde1d&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"201610251038\" created=\"20161025102343\" tags=\"作业\" _hash=\"3d11e17253bb63569908202e4830ac583fbe2d64\">\r\n<pre>新加坡管理大学\r\n\r\n一、学校简介：新加坡管理大学(简称新大,SMU)创建于2000年1月12日，是新加坡政府投资创办的第三所公立大学，是以世界级水平研究和卓越教学著称的亚洲顶尖学府。其中信息系统学院（SIS）是一个在国际上关于信息系统技术、信息系统管理及相关技术与管理交集问题教学上获得认可的学院。它是除北美国家外第一个被ischools所认可学校，它拥有深厚的技术研究及创造能力，在教学战略上选择的领域是信息技术、系统及应用程序。\r\n二、在校人员及学院划分：新大目前学生规模为8000多名，其中本科生7000多名，分布于六个学院会计学院、李光前商学院、经济学院、信息系统学院、法律学院以及社会科学学院。\r\n三、主要研究方向：\r\n（1）本科生研究教学方向：集成业务及技术、IT体系结构、设计和开发技能、项目管理、企业信息系统的应变技能\r\n（2）硕士生研究教学方向：集成技术及对特定服务行业操作的集成技术在数据为中心的视角上为服务行业提高服务、强调在服务交付过程、数据操作、数据分析、解决方案和企业IT体系结构之间的联系、\r\n（3）博士生研究教学方向：网络完全、数据管理与分析、信息系统与管理、智能系统与决策分析、软件及Cyber-physical系统\r\n\r\n\r\n\r\n加利福利亚大学伯克利分校\r\n\r\n学校简介：加利福尼亚大学伯克利分校(University of California-Berkeley，简称UC Berkeley、Berkeley或Cal 加州大学伯克利分校，伯克利加州大学)是美国顶尖公立研究型大学，也是世界上最富盛名且最顶尖的公立大学。加州大学伯克利分校是加利福尼亚大学中最老的一所，也是美国大学协会(Association of American Universities)创始会员之一，其中加州大学伯克利分校信息学院的最新的和最小的学校。位于校园的中心,该校是一个主要致力于研究扩大获取信息,提高其可用性、可靠性和可信度同时保护安全和隐私。\r\n在校人员及学院分布：加州大学伯克利分校以传统的多学科综合为主，以新兴学科和专业学院为辅。全校共有14个学院，涵盖170个系所。\r\n主要研究教学方向：\r\n（1）信息管理和系统硕士学位研究教学方向：是一个计划为期两年的全职项目,旨在培养学生成功获取信息的专业技能。需要计算机科学、认知科学、心理学和社会学,经济学,商业,法律,图书馆及信息研究和通讯多学课综合教学。\r\n（2）信息和数据科学硕士（MIDS）研究教学方向：处理大规模数据需要独特的新技能和工具。MIDS程序具有广泛的学科广度;但其他项目仅关注高等数学和建模,MIDS程序从社会科学和政策研究提供了在统计,计算机科学和工程帮助。\r\n（3）信息管理和系统博士学位研究教学方向：旨在提供的资源,支持有想象力的学者们追求新思想,开展他们自己的研究,进化世界各地的信息。\r\n\r\n\r\n</pre>\r\n</div>\r\n<div title=\"TiddlySpaceCSRF\" server.title=\"TiddlySpaceCSRF\" server.page.revision=\"1521904\" server.etag=\"&quot;tiddlyspace/TiddlySpaceCSRF/1521904:c04c1dc41f81091cf282489220f8076939150cdf&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"10b0276ddc805a9489b6449c972bb1dc00fb9cf0\">\r\n<pre>(function() {\r\nvar getCSRFToken = function(window) {\r\n\t// XXX: should not use RegEx - cf.\r\n\t// http://www.quirksmode.org/js/cookies.html\r\n\t// https://github.com/TiddlySpace/tiddlyspace/commit/5f4adbe009ed4bda3ce39058a3fb07de1420358d\r\n\tvar regex = /^(?:.*; )?csrf_token=([^(;|$)]*)(?:;|$)/;\r\n\tvar match = regex.exec(document.cookie);\r\n\tvar csrf_token = null;\r\n\tif (match &amp;&amp; (match.length === 2)) {\r\n\t\tcsrf_token = match[1];\r\n\t}\r\n\r\n\treturn csrf_token;\r\n};\r\n\r\nif (typeof config !== 'undefined' &amp;&amp; config.extensions &amp;&amp;\r\n\t\tconfig.extensions.tiddlyspace &amp;&amp;\r\n\t\tconfig.extensions.tiddlyspace.getCSRFToken === null) {\r\n\tconfig.extensions.tiddlyspace.getCSRFToken = getCSRFToken;\r\n} else {\r\n\twindow.getCSRFToken = getCSRFToken;\r\n}\r\n})(window);</pre>\r\n</div>\r\n<div title=\"moreCommand\" server.title=\"moreCommand\" server.page.revision=\"1521923\" server.etag=\"&quot;system-images_public/moreCommand/1521923:e065e77e528ce86766148ce5813e763c8f284106&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-images_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-images_public\" server.permissions=\"read\" server.content-type=\"image/svg+xml\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch\" _hash=\"83f02e8680765ba08fd5764a7627f51cdd4b7f0d\">\r\n<pre>&lt;svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xl=\"http://www.w3.org/1999/xlink\" version=\"1.1\" viewBox=\"434 218 68 68\"\r\nwidth=\"30\" height=\"30\"&gt;\r\n&lt;g stroke=\"none\" stroke-opacity=\"1\" stroke-dasharray=\"none\" fill=\"none\" fill-opacity=\"1\"&gt;\r\n\t&lt;g&gt;\r\n\t\t&lt;path d=\"M 478.39694 232.53705 L 478.39694 232.53705 \r\n\t\tC 477.1145 231.85132 475.77875 231.30147 474.41058 230.88734 L 474.41058 218.24994 L 461.58942 218.24994 \r\n\t\tL 461.58942 230.88734 C 460.22125 231.30147 458.8855 231.85132 457.60306 232.53705 L 448.66824 223.60214 \r\n\t\tL 439.6022 232.66814 L 448.53717 241.60304 C 447.8515 242.8854 447.30157 244.22116 446.88745 245.58936 \r\n\t\tL 434.25 245.58936 L 434.25 258.41052 L 446.88745 258.41052 \r\n\t\tC 447.30157 259.77869 447.8515 261.11447 448.53717 262.39688 L 439.6022 271.33173 L 448.66824 280.3978 \r\n\t\tL 457.60306 271.46283 C 458.8855 272.14862 460.22125 272.69846 461.58942 273.11252 L 461.58942 285.74988 \r\n\t\tL 474.41058 285.74988 L 474.41058 273.11252 C 475.77875 272.69846 477.1145 272.14862 478.39694 271.46283 \r\n\t\tL 487.33176 280.3978 L 496.39767 271.33173 L 487.46286 262.39688 \r\n\t\tC 488.14853 261.11447 488.69836 259.77869 489.11255 258.41052 L 501.74988 258.41052 L 501.74988 245.58936 \r\n\t\tL 489.11255 245.58936 C 488.69836 244.22116 488.14853 242.8854 487.46286 241.60304 L 496.39767 232.66814 \r\n\t\tL 487.33176 223.60214 Z M 475.3328 244.66714 C 479.3825 248.71698 479.3825 255.2829 475.3328 259.33273 \r\n\t\tC 471.28296 263.3826 464.71704 263.3826 460.66724 259.33273 \r\n\t\tC 456.61737 255.2829 456.61737 248.71698 460.66724 244.66714 \r\n\t\tC 464.71704 240.61734 471.28296 240.61734 475.3328 244.66714\" fill=\"#111\"\r\n\t\tclass=\"glyph\"/&gt;\r\n\t&lt;/g&gt;\r\n&lt;/g&gt;\r\n&lt;/svg&gt;</pre>\r\n</div>\r\n<div title=\"个人翻译部分\" server.title=\"个人翻译部分\" server.page.revision=\"2564771\" server.etag=\"&quot;pearl_public/%E4%B8%AA%E4%BA%BA%E7%BF%BB%E8%AF%91%E9%83%A8%E5%88%86/2564771:e5b19d22f0d0be4741baf06920b0e1eb3ed16887&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160925045324\" created=\"20160921042136\" tags=\"作业\" _hash=\"3c17e3138e42ebf5c88a8f7c113b66b7ac2968eb\">\r\n<pre>关于信息污染的定义是稀少的，因此它是值得去探寻一些相关的概念，第一个被讨论的相关概念是信息质量，由于信息系统的传播和万维网的普及，在最近几年的关注中，信息质量取得了一些研究。低质量的信息被认为是信息污染，因为它将不能被使用并且被认为是没有必要的。信息质量被普遍地定义是使用信息的适用度（Bizer&amp;Cyganiak,2009）。因此，这也意味着信息质量是取决于任务本身，并且信息质量是客观的。取决于任务本身这一解释是被Arary&amp;Kopak支持的，他们说明质量的价值判断是取决于一个特定的目标和应用，其他重要的信息质量因素可能被看做是一些多方面的思考，一些可使用的特定属性的定义在信息质量研究中被发现。Tayloy定义了五种信息属性：精确度，综合性，流通性，可靠性和有效性。在近几年一系列属性的不同在信息质量架构中广泛地被接受并且定义了一份包含20种信息质量属性的丰富的表单。Davis&amp;Olson记录了在做决策的认知方面的信息质量有重要的三个因素：信息的多用性，信息确定性，信息的错误和偏见。从它提供了关于信息本身的因素和使用者的认知后，它确实成为一种很有用的理论。\r\n目录：项目管理ERD数据模型应用MS-VISIO OKM\r\n表格：数据表格成分和有关联的</pre>\r\n</div>\r\n<div title=\"ColorPalette [draft]\" server.title=\"ColorPalette [draft]\" server.page.revision=\"2564768\" server.etag=\"&quot;pearl_private/ColorPalette%20%5Bdraft%5D/2564768:d8d1b6ffd900ac12fc7ce7c18bd04fcc7484cd09&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_private\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_private\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160925045214\" created=\"20160914133502\" tags=\"excludeLists excludeSearch\" publish.name=\"ColorPalette\" _hash=\"2d8aaaf639bf27f41419692fdbcb8a43f9d78e72\">\r\n<pre>/*{{{*/\r\nBackground: #e0dcf8\r\nForeground: #090622\r\nPrimaryPale: #fbfafe\r\nPrimaryLight: #c9c4ed\r\nPrimaryMid: #5548b6\r\nPrimaryDark: #4b4a53\r\nSecondaryPale: #fdfefa\r\nSecondaryLight: #e1edc4\r\nSecondaryMid: #97b648\r\nSecondaryDark: #51534a\r\nTertiaryPale: #fefdfa\r\nTertiaryLight: #edeac4\r\nTertiaryMid: #b6b048\r\nTertiaryDark: #53534a\r\nError: #f88\r\nColorPaletteParameters: HSL([247|10], [0.67|0.53|0.43|0.06],[0.31|0.5|0.85|0.99])\r\n/*}}}*/</pre>\r\n</div>\r\n<div title=\"小组作业\" server.title=\"小组作业\" server.page.revision=\"2564773\" server.etag=\"&quot;pearl_public/%E5%B0%8F%E7%BB%84%E4%BD%9C%E4%B8%9A/2564773:d7a8977bebb16cdc87a6f60ffc9bcbd0e3b69b66&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160925045357\" created=\"20160921041906\" tags=\"作业\" _hash=\"d697cb24fe29f516524af25af887d31c8b747d4b\">\r\n<pre>                                                              对信息垃圾的理解\r\n因为信息垃圾是（信息）属性领域里的一种新发现，存在定义缺乏。对信息垃圾的观念将会被解构（通过）一种工具来理解这个话题。第一种成分被定义为信息。Himma在 2007年给了一种哲学上的解释。看得见得信息遵循着：信息，我们通常用这个称呼，它和“收集数据”这个动作有关联或者是这个处于已经被收集了这种状态下的数据，和因此采出来的一种正确的命题内容。例如：内容的价值是真或者假。(Floridi 在2005年)广义上来说，对信息的简单定义是“有用的数据”或者“有用的回答”。（Hornsby在2003年）“垃圾”在另一种方面，本质有在英语上有两个解释：1、那些被用完就丢走的不想要的事情或者其他任何材料。2、那些你只需要取其其中小数量价值的。（F Wijnhoven et al. 2012)“信息垃圾”因此被人们定义为不需要或者是没有价值的数据，是通过判断这个数据能否被我们拿到然后利用。第二种观点来自 Hicks(2007),描述信息垃圾作为一种补充的行为和增加的任何不作为的（数据），因为信息使用者不会立即提供通道（给你）机会，精确（数据），下载信息。\r\n关于信息污染的定义是稀少的，因此它是值得去探寻一些相关的概念，第一个被讨论的相关概念是信息质量，由于信息系统的传播和万维网的普及，在最近几年的关注中，信息质量取得了一些研究。低质量的信息被认为是信息污染，因为它将不能被使用并且被认为是没有必要的。信息质量被普遍地定义是使用信息的适用度（Bizer&amp;Cyganiak,2009）。因此，这也意味着信息质量是取决于任务本身，并且信息质量是客观的。取决于任务本身这一解释是被Arary&amp;Kopak支持的，他们说明质量的价值判断是取决于一个特定的目标和应用，其他重要的信息质量因素可能被看做是一些多方面的思考，一些可使用的特定属性的定义在信息质量研究中被发现。Tayloy定义了五种信息属性：精确度，综合性，流通性，可靠性和有效性。在近几年一系列属性的不同在信息质量架构中广泛地被接受并且定义了一份包含20种信息质量属性的丰富的表单。Davis&amp;Olson记录了在做决策的认知方面的信息质量有重要的三个因素：信息的多用性，信息确定性，信息的错误和偏见。从它提供了关于信息本身的因素和使用者的认知后，它确实成为一种很有用的理论。\r\n在英特网上一种极为普遍的信息浪费形式是众所周知的垃圾网页，Araujo和Martinez-Romo所陈述的“网页垃圾或垃圾索引，包括所有的技术使用有目的的去得到一个不正当的高等级。”正如一个巨大的正在持续增加的这部分交通对于网页位置来源于搜索引擎方式。得到一个高等级是很重要的通过他们的目标受众去发现网页位置。也有许多符合伦理道德的方式去助推一个网页的等级，通过提高整个内容的外观，也可以更加容易制作为网络爬虫检索内容。此外，制作这个网页对潜在的参观者是有利的，也能够提高一个网页的搜索引擎排名。不幸的是工艺页面对于这个基本用途的增加，搜索引擎的等级并没有提高这个页面的效用，这已经成了普遍的训练。最普遍的网页垃圾技术包括人工生成的内容或者关键字以及覆盖、重定向垃圾邮件和链接农场。网页垃圾严重的污染了搜索引擎，使得相关结果减少，对于所有者和搜索引擎使用者的位置是一个关键的问题，因为错误的和无意义的网页获得了高网页排名。\r\n</pre>\r\n</div>\r\n<div title=\"SideBarOptions\" server.title=\"SideBarOptions\" server.page.revision=\"1521921\" server.etag=\"&quot;system-theme_public/SideBarOptions/1521921:366018660ccece8f731865cbe66ac1d3e9dd9168&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-theme_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-theme_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch\" _hash=\"6516f71685d10be266a599f46d8dcf1c658225d0\">\r\n<pre>&lt;&lt;closeAll&gt;&gt;&lt;&lt;permaview&gt;&gt;&lt;&lt;newTiddler&gt;&gt;</pre>\r\n</div>\r\n<div title=\"shadowIcon\" server.title=\"shadowIcon\" server.page.revision=\"1521926\" server.etag=\"&quot;system-images_public/shadowIcon/1521926:b353c94efdc04eaabe30584a9e78a9d6ce6a9ea5&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-images_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-images_public\" server.permissions=\"read\" server.content-type=\"image/png\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch\" _hash=\"754f7258625a19c375dcae5254d6a604c7686d8d\">\r\n<pre>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</pre>\r\n</div>\r\n<div title=\"ViewTemplate\" server.title=\"ViewTemplate\" server.page.revision=\"1521912\" server.etag=\"&quot;system-theme_public/ViewTemplate/1521912:278d821b2815647f0234b3b834519ef797cba935&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-theme_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-theme_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch\" _hash=\"77bbe9ac7998547867eb4ef4aca07906fa2323e8\">\r\n<pre>&lt;!--{{{--&gt;\r\n&lt;div class='toolbar'\r\n\tmacro='toolbar [[ToolbarCommands::ViewToolbar]] icons:yes height:16 width:16 more:popup'&gt;\r\n&lt;/div&gt;\r\n&lt;div class='heading'&gt;\r\n\t&lt;span class='spaceSiteIcon'\r\n\t\tmacro='tiddlerOrigin label:no spaceLink:yes height:48 width:48 preserveAspectRatio:yes'&gt;\r\n\t&lt;/span&gt;\r\n\t&lt;span class=\"titleBar\"&gt;\r\n\t\t&lt;div class='title' macro='view title text'&gt;&lt;/div&gt;\r\n\t\t&lt;span class=\"subtitle\" macro='viewRevisions page:5'&gt;\r\n\t\t\tlast modified on\r\n\t\t\t&lt;span macro=\"view modified date\"&gt;&lt;/span&gt;\r\n\t\t&lt;/span&gt;\r\n\t\t&lt;div macro=\"view title replyLink\"&gt;&lt;/div&gt;\r\n\t&lt;/span&gt;\r\n\t&lt;span class='followPlaceHolder' macro='followTiddlers'&gt;&lt;/span&gt;\r\n\t&lt;span class='modifierIcon'\r\n\t\tmacro='view modifier SiteIcon label:no spaceLink:yes height:48 width:48 preserveAspectRatio:yes'&gt;\r\n\t&lt;/span&gt;\r\n\t&lt;div class='tagClear'&gt;&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;div class='content'&gt;\r\n\t&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;div class='tagInfo'&gt;\r\n\t&lt;div class='tidTags' macro='tags'&gt;&lt;/div&gt;\r\n\t&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;!--}}}--&gt;</pre>\r\n</div>\r\n<div title=\"作业\" server.title=\"作业\" server.page.revision=\"2576630\" server.etag=\"&quot;pearl_public/%E4%BD%9C%E4%B8%9A/2576630:aa505ee9b7732ec4919b42a1ff07481c086b775f&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20161025103516\" created=\"20160925044840\" tags=\"\" _hash=\"fa9f0c3de40cdbf659cdee1ffe895535999cf2f0\">\r\n<pre>作业\r\n&lt;html&gt;\r\n&lt;head&gt;\r\n      &lt;title&gt;第一个HTML代码&lt;/title&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n&lt;div align=\"center\"&gt;\r\n&lt;img src=\"http://img.taopic.com/uploads/allimg/130929/235042-13092ZJ11945.jpg\" hight=\"500\" width=\"500\" &gt;&lt;br/&gt;\r\n&lt;/div&gt;\r\n&lt;hr width=\"800\" color=\"pink\" size\"10\"/&gt;\r\n\r\n&lt;/body&gt;\r\n&lt;/html&gt;</pre>\r\n</div>\r\n<div title=\"MainMenu\" server.title=\"MainMenu\" server.page.revision=\"2564778\" server.etag=\"&quot;pearl_public/MainMenu/2564778:608f039110b4b499fc7246a856002df8264312eb&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160925045709\" created=\"20160925033248\" tags=\"\" _hash=\"3328b13dfcab642d186dbaae9ab082cca800ece6\">\r\n<pre>[[首页]] [[图片]] [[文件]] [[作业]] [[日志]]</pre>\r\n</div>\r\n<div title=\"editTiddler\" server.title=\"editTiddler\" server.page.revision=\"1521932\" server.etag=\"&quot;system-images_public/editTiddler/1521932:6c7b7f5c313534bb1b8ca462a3eb7dc9a258a8fa&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-images_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-images_public\" server.permissions=\"read\" server.content-type=\"image/svg+xml\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch\" _hash=\"3083cb53eb17cc9c4f3863af070aac156272cef1\">\r\n<pre>&lt;svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xl=\"http://www.w3.org/1999/xlink\" version=\"1.1\" viewBox=\"301 225 48 52\"\r\nwidth=\"30\" height=\"30\"&gt;\r\n&lt;g stroke=\"none\" stroke-opacity=\"1\" stroke-dasharray=\"none\" fill=\"none\" fill-opacity=\"1\"&gt;\r\n\t&lt;g&gt;\r\n\t\t&lt;path d=\"M 333.00003 234 L 306 258.75003 L 301.5 270 L 312.75 265.50003 L 339.75 240.74998 Z M 337.5 229.50002 \r\n\t\tL 335.24988 231.75008 L 341.99997 238.50003 L 344.24997 236.24995 Z M 342 225.00003 L 339.74988 227.25009 \r\n\t\tL 346.5 234.00005 L 348.75 231.75003 Z M 301.5 273.9719 C 301.5 273.9719 309.59888 277.99927 317.70013 273.97183 \r\n\t\tC 325.80066 269.94437 341.99997 276.65686 341.99997 276.65686 L 341.99997 273.97195 \r\n\t\tC 341.99997 273.97195 325.80014 267.2594 317.70013 271.28687 C 309.6 275.31451 301.5 271.28683 301.5 271.28683 Z\" \r\n\t\tfill=\"#101010\" class=\"glyph\"/&gt;\r\n\t&lt;/g&gt;\r\n&lt;/g&gt;\r\n&lt;/svg&gt;</pre>\r\n</div>\r\n<div title=\"chrjs\" server.title=\"chrjs\" server.page.revision=\"1521886\" server.etag=\"&quot;tiddlyspace/chrjs/1521886:9004c7c608f990a08b80de5bc2743a1317ca1973&quot;\" modifier=\"None\" creator=\"None\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch systemConfig\" _cache-max-age=\"43200\" _hash=\"21f8cd31fb5331db45ab9f2cfbaeb97c6cdf38a9\">\r\n<pre>/***\r\nhttps://raw.github.com/tiddlyweb/chrjs/master/main.js\r\n***/\r\n//{{{\r\n// TiddlyWeb adaptor\r\n// v0.14.3\r\n\r\n/*jslint vars: true, unparam: true, nomen: true, white: true */\r\n/*global jQuery */\r\n\r\nvar tiddlyweb = (function($) {\r\n\r\n\"use strict\";\r\n\r\nvar tw = {\r\n\troutes: {\r\n\t\t// host is the TiddlyWeb instance's URI (including server_prefix)\r\n\t\t// placeholders \"_type\" &amp; \"name\" refer to the respective bag/recipe\r\n\t\troot     : \"{host}/\",\r\n\t\tbags     : \"{host}/bags\",\r\n\t\tbag      : \"{host}/bags/{name}\",\r\n\t\trecipes  : \"{host}/recipes\",\r\n\t\trecipe   : \"{host}/recipes/{name}\",\r\n\t\ttiddlers : \"{host}/{_type}s/{name}/tiddlers\",\r\n\t\ttiddler  : \"{host}/{_type}s/{name}/tiddlers/{title}\",\r\n\t\trevisions: \"{host}/{_type}s/{name}/tiddlers/{title}/revisions\",\r\n\t\trevision : \"{host}/{_type}s/{name}/tiddlers/{title}/revisions/{revision}\",\r\n\t\tsearch   : \"{host}/search?q={query}\"\r\n\t}\r\n};\r\n\r\nvar convertTimestamp, supplant;\r\n\r\n// host (optional) is the URI of the originating TiddlyWeb instance\r\ntw.Resource = function(type, host) {\r\n\tif(arguments.length) { // initialization\r\n\t\tthis._type = type;\r\n\t\tif(host !== false) {\r\n\t\t\tthis.host = host !== undefined ? host.replace(/\\/$/, \"\") : null;\r\n\t\t}\r\n\t}\r\n};\r\n$.extend(tw.Resource.prototype, {\r\n\t// retrieves resource from server\r\n\t// callback is passed resource, status, XHR (cf. jQuery.ajax success)\r\n\t// errback is passed XHR, error, exception, resource (cf. jQuery.ajax error)\r\n\t// filters is an optional filter string (e.g. \"select=tag:foo;limit=5\")\r\n\tget: function(callback, errback, filters) {\r\n\t\tvar uri = this.route();\r\n\t\tif(filters) {\r\n\t\t\tvar separator = uri.indexOf(\"?\") === -1 ? \"?\" : \";\";\r\n\t\t\turi += separator + filters;\r\n\t\t}\r\n\t\tvar self = this;\r\n\t\treturn $.ajax({\r\n\t\t\turl: uri,\r\n\t\t\ttype: \"GET\",\r\n\t\t\tdataType: \"json\",\r\n\t\t\tsuccess: function(data, status, xhr) {\r\n\t\t\t\tvar resource = self.parse(data);\r\n\t\t\t\tresource.etag = xhr.getResponseHeader(\"Etag\");\r\n\t\t\t\tcallback(resource, status, xhr);\r\n\t\t\t},\r\n\t\t\terror: function(xhr, error, exc) {\r\n\t\t\t\terrback(xhr, error, exc, self);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t// sends resource to server\r\n\t// callback is passed data, status, XHR (cf. jQuery.ajax success)\r\n\t// errback is passed XHR, error, exception, resource (cf. jQuery.ajax error)\r\n\tput: function(callback, errback) {\r\n\t\tvar self = this;\r\n\t\tvar options = {\r\n\t\t\turl: this.route(),\r\n\t\t\ttype: \"PUT\",\r\n\t\t\tcontentType: \"application/json\",\r\n\t\t\tdata: JSON.stringify(this.baseData()),\r\n\t\t\tsuccess: function(data, status, xhr) {\r\n\t\t\t\tcallback(self, status, xhr);\r\n\t\t\t},\r\n\t\t\terror: function(xhr, error, exc) {\r\n\t\t\t\terrback(xhr, error, exc, self);\r\n\t\t\t}\r\n\t\t};\r\n\t\tif(this.ajaxSetup) {\r\n\t\t\tthis.ajaxSetup(options);\r\n\t\t}\r\n\t\treturn $.ajax(options);\r\n\t},\r\n\t// deletes resource on server\r\n\t// callback is passed data, status, XHR (cf. jQuery.ajax success)\r\n\t// errback is passed XHR, error, exception, resource (cf. jQuery.ajax error)\r\n\t\"delete\": function(callback, errback) {\r\n\t\tvar self = this;\r\n\t\tvar options = {\r\n\t\t\turl: this.route(),\r\n\t\t\ttype: \"DELETE\",\r\n\t\t\tsuccess: function(data, status, xhr) {\r\n\t\t\t\tcallback(self, status, xhr);\r\n\t\t\t},\r\n\t\t\terror: function(xhr, error, exc) {\r\n\t\t\t\terrback(xhr, error, exc, self);\r\n\t\t\t}\r\n\t\t};\r\n\t\tif(this.ajaxSetup) {\r\n\t\t\tthis.ajaxSetup(options);\r\n\t\t}\r\n\t\treturn $.ajax(options);\r\n\t},\r\n\t// returns an object carrying only the essential information of the resource\r\n\tbaseData: function() {\r\n\t\tvar data = {},\r\n\t\t\tself = this;\r\n\t\t$.each(this.data, function(i, item) {\r\n\t\t\tvar value = self[item];\r\n\t\t\tif(value !== undefined) {\r\n\t\t\t\tdata[item] = value;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn data;\r\n\t},\r\n\t// returns corresponding instance from a raw object (if applicable)\r\n\tparse: function(data) {\r\n\t\treturn data;\r\n\t},\r\n\t// list of accepted keys in serialization\r\n\tdata: [],\r\n\t// returns resource's URI\r\n\troute: function() {\r\n\t\treturn supplant(tw.routes[this._type], this);\r\n\t}\r\n});\r\n\r\nvar Container = function(type, name, host) {\r\n\tif(arguments.length) { // initialization\r\n\t\ttw.Resource.apply(this, [type, host]);\r\n\t\tthis.name = name;\r\n\t\tthis.desc = \"\";\r\n\t\tthis.policy = new tw.Policy({});\r\n\t}\r\n};\r\nContainer.prototype = new tw.Resource();\r\n$.extend(Container.prototype, {\r\n\ttiddlers: function() {\r\n\t\treturn new tw.TiddlerCollection(this);\r\n\t},\r\n\tparse: function(data) {\r\n\t\tvar type = tw._capitalize(this._type),\r\n\t\t\tcontainer = new tw[type](this.name, this.host);\r\n\t\tdata.policy = new tw.Policy(data.policy);\r\n\t\treturn $.extend(container, data);\r\n\t},\r\n\tdata: [\"desc\", \"policy\"]\r\n});\r\n\r\n// attribs is an object whose members are merged into the instance (e.g. query)\r\ntw.Collection = function(type, host, attribs) {\r\n\tif(arguments.length) { // initialization\r\n\t\ttw.Resource.apply(this, [type, host]);\r\n\t\t$.extend(this, attribs);\r\n\t}\r\n};\r\ntw.Collection.prototype = new tw.Resource();\r\n\r\ntw.TiddlerCollection = function(container, tiddler) {\r\n\tif(arguments.length) { // initialization\r\n\t\ttw.Collection.apply(this, [tiddler ? \"revisions\" : \"tiddlers\"]);\r\n\t\tthis.container = container || null;\r\n\t\tthis.tiddler = tiddler || null;\r\n\t}\r\n};\r\ntw.TiddlerCollection.prototype = new tw.Collection();\r\n$.extend(tw.TiddlerCollection.prototype, {\r\n\tparse: function(data) {\r\n\t\tvar container = this.container;\r\n\t\treturn $.map(data, function(item, i) {\r\n\t\t\tvar tiddler = new tw.Tiddler(item.title, container),\r\n\t\t\t\tbag = item.bag;\r\n\t\t\ttiddler = tw.Tiddler.prototype.parse.apply(tiddler, [item]);\r\n\t\t\tif(!tiddler.bag &amp;&amp; bag) { // XXX: bag always present!?\r\n\t\t\t\ttiddler.bag = new tw.Bag(bag, container.host);\r\n\t\t\t}\r\n\t\t\tif(!tiddler.recipe &amp;&amp; item.recipe) {\r\n\t\t\t\ttiddler.recipe = new tw.Recipe(item.recipe, container.host);\r\n\t\t\t}\r\n\t\t\tdelete item.recipe;\r\n\t\t\treturn $.extend(tiddler, item);\r\n\t\t});\r\n\t},\r\n\troute: function() {\r\n\t\tvar params = this.container;\r\n\t\tif(this.tiddler) {\r\n\t\t\tvar container = this.tiddler.bag || this.tiddler.recipe;\r\n\t\t\tparams = {\r\n\t\t\t\t_type: container._type,\r\n\t\t\t\thost: container.host,\r\n\t\t\t\tname: container.name,\r\n\t\t\t\ttitle: this.tiddler.title\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn supplant(tw.routes[this._type], params);\r\n\t}\r\n});\r\n\r\ntw.Search = function(query, host) {\r\n\ttw.Collection.apply(this, [\"search\", host]);\r\n\tthis.query = query;\r\n};\r\ntw.Search.prototype = new tw.Collection();\r\n$.extend(tw.Search.prototype, {\r\n\tparse: function(data) {\r\n\t\tthis.container = { // XXX: hacky\r\n\t\t\t_type: \"bag\",\r\n\t\t\thost: this.host\r\n\t\t};\r\n\t\tvar tiddlers = tw.TiddlerCollection.prototype.parse.apply(this, arguments);\r\n\t\tdelete this.container;\r\n\t\treturn tiddlers;\r\n\t}\r\n});\r\n\r\n// title is the name of the tiddler\r\n// container (optional) is an instance of either Bag or Recipe\r\n// optionally accepts a single object representing tiddler attributes\r\ntw.Tiddler = function(title, container) {\r\n\ttw.Resource.apply(this, [\"tiddler\", false]);\r\n\tthis.title = title;\r\n\tthis.bag = container &amp;&amp; container._type === \"bag\" ? container : null;\r\n\tthis.recipe = container &amp;&amp; container._type === \"recipe\" ? container : null;\r\n\tvar self = this;\r\n\t$.each(this.data, function(i, item) {\r\n\t\tself[item] = undefined; // exposes list of standard attributes for inspectability\r\n\t});\r\n\tif(title &amp;&amp; title.title) { // title is an object of tiddler attributes\r\n\t\t$.extend(this, title);\r\n\t}\r\n};\r\ntw.Tiddler.prototype = new tw.Resource();\r\n$.extend(tw.Tiddler.prototype, {\r\n\trevisions: function() {\r\n\t\treturn new tw.TiddlerCollection(this.bag || this.recipe, this);\r\n\t},\r\n\troute: function() {\r\n\t\tvar container = this.bag || this.recipe;\r\n\t\tvar params = $.extend({}, this, {\r\n\t\t\thost: container ? container.host : null,\r\n\t\t\t_type: this.bag ? \"bag\" : (this.recipe ? \"recipe\" : null),\r\n\t\t\tname: container ? container.name : null\r\n\t\t});\r\n\t\treturn supplant(tw.routes[this._type], params);\r\n\t},\r\n\tparse: function(data) {\r\n\t\tvar tiddler = new tw.Tiddler(this.title),\r\n\t\t\tcontainer = this.bag || this.recipe;\r\n\t\tif(data.bag) {\r\n\t\t\ttiddler.bag = new tw.Bag(data.bag, container.host);\r\n\t\t\tdelete data.bag;\r\n\t\t}\r\n\t\tdelete data.recipe;\r\n\t\ttiddler.created = data.created ? convertTimestamp(data.created) : new Date();\r\n\t\tdelete data.created;\r\n\t\ttiddler.modified = data.modified ? convertTimestamp(data.modified) : new Date();\r\n\t\tdelete data.modified;\r\n\t\tif(this.recipe) {\r\n\t\t\ttiddler.recipe = this.recipe;\r\n\t\t}\r\n\t\treturn $.extend(tiddler, data);\r\n\t},\r\n\tdata: [\"created\", \"creator\", \"modifier\", \"modified\", \"tags\", \"type\", \"text\",\r\n\t\t\t\"fields\"],\r\n\tajaxSetup: function(options) {\r\n\t\tvar self = this;\r\n\t\tif(this.etag &amp;&amp; (options.type === \"PUT\" || options.type === \"DELETE\")) {\r\n\t\t\toptions.beforeSend = function(xhr) {\r\n\t\t\t\txhr.setRequestHeader(\"If-Match\", self.etag);\r\n\t\t\t};\r\n\t\t}\r\n\t\tif(options.type === \"PUT\") {\r\n\t\t\tvar callback = options.success;\r\n\t\t\toptions.success = function(data, status, xhr) {\r\n\t\t\t\tvar loc = xhr.getResponseHeader(\"Location\"),\r\n\t\t\t\t\tetag = xhr.getResponseHeader(\"Etag\");\r\n\t\t\t\tif(loc &amp;&amp; etag) {\r\n\t\t\t\t\tself.etag = etag;\r\n\t\t\t\t\tif(!self.bag) {\r\n\t\t\t\t\t\tvar bag = loc.split(\"/bags/\").pop().split(\"/\")[0];\r\n\t\t\t\t\t\tself.bag = new tw.Bag(bag, self.recipe.host);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcallback(self, status, xhr);\r\n\t\t\t\t} else { // IE\r\n\t\t\t\t\tself.get(callback, options.error);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n});\r\n\r\ntw.Revision = function(id, tiddler) {\r\n\tvar container = tiddler.bag || tiddler.recipe;\r\n\ttw.Tiddler.apply(this, [tiddler.title, container]);\r\n\tthis._type = \"revision\";\r\n\tthis.revision = id;\r\n};\r\ntw.Revision.prototype = new tw.Tiddler();\r\n$.extend(tw.Revision.prototype, {\r\n\trevisions: false,\r\n\tdata: false,\r\n\tput: false,\r\n\t\"delete\": false\r\n});\r\n\r\ntw.Bag = function(name, host) {\r\n\tContainer.apply(this, [\"bag\", name, host]);\r\n};\r\ntw.Bag.prototype = new Container();\r\n\r\ntw.Recipe = function(name, host) {\r\n\tContainer.apply(this, [\"recipe\", name, host]);\r\n\tthis.recipe = [];\r\n};\r\ntw.Recipe.prototype = new Container();\r\n$.extend(tw.Recipe.prototype, {\r\n\tdata: [\"recipe\"].concat(Container.prototype.data)\r\n});\r\n\r\ntw.Policy = function(constraints) { // TODO: validation?\r\n\tvar self = this;\r\n\t$.each(this.constraints, function(i, item) {\r\n\t\tself[item] = constraints[item];\r\n\t});\r\n};\r\ntw.Policy.prototype.constraints = [\"read\", \"write\", \"create\", \"delete\",\r\n\t\"manage\", \"accept\", \"owner\"];\r\n\r\n/*\r\n * utilities\r\n */\r\n\r\ntw._capitalize = function(str) {\r\n\treturn str.charAt(0).toUpperCase() + str.slice(1);\r\n};\r\n\r\n// convert YYYYMMDDhhmmss timestamp to Date instance\r\nconvertTimestamp = function(t) {\r\n\tif (t.match(/^\\d{12,17}$/)) {\r\n\t\treturn new Date(Date.UTC(\r\n\t\t\tparseInt(t.substr(0, 4), 10),\r\n\t\t\tparseInt(t.substr(4, 2), 10) - 1,\r\n\t\t\tparseInt(t.substr(6, 2), 10),\r\n\t\t\tparseInt(t.substr(8, 2), 10),\r\n\t\t\tparseInt(t.substr(10, 2), 10),\r\n\t\t\tparseInt(t.substr(12, 2) || \"0\", 10),\r\n\t\t\tparseInt(t.substr(14, 3) || \"0\", 10)\r\n\t\t));\r\n\t} else {\r\n\t\treturn new Date(Date.parse(t));\r\n\t}\r\n};\r\n\r\n// adapted from Crockford (http://javascript.crockford.com/remedial.html)\r\nsupplant = function(str, obj) {\r\n\treturn str.replace(/{([^{}]*)}/g, function (a, b) {\r\n\t\tvar r = obj[b];\r\n\t\tr = typeof r === \"string\" || typeof r === \"number\" ? r : a;\r\n\t\treturn $.inArray(b, [\"host\", \"query\"]) !== -1 ? r : encodeURIComponent(r); // XXX: special-casing\r\n\t});\r\n};\r\n\r\nreturn tw;\r\n\r\n}(jQuery));\r\n//}}}</pre>\r\n</div>\r\n<div title=\"favicon.ico\" server.title=\"favicon.ico\" server.page.revision=\"1521895\" server.etag=\"&quot;tiddlyspace/favicon.ico/1521895:e9c299ab974a93d6869a0b8872bd115ce2c9e35f&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"image/x-icon\" modified=\"20131111192334\" created=\"20131111192334\" tags=\"excludeLists excludeSearch\" _hash=\"d884f6069c2350d026d57c45dc100c1390bd6112\">\r\n<pre>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AP8zZgAAAGYA//8zAADMMwD/mTMAAGYzAP8zMwAAADMAzP8AAADMAADMmQAAAGYAAMwzAAAAAADuzAAA3QAAALvMAACqAAAAiMwAAHcAAABVmQAARAAAACKZAAARAADuAJkA3QAAALsAmQCqAAAAiACZAHcAAABVAJkARAAAACIAZgARAADuAABm3QAAALsAAGaqAAAAiAAAZncAAABVAABmRAAAACIAAGYRAAAA7u7uM93d3QC7u7szqqqqAIiIiDN3d3cAVVVVM0RERAAiIiIzERERAAAAADMBAQEBAQEBAQEBpXl5eXl5eXl5eXmlAQEBAQEBAQEBAQEBAQEBAQEBgHl5eXl5eXl5eXl5eXl5gAEBAQEBAQEBAQEBAQEB/Xp5eXlVT04qKioqTk9VeXl5ev0BAQEBAQEBAQEBAaV5eXlPKioqKioqKioqKioqT3l5eaUBAQEBAQEBAQGAeXlVTioqKioqKioqKioqKioqTlV5eYABAQEBAQEBgHl5VSoqKioqKioqKioqKioqKioqKlV5eYABAQEBAaV5eVUqKioqKioqKioqKioqKioqKioqKlV5eaUBAQEBeXlVKioqKioqKioqKioqKioqKioqKioqKlV5eQEBAXl5eU4qKioqKioqKjExMTExMSoqKioqKioqTnl5eQEBeXlPKioqKioqKjEyMjIyMjIyMjEqKioqKioqT3l5AXp5eSoqKioqKioxMjIxBwcHBzEyMjEqKioqKioqeXl6eXlVKioqKioqMTIxBwcHBwcHBwcxMjEqKioqKipVeXl5eU8qKioqKioyMgcHBwcHBwcHBwcyMioqKioqKk95eXl5TioqKioqMTIxBwcHBwcHBwcHBzEyMSoqKioqTnl5eXkqKioqKioxMgcHBwcHBwcHBwcHBzIxKioqKioqeXl5eSoqKioqKjEyBwcHBwcHBwcHBwcHMjEqKioqKip5eXl5KioqKioqMTIHBwcHBwcHBwcHBwcyMSoqKioqKnl5eXkqKioqKioxMgcHBwcHBwcHBwcHBzIxKioqKioqeXl5eU4qKioqKjEyMQcHBwcHBwcHBwcxMjEqKioqKk55eXl5TyoqKioqKjIyBwcHBwcHBwcHBzIyKioqKioqT3l5eXlVKioqKioqMTIxBwcHBwcHBwcxMjEqKioqKipVeXl6eXkqKioqKioqMTIyMQcHBwcxMjIxKioqKioqKnl5egF5eU8qKioqKioqMTIyMjIyMjIyMSoqKioqKipPeXkBAXl5eU4qKioqKioqKjExMTExMSoqKioqKioqTnl5eQEBAXl5VSoqKioqKioqKioqKioqKioqKioqKipVeXkBAQEB+nl5VSoqKioqKioqKioqKioqKioqKioqVXl5+gEBAQEBenl5VSoqKioqKioqKioqKioqKioqKlV5eXoBAQEBAQEBeXl5VU4qKioqKioqKioqKioqKk5VeXl5AQEBAQEBAQEBenl5eU8qKioqKioqKioqKipPeXl5egEBAQEBAQEBAQEB+nl5eXlVT04qKioqTk9VeXl5efoBAQEBAQEBAQEBAQEBAXl5eXl5eXl5eXl5eXl5eXkBAQEBAQEBAQEBAQEBAQEBAQF6eXl5eXl5eXl5eXoBAQEBAQEBAQEB/+AH//+AAf/+AAB//AAAP/gAAB/wAAAP4AAAB8AAAAPAAAADgAAAAYAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAYAAAAHAAAADwAAAA+AAAAfwAAAP+AAAH/wAAD/+AAB//4AB///gB/8oAAAAIAAAAEAAAAABACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAACAAAAAwAAAAMAAAADAAAABG1bSA61m3JXuqB4mbuhd8m9o3jqvaF4+b2hePm9o3jqu6F3ybqgeJm1m3JXbVtIDgAAAAQAAAADAAAAAwAAAAMAAAACAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAACAAAAAwAAAAUAAAAGAAAACI98Wye0nXWavKF4876kev++pHr/vqR6/76kev++pHr/vqR6/76kev++pHr/vqR6/76kev+8oXjztJ11mo98WycAAAAIAAAABgAAAAUAAAADAAAAAgAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAQAAAAHAAAAChwcHBKulnGJvaN5+L6kev++pHr/y7GJ/9/Fnv/s1K7/9t25//rivv/64r7/9t25/+zUrv/fxZ7/y7GJ/76kev++pHr/vaN5+K6WcYkcHBwSAAAACgAAAAcAAAAEAAAAAgAAAAEAAAAAAAAAAAAAAAEAAAADAAAABwAAAAtuYkUst552z76kev++pHr+1LuS//Latf/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD/8tq1/9S7kv++pHr+vqR6/7eeds9uYkUsAAAACwAAAAcAAAADAAAAAQAAAAAAAAABAAAAAgAAAAQAAAAIi3hbNbqgd+a+pHr/xayD/+3Vr//85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA/+3Vr//FrIP/vqR6/7qgd+aJdVg0AAAACAAAAAQAAAACAAAAAQAAAAEAAAACAAAABIl8WSW8oXjlvqR6/8yyiv/54Lz//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//ngvP/Msor/vqR6/7yheOWJfFklAAAABAAAAAIAAAABAAAAAAAAAAFfXz8Iu6F4zL6kev/Msor/+uK+//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//rivv/Msor/vqR6/7uheMxfXz8IAAAAAQAAAAAAAAAAAAAAAbqid4K+pHr/xayD//ngvP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//fgvP/FrIP/vqR6/7qid4IAAAABAAAAAAAAAAC3l28gvaN5+L6kev7t1a///OXA//zlwP/85cD//OXA//zlwP/85cD//OXA/+/Twv/Qq8f/u5HK/7OGzP+zhsz/u5HK/9Crx//v08L//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA/+3Vr/++pHr+vaN5+LeXbyAAAAAAAAAAALuheJa+pHr/1LuS//zlwP/85cD//OXA//zlwP/85cD//OXA//riwP/Pq8f/r4HM/6+Bzf+vgc3/r4HN/6+Bzf+vgc3/r4HN/6+BzP/Pq8f/+uLA//zlwP/85cD//OXA//zlwP/85cD//OXA/9S5kv++pHr/u6F4lgAAAACii3MLvKF4876kev/y2rX//OXA//zlwP/85cD//OXA//zlwP/64sD/w5vJ/6+Bzf+vg83/w5vc/9W06v/dwPD/3cDw/9W06v/Dm9z/r4PN/6+Bzf/Dm8n/+uLA//zlwP/85cD//OXA//zlwP/85cD/8tq1/76kev+8oXjzootzC72feFW+pHr/y7GJ//zlwP/85cD//OXA//zlwP/85cD//OXA/8+rx/+vgc3/tIfQ/9a16//hw/P/4cPz/+HD8//hw/P/4cPz/+HD8//Wtev/tIfQ/6+Bzf/Pq8f//OXA//zlwP/85cD//OXA//zlwP/85cD/y7GJ/76kev+9n3hVvaF4mL6kev/fxZ7//OXA//zlwP/85cD//OXA//zlwP/v08L/r4HM/6+Dzf/Wtev/4cPz/+HD8//hw/P/4cPz/+HD8//hw/P/4cPz/+HD8//Wtev/r4PN/6+BzP/v08L//OXA//zlwP/85cD//OXA//zlwP/fxZ7/vqR6/72heJi8oXfIvqR6/+zUrv/85cD//OXA//zlwP/85cD//OXA/9Crx/+vgc3/w5vc/+HD8//hw/P/4cPz/+HD8//hw/P/4cPz/+HD8//hw/P/4cPz/+HD8//Dm9z/r4HN/9Crx//85cD//OXA//zlwP/85cD//OXA/+zUrv++pHr/vKF3yL2jeOq+pHr/9t25//zlwP/85cD//OXA//zlwP/85cD/u5HK/6+Bzf/VtOr/4cPz/+HD8//hw/P/4cPz/+HD8//hw/P/4cPz/+HD8//hw/P/4cPz/9W06v+vgc3/u5HK//zlwP/85cD//OXA//zlwP/85cD/9t25/76kev+9o3jqvaF4+b6kev/64r7//OXA//zlwP/85cD//OXA//zlwP+zhsz/r4HN/93A8P/hw/P/4cPz/+HD8//hw/P/4cPz/+HD8//hw/P/4cPz/+HD8//hw/P/3cDw/6+Bzf+zhsz//OXA//zlwP/85cD//OXA//zlwP/64r7/vqR6/72hePm9oXj5vqR6//rivv/85cD//OXA//zlwP/85cD//OXA/7OGzP+vgc3/3cDw/+HD8//hw/P/4cPz/+HD8//hw/P/4cPz/+HD8//hw/P/4cPz/+HD8//dwPD/r4HN/7OGzP/85cD//OXA//zlwP/85cD//OXA//rivv++pHr/vaF4+b2jeOq+pHr/9t25//zlwP/85cD//OXA//zlwP/85cD/u5HK/6+Bzf/VtOr/4cPz/+HD8//hw/P/4cPz/+HD8//hw/P/4cPz/+HD8//hw/P/4cPz/9W06v+vgc3/u5HK//zlwP/85cD//OXA//zlwP/85cD/9t25/76kev+9o3jqvKF3yL6kev/s1K7//OXA//zlwP/85cD//OXA//zlwP/Qq8f/r4HN/8Ob3P/hw/P/4cPz/+HD8//hw/P/4cPz/+HD8//hw/P/4cPz/+HD8//hw/P/w5vc/6+Bzf/Qq8f//OXA//zlwP/85cD//OXA//zlwP/s1K7/vqR6/7yhd8i9oXiYvqR6/9/Fnv/85cD//OXA//zlwP/85cD//OXA/+/Twv+vgcz/r4PN/9a16//hw/P/4cPz/+HD8//hw/P/4cPz/+HD8//hw/P/4cPz/9a16/+vg83/r4HM/+/Twv/85cD//OXA//zlwP/85cD//OXA/9/Fnv++pHr/vaF4mL2feFW+pHr/y7GJ//zlwP/85cD//OXA//zlwP/85cD//OXA/8+rx/+vgc3/tIfQ/9a16//hw/P/4cPz/+HD8//hw/P/4cPz/+HD8//Wtev/tIfQ/6+Bzf/Pq8f//OXA//zlwP/85cD//OXA//zlwP/85cD/y7GJ/76kev+9n3hVootzC7yhePO+pHr/8tq1//zlwP/85cD//OXA//zlwP/85cD/+uLA/8Obyf+vgc3/r4PN/8Ob3P/VtOr/3cDw/93A8P/VtOr/w5vc/6+Dzf+vgc3/w5vJ//riwP/85cD//OXA//zlwP/85cD//OXA//Latf++pHr/vKF486KLcwsAAAAAu6N3l76kev/Uu5L//OXA//zlwP/85cD//OXA//zlwP/85cD/+uLA/8+rx/+vgcz/r4HN/6+Bzf+vgc3/r4HN/6+Bzf+vgc3/r4HM/8+rx//64sD//OXA//zlwP/85cD//OXA//zlwP/85cD/1LmS/76kev+7oXiWAAAAAAAAAAC3l28gvaN5+L6kev7t1a///OXA//zlwP/85cD//OXA//zlwP/85cD//OXA/+/Twv/Qq8f/u5HK/7OGzP+zhsz/u5HK/9Crx//v08L//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA/+3Vr/++pHr+vaN5+LeXbyAAAAAAAAAAAAAAAAC6oneCvqR6/8Wsg//54Lz//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/34Lz/xayD/76kev+6oneCAAAAAAAAAAAAAAAAAAAAAH9/VQa8oHjLvqR6/8yyiv/64r7//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD/+uK+/8yyiv++pHr/vKB4y39/VQYAAAAAAAAAAAAAAAAAAAAAAAAAALKhbh67o3nkvqR6/8yyiv/54Lz//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//ngvP/Msor/vqR6/7ujeeSyoW4eAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALqbdim7o3nkvqR6/8Wsg//t1a///OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/t1a//xayD/76kev+7o3nkupt2KQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALKhbh68oHjLvqR6/76kev7Uu5L/8tq1//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/85cD//OXA//zlwP/y2rX/1LmS/76kev6+pHr/vKB4y7Khbh4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH9/VQa6oneCvaN5+L6kev++pHr/y7GJ/9/Fnv/s1K7/9t25//rivv/64r7/9t25/+zUrv/fxZ7/y7GJ/76kev++pHr/vaN5+Lqid4J/f1UGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC3l28gu6F4lryhePO+pHr/vqR6/76kev++pHr/vqR6/76kev++pHr/vqR6/76kev++pHr/vKF487uheJa3l28gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAootzC72feFW9oXiYvKF3yL2jeOq9oXj5vaF4+b2jeOq8oXfIvaF4mL2feFWii3MLAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/gB///gAH//gAAf/wAAD/4AAAf8AAAD+AAAAfAAAADwAAAA4AAAAGAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAGAAAABwAAAA8AAAAPgAAAH8AAAD/gAAB/8AAA//gAAf/+AAf//4Af/</pre>\r\n</div>\r\n<div title=\"BinaryUploadPlugin\" server.title=\"BinaryUploadPlugin\" server.page.revision=\"1521860\" server.etag=\"&quot;system-plugins_public/BinaryUploadPlugin/1521860:a5592b90eca98cd02b7bb735f01f17043bef4b59&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-plugins_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-plugins_public\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"fa2a79fa940254cf1cdd7980c85b5efd0eff0ce5\">\r\n<pre>/***\r\n|''Name''|BinaryUploadPlugin|\r\n|''Version''|0.3.16|\r\n|''Author''|Ben Gillies and Jon Robson|\r\n|''Type''|plugin|\r\n|''Source''|http://github.com/TiddlySpace/tiddlyspace/raw/master/src/plugins/BinaryUploadPlugin.js|\r\n|''Description''|Upload a binary file to TiddlyWeb|\r\n|''CoreVersion''|2.6.1|\r\n|''Requires''|TiddlySpaceConfig TiddlyWebConfig|\r\n!Usage\r\n{{{\r\n&lt;&lt;binaryUpload bag:&lt;name&gt; edit:tags edit:title tags:&lt;default tags&gt; title:&lt;title&gt; &gt;&gt;\r\n}}}\r\n* {{{bag:&lt;name&gt;}}}: optional; if left out, the file will be saved to the current workspace\r\n* {{{edit:tags}}}: specifies that you want to tag the file being uploaded\r\n* {{{edit:title}}}: specifies that you want to set the title to something other than the filename\r\n* {{{tags:&lt;default tags&gt;}}}: specifies a default set of tags to apply to the file (requires {{{edit:tags}}} to be set)\r\n* {{{title:&lt;title&gt;}}}: predefines the title of the binary tiddler\r\n!Requires\r\nTiddlyWeb\r\ntiddlywebplugins.form\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nvar tiddlyspace = config.extensions.tiddlyspace;\r\n\r\nvar macro = config.macros.binaryUpload = {\r\n\tlocale: {\r\n\t\ttitleDefaultValue: \"Please enter a title...\",\r\n\t\ttagsDefaultValue: \"Please enter some tags...\",\r\n\t\ttitlePrefix: \"title: \",\r\n\t\ttagsPrefix: \"tags: \",\r\n\t\tloadSuccess: 'Tiddler %0 successfully uploaded',\r\n\t\tloadError: \"An error occurred when uploading the tiddler %0\",\r\n\t\tuploadInProgress: \"Please wait while the file is uploaded...\",\r\n\t\tmembersOnly: \"Only members can upload.\"\r\n\t},\r\n\trenderInputFields: function(container, options) {\r\n\t\tvar locale = macro.locale;\r\n\t\tvar editableFields = options.edit;\r\n\t\tvar includeFields = {\r\n\t\t\ttags:  editableFields &amp;&amp; editableFields.contains(\"tags\") ? true : false,\r\n\t\t\ttitle: editableFields &amp;&amp; editableFields.contains(\"title\") ? true : false\r\n\t\t};\r\n\t\tvar fields = [\"title\", \"tags\"];\r\n\t\tfor(var i = 0; i &lt; fields.length; i++) {\r\n\t\t\tvar fieldName = fields[i];\r\n\t\t\tvar userDefault = options[fieldName];\r\n\t\t\tvar defaultValue = userDefault ? userDefault[0] : false;\r\n\t\t\tif(includeFields[fieldName] || defaultValue) {\r\n\t\t\t\tvar localeDefault = locale[\"%0DefaultValue\".format(fieldName)];\r\n\t\t\t\tvar className = defaultValue ? \"userInput\" : \"userInput notEdited\";\r\n\t\t\t\tvar inputEl;\r\n\t\t\t\tvar val = defaultValue || localeDefault || \"\";\r\n\t\t\t\tvar iContainer = $(\"&lt;div /&gt;\").addClass(\"binaryUpload%0\".format(fieldName)).\r\n\t\t\t\t\tappendTo(container);\r\n\t\t\t\tif(defaultValue &amp;&amp; !includeFields[fieldName]) {\r\n\t\t\t\t\tvar label = locale[\"%0Prefix\".format(fieldName)];\r\n\t\t\t\t\t$(\"&lt;span /&gt;\").text(label).appendTo(iContainer);\r\n\t\t\t\t\t$(\"&lt;span /&gt;\").addClass(\"disabledInput\").text(val).appendTo(iContainer);\r\n\t\t\t\t\tinputEl = $(\"&lt;input /&gt;\").attr(\"type\", \"hidden\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tinputEl = $(\"&lt;input /&gt;\").attr(\"type\", \"text\");\r\n\t\t\t\t}\r\n\t\t\t\tinputEl.attr(\"name\", fieldName).\r\n\t\t\t\t\taddClass(\"%0Edit\".format(fieldName)).\r\n\t\t\t\t\tval(val).addClass(className).appendTo(iContainer);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tgetTiddlerName: function(fileName) {\r\n\t\tvar fStart = fileName.lastIndexOf(\"\\\\\");\r\n\t\tvar fStart2 = fileName.lastIndexOf(\"/\");\r\n\t\tfStart = fStart &lt; fStart2 ? fStart2 : fStart;\r\n\t\tfileName = fileName.substr(fStart+1);\r\n\t\treturn fileName;\r\n\t},\r\n\terrorHandler: function(fileName) {\r\n\t\tdisplayMessage(\"upload of file %0 failed\".format(fileName));\r\n\t},\r\n\tuploadFile: function(place, baseURL, workspace, options) {\r\n\t\tvar pleaseWait = $(\".uploadProgress\", place);\r\n\t\tvar iframeName = options.target;\r\n\t\tvar form = $(\"form\", place);\r\n\t\tvar existingVal = $(\"input[name=title]\", form).val();\r\n\t\tvar fileName = existingVal || $('input:file', form).val();\r\n\t\tif(!fileName) {\r\n\t\t\treturn false; // the user hasn't selected a file yet\r\n\t\t}\r\n\t\tfileName = macro.getTiddlerName(fileName);\r\n\t\t$(\"input[name=title]\", place).val(fileName);\r\n\t\t// we need to go somewhere afterwards to ensure the onload event triggers\r\n\t\tvar redirectTo = \"/%0/tiddlers.txt?select=title:%1\".\r\n\t\t\tformat(workspace, fileName);\r\n\t\tvar token = tiddlyspace ? tiddlyspace.getCSRFToken() : \"\";\r\n\t\tvar action = \"%0?csrf_token=%1&amp;redirect=%2\"\r\n\t\t\t.format(baseURL, token, redirectTo);\r\n\t\tform[0].action = action; // dont use jquery to work with ie\r\n\t\tform[0].target = iframeName;\r\n\t\t// do not refactor following line... won't work in IE6 otherwise\r\n\t\t$(place).append($('&lt;iframe name=\"' + iframeName + '\" id=\"' + iframeName + '\"/&gt;').css('display','none'));\r\n\t\tmacro.iFrameLoader(iframeName, function() {\r\n\t\t\tvar content = document.getElementById(iframeName).contentWindow.document.documentElement;\r\n\t\t\tif($(content).text().indexOf(fileName) &gt; -1) {\r\n\t\t\t\toptions.callback(place, fileName, workspace, baseURL);\r\n\t\t\t} else {\r\n\t\t\t\tmacro.errorHandler(fileName);\r\n\t\t\t}\r\n\t\t\tform.show(1000);\r\n\t\t\tpleaseWait.hide(1000);\r\n\t\t});\r\n\t\tform.hide(1000);\r\n\t\tpleaseWait.show(1000);\r\n\t\treturn true;\r\n\t},\r\n\tcreateUploadForm: function(place, options) {\r\n\t\tvar locale = macro.locale;\r\n\t\tif(readOnly) {\r\n\t\t\t$('&lt;div class=\"annotation\" /&gt;').text(locale.membersOnly).\r\n\t\t\t\tappendTo(place);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar bag = options.bag;\r\n\t\toptions.callback = options.callback ? options.callback :\r\n\t\t\tfunction(place, fileName, workspace, baseurl) {\r\n\t\t\t\tmacro.displayFile(place, fileName, workspace);\r\n\t\t\t\tdisplayMessage(locale.loadSuccess.format(fileName));\r\n\t\t\t\t$(\"input[type=text]\", place).val(\"\");\r\n\t\t\t};\r\n\t\tvar defaults = config.defaultCustomFields;\r\n\t\tplace = $(\"&lt;div /&gt;\").addClass(\"container\").appendTo(place)[0];\r\n\t\tvar workspace = bag ? \"bags/%0\".format(bag) : config.defaultCustomFields[\"server.workspace\"];\r\n\t\tvar baseURL = defaults[\"server.host\"];\r\n\t\tbaseURL += (baseURL[baseURL.length - 1] !== \"/\") ? \"/\" : \"\";\r\n\t\tbaseURL = \"%0%1/tiddlers\".format(baseURL, workspace);\r\n\t\t//create the upload form, complete with invisible iframe\r\n\t\tvar iframeName = \"binaryUploadiframe%0\".format(Math.random());\r\n\t\t// do not refactor following line of code to work in IE6.\r\n\t\tvar form = $('&lt;form action=\"%0\" method=\"POST\" enctype=\"multipart/form-data\" /&gt;'.\r\n\t\t\t\t\tformat(baseURL)).addClass(\"binaryUploadForm\").\r\n\t\t\tappendTo(place)[0];\r\n\t\tmacro.renderInputFields(form, options);\r\n\t\t$(form).\r\n\t\t\tappend('&lt;div class=\"binaryUploadFile\"&gt;&lt;input type=\"file\" name=\"file\" /&gt;&lt;/div&gt;').\r\n\t\t\tappend('&lt;div class=\"binaryUploadSubmit\"&gt;&lt;input type=\"submit\" value=\"Upload\" disabled /&gt;&lt;/div&gt;').\r\n\t\t\tsubmit(function(ev) {\r\n\t\t\t\tthis.target = iframeName;\r\n\t\t\t\toptions.target = iframeName;\r\n\t\t\t\tmacro.uploadFile(place, baseURL, workspace, options);\r\n\t\t\t})\r\n\t\t\t.find('[type=\"file\"]').bind('change', function() {\r\n\t\t\t\t$(form).find('[type=\"submit\"]').prop('disabled', false);\r\n\t\t\t}).end();\r\n\t\t$('&lt;div /&gt;').addClass(\"uploadProgress\").text(locale.uploadInProgress).hide().appendTo(place);\r\n\t\t$(\"input[name=file]\", place).change(function(ev) {\r\n\t\t\tvar target = $(ev.target);\r\n\t\t\tvar fileName = target.val();\r\n\t\t\tvar title = $(\"input[type=text][name=title]\", place);\r\n\t\t\tif(!title.val()) {\r\n\t\t\t\ttitle.val(fileName);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\thandler: function(place, macroName, params, wikifier, paramString, tiddler) {\r\n\t\tparams = paramString.parseParams(null, null, true);\r\n\t\tmacro.createUploadForm(place, params[0]);\r\n\t},\r\n\tiFrameLoader: function(iframeName, callback) {\r\n\t\tvar iframe = document.getElementById(iframeName); //jQuery doesn't seem to want to do this!?\r\n\t\tvar locale = macro.locale;\r\n\t\t$(\".userInput\").addClass(\"notEdited\"); // reset editing\r\n\t\tvar finishedLoading = function() {\r\n\t\t\tcallback();\r\n\t\t};\r\n\t\tvar iFrameLoadHandler = function() {\r\n\t\t\tfinishedLoading.apply();\r\n\t\t\treturn;\r\n\t\t};\r\n\r\n\t\tiframe.onload = iFrameLoadHandler;\r\n\t\t//IE\r\n\t\tcompleteReadyStateChanges = 0;\r\n\t\tiframe.onreadystatechange = function() {\r\n\t\t\tif (++(completeReadyStateChanges) == 3) {\r\n\t\t\t\tiFrameLoadHandler();\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\tdisplayFile: function(place, title, workspace) {\r\n\t\tvar adaptor = store.getTiddlers()[0].getAdaptor();\r\n\t\tvar context = {\r\n\t\t\tworkspace: workspace,\r\n\t\t\thost: config.defaultCustomFields['server.host']\r\n\t\t};\r\n\t\tadaptor.getTiddler(title, context, null, function(context) {\r\n\t\t\tif(context.status) {\r\n\t\t\t\tstore.addTiddler(context.tiddler);\r\n\t\t\t\tstory.displayTiddler(place, title);\r\n\t\t\t\tvar image = config.macros.image;\r\n\t\t\t\tif(image &amp;&amp; image.refreshImage) {\r\n\t\t\t\t\timage.refreshImage(\"/%0/tiddlers/%1\".format(workspace, title));\r\n\t\t\t\t\timage.refreshImage(title);\r\n\t\t\t\t\timage.refreshImage(\"/%0\".format(title));\r\n\t\t\t\t\timage.refreshImage(\"%0/%1/tiddlers/%2\".format(config.extensions.tiddlyweb.host, workspace, title));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tdisplayMessage(macro.locale.loadError.format(title));\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n};\r\n\r\nif(tiddlyspace) {\r\n\tconfig.macros.binaryUploadPublic = {\r\n\t\thandler: function(place, macroName, params, wikifier, paramString, tiddler) {\r\n\t\t\tvar options = paramString.parseParams(null, null, true)[0];\r\n\t\t\tvar bag = tiddlyspace.getCurrentBag(\"public\");\r\n\t\t\toptions.bag = bag;\r\n\t\t\tmacro.createUploadForm(place, options);\r\n\t\t}\r\n\t};\r\n\tconfig.messages.privacySetting = config.options.chkPrivateMode ?\r\n\t\t\"private\" : \"public\";\r\n\tconfig.macros.binaryUpload.defaultWorkspace = tiddlyspace.\r\n\t\tgetCurrentWorkspace(config.messages.privacySetting);\r\n}\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"apps\" server.title=\"apps\" server.page.revision=\"1521891\" server.etag=\"&quot;tiddlyspace/apps/1521891:e526168928a1ee7869ecf87dcbe0f84896ba4351&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"text/html\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch\" _hash=\"901ce9fdbc458a92f3643134f0bd968fc1f69cb1\">\r\n<pre>&lt;!DOCTYPE html&gt;\r\n&lt;html lang=\"en\"&gt;\r\n&lt;head&gt;\r\n\t&lt;meta charset=\"utf-8\"/&gt;\r\n\t&lt;title&gt;TiddlySpace Apps&lt;/title&gt;\r\n\t&lt;link rel=\"stylesheet\" href=\"/bags/common/tiddlers/reset.css\" /&gt;\r\n\t&lt;link rel=\"stylesheet\" href=\"/bags/common/tiddlers/appspage.css\" /&gt;\r\n\t&lt;!--[if lt IE 7 ]&gt;\r\n\t&lt;link rel=\"stylesheet\" href=\"/bags/common/tiddlers/appspageie6.css\" /&gt;\r\n\t&lt;![endif]--&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n\t\r\n\t&lt;div id=\"wrapper\"&gt;\r\n\t\t&lt;div id=\"TSbar\"&gt;&lt;/div&gt;\r\n\t\t&lt;div id=\"main-content\"&gt;\r\n\t\t\t&lt;div id=\"space-details\"&gt;\r\n\t\t\t\t&lt;a href=\"/_space\"&gt;&lt;img class=\"siteicon\"&gt;&lt;/a&gt;\r\n\t\t\t\t&lt;div id=\"title-subtitle\"&gt;\r\n\t\t\t\t\t&lt;h1 class=\"spaceaddress\"&gt;\r\n\t\t\t\t\t\t&lt;span class=\"spaceName\"&gt;&lt;/span&gt;&lt;span class=\"hostName\"&gt;&lt;/span&gt;\r\n\t\t\t\t\t&lt;/h1&gt;\r\n\t\t\t\t\t&lt;p class=\"tagline\"&gt;&lt;span class=\"subTitle\"&gt;&lt;/span&gt;&lt;a class=\"managespaces\" href=\"/_space\"&gt;manage space&lt;/a&gt;&lt;/p&gt;\r\n\t\t\t\t&lt;/div&gt;\r\n\t\t\t&lt;/div&gt;\r\n\t\t\t&lt;div id=\"holder\"&gt;\r\n\t\t\t\t&lt;div id=\"appswitcher-wrapper\"&gt;\r\n\t\t\t\t\t&lt;div id=\"appswitcher\"&gt;\r\n\t\t\t\t\t\t&lt;h2&gt;Your Apps&lt;/h2&gt;\r\n\t\t\t\t\t\t&lt;ul id=\"app-list\"&gt;\r\n\t\t\t\t\t\t\t&lt;li class=\"htmlserialisation\"&gt;\r\n\t\t\t\t\t\t\t\t&lt;a href=\"/tiddlers.html?select=tag:!excludeLists;sort=-modified\"&gt;\r\n\t\t\t\t\t\t\t\t\t&lt;img src=\"/bags/common/tiddlers/browse_read_blue.png\" alt=\"Icon for the HTML Serialisation\" class=\"app-img\" /&gt;\r\n\t\t\t\t\t\t\t\t\tBROWSE\r\n\t\t\t\t\t\t\t\t&lt;/a&gt;\r\n\t\t\t\t\t\t\t&lt;/li&gt;\r\n\t\t\t\t\t\t\t&lt;li class=\"tiddlywiki\"&gt;\r\n\t\t\t\t\t\t\t\t&lt;a href=\"/tiddlers.wiki\"&gt;\r\n\t\t\t\t\t\t\t\t\t&lt;img src=\"/bags/common/tiddlers/tiddlywiki2_blue.png\" alt=\"Icon for TiddlyWiki\" class=\"app-img\" /&gt;\r\n\t\t\t\t\t\t\t\t\tTIDDLYWIKI\r\n\t\t\t\t\t\t\t\t&lt;/a&gt;\r\n\t\t\t\t\t\t\t&lt;/li&gt;\r\n\t\t\t\t\t\t&lt;/ul&gt;\r\n\t\t\t\t\t\t&lt;div id=\"addapp\"&gt;\r\n\t\t\t\t\t\t\t&lt;button class=\"inactive\"&gt;Add More!&lt;/button&gt;\r\n\t\t\t\t\t\t&lt;/div&gt;\r\n\t\t\t\t\t&lt;/div&gt;\r\n\t\t\t\t\t&lt;div id=\"app-desc\"&gt;\r\n\t\t\t\t\t\t&lt;ul&gt;\r\n\t\t\t\t\t\t\t&lt;li class=\"htmlserialisationdesc\"&gt;&lt;p&gt;an easy to understand HTML representation of your content.&lt;/p&gt;&lt;/li&gt;\r\n\t\t\t\t\t\t\t&lt;li class=\"tiddlywikidesc\"&gt;&lt;p&gt;use TiddlyWiki to create, edit and organise your content.&lt;/p&gt;&lt;/li&gt;\r\n\t\t\t\t\t\t&lt;/ul&gt;\r\n\t\t\t\t\t&lt;/div&gt;\r\n\t\t\t\t\t&lt;div style=\"clear: both;\"&gt;&lt;/div&gt;\r\n\t\t\t\t&lt;/div&gt;\r\n\t\t\t&lt;/div&gt;\r\n\t\t&lt;/div&gt;\r\n\t\t&lt;div id=\"footer\"&gt;&lt;!-- ie doesn't support footer tag --&gt;\r\n\t\t\t&lt;div id=\"footer-content\"&gt;\r\n\t\t\t\t&lt;div class=\"links\"&gt;\r\n\t\t\t\t\t&lt;a href=\"http://blog.tiddlyspace.com\"&gt;blog&lt;/a&gt;\r\n\t\t\t\t\t&lt;a href=\"http://featured.tiddlyspace.com\"&gt;featured&lt;/a&gt;\r\n\t\t\t\t\t&lt;a href=\"http://docs.tiddlyspace.com\"&gt;documentation&lt;/a&gt;\r\n\t\t\t\t\t&lt;a href=\"https://github.com/TiddlySpace/tiddlyspace\"&gt;source&lt;/a&gt;\r\n\t\t\t\t&lt;/div&gt;\r\n\t\t\t\t&lt;p&gt;TiddlySpace 2011, created by &lt;a href=\"http://osmosoft.com\"&gt;Osmosoft&lt;/a&gt;&lt;/p&gt;\r\n\t\t\t&lt;/div&gt;\r\n\t\t&lt;/div&gt;\r\n\t&lt;/div&gt;\r\n\t\r\n\t&lt;script type=\"text/javascript\" src=\"/bags/common/tiddlers/backstage.js\"&gt;&lt;/script&gt;\r\n\t&lt;script type=\"text/javascript\" src=\"/bags/common/tiddlers/jquery.js\"&gt;&lt;/script&gt;\r\n\t&lt;script type=\"text/javascript\" src=\"/bags/tiddlyspace/tiddlers/chrjs\"&gt;&lt;/script&gt;\r\n\t&lt;script type=\"text/javascript\" src=\"/bags/common/tiddlers/chrjs-store.js\"&gt;&lt;/script&gt;\r\n\t&lt;script type=\"text/javascript\" src=\"/bags/common/tiddlers/jquery-json.js\"&gt;&lt;/script&gt;\r\n\t&lt;script type=\"text/javascript\" src=\"/bags/common/tiddlers/appspage.js\"&gt;&lt;/script&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;</pre>\r\n</div>\r\n<div title=\"PageTemplate\" server.title=\"PageTemplate\" server.page.revision=\"1521914\" server.etag=\"&quot;system-theme_public/PageTemplate/1521914:706aca27d99afd36b7c564473e986c24023d0f5a&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-theme_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-theme_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch\" _hash=\"f7d57de5937a110a2d275d11eebcd4557fc34f25\">\r\n<pre>&lt;!--{{{--&gt;\r\n&lt;div class='header'&gt;\r\n\t&lt;div id='sidebarSearch'&gt;\r\n\t\t&lt;span macro='search'&gt;&lt;/span&gt;\r\n\t&lt;/div&gt;\r\n\t&lt;div class='headerForeground'&gt;\r\n\t\t&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;\r\n\t\t&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;\r\n\t&lt;/div&gt;\r\n\t&lt;div class='clearFloat'&gt;&lt;/div&gt;\r\n&lt;/div&gt;\r\n\r\n&lt;div id='menuBar'&gt;\r\n\t&lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;\r\n\t&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;div id='displayArea'&gt;\r\n\t&lt;div id='messageArea'&gt;&lt;/div&gt;\r\n\t&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;\r\n\t&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;!--}}}--&gt;</pre>\r\n</div>\r\n<div title=\"pearl\" server.title=\"pearl\" server.page.revision=\"2559250\" server.etag=\"&quot;pearl_public/pearl/2559250:ca767b1decc74819597d335b6dd9abe0787ba70e&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160914134708\" created=\"20160914134540\" tags=\"\" _hash=\"320fa02a184c023c62b724bda6eef291e2d53640\">\r\n<pre>[[pearl prince]]</pre>\r\n</div>\r\n<div title=\"首页\" server.title=\"首页\" server.page.revision=\"2564806\" server.etag=\"&quot;pearl_public/%E9%A6%96%E9%A1%B5/2564806:fde65cdf0e081ebd2d576f55082473b99f12ce62&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160925051518\" created=\"20160925034324\" tags=\"\" _hash=\"707a57172046579995fc6efd1c0faacd739ff6dd\">\r\n<pre>&lt;html&gt;\r\n&lt;head&gt;\r\n      &lt;title&gt;第一个HTML代码&lt;/title&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n&lt;div align=\"center\"&gt;\r\n&lt;img src=\"http://zw.shangxueba.com/uploadfile/20150901/201509011346492814.jpg\" hight=\"500\" width=\"500\" &gt;&lt;br/&gt;\r\n\r\n&lt;/div&gt;\r\n\r\n&lt;/body&gt;\r\n&lt;/html&gt;\r\n</pre>\r\n</div>\r\n<div title=\"TiddlySpaceInit\" server.title=\"TiddlySpaceInit\" server.page.revision=\"1521909\" server.etag=\"&quot;tiddlyspace/TiddlySpaceInit/1521909:ad2b9f453ce9f912a8297fd024c40f8d71582a43&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"05e5325df4a93506529425c558842d5953dd6a44\">\r\n<pre>/***\r\n|''Name''|TiddlySpaceInitialization|\r\n|''Version''|0.7.3|\r\n|''Description''|Initializes new TiddlySpaces the first time they are created|\r\n|''Status''|@@beta@@|\r\n|''Source''|http://github.com/TiddlySpace/tiddlyspace/blob/master/src/plugins/TiddlySpaceInit.js|\r\n|''CoreVersion''|2.6.1|\r\n|''Requires''|TiddlySpaceConfig RandomColorPalettePlugin chrjs ImageMacroPlugin|\r\n!TODO\r\n* robust error notification and recovery\r\n!MarkupPreHead\r\n&lt;!--{{{--&gt;\r\n&lt;link href=\"/bags/%0_public/tiddlers.atom\" rel=\"alternate\"\r\n\ttype=\"application/atom+xml\" title=\"%0's public feed\" /&gt;\r\n&lt;link rel=\"canonical\" href=\"%1/\" /&gt;\r\n&lt;!--}}}--&gt;\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nvar versionField = \"tiddlyspaceinit_version\";\r\nvar markupPreHead = store.getTiddlerText(tiddler.title + \"##MarkupPreHead\", \"\");\r\nvar tiddlyspace = config.extensions.tiddlyspace;\r\nvar currentSpace = tiddlyspace.currentSpace;\r\nvar tweb = config.extensions.tiddlyweb;\r\n\r\nvar plugin = config.extensions.TiddlySpaceInit = {\r\n\tversion: \"0.6\",\r\n\tSiteTitle: \"%0\",\r\n\tSiteSubtitle: \"a TiddlySpace\",\r\n\tflagTitle: \"%0SetupFlag\",\r\n\tflagWarning: \"Please do not modify this tiddler; it was created \" +\r\n\t\t\"automatically upon space creation.\",\r\n\r\n\tdispatch: function(ev) {\r\n\t\tvar title = plugin.flagTitle.format([currentSpace.name]);\r\n\t\tconfig.annotations[title] = plugin.flagWarning;\r\n\t\tif(currentSpace.type != \"private\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar tiddlers = [];\r\n\t\tvar tid = store.getTiddler(title);\r\n\t\tif(tid) {\r\n\t\t\tcurVersion = parseFloat(tid.fields[versionField]);\r\n\t\t\treqVersion = parseFloat(plugin.version);\r\n\t\t\tif(curVersion &lt; reqVersion) {\r\n\t\t\t\tplugin.update(curVersion, tid);\r\n\t\t\t\ttid.fields[versionField] = plugin.version;\r\n\t\t\t\ttid.incChangeCount();\r\n\t\t\t\ttid = store.saveTiddler(tid);\r\n\t\t\t\ttiddlers.push(tid);\r\n\t\t\t}\r\n\t\t} else { // first run\r\n\t\t\ttid = new Tiddler(title);\r\n\t\t\ttid.tags = [\"excludeLists\", \"excludeSearch\", \"excludePublisher\"];\r\n\t\t\ttid.fields = $.extend({}, config.defaultCustomFields);\r\n\t\t\ttid.fields[versionField] = plugin.version;\r\n\t\t\ttid.text = \"@@%0@@\".format([plugin.flagWarning]);\r\n\t\t\ttid = store.saveTiddler(tid);\r\n\t\t\ttiddlers = tiddlers.concat(plugin.firstRun(), tid);\r\n\t\t}\r\n\t\tautoSaveChanges(null, tiddlers);\r\n\t},\r\n\tupdate: function(curVersion, flagTiddler) {\r\n\t\tif(curVersion &lt; 0.2) {\r\n\t\t\tthis.createAvatar();\r\n\t\t}\r\n\t\tif(curVersion &lt; 0.3) {\r\n\t\t\tflagTiddler.tags.pushUnique(\"excludePublisher\"); // XXX: never persisted\r\n\t\t}\r\n\t\tif(curVersion &lt; 0.5) { // v0.4 was faulty\r\n\t\t\tthis.setupMarkupPreHead();\r\n\t\t}\r\n\t\tif(curVersion &lt; 0.6) {\r\n\t\t\tthis.purgeSystemSettings();\r\n\t\t}\r\n\t},\r\n\tpubTid: {\r\n\t\ttags: [\"excludeLists\", \"excludeSearch\"],\r\n\t\tfields: $.extend({}, config.defaultCustomFields, {\r\n\t\t\t\"server.workspace\": tiddlyspace.getCurrentWorkspace(\"public\")\r\n\t\t})\r\n\t},\r\n\tmakeTiddlerIfNot: function(tiddler) {\r\n\t\tif (!store.tiddlerExists(tiddler.title)) {\r\n\t\t\t$.extend(true, tiddler, plugin.pubTid);\r\n\t\t\treturn [store.saveTiddler(tiddler)];\r\n\t\t} else {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t},\r\n\tfirstRun: function() {\r\n\t\tvar tiddlers = [];\r\n\t\t// generate Site*itle\r\n\t\t$.each([\"SiteTitle\", \"SiteSubtitle\"], function(i, item) {\r\n\t\t\tvar tid = new Tiddler(item);\r\n\t\t\ttid.text = plugin[item].format([currentSpace.name]);\r\n\t\t\ttiddlers.push.apply(tiddlers,\r\n\t\t\t\tplugin.makeTiddlerIfNot(tid));\r\n\t\t});\r\n\t\t// generate public ColorPalette\r\n\t\tvar tid = new Tiddler(\"ColorPalette\");\r\n\t\ttid.text = config.macros.RandomColorPalette.generatePalette({\r\n\t\t\tsaturation_pale: 0.67, saturation_light: 0.53,\r\n\t\t\tsaturation_mid: 0.43, saturation_dark: 0.06,\r\n\t\t\tpale: 0.99, light: 0.85, mid: 0.5, dark: 0.31\r\n\t\t},\r\n\t\t\tfalse);\r\n\t\ttiddlers.push.apply(tiddlers, plugin.makeTiddlerIfNot(tid));\r\n\t\tthis.createAvatar();\r\n\t\tthis.setupMarkupPreHead();\r\n\t\treturn tiddlers;\r\n\t},\r\n\t// remove _cookie slices (TiddlyWiki 2.6.2 beta 6 remnants)\r\n\tpurgeSystemSettings: function() {\r\n\t\tvar ss = store.getTiddler(\"SystemSettings\");\r\n\t\tif(ss) {\r\n\t\t\tvar lines = ss.text.split(\"\\n\");\r\n\t\t\tvar persistentOptions = $.grep(lines, function(line, i) {\r\n\t\t\t\treturn line.indexOf(\"_cookie:\") == -1;\r\n\t\t\t});\r\n\t\t\tss.text = persistentOptions.join(\"\\n\");\r\n\t\t\tss = store.saveTiddler(ss);\r\n\t\t\tautoSaveChanges(null, [ss]);\r\n\t\t}\r\n\t},\r\n\tcreateAvatar: function() {\r\n\t\tvar avatar = \"SiteIcon\";\r\n\t\tvar host = tweb.host;\r\n\t\tvar notify = function(xhr, error, exc) {\r\n\t\t\tdisplayMessage(\"ERROR: could not create avatar - \" + // TODO: i18n\r\n\t\t\t\t\"%0: %1\".format([xhr.statusText, xhr.responseText]));\r\n\t\t\t// TODO: resolve!?\r\n\t\t};\r\n\r\n\t\tvar pubBag = tiddlyspace.getCurrentBag(\"public\");\r\n\t\tvar tid = new tiddlyweb.Tiddler(avatar);\r\n\t\ttid.bag = new tiddlyweb.Bag(pubBag, host);\r\n\r\n\t\tvar callback = function(data, status, xhr) {}; // avatar already exists; do nothing\r\n\t\tvar errback = function(xhr, error, exc) {\r\n\t\t\tif(xhr.status != 404) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// copy default avatar\r\n\t\t\tvar _notify = function(tid, status, xhr) {\r\n\t\t\t\tdisplayMessage(\"created avatar\"); // TODO: i18n\r\n\t\t\t\tvar image = config.macros.image;\r\n\t\t\t\tif(image &amp;&amp; image.refreshImage) {\r\n\t\t\t\t\tvar uri = \"/%0/tiddlers/SiteIcon\".\r\n\t\t\t\t\t\tformat(tiddlyspace.getCurrentWorkspace(\"public\"));\r\n\t\t\t\t\timage.refreshImage(uri);\r\n\t\t\t\t\timage.refreshImage(\"SiteIcon\");\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tvar _callback = function(tid, status, xhr) {\r\n\t\t\t\ttid.title = avatar;\r\n\t\t\t\ttid.bag.name = pubBag;\r\n\t\t\t\tdelete tid.etag;\r\n\t\t\t\ttid.put(_notify, notify); // TODO: add to current session document (via adaptor?)\r\n\t\t\t};\r\n\t\t\ttweb.getUserInfo(function(user) {\r\n\t\t\t\tvar avatarTitle = currentSpace.name == user.name ?\r\n\t\t\t\t\t\"defaultUserIcon\" : \"defaultSiteIcon\";\r\n\t\t\t\tvar tid = new tiddlyweb.Tiddler(avatarTitle);\r\n\t\t\t\ttid.bag = new tiddlyweb.Bag(\"common\", host);\r\n\t\t\t\ttid.get(_callback, notify);\r\n\t\t\t});\r\n\t\t};\r\n\t\ttid.get(callback, errback);\r\n\t},\r\n\tsavePublicTiddlerText: function(title, text, pubWorkspace) {\r\n\t\tvar tid = new Tiddler(title);\r\n\t\ttid.text = text;\r\n\t\ttid.tags = [\"excludeLists\"];\r\n\t\ttid.fields = $.extend({}, config.defaultCustomFields);\r\n\t\ttid.fields[\"server.workspace\"] = pubWorkspace;\r\n\t\ttid.fields[\"server.page.revision\"] = \"false\";\r\n\t\ttid = store.saveTiddler(tid);\r\n\t\tautoSaveChanges(null, [tid]);\r\n\t},\r\n\tsetupMarkupPreHead: function() {\r\n\t\tvar pubWorkspace = tiddlyspace.getCurrentWorkspace(\"public\");\r\n\t\tvar existing = store.getTiddler(\"MarkupPreHead\");\r\n\t\tif(!existing || existing.fields[\"server.workspace\"] != pubWorkspace) {\r\n\t\t\tvar context = this;\r\n\t\t\ttweb.getStatus(function(status) {\r\n\t\t\t\tvar text = markupPreHead.format(currentSpace.name,\r\n\t\t\t\t\ttiddlyspace.getHost(status.server_host, currentSpace.name));\r\n\t\t\t\tcontext.savePublicTiddlerText(\"MarkupPreHead\", text,\r\n\t\t\t\t\tpubWorkspace);\r\n\t\t\t});\r\n\t\t}\r\n\t\t// also set up DefaultTiddlers\r\n\t\tvar title = \"DefaultTiddlers\";\r\n\t\texisting = store.getTiddler(title) || new Tiddler(title);\r\n\t\tif(existing.fields[\"server.workspace\"] != pubWorkspace) {\r\n\t\t\tvar text = existing.text || store.getShadowTiddlerText(title);\r\n\t\t\tthis.savePublicTiddlerText(title, text, pubWorkspace);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n$(document).bind(\"startup\", plugin.dispatch);\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"privateNotPublicIcon\" server.title=\"privateNotPublicIcon\" server.page.revision=\"1521893\" server.etag=\"&quot;tiddlyspace/privateNotPublicIcon/1521893:8e9c17cb151b0c5aefd10b9a86674a163d2853e4&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"image/png\" modified=\"20131111192334\" created=\"20131111192334\" tags=\"excludeLists excludeSearch\" _hash=\"ec84c2619af08b1c361984baa4e8e871e8ce8946\">\r\n<pre>iVBORw0KGgoAAAANSUhEUgAAADEAAAAwCAYAAAC4wJK5AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAEZ0FNQQAAsY58+1GTAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAOxAAADsQBlSsOGwAACvZJREFUeNrtWWtsW+UZfs6JnfgaO47jOInTXJrSNEkvdOUm2jEXJJC2VaUrEhpopNImfkzA/rAN+NNJY5vGj20a0n4wBIEixsaAafuxSUWG0a6wAqW59ZamaWInTmInduw4ji/n7P2+4+M48SVuWmA/eCXrnGMff+d9vvf9nvd5vwN8Zf8fJlzvAEc9Hs2yD/eJMu6SIXUIELbJQCv9VLXyFGEesjxBx//IsnRZEMXjv3jI/dmXDuLp1zy7IONRcu4BuqzdwIMvy5CPpQTxj79+2O39QkE884pnryzIv6HTPWt/q6iogNlsgkFXBV2VDkKFgEQiCUlKIxKNIRZbQiqVWvu3ZQjy61JS/NmvjrjHPlcQR//sMSWWpT/QXx6kS436vdFgQGNjPerr7NDrdBBFsegYsiwjEonCO+XHzGwAy8uJ3J8XaewfVbrw8lG3O3XDQTxzzHM7OfAXOnWp39lsVmxpa4XVatlQCkiShEn/DK5OeBGNLq4AFXC8Kik8cPSIO3TDQDx9zPMwTeFL6uzr9Tr0dG7lIG6EsehM+CZxceQK0ul0hgdwFZJw+NnvuT8uZ4yKMgBQCkHHrl2NTuze2QOj0XDj6JE8tlRXo6HegdBChFJsmX1tpek9dOeh3rdPvN03t2EQT73qOShAfk0F0NHeips62kvm/PWYVqtBU4MTi4uLiC7G2FcGwnfgjkO9fz35Vt/CNYP46UueVlGU/06nJnbdedNmtLVs4rP2uRYtGt9JEckBYqUp+/rdB3pffe9vfUUXe8FpFTR8DdjZ+SZXE1qaXV9oBd7R0wV7bY16uWdZg+euKRJPv+r5Ps334+ycDbS9u7PsCKRSaWKbGVy64sXZoVFcGJnAyJVJBIJhxBMJWMzGstKRPa+2pga+qWnOYvT0W+862Hvy3+/0ja4LgkmIdIRTqZU9bM/undBqNGUBYM6+f6ofE5OzCIWjvMglkyl+DEcWMTU9h0ujPp77tTXV646n0VDhNJngn55RqXf33Y/3vvBeX59UMp0SPjxIUoLpHjQ3NVLVrVqfIiUZJz8axCdnL/JIqKavImfNOph02lWR+vTsJQ42995ixjLBYbeplz1xL+4pCHiVQ5AfYYnDotDW0lxWBE78d5CKVlCZEVHA/h3NuG1rA5xWA79mNhtewocXpvDuZ+NIpiWa3Tmc+ngYe2/tgSCWTtWO9jbMBOZ4PSG2/Al99c+i6fTjYx5XhYzfMl+cDjuaqCaUk0IXL3uzM//Egd24o7MBZn3lqnVkpGhsbapBh9OMQCCIFouMTbolaBZ8EMJTkOd9kBcobZbCfCqFCoqeqLhWWVlJ6RlGbCnO1kbrHd/pfXEt5WYjoZWlg/R3jZJKTesCSNOC6x8ezUbgh9/chbb6wrkei8Xg8/kwOTmJXXU5KS0TayYzzJmMQ45HIIeneckWrQ0QbMSKWj2llY3IYV5xWOIp9XJBEJIsbhYEmSagQrZYzOvS0ZWrfr5wme3raioIgDHL2NgYJiYm+HmusRk2m8200LVZoNFoVLmPUkeanwRCUxBtzaiz1+P8xcuZVSzdVRQEAdjLQ6/XC+XQ4FxoJaJ7u/Mjx+TD4OAgFhZW7rNYLKR4G0l32TiIvOiSdpqZmeFRi0QiCpjgOKooQiaDHlGS8qSpbi+1sDkrmU3l6aL5UDS7FtgiXqWpqeL29/cjHo8r9+j1aG9vh8PhKK2BqB9paCBScDrh9Xp5FHn/sTiPbosWpxmGjJ/FQNiRYaZyTE0lQ6Umy0LMmONnzpyh35P8uq6uDp2dncT7mrIrNiOF5uZmDnpgYIBHxSwmsY2E8/C8ouVKyg41R8sRbDyXEynKYzm7BlgKqQDq6+vR3d19TQByrYrq1I4dO3gkmTVQwBuNZWinRDJR1gNqrFwbYmk5BX+IizUefp7LrOmurcW2bduuWzSytbN9+3aearxuEH94PB57sXRiCaxLJcvrDG3Was5QvOAN+fDtPc2chdQHd3V1FQUQHQtgbsCLpekwUrEEREpJI9WR2ptbYHTV5N1vNBrR1taGkZERaJVpZ0Xvybxit+/+Rx6mamKXqDSSal13+iwWI9dCLIUmAhE4K2NIxJWIsAgw+lxri955jP7pI0yfvIQlfxjJSBzpeBKpxWV+HTxzFfHZCCwd9VTwVieJiXQUY60MVbf39vb+ri+jo1buFOUPeXosxYXcnrcokxAB7OhqV9YH1ZdISGnAqqlLs9vtefdHRmcx8soJ7mzuAtZSdc8lhtDwJLz/GizIXIyeM8bkxLfy00kS34cg97LT6dkAITeuC6SjrZHUaRC6eBCqHy6XKy+NktFlXHnzNKSUUvCMtdWwtTqho2iq90YDYUwPX0Wa0plFxP61VhgaV/fxjHrHx8fVy3vp886qSKREHGcHLtiCc2UvPCbiXDbdSh9Qm7+PxpxiacMj5axF487N0BMx5II12S1wbF0RnYFPxgquDXWBU9b35LGTsgsnv8nOw+EFqrSR8jidQuCwKJLdYDAUpNMwKdhsMdrcUHTBmxxWiBrFyUXffOF7TCb1tLMgxYqS+KJ6fuHyaPk8uLy49gGrO76YQtsaYiGNrrJkkavQKiCkRGGWVGuGWpzzQPz8EfdxtnnFtdFciOv48nbC0lknCjYtBsXxdDLNc76kOl5W0q5Cpy17DvM1hig8pq6N/uFzclzZB1pnlIqMFEkW/NncVpfdKFuYChYPaCSWrf76unVb2GhREL/8rvu8LAvPKzOXEobOXeAPL60PjFnlWshYEVM7uMCoH/GFWGFROT67AryjrmhvkrHzJbdsqtJ4ig68brBm5OzAUEkgok4pbKwfUJXrqvFsRtTdotQUmeT2xKeXMD8xk02tFOX/7EUvFjJtrs5RjZpuV8H+hD0jE9XSII4ecccpCPdTBR9T6kYQ/YPDeY1N1gwrm8rT09MFb2m6twcWal1VIMzp0Q8GMHpyEFdODHBQ6lpoPbi7YO8dDAZzfThZEgSz5464/SkI+2goLpD8MwGcOv0pq+j5rGKi2iAq1Do1NZXdGF5rbYdvQYN7G90qZtdIKp7IRplpqNZDe6B3Ft5pV7UZL2ui+GZZG8qsId93uPdd6t1ZX2tje0jeST8VHBHV5pxixY4yzVAszJsY1pNYrdaCFGpqqUXtzk1cG0nEVqwuaKv1sPW4sOnAzVwIFrJQKMRVcgb8W/v37+8rCwSzD97q87O9UEnELqY02KyxdeKfnuW+s5cszGlBX63sWEgp/kAGIofTV+ugKi3M7XVcWjhu24y6PW2o7nBAo68s+i6DdYoq+9HzHiXxN76h112Zrf7f86337E6dBg1OBxrrHajWSpC9A7w3Zt+zPqBQRK7VhoaGeO+diebzbrf7sbLfTxSISv+dB3rfEESZSrPQxXdQaJaYRPFN+XF1KgC5ohJWbYqyS+KLnIFhsnwjzREb+9y5c1kAbKuLxnmAopC4rhePqj35ksep0Uq9giw8lNExWdHUShA3W1YGr6mpwZYtW7iAK9cYlZ4/fz7bKZJ5CQAFwT2y4RePJdPsFU+PIEr3SJLYktn6aXXoYe+iTMoQUVbhsr6bHVU1uvbVF3Oa7XSw2c+pTUUB3DAQxYx64U5y5AWm2NeyFIsK+6hpxook26NaW4vo//+ghfwDAuDf8IvHGwTmG+TcE+TwferrszLsY7r/WXL+nXXbgS/yDRDbpSAwh+n0NnKwJyOnXZlNikAmbd6j4xtMG7mv8X32V/Zl2/8AlGCJNTw3pK8AAAAASUVORK5CYII=</pre>\r\n</div>\r\n<div title=\"图片\" server.title=\"图片\" server.page.revision=\"2565019\" server.etag=\"&quot;pearl_public/%E5%9B%BE%E7%89%87/2565019:7a33eeb1ed5f439e09a6c2f60975311818f8466e&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160925072720\" created=\"20160925051405\" tags=\"图片\" _hash=\"5aa1a79d0b72f931320594c04068a13e34bb03d8\">\r\n<pre> '图片'\r\n&lt;html&gt;\r\n&lt;head&gt;\r\n      &lt;title&gt;第一个HTML代码&lt;/title&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n&lt;div align=\"center\"&gt;\r\n&lt;img src=\"http://dl.bizhi.sogou.com/images/1600x900/2014/04/30/596243.jpg\" hight=\"500\" width=\"500\" &gt;&lt;br/&gt;\r\n&lt;/div&gt;\r\n&lt;hr width=\"800\" color=\"pink\" size\"10\"/&gt;\r\n\r\n&lt;/body&gt;\r\n&lt;/html&gt;</pre>\r\n</div>\r\n<div title=\"ImportTiddlers\" server.title=\"ImportTiddlers\" server.page.revision=\"2582759\" server.etag=\"&quot;pearl_public/ImportTiddlers/2582759:ac86cda995f515c199dfd2524d486151f7b9bf9a&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20161108123518\" created=\"20161108123518\" tags=\"\" _hash=\"4bcb0c7e93ab324261b8b2482254c53db7d78258\">\r\n<pre>&lt;&lt;importTiddlers&gt;&gt;\r\n</pre>\r\n</div>\r\n<div title=\"TiddlySpaceLinkPlugin\" server.title=\"TiddlySpaceLinkPlugin\" server.page.revision=\"1521865\" server.etag=\"&quot;system-plugins_public/TiddlySpaceLinkPlugin/1521865:52f27a7a05aaab99f3e9513c970fb4d2fd932579&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-plugins_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-plugins_public\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"b88cfa8ccd99b328c34b54aa9371c8f9ce02ffaf\">\r\n<pre>/***\r\n|''Name:''|TiddlySpaceLinkPlugin|\r\n|''Description:''|Formatter to reference other spaces from wikitext |\r\n|''Author:''|PaulDowney (psd (at) osmosoft (dot) com) |\r\n|''Source:''|http://github.com/TiddlySpace/tiddlyspace/raw/master/src/plugins/TiddlySpaceLinkPlugin.js|\r\n|''Version:''|1.4.2|\r\n|''License:''|[[BSD License|http://www.opensource.org/licenses/bsd-license.php]] |\r\n|''Comments:''|Please make comments at http://groups.google.co.uk/group/TiddlyWikiDev |\r\n|''~CoreVersion:''|2.4|\r\n!!Documentation\r\nThis plugin provides wikitext formatters for referencing another [[space|Space]] on the same TiddlySpace server, as in the following examples:\r\n&lt;&lt;&lt;\r\n  {{{@space}}} -- @space \r\n  {{{~@space}}} -- ~@space \r\n  {{{Tiddler@space}}} -- Tiddler@space\r\n  {{{[[Tiddler Title]]@space}}} -- [[Tiddler Title]]@space \r\n  {{{[[Link text|Tiddler Title]]@space}}} -- [[Link text|Tiddler Title]]@space\r\n&lt;&lt;&lt;\r\nLinks to tiddlers with a title begining with an \"@\" remain as tiddlyLinks:\r\n&lt;&lt;&lt;\r\n  {{{[[@tiddler]]}}} -- [[@tiddler]]\r\n&lt;&lt;&lt;\r\nand these may be changed into a space link using {{{@@}}}:\r\n&lt;&lt;&lt;\r\n  {{{[[@@space]]}}} -- [[@@space]]\r\n  {{{[[Link to an another space|@@space]]}}} -- [[Link to another space|@@space]]\r\n  {{{[[@space|@@space]]}}} -- [[@space|@@space]]\r\n&lt;&lt;&lt;\r\nTiddlySpace includes the [[TiddlySpaceLinkPlugin]] which provides WikiText markup for linking to other spaces on the same server. For example @glossary is a link to the {{{glossary}}} space and [[Small Trusted Group]]@glossary a link to an individual tiddler in the @glossary space. Prefixing the link with a tilde escapes the link, for example {{{~@space}}}.\r\nEmail addresses, for example joe.bloggs@example.com and mary@had.a.little.lamb.org should be unaffected.\r\n!!Features\r\nThe plugin provides external links decorated so that other plugins may be included to add features such as the ability to dynamically pull externally linked tiddlers into the current TiddlyWiki.\r\nWikitext linking to a space on another server, for example from a tiddler in a space on tiddlyspace.com to a tiddler or a space on example.com, isn't currently supported. \r\n!!Code\r\n***/\r\n//{{{\r\n/*jslint onevar: false nomen: false plusplus: false */\r\n/*global jQuery config createTiddlyText createExternalLink createTiddlyLink */\r\n\r\nfunction createSpaceLink(place, spaceName, title, alt, isBag) {\r\n\tvar link, a, currentSpaceName, label;\r\n\ttry {\r\n\t\tif (spaceName === config.extensions.tiddlyspace.currentSpace.name) {\r\n\t\t\ttitle = title || spaceName;\r\n\t\t\ta = createTiddlyLink(place, title, false);\r\n\t\t\tjQuery(a).text(alt || title);\r\n\t\t\treturn a;\r\n\t\t}\r\n\t} catch (ex1) {\r\n\t\tcurrentSpaceName = false;\r\n\t}\r\n\r\n\ta = jQuery(\"&lt;a /&gt;\").addClass('tiddlySpaceLink externalLink').appendTo(place)[0];\r\n\tif(title) {\r\n\t\tjQuery(a).attr('tiddler', title);\r\n\t}\r\n\tif(isBag) {\r\n\t\tjQuery(a).attr('bag', spaceName);\r\n\t} else {\r\n\t\tjQuery(a).attr('tiddlyspace', spaceName);\r\n\t}\r\n\r\n\tconfig.extensions.tiddlyweb.getStatus(function(status) {\r\n\t\tlink = status.server_host.url;\r\n\t\tif (title) {\r\n\t\t\tlabel = alt || title;\r\n\t\t\tlink = link + \"/\" + encodeURIComponent(title);\r\n\t\t} else {\r\n\t\t\tlabel = alt || spaceName;\r\n\t\t}\r\n\t\t// assumes a http URI without user:pass@ prefix\r\n\t\tif(!isBag) {\r\n\t\t\tlink = link.replace(\"http://\", \"http://\" + spaceName.toLowerCase() + \".\");\r\n\t\t} else {\r\n\t\t\tlink += \"/bags/\" + spaceName + \"/tiddlers.wiki\";\r\n\t\t}\r\n\t\tjQuery(a).attr(\"href\", link).text(label);\r\n\t});\r\n\treturn a;\r\n}\r\n\r\n(function ($) {\r\n\r\n\tconfig.textPrimitives.spaceName = \"[a-zA-Z][a-zA-Z0-9-]*[a-zA-Z0-9]\";\r\n\tconfig.textPrimitives.spaceNameStrict = \"[a-z][a-z0-9-]*\";\r\n\tconfig.textPrimitives.bareTiddlerLetter = config.textPrimitives.anyLetterStrict;\r\n\r\n\tconfig.formatters.splice(0, 0, {\r\n\t\tname: \"spacenameLink\",\r\n\t\tmatch: config.textPrimitives.unWikiLink + \"?\" + config.textPrimitives.bareTiddlerLetter + \"*@\" + config.textPrimitives.spaceName + \"\\\\.?.?\",\r\n\t\tlookaheadRegExp: new RegExp(config.textPrimitives.unWikiLink + \"?(\" + config.textPrimitives.bareTiddlerLetter + \"*)@(\" + config.textPrimitives.spaceName + \")\", \"mg\"),\r\n\t\thandler: function (w) {\r\n\t\t\tif (w.matchText.substr(w.matchText.length - 2, 1) === '.' &amp;&amp; w.matchText.substr(w.matchText.length - 1, 1).match(/[a-zA-Z]/)) {\r\n\t\t\t\tw.outputText(w.output, w.matchStart, w.nextMatch);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (w.matchText.substr(0, 1) === config.textPrimitives.unWikiLink) {\r\n\t\t\t\tw.outputText(w.output, w.matchStart + 1, w.nextMatch);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.lookaheadRegExp.lastIndex = w.matchStart;\r\n\t\t\tvar lookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\t\tif (lookaheadMatch &amp;&amp; lookaheadMatch.index === w.matchStart) {\r\n\t\t\t\tcreateSpaceLink(w.output, lookaheadMatch[2], lookaheadMatch[1]);\r\n\t\t\t\tw.nextMatch = this.lookaheadRegExp.lastIndex;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"tiddlySpaceLink\",\r\n\t\tmatch: \"\\\\[\\\\[[^\\\\|\\\\]]*\\\\|*@@\" + config.textPrimitives.spaceName + \"\\\\]\",\r\n\t\tlookaheadRegExp: new RegExp(\"\\\\[\\\\[(.*?)(?:\\\\|@@(.*?))?\\\\]\\\\]\", \"mg\"),\r\n\t\thandler: function (w) {\r\n\t\t\tthis.lookaheadRegExp.lastIndex = w.matchStart;\r\n\t\t\tvar lookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\t\tif (lookaheadMatch &amp;&amp; lookaheadMatch.index === w.matchStart) {\r\n\t\t\t\tvar alt = lookaheadMatch[2] ? lookaheadMatch[1] : lookaheadMatch[1].replace(/^@@/, \"\");\r\n\t\t\t\tvar space = lookaheadMatch[2] || alt;\r\n\t\t\t\tcreateSpaceLink(w.output, space, \"\", alt);\r\n\t\t\t\tw.nextMatch = this.lookaheadRegExp.lastIndex;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tname: \"tiddlyLinkSpacenameLink\",\r\n\t\tmatch: \"\\\\[\\\\[[^\\\\[]*\\\\]\\\\]@\",\r\n\t\tlookaheadRegExp: new RegExp(\"\\\\[\\\\[(.*?)(?:\\\\|(.*?))?\\\\]\\\\]@(\" + config.textPrimitives.spaceName + \")\", \"mg\"),\r\n\t\thandler: function (w) {\r\n\t\t\tthis.lookaheadRegExp.lastIndex = w.matchStart;\r\n\t\t\tvar lookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\t\tif (lookaheadMatch &amp;&amp; lookaheadMatch.index === w.matchStart) {\r\n\t\t\t\tvar title = lookaheadMatch[2] || lookaheadMatch[1];\r\n\t\t\t\tvar alt = lookaheadMatch[1] || lookaheadMatch[2];\r\n\t\t\t\tcreateSpaceLink(w.output, lookaheadMatch[3], title, alt);\r\n\t\t\t\tw.nextMatch = this.lookaheadRegExp.lastIndex;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t// ensure space links don't appear as missing links\r\n\tconfig.textPrimitives.brackettedLink = \"\\\\[\\\\[([^\\\\]][^@\\\\]][^\\\\]]*)\\\\]\\\\](?=[^@])\";\r\n\tconfig.textPrimitives.titledBrackettedLink = \"\\\\[\\\\[([^\\\\[\\\\]\\\\|]+)\\\\|([^\\\\[\\\\]\\\\|]+)\\\\]\\\\](?=[^@])\";\r\n\r\n\t// reevaluate derrived expressions ..\r\n\tconfig.textPrimitives.tiddlerForcedLinkRegExp = new RegExp(\"(?:\" + config.textPrimitives.titledBrackettedLink + \")|(?:\" +\r\n\t\tconfig.textPrimitives.brackettedLink + \")|(?:\" +\r\n\t\tconfig.textPrimitives.urlPattern + \")\",\"mg\");\r\n\tconfig.textPrimitives.tiddlerAnyLinkRegExp = new RegExp(\"(\"+ config.textPrimitives.wikiLink + \")|(?:\" +\r\n\t\tconfig.textPrimitives.titledBrackettedLink + \")|(?:\" +\r\n\t\tconfig.textPrimitives.brackettedLink + \")|(?:\" +\r\n\t\tconfig.textPrimitives.urlPattern + \")\",\"mg\");\r\n\r\n\t// treat space links in titledBracketedLink as external links\r\n\tvar missingTiddlySpaceLink = new RegExp(\"^@@\" + config.textPrimitives.spaceName + \"$\", \"\");\r\n\tvar isExternalLink = config.formatterHelpers.isExternalLink;\r\n\tconfig.formatterHelpers.isExternalLink = function(link) {\r\n\t\treturn missingTiddlySpaceLink.test(link) || isExternalLink(link);\r\n\t};\r\n\r\n}(jQuery));\r\n//}}}</pre>\r\n</div>\r\n<div title=\"ToolbarCommands\" server.title=\"ToolbarCommands\" server.page.revision=\"1521884\" server.etag=\"&quot;tiddlyspace/ToolbarCommands/1521884:f13336b1fbba6dde73bceb31d845a086ba49d8fd&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192334\" created=\"20131111192334\" tags=\"excludeLists excludeSearch\" _hash=\"b4c48a116434073fe3dd125db8ac7616ac920c98\">\r\n<pre>|~ViewToolbar|+editTiddler +cloneTiddler &gt; fields refreshTiddler changeToPublic changeToPrivate revisions syncing permalink references jump closeOthers &lt; closeTiddler|\r\n|~EditToolbar|+saveTiddler saveDraft -cancelTiddler deleteTiddler|\r\n|~RevisionToolbar|&gt; fields revert|</pre>\r\n</div>\r\n<div title=\"unsyncedIcon\" server.title=\"unsyncedIcon\" server.page.revision=\"1521924\" server.etag=\"&quot;system-images_public/unsyncedIcon/1521924:39f4c78cecb2c626b3bbda3d8eeea2b00dd5582e&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-images_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-images_public\" server.permissions=\"read\" server.content-type=\"image/png\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch\" _hash=\"f130b8a5de4a2cd9ab4d23a6fc3e9a8d83d1b7b3\">\r\n<pre>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</pre>\r\n</div>\r\n<div title=\"课文翻译（修改版）\" server.title=\"课文翻译（修改版）\" server.page.revision=\"2565013\" server.etag=\"&quot;pearl_public/%E8%AF%BE%E6%96%87%E7%BF%BB%E8%AF%91%EF%BC%88%E4%BF%AE%E6%94%B9%E7%89%88%EF%BC%89/2565013:c92b495ccc878903c6e6d80b7d2164719b49d6a7&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160925071429\" created=\"20160925062225\" tags=\"作业\" _hash=\"cf859037b1f1de1dfc51e062f086b414a30e9a53\">\r\n<pre>方法和目的：\r\n     这本书的目的是为了给大家提供一个关于信息管理更全面的认知，依据我们对于David kolb论述的充分理解，知识可以划分为两个基本的维度：（抽象对具体，思索对实验），并且研究是一个在这些维度之间渐进循环的过程。\r\n     1.抽象的认知：这就意味着一些基本的术语是能够被解释的，在每一个章节中，他们通过对信息和情报的见解的不同看法进行解释，为了一种信息管理的方法进行一次关于它的主要的哲学思想和含义的讨论。\r\n    2.实验：我们向读者发起挑战，通过提供给他们信息管理的方法和技术与描述，去应用信息管理的概念。\r\n    3.具体的经验：我们通过抽象的哲学观点和有关信息管理的方法和技术去解决日常问题来论证它的实用性。在这本书通过读者提供自己需要去使用工具去分析具体问题的一些实际的例子与任务进行学习。\r\n    4.反思：我们向读者发起挑战，用一种批判性的方法思考他们在任务中读到和审判了什么，我们邀请他们去发现他们未来的学习生涯中的挑战，一个好的方法是通过团队的影响，当然一个适当的方法是建立一个提供情报的平台去讨论他们所读和所做的事情，这个很容易去做，第一步是学习理解提供情报的挑战，也就是避免错误的和无意义的情报，而是通过电子技术的方法来获得实际的知识。谷歌就提供了一些好的机会（看这章的末尾）。\r\n\r\n读完这本书，读者将会：\r\n    1.理解和分辨对信息管理的不同方法，它们的优势和劣势，并且提供独特的方法。\r\n    2.学习构建简单的经验和管理之间的关系的模型，说明信息需要经营管理和公共政策的共同执行。\r\n    3.理解一个主要的问题，就是转变抽象的信息需要具体的信息收集、处理和规程表示法。\r\n    4.理解一些在组织上复杂的信息管理，和在组织上用信息系统的挑战，可能是全部中最重要的。\r\n    5.形成思考和分析的能力去论证信息、情报、信息管理和信息技术的用法。这个能力会对你的整个职业生涯有帮助，并且使你能够精密的去判断和获得未来的新信息的机会。比如说我的目标在于讨论信息管理像是与生俱来的人类本能，而不是靠技术的支持。\r\n\r\n这些课程、洞察力和技巧是经营管理、公共管理、社会科学和经济学的大学生的基本能力，但是这本书同样也适合于每个对信息和情报的基本原来感兴趣的人。\r\n</pre>\r\n</div>\r\n<div title=\"SiteSubtitle\" server.title=\"SiteSubtitle\" server.page.revision=\"2564677\" server.etag=\"&quot;pearl_public/SiteSubtitle/2564677:83278879c8e8d5c59c0de37fffed44342b74f1e6&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160925033048\" created=\"20160925033048\" tags=\"\" _hash=\"afdaf29deea05c9f14d8d42589d9e66f0268523d\">\r\n<pre>如果命运是条孤独的河流，谁会是你灵魂的摆渡者</pre>\r\n</div>\r\n<div title=\"TiddlySpaceRevisionView\" server.title=\"TiddlySpaceRevisionView\" server.page.revision=\"1521859\" server.etag=\"&quot;system-plugins_public/TiddlySpaceRevisionView/1521859:af6492ee5e25abd841c12ffa9a5e057e25ca07cf&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-plugins_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-plugins_public\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeMissing excludeSearch systemConfig\" _hash=\"be83cfafd902bff89908e6f74d71228655be3490\">\r\n<pre>/***\r\n|''Name''|TiddlySpaceRevisionView|\r\n|''Description''|Show tiddler revisions in a stack of cards view|\r\n|''Author''|BenGillies|\r\n|''Version''|0.2.0|\r\n|''Status''|beta|\r\n|''Source''|http://github.com/TiddlySpace/tiddlyspace|\r\n|''CodeRepository''|http://github.com/TiddlySpace/tiddlyspace|\r\n|''License''|[[BSD|http://www.opensource.org/licenses/bsd-license.php]]|\r\n|''CoreVersion''|2.6.0|\r\n|''Requires''|TiddlyWebAdaptor|\r\n!Usage\r\nThe viewRevisions macro can be attached to any element, which should be passed\r\nin as a parameter.\r\n\r\nFor example:\r\n\r\n&amp;lt;&amp;lt;viewRevisions page:10 link:\"&lt;&lt;view modified date&gt;&gt;\"&amp;gt;&amp;gt;\r\n\r\nwould show the revisions \"stack of cards\" view, 10 at a time, when the modified\r\ndate is clicked.\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nvar me = config.macros.viewRevisions = {\r\n\trevisionTemplate: \"RevisionTemplate\",\r\n\trevSuffix: \" [rev. #%0]\", // text to append to each tiddler title\r\n\tdefaultPageSize: 5, // default number of revisions to show\r\n\tdefaultLinkText: \"View Revisions\", // when there's nothing else to use\r\n\toffsetTop: 30, // in px\r\n\toffsetLeft: 10, // in px\r\n\tshiftDownDelay: 50, // in ms\r\n\tvisibleSlideAmount: 20, // amount of revisions to show on left hand edge after sliding\r\n\tzIndex: 100, // default z-index\r\n\thandler: function(place, macroName, params, wikifier, paramString, tiddler) {\r\n\t\tparams = paramString.parseParams(null, null, true)[0];\r\n\t\tvar tiddlerElem = story.findContainingTiddler(place);\r\n\r\n\t\tvar revButton;\r\n\t\tvar pageSize = parseInt(params.page[0], 10) || me.defaultPageSize;\r\n\t\tvar linkObj = params.link ? params.link[0] || me.defaultLinkText : false;\r\n\t\tif(linkObj) {\r\n\t\t\trevButton = $('&lt;span class=\"button openRevisions\" /&gt;')\r\n\t\t\t\t.appendTo(place);\r\n\t\t\twikify(linkObj, revButton[0], null, tiddler);\r\n\t\t} else {\r\n\t\t\trevButton = place;\r\n\t\t}\r\n\r\n\t\t$(revButton).click(function() {\r\n\t\t\tif (!$(tiddlerElem).hasClass(\"revisions\")) {\r\n\t\t\t\tme.showRevisions(tiddlerElem, tiddler, pageSize);\r\n\t\t\t} else {\r\n\t\t\t\tme.closeRevisions(tiddlerElem);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t// initialisation for revision view\r\n\tshowRevisions: function(tiddlerElem, tiddler, pageSize) {\r\n\t\tvar context = {\r\n\t\t\thost: tiddler.fields[\"server.host\"],\r\n\t\t\tworkspace: tiddler.fields[\"server.workspace\"]\r\n\t\t};\r\n\t\t$(tiddlerElem).addClass(\"revisions\").attr(\"revName\", tiddler.title);\r\n\t\t// ensure toolbar commands deactivate RevisionsView\r\n\t\t$(\"a\", \".toolbar\", tiddlerElem).each(function(index, btn) {\r\n\t\t\tvar _onclick = btn.onclick;\r\n\t\t\tbtn.onclick = function(e) {\r\n\t\t\t\tme.closeRevisions(tiddlerElem);\r\n\t\t\t\t_onclick.apply(this, arguments);\r\n\t\t\t};\r\n\t\t});\r\n\t\t// ensure default action deactivates RevisionsView\r\n\t\tvar _ondblclick = tiddlerElem.ondblclick;\r\n\t\ttiddlerElem.ondblclick = function(e) {\r\n\t\t\tme.closeRevisions(tiddlerElem);\r\n\t\t\t_ondblclick.apply(this, arguments);\r\n\t\t};\r\n\t\tvar type = tiddler.fields[\"server.type\"];\r\n\t\tvar adaptor = new config.adaptors[type]();\r\n\t\tvar userParams = {\r\n\t\t\ttiddlerElem: tiddlerElem,\r\n\t\t\tpageSize: pageSize,\r\n\t\t\ttitle: tiddler.title\r\n\t\t};\r\n\t\tme.createCloak(tiddlerElem);\r\n\t\tadaptor.getTiddlerRevisionList(tiddler.title, null, context, userParams,\r\n\t\t\t\tfunction(context, userParams) {\r\n\t\t\t\t\t// strip the current revision\r\n\t\t\t\t\tcontext.revisions.shift();\r\n\t\t\t\t\tme.expandStack(context, userParams);\r\n\t\t\t\t});\r\n\t},\r\n\r\n\t// fetch the actual revision and put it in the tiddler div\r\n\tshowRevision: function(place, revision, callback) {\r\n\t\tvar context = {\r\n\t\t\thost: revision.fields[\"server.host\"],\r\n\t\t\tworkspace: revision.fields[\"server.workspace\"]\r\n\t\t};\r\n\t\tvar userParams = {\r\n\t\t\trevElem: place\r\n\t\t};\r\n\t\tvar type = revision.fields[\"server.type\"];\r\n\t\tvar adaptor = new config.adaptors[type]();\r\n\t\tvar revNo = revision.fields[\"server.page.revision\"];\r\n\t\tadaptor.getTiddlerRevision(revision.title, revNo, context, userParams,\r\n\t\t\tfunction(context, userParams) {\r\n\t\t\t\tvar tiddler = context.tiddler;\r\n\t\t\t\ttiddler.title += me.revSuffix\r\n\t\t\t\t\t.format([$(place).attr(\"revision\")]);\r\n\t\t\t\ttiddler.fields.doNotSave = true;\r\n\t\t\t\tif (store.getTiddler(tiddler.title)) {\r\n\t\t\t\t\tstore.deleteTiddler(tiddler.title);\r\n\t\t\t\t}\r\n\t\t\t\tstore.addTiddler(tiddler);\r\n\r\n\t\t\t\t//now, populate the existing div\r\n\t\t\t\tvar revElem = userParams.revElem;\r\n\t\t\t\t$(revElem).attr(\"id\", story.tiddlerId(tiddler.title));\r\n\t\t\t\t$(revElem).attr(\"refresh\", \"tiddler\");\r\n\t\t\t\tvar getTemplate = function() {\r\n\t\t\t\t\tvar themeName = config.options.txtTheme;\r\n\t\t\t\t\tif (themeName) {\r\n\t\t\t\t\t\treturn store.getTiddlerSlice(themeName,\r\n\t\t\t\t\t\t\tme.revisionTemplate) || me.revisionTemplate ||\r\n\t\t\t\t\t\t\t\"ViewTemplate\";\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn (store.getTiddler(me.revisionTemplate)) ?\r\n\t\t\t\t\t\t\tme.revisionTemplate : \"ViewTemplate\";\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tvar template = getTemplate();\r\n\t\t\t\tstory.refreshTiddler(tiddler.title, template, true);\r\n\t\t\t\tcallback(tiddler);\r\n\t\t\t});\r\n\t},\r\n\r\n\tcreateCloak: function(promoteElem) {\r\n\t\tvar el = $(promoteElem);\r\n\t\t// cache styles for resetting later\r\n\t\tel.data({\r\n\t\t\ttop: el.css(\"top\"),\r\n\t\t\tleft: el.css(\"left\"),\r\n\t\t\tzIndex: el.css(\"z-index\")\r\n\t\t});\r\n\r\n\t\t$('&lt;div class=\"revisionCloak\" /&gt;').css(\"z-index\", me.zIndex)\r\n\t\t\t.click(function() {\r\n\t\t\t\tme.closeRevisions(promoteElem);\r\n\t\t\t})\r\n\t\t\t.appendTo(document.body);\r\n\r\n\t\tel.css(\"z-index\", me.zIndex + 1);\r\n\t},\r\n\r\n\t// clean up, removing all evidence of revision view\r\n\tcloseRevisions: function(promoteElem) {\r\n\t\tvar el = $(promoteElem);\r\n\t\t// revert the original tiddler back to its previous state\r\n\t\tel.removeAttr(\"revName\").removeClass(\"revisions\").css({\r\n\t\t\ttop: el.data(\"top\"),\r\n\t\t\tleft: el.data(\"left\"),\r\n\t\t\tzIndex: el.data(\"zIndex\")\r\n\t\t});\r\n\r\n\t\t// remove any revisions still in the store\r\n\t\tvar revisions = $(\".revisions\");\r\n\t\trevisions.each(function(index, revision) {\r\n\t\t\tvar revAttributes = revision.attributes;\r\n\t\t\tif ((revAttributes.revname) &amp;&amp;\r\n\t\t\t\t\t(revAttributes.revision)) {\r\n\t\t\t\tvar revName = revAttributes.revname.value;\r\n\t\t\t\tvar revNo = revAttributes.revision.value;\r\n\t\t\t\tvar title = revName + me.revSuffix.format([revNo]);\r\n\r\n\t\t\t\tif (store.getTiddler(title)) {\r\n\t\t\t\t\tstore.deleteTiddler(title);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// delete the previous revisions\r\n\t\trevisions.remove();\r\n\r\n\t\t// remove the cloak\r\n\t\t$(\".revisionCloak\").remove();\r\n\t},\r\n\r\n\t// calback from getting list of revisions\r\n\texpandStack: function(context, userParams) {\r\n\t\tvar pageSize = userParams.pageSize;\r\n\r\n\t\tvar from = userParams.from || 0;\r\n\t\tvar tiddlerElem = userParams.tiddlerElem;\r\n\r\n\t\tuserParams.defaultHeight = $(tiddlerElem).height();\r\n\t\tuserParams.defaultWidth = $(tiddlerElem).width();\r\n\t\tif (from &lt; context.revisions.length) {\r\n\t\t\tme.displayNextRevision(tiddlerElem, userParams, context, from,\r\n\t\t\t\tfrom + pageSize - 1);\r\n\t\t}\r\n\t},\r\n\r\n\t// place the next div above and behind the previous one\r\n\tdisplayNextRevision: function(tiddlerElem, userParams, context, from, to) {\r\n\t\tvar revision = context.revisions[from];\r\n\t\tvar callback = function() {\r\n\t\t\tvar revText = revBtn.getRevisionText(tiddlerElem, revision);\r\n\t\t\ttiddlerElem = me.createRevisionObject(tiddlerElem, context,\r\n\t\t\t\tuserParams, revText);\r\n\t\t\t$(tiddlerElem)\r\n\t\t\t\t.attr(\"revision\", (context.revisions.length - from));\r\n\t\t\tif ((from &lt; to) &amp;&amp; ((from + 1) &lt; context.revisions.length)){\r\n\t\t\t\tme.displayNextRevision(tiddlerElem, userParams, context,\r\n\t\t\t\t\tfrom + 1, to);\r\n\t\t\t} else if ((context.revisions.length - 1) &gt; to) {\r\n\t\t\t\tme.showMoreButton(tiddlerElem, context, userParams, to + 1);\r\n\t\t\t}\r\n\t\t};\r\n\t\tme.shiftVisibleDown(userParams.title, callback);\r\n\t},\r\n\r\n\tcreateRevisionObject: function(tiddlerElem, context, userParams, text) {\r\n\t\tvar newPosition = me.calculatePosition(tiddlerElem, context);\r\n\t\treturn $('&lt;div class=\"revisions tiddler\" /&gt;')\r\n\t\t\t.css({\r\n\t\t\t\tposition: \"absolute\",\r\n\t\t\t\ttop: newPosition.top,\r\n\t\t\t\tleft: newPosition.left,\r\n\t\t\t\t\"z-index\": me.zIndex + 1,\r\n\t\t\t\theight: userParams.defaultHeight,\r\n\t\t\t\twidth: userParams.defaultWidth\r\n\t\t\t})\r\n\t\t\t.attr(\"revName\", userParams.title)\r\n\t\t\t.append(text)\r\n\t\t\t.insertBefore(tiddlerElem);\r\n\t},\r\n\r\n\t// move the already present revisions down by 1 to fit the next one in\r\n\tshiftVisibleDown: function(title, callback) {\r\n\t\tvar revisions = $(\"[revName='%0'].revisions\".format([title]));\r\n\t\tvar revisionCount = revisions.length;\r\n\r\n\t\t$(revisions).animate({top: \"+=\" + me.offsetTop},\r\n\t\t\t\tme.shiftDownDelay, function() {\r\n\t\t\t\t\trevisionCount -= 1;\r\n\t\t\t\t\tif ((callback) &amp;&amp; (!revisionCount)) {\r\n\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t},\r\n\r\n\t// where we put the new revision\r\n\tcalculatePosition: function(elem, context) {\r\n\t\tvar offset = $(elem).offset();\r\n\t\tvar currentPosition = $(elem).position();\r\n\t\tvar newPosition = {\r\n\t\t\ttop: currentPosition.top - me.offsetTop\r\n\t\t};\r\n\t\tif ((context.restrictLeft) ||\r\n\t\t\t\t((offset.left - me.offsetLeft) &lt;\r\n\t\t\t\t$(\"#contentWrapper\").offset().left)) {\r\n\t\t\tnewPosition.left = $(elem).position().left;\r\n\t\t\tcontext.restrictLeft = true;\r\n\t\t} else {\r\n\t\t\tnewPosition.left = currentPosition.left - me.offsetLeft;\r\n\t\t}\r\n\t\treturn newPosition;\r\n\t},\r\n\r\n\t// equivalent of displayNextRevision, but for the more button\r\n\tshowMoreButton: function(tiddlerElem, context, userParams, moreIndex) {\r\n\t\tuserParams.from = moreIndex + 1;\r\n\t\tme.shiftVisibleDown(userParams.title, function() {\r\n\t\t\tvar btn = me.createRevisionObject(tiddlerElem, context, userParams,\r\n\t\t\t\t\"\");\r\n\r\n\t\t\tvar more = createTiddlyButton(btn[0], \"more...\", \"show more revisions\",\r\n\t\t\t\tfunction() {\r\n\t\t\t\t\tif ($(\".viewRevision\").length) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tuserParams.tiddlerElem = btn[0];\r\n\t\t\t\t\t$(btn).text(\"\")\r\n\t\t\t\t\t\t.append(revBtn\r\n\t\t\t\t\t\t\t.getRevisionText(btn[0], context.revisions[moreIndex]))\r\n\t\t\t\t\t\t.attr(\"revision\", context.revisions.length - moreIndex);\r\n\t\t\t\t\tme.expandStack(context, userParams);\r\n\t\t\t\t});\r\n\t\t\t$(more).css(\"float\", \"right\");\r\n\t\t});\r\n\t},\r\n\r\n\tstripRevFromTitle: function(revisionTitle) {\r\n\t\treturn revisionTitle.split(/ ?\\[rev\\. #[0-9]+\\]$/)[0];\r\n\t},\r\n\r\n\tonClickRevision: function(revElem, revision, callback) {\r\n\t\t// don't do anything if we are still loading\r\n\t\tif ($(\".revisions\").hasClass(\"loading\")) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar origTitle = me.stripRevFromTitle(revision.title);\r\n\t\tif ($(revElem).hasClass(\"viewRevision\")) {\r\n\t\t\t$(\".revisions\").addClass(\"loading\");\r\n\t\t\tme.slideIn(revElem, revision, origTitle, function() {\r\n\t\t\t\tstore.deleteTiddler(revision.title);\r\n\t\t\t\trevision.title = origTitle;\r\n\t\t\t\t$(revElem).text(\"\").append(revBtn.getRevisionText(revElem,\r\n\t\t\t\t\t\trevision))\r\n\t\t\t\t\t.removeAttr(\"tags\").removeAttr(\"tiddler\")\r\n\t\t\t\t\t.removeAttr(\"refresh\").removeAttr(\"template\")\r\n\t\t\t\t\t.removeAttr(\"id\");\r\n\t\t\t\t$(\".revisions\").removeClass(\"loading\");\r\n\t\t\t\tif (callback) {\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$(revElem).removeAttr(\"prevPos\").removeClass(\"viewRevision\");\r\n\t\t} else {\r\n\t\t\tvar viewRevision = function() {\r\n\t\t\t\tvar prevPos = $(revElem).position().left;\r\n\t\t\t\t$(revElem).addClass(\"viewRevision\").attr(\"prevPos\", prevPos);\r\n\t\t\t\t$(\".revisions\").addClass(\"loading\");\r\n\t\t\t\tme.showRevision(revElem, revision, function(rev) {\r\n\t\t\t\t\tme.slideOut(revElem, rev, origTitle, function() {\r\n\t\t\t\t\t\t$(\".revisions\").removeClass(\"loading\");\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\t// make sure another revision isn't already out\r\n\t\t\tif ($(\".viewRevision\").length) {\r\n\t\t\t\tvar newRevElem = $(\".viewRevision\")[0];\r\n\t\t\t\tvar newRevision = store.getTiddler($(newRevElem)\r\n\t\t\t\t\t.attr(\"tiddler\"));\r\n\t\t\t\tme.onClickRevision(newRevElem, newRevision, viewRevision);\r\n\t\t\t} else {\r\n\t\t\t\tviewRevision();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tslideOut: function(revElem, revision, title, callback) {\r\n\t\tvar leftMostPos = $(\"[revName='%0'].revisions\".format([title]))\r\n\t\t\t.offset().left;\r\n\t\tvar width = $(revElem).width();\r\n\t\tvar originalLeftPos = $(story.getTiddler(title))\r\n\t\t\t.position().left;\r\n\r\n\t\tvar slideAmount = leftMostPos + width - me.visibleSlideAmount;\r\n\t\t$(\"[revName='%0'].revisions:not(.viewRevision)\".format([title]))\r\n\t\t\t.animate({left: \"-=\" + slideAmount}, 1000);\r\n\t\t$(revElem)\r\n\t\t\t.attr(\"baseHeight\", $(revElem).css(\"height\"))\r\n\t\t\t.css(\"height\", \"auto\")\r\n\t\t\t.animate({left: originalLeftPos}, 1000, callback);\r\n\t},\r\n\r\n\tslideIn: function(revElem, revision, title, callback) {\r\n\t\tvar slideAmount = $(revElem).offset().left -\r\n\t\t\t$(story.getTiddler(title)).offset().left;\r\n\t\tvar origRevPos = $(revElem).attr(\"prevPos\");\r\n\r\n\t\t$(\"[revName='%0'].revisions:not(.viewRevision)\".format([title]))\r\n\t\t\t.animate({left: \"+=\" + slideAmount}, 1000);\r\n\t\t$(revElem).animate({left: origRevPos}, 1000, function() {\r\n\t\t\t$(revElem)\r\n\t\t\t\t.css(\"height\", $(revElem).attr(\"baseHeight\"))\r\n\t\t\t\t.removeAttr(\"baseHeight\");\r\n\t\t\tcallback();\r\n\t\t});\r\n\t}\r\n};\r\n\r\nvar revBtn;\r\nconfig.macros.slideRevision = revBtn = {\r\n\tbtnText: \"created by %0 at %1 on %2\",\r\n\thandler: function(place, macroName, params, wikifier, paramString, tiddler) {\r\n\t\tvar btn = revBtn.getRevisionText(place, tiddler);\r\n\t\t$(place).append(btn);\r\n\t},\r\n\r\n\tgetRevisionText: function(place, revision) {\r\n\t\tvar text = revBtn.btnText.format([revision.modifier,\r\n\t\t\trevision.modified.formatString(\"0hh:0mm\"),\r\n\t\t\trevision.modified.formatString(\"0DD MMM YYYY\")]);\r\n\t\tvar btn = $('&lt;a href=\"javascript:;\" class=\"button revButton\" /&gt;')\r\n\t\t\t.text(text)\r\n\t\t\t.click(function() {\r\n\t\t\t\tvar revElem = story.findContainingTiddler(this);\r\n\t\t\t\tme.onClickRevision(revElem, revision);\r\n\t\t\t});\r\n\t\treturn btn;\r\n\t}\r\n};\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"StyleSheet\" server.title=\"StyleSheet\" server.page.revision=\"1521913\" server.etag=\"&quot;system-theme_public/StyleSheet/1521913:ce84d7fd60bc3031708b0bf89962eb12b0428dbe&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-theme_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-theme_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch\" _hash=\"c5c2e73087cfd75aca63dcb28adc965de9a15baa\">\r\n<pre>[[StyleSheetTiddlySpace]]</pre>\r\n</div>\r\n<div title=\"SiteTitle\" server.title=\"SiteTitle\" server.page.revision=\"2566410\" server.etag=\"&quot;pearl_public/SiteTitle/2566410:d73adb2e601c913b7b8e6e26eebf5a11235a57ff&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160927120308\" created=\"20160908133954\" tags=\"excludeLists excludeSearch\" _hash=\"959508b6a6979af7d39892242d2f725e570bfe88\">\r\n<pre>迪伦</pre>\r\n</div>\r\n<div title=\"TiddlySpaceToolbar\" server.title=\"TiddlySpaceToolbar\" server.page.revision=\"1521861\" server.etag=\"&quot;system-plugins_public/TiddlySpaceToolbar/1521861:ea7ca7985409b40a2441a04f425e2f9a4a725de1&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-plugins_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-plugins_public\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"f1d6038be5d1ecd8d107d604b0f0dce76bc901da\">\r\n<pre>/***\r\n|''Name''|TiddlySpaceToolbar|\r\n|''Description''|augments tiddler toolbar commands with SVG icons|\r\n|''Author''|Osmosoft|\r\n|''Version''|0.6.6|\r\n|''Status''|@@beta@@|\r\n|''Source''|http://github.com/TiddlySpace/tiddlyspace/raw/master/src/plugins/TiddlySpaceToolbar.js|\r\n|''CodeRepository''|http://github.com/TiddlySpace/tiddlyspace|\r\n|''License''|[[BSD|http://www.opensource.org/licenses/bsd-license.php]]|\r\n|''CoreVersion''|2.5.0|\r\n|''Requires''|ImageMacroPlugin|\r\n|''Keywords''|toolbar icons SVG|\r\n!Description\r\nreplaces tiddler toolbar commands with SVG icons if available\r\n!Notes\r\nrequires [[ImageMacroPlugin|http://svn.tiddlywiki.org/Trunk/contributors/JonRobson/plugins/ImageMacroPlugin/plugins/ImageMacroPlugin.tid]]\r\n\r\nSVG icons are drawn from tiddlers titled {{{&lt;command&gt;.svg}}}\r\nIn readonly mode a tiddler called {{{&lt;command&gt;ReadOnly.svg}}} will be used if it exists.\r\n!TODO\r\n* rename (IconToolbarPlugin?)\r\n* support more than one more popup menu in the toolbar.\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nif(!config.macros.image) {\r\n\tthrow \"Missing dependency: ImageMacroPlugin\";\r\n}\r\n\r\nvar macro = config.macros.toolbar;\r\n\r\nmacro.icons = {\r\n\tcloneTiddler: \"editTiddler\"\r\n};\r\n\r\nvar _handler = macro.handler;\r\nmacro.handler = function(place, macroName, params, wikifier,\r\n\t\tparamString, tiddler) {\r\n\tvar toolbar = $(place);\r\n\ttoolbar.attr({\r\n\t\trefresh: \"macro\",\r\n\t\tmacroName: macroName\r\n\t}).data(\"args\", arguments);\r\n\tvar status = _handler.apply(this, arguments);\r\n\tif(tiddler.isReadOnly()) {\r\n\t\ttoolbar.addClass(\"toolbarReadOnly\");\r\n\t} else {\r\n\t\ttoolbar.removeClass(\"toolbarReadOnly\");\r\n\t}\r\n\tvar parsedParams = paramString.parseParams(\"name\")[0];\r\n\tif(parsedParams.icons &amp;&amp; parsedParams.icons == \"yes\") {\r\n\t\tthis.augmentCommandButtons(place);\r\n\t}\r\n\tif(parsedParams.more &amp;&amp; parsedParams.more == \"popup\") {\r\n\t\t// note we must override the onclick event like in createTiddlyButton\r\n\t\t// otherwise the click event is the popup AND the slider\r\n\t\t$(\".moreCommand\", place).each(function(i, el) {\r\n\t\t\tel.onclick = macro.onClickMorePopUp;\r\n\t\t});\r\n\t\t// buttons that are after a less command should not be in more menu.\r\n\t\t$(\".lessCommand ~ .button\", place).appendTo(place);\r\n\t\t$(\".lessCommand\", place).remove();\r\n\t}\r\n\treturn status;\r\n};\r\n\r\nmacro.refresh = function(place, params) {\r\n\tvar args = $(place).empty().data(\"args\");\r\n\tthis.handler.apply(this, args);\r\n};\r\n\r\nvar imageMacro = config.macros.image;\r\nmacro.augmentCommandButtons = function(toolbar) {\r\n\t$(\".button\", toolbar).each(function(i, el) {\r\n\t\tvar cmd = $(el).attr(\"commandname\");\r\n\t\tcmd = cmd ? cmd : \"moreCommand\"; // XXX: special-casing of moreCommand due to ticket #1234\r\n\t\tvar icon = store.tiddlerExists(cmd) ? cmd : macro.icons[cmd];\r\n\t\tvar text = $(el).text();\r\n\t\tif(readOnly) {\r\n\t\t\tvar readOnlyAlternative = \"%0ReadOnly\".format([icon]);\r\n\t\t\tif(store.tiddlerExists(readOnlyAlternative)) {\r\n\t\t\t\ticon = readOnlyAlternative;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(store.tiddlerExists(icon)) {\r\n\t\t\t$(el).css({display: \"inline-block\"}).empty();\r\n\t\t\timageMacro.renderImage(el, icon, { alt: text });\r\n\t\t}\r\n\t});\r\n};\r\n\r\n// provide onClickMore to provide extra commands in a popup\r\nmacro.onClickMorePopUp = function(ev) {\r\n\tev = ev || window.event;\r\n\tvar sibling = this.nextSibling;\r\n\tif(sibling) {\r\n\t\tvar commands = sibling.childNodes;\r\n\t\tvar popup = Popup.create(this);\r\n\t\t$(popup).addClass(\"taggedTiddlerList\");\r\n\t\tfor(var i = 0; i &lt; commands.length; i++) {\r\n\t\t\tvar li = createTiddlyElement(popup, \"li\", null);\r\n\t\t\tvar oldCommand = commands[i];\r\n\t\t\tvar command = oldCommand.cloneNode(true);\r\n\t\t\tcommand.onclick = oldCommand.onclick;\r\n\t\t\tli.appendChild(command);\r\n\t\t}\r\n\t\tPopup.show();\r\n\t}\r\n\tev.cancelBubble = true;\r\n\tif(ev.stopPropagation) {\r\n\t\tev.stopPropagation();\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"TiddlySpaceSearcher\" server.title=\"TiddlySpaceSearcher\" server.page.revision=\"1521908\" server.etag=\"&quot;tiddlyspace/TiddlySpaceSearcher/1521908:f738502828505bd13b0da0755c5c614c20c8ca8f&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"e3762c200fa4b897f6e7bbb9e0e7d83f860a89a5\">\r\n<pre>/***\r\n|''Name''|TiddlySpaceSearcher|\r\n|''Version''|0.2.5|\r\n|''Requires''|TiddlySpaceConfig TiddlySpaceFollowingPlugin|\r\n***/\r\n//{{{\r\n(function($) {\r\nvar tiddlyspace = config.extensions.tiddlyspace;\r\nvar tsScan = config.macros.tsScan;\r\n\r\nconfig.shadowTiddlers.SearchTemplate = \"&lt;&lt;view server.bag SiteIcon label:no width:24 height:24 preserveAspectRatio:yes&gt;&gt; &lt;&lt;view server.bag spaceLink title external:no&gt;&gt; in space &lt;&lt;view server.bag spaceLink&gt;&gt;\";\r\nconfig.shadowTiddlers.StyleSheetSearch = [\".resultsArea .siteIcon { display: inline; }\",\r\n\t\".searchForm {text-align: left;}\"].join(\"\\n\");\r\nstore.addNotification(\"StyleSheetSearch\", refreshStyles);\r\n\r\nvar search = config.macros.tsSearch = {\r\n\tlocale: {\r\n\t\tadvanced: \"Advanced Options\",\r\n\t\theader: \"Search\",\r\n\t\tresultsHeader: \"Results (%0)\",\r\n\t\tfind: \"find\",\r\n\t\tnoResults: \"No tiddlers matched your search query\",\r\n\t\tquery: \"QUERY: \",\r\n\t\terror: \"please provide a search query or a tag, modifier or title!\",\r\n\t\ttitleAdvanced: \"where the title is\",\r\n\t\tmodifierAdvanced: \"where the last modifier is\",\r\n\t\tspaceAdvanced: \"only in the space: \",\r\n\t\tnotspaceAdvanced: \"but not in the spaces: \",\r\n\t\ttagsAdvanced: \"with the tags: \"\r\n\t},\r\n\tandConstructor: function(container, label, fieldname, negationMode) {\r\n\t\tvar tags = $(\"&lt;div /&gt;\").appendTo(container);\r\n\t\t$('&lt;span /&gt;').text(label).appendTo(tags);\r\n\t\tvar id = \"area\" + Math.random();\r\n\t\tcontainer = $(\"&lt;span /&gt;\").attr(\"id\", id).appendTo(tags)[0];\r\n\t\tfunction add(container) {\r\n\t\t\tvar el = $('&lt;input type=\"text\" /&gt;').attr(\"field\", fieldname).appendTo(container);\r\n\t\t\tif(negationMode) {\r\n\t\t\t\tel.attr(\"negation\", \"true\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tadd(container);\r\n\t\tvar el = $(\"&lt;button /&gt;\").text(\"AND\").click(function(ev) {\r\n\t\t\tadd($(ev.target).data(\"container\"));\r\n\t\t\tev.preventDefault();\r\n\t\t}).appendTo(tags);\r\n\t\t$(el).data(\"container\", container);\r\n\t},\r\n\tfieldConstructor: function(container, label, field) {\r\n\t\tcontainer = $(\"&lt;div /&gt;\").appendTo(container)[0];\r\n\t\t$(\"&lt;span /&gt;\").text(label).appendTo(container);\r\n\t\t$(\"&lt;input /&gt;\").attr(\"text\", \"input\").attr(\"field\", field).appendTo(container);\r\n\t},\r\n\tadvancedOptions: function(form) {\r\n\t\tvar locale = search.locale;\r\n\t\tvar container = $(\"&lt;div /&gt;\").addClass(\"tsAdvancedOptions\").appendTo(form)[0];\r\n\t\t$(\"&lt;h2/ &gt;\").text(search.locale.advanced).appendTo(container);\r\n\t\t$(\"&lt;div /&gt;\").addClass(\"separator\").appendTo(container);\r\n\t\tsearch.fieldConstructor(container, locale.titleAdvanced, \"title\");\r\n\t\tsearch.fieldConstructor(container, locale.modifierAdvanced, \"modifier\");\r\n\t\tsearch.fieldConstructor(container, locale.spaceAdvanced, \"space\");\r\n\t\tsearch.andConstructor(container, locale.notspaceAdvanced, \"space\", true);\r\n\t\tsearch.andConstructor(container, locale.tagsAdvanced, \"tag\");\r\n\t},\r\n\tconstructSearchQuery: function(form) {\r\n\t\tvar data = [], select = [];\r\n\t\tvar query = $(\"[name=q]\", form).val();\r\n\t\tif(query) {\r\n\t\t\tdata.push(\"q=%0\".format(query));\r\n\t\t}\r\n\r\n\t\t// add tags, fields etc..\r\n\t\t$(\"[field]\", form).each(function(i, el) {\r\n\t\t\tvar val = $(el).val();\r\n\t\t\tvar name = $(el).attr(\"field\");\r\n\t\t\tvar negate = $(el).attr(\"negation\") == \"true\";\r\n\t\t\tif(val &amp;&amp; name) {\r\n\t\t\t\tval = encodeURIComponent(val);\r\n\t\t\t\tval = negate ? \"!\" + val : val;\r\n\t\t\t\tif(name == \"space\") {\r\n\t\t\t\t\tval += \"_public\";\r\n\t\t\t\t\tname = \"bag\";\r\n\t\t\t\t}\r\n\t\t\t\tif(negate) {\r\n\t\t\t\t\tselect.push(\"select=%0:%1\".format(name,val));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar prefix = data.length === 0 ? \"q=\" : \"\";\r\n\t\t\t\t\tdata.push('%0%1:\"%2\"'.format(prefix, name, val));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar dataString = data.join(\" \");\r\n\t\tif(dataString.length === 0 &amp;&amp; !query) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar selectStatement = select.join(\"&amp;\");\r\n\t\tif(dataString.length &gt; 0 &amp;&amp; selectStatement.length &gt; 0) {\r\n\t\t\tdataString += \"&amp;\";\r\n\t\t}\r\n\t\tdataString += selectStatement;\r\n\t\treturn \"/search?%0\".format(dataString);\r\n\t},\r\n\tconstructForm: function(place) {\r\n\t\tvar locale = search.locale;\r\n\t\t$(\"&lt;h1 /&gt;\").text(locale.header).appendTo(place);\r\n\t\tvar form = $(\"&lt;form /&gt;\").appendTo(place)[0];\r\n\t\t$('&lt;input type=\"text\" name=\"q\" /&gt;').appendTo(form);\r\n\t\t$('&lt;input type=\"submit\" /&gt;').val(locale.find).appendTo(form);\r\n\t\tsearch.advancedOptions(form);\r\n\t\tvar query = $('&lt;h2 class=\"query\"/&gt;').appendTo(place)[0];\r\n\t\tvar results = $(\"&lt;div /&gt;\").appendTo(place).addClass(\"resultsArea\")[0];\r\n\t\tvar lookup = function(url) {\r\n\t\t\tif(!url) {\r\n\t\t\t\tresults.empty().addClass(\"error\").text(locale.error);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconfig.extensions.tiddlyweb.getStatus(function(status) {\r\n\t\t\t\t$(query).text(locale.query);\r\n\t\t\t\tvar href = status.server_host.url + url;\r\n\t\t\t\t$(\"&lt;a /&gt;\").attr(\"href\", href).text(href).appendTo(query);\r\n\t\t\t\ttsScan.scan(results, { url: url, emptyMessage: search.locale.noResults, cache: true,\r\n\t\t\t\t\ttemplate: \"SearchTemplate\", sort: \"title\", callback: function(tiddlers) {\r\n\t\t\t\t\t\t$(\"&lt;h2 /&gt;\").text(locale.resultsHeader.format(tiddlers.length)).prependTo(results);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t};\r\n\t\t$(form).submit(function(ev) {\r\n\t\t\tev.preventDefault();\r\n\t\t\tvar url = search.constructSearchQuery(form);\r\n\t\t\tconfig.macros.tsSearch.lastSearch = url;\r\n\t\t\tlookup(url);\r\n\t\t});\r\n\t\tif(search.lastSearch) {\r\n\t\t\tlookup(search.lastSearch);\r\n\t\t}\r\n\t\treturn form;\r\n\t},\r\n\thandler: function(place) {\r\n\t\tvar container = $(\"&lt;div /&gt;\").addClass(\"searchForm\").appendTo(place)[0];\r\n\t\tsearch.constructForm(container);\r\n\t}\r\n};\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"Start writing\" server.title=\"Start writing\" server.page.revision=\"1521876\" server.etag=\"&quot;system-info_public/Start%20writing/1521876:caace473da69fc090440a4f07aff2485c0c11511&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-info_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-info_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeMissing excludeSearch\" _hash=\"7d1a54121ab3a090a54dd263b3e45c3f7699f8ed\">\r\n<pre>Click the \"new tiddler\" button towards the top right of the screen to write something in your space. You'll need to give it a title, some content and, optionally, some tags that will help you identify it later.\r\n\r\n!Stuck for ideas?\r\nNot sure what to write about? Not sure what to keep in your space? Other people use ~TiddlySpace for almost anything. How about some of the following:\r\n\r\n* [[Save interesting sites|http://bookmarks.tiddlyspace.com]], images or articles from around the web so that you can refer back to them.\r\n* [[Record your family tree|http://familytree.tiddlyspace.com]], store notes on long lost relatives or ancestors and map their relationship to you.\r\n* [[Make up a pocketbook|http://pocketbook.tiddlyspace.com]] to store some useful information in, then print it out, [[fold it up|http://www.pocketmod.com/]], and take it with you.\r\n* [[Plan your holiday|http://the-web-is-your-oyster.tiddlyspace.com/]], record where you're planning to go, note down places of interest and refer back to it later.\r\n* [[Create a mindmap|http://mindmaps.tiddlyspace.com/]] to visualise your inner thoughts and see how they relate to each other.\r\n* [[Set up a questionnaire|http://questionnaire.tiddlyspace.com/]] and get all your friends to answer it.\r\n\r\nIf you don't like any of those ideas, you can still use this space directly to keep notes and link them together, make a todo list and keep track of everything you're doing, or any one of a hundred million other things.\r\n\r\nStill stuck? Check out the @featured space for more suggestions.\r\n\r\nYou can also [[socialise with others|How to socialise]].</pre>\r\n</div>\r\n<div title=\"EditTemplate\" server.title=\"EditTemplate\" server.page.revision=\"1521922\" server.etag=\"&quot;system-theme_public/EditTemplate/1521922:7b69f435c72aea6c9b5fe2de010a1cebc6ae92e7&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-theme_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-theme_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch\" _hash=\"bb2ebcb9880f563a789711fbbbec5d3bfcb1b248\">\r\n<pre>&lt;!--{{{--&gt;\r\n&lt;div class='toolbar'\r\n\tmacro='toolbar [[ToolbarCommands::EditToolbar]] icons:yes'&gt;\r\n&lt;/div&gt;\r\n&lt;div class='heading editorHeading'&gt;\r\n\t&lt;div class='editor title' macro='edit title'&gt;&lt;/div&gt;\r\n\t&lt;div class='tagClear'&gt;&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;div class='annotationsBox' macro='annotations'&gt;\r\n\t&lt;div class='editSpaceSiteIcon'\r\n\t\tmacro='tiddlerOrigin height:16 width:16 label:no interactive:no'&gt;\r\n\t&lt;/div&gt;\r\n\t&lt;div class=\"privacyEdit\" macro='setPrivacy label:no interactive:no'&gt;&lt;/div&gt;\r\n\t&lt;div class='tagClear'&gt;&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;\r\n&lt;div class='editorFooter'&gt;\r\n\t&lt;div class='tagTitle'&gt;tags&lt;/div&gt;\r\n\t&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;\r\n\t&lt;div class='tagAnnotation'&gt;\r\n\t\t&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;\r\n\t\t&lt;span macro='tagChooser excludeLists'&gt;&lt;/span&gt;\r\n\t&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;!--}}}--&gt;</pre>\r\n</div>\r\n<div title=\"TiddlySpaceFilters\" server.title=\"TiddlySpaceFilters\" server.page.revision=\"1521906\" server.etag=\"&quot;tiddlyspace/TiddlySpaceFilters/1521906:d0329aaeb214dacdce5dc12dfd1d5f5e0d30c568&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192334\" created=\"20131111192334\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"3b6e75a776f9a07498220fe23b305bc97b531afc\">\r\n<pre>/***\r\n|''Name''|TiddlySpaceFilters|\r\n|''Description''|provide TiddlySpace-specific filter extensions|\r\n|''Author''|Jon Robson|\r\n|''Version''|0.6.1|\r\n|''Status''|@@beta@@|\r\n|''CoreVersion''|2.6.2|\r\n|''Requires''|TiddlySpaceConfig|\r\n|''License''|[[BSD|http://www.opensource.org/licenses/bsd-license.php]]|\r\n!Usage\r\n{{{\r\n&lt;&lt;tsList Private&gt;&gt;\r\n&lt;&lt;tsList Public&gt;&gt;\r\n&lt;&lt;tsList Draft&gt;&gt;\r\n}}}\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nvar tiddlyspace = config.extensions.tiddlyspace;\r\nvar privateBag = tiddlyspace.getCurrentBag(\"private\");\r\nvar publicBag = tiddlyspace.getCurrentBag(\"public\");\r\n\r\nconfig.filterHelpers = {\r\n\tis: {\r\n\t\t\"private\": function(tiddler) {\r\n\t\t\tvar bag = tiddler.fields[\"server.bag\"];\r\n\t\t\treturn bag == privateBag;\r\n\t\t},\r\n\t\t\"public\": function(tiddler) {\r\n\t\t\tvar bag = tiddler.fields[\"server.bag\"];\r\n\t\t\treturn bag == publicBag;\r\n\t\t},\r\n\t\tdraft: function(tiddler) {\r\n\t\t\tvar fields = tiddler.fields;\r\n\t\t\tvar bag = fields[\"server.bag\"];\r\n\t\t\treturn (privateBag == bag &amp;&amp; fields[\"publish.name\"]) ? true : false;\r\n\t\t},\r\n\t\tlocal: function(tiddler) {\r\n\t\t\treturn config.filterHelpers.is[\"public\"](tiddler) ||\r\n\t\t\t\tconfig.filterHelpers.is[\"private\"](tiddler);\r\n\t\t},\r\n\t\tunsynced: function(tiddler) {\r\n\t\t\treturn tiddler ? tiddler.isTouched() : false;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconfig.filters.is = function(results, match) {\r\n\tvar candidates = store.getTiddlers(\"title\");\r\n\tvar type = match[3];\r\n\tfor (var i = 0; i &lt; candidates.length; i++) {\r\n\t\tvar tiddler = candidates[i];\r\n\t\tvar helper = config.filterHelpers.is[type];\r\n\t\tif(helper &amp;&amp; helper(tiddler)) {\r\n\t\t\tresults.pushUnique(tiddler);\r\n\t\t}\r\n\t}\r\n\treturn results;\r\n};\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"deleteTiddler\" server.title=\"deleteTiddler\" server.page.revision=\"1521929\" server.etag=\"&quot;system-images_public/deleteTiddler/1521929:1cc3127e699b8c5f589b18f2ca3703689f7cbdea&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-images_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-images_public\" server.permissions=\"read\" server.content-type=\"image/svg+xml\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch\" _hash=\"cdf65cc5eb8e6665817a04cc764cd8797947f799\">\r\n<pre>&lt;svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xl=\"http://www.w3.org/1999/xlink\" version=\"1.1\" viewBox=\"450 366 38 57\"\r\nwidth=\"30\" height=\"30\"&gt;\r\n\t&lt;g stroke=\"none\" stroke-opacity=\"1\" stroke-dasharray=\"none\" fill=\"none\" fill-opacity=\"1\"&gt;\r\n\t\t&lt;g&gt;\r\n\t\t\t&lt;path d=\"M 452.1094 421.2422 L 450 421.2422 L 450 423 L 487.9688 423 L 487.9688 421.2422 L 485.8595 421.2422 \r\n\t\t\tL 485.8595 377.29688 L 487.9688 377.29688 L 487.9688 375.53906 L 485.8595 375.53906 \r\n\t\t\tC 485.8595 375.53906 481.12463 371.59341 473.02023 370.52802 C 472.6824 368.9689 471.72098 366.75 468.9844 366.75 \r\n\t\t\tC 466.24783 366.75 465.28638 368.9689 464.94864 370.52802 \r\n\t\t\tC 456.84418 371.59341 452.1094 375.53906 452.1094 375.53906 L 450 375.53906 L 450 377.29688 L 452.1094 377.29688 \r\n\t\t\tZ M 467.12247 370.32086 L 467.12247 370.32086 C 467.3805 369.42395 467.90762 368.50781 468.9844 368.50781 \r\n\t\t\tC 470.0612 368.50781 470.5883 369.42395 470.84634 370.32086 \r\n\t\t\tC 470.24136 370.2848 469.62054 370.26562 468.9844 370.26562 \r\n\t\t\tC 468.34827 370.26562 467.72748 370.2848 467.12247 370.32086 Z M 454.21875 420.92804 L 454.21875 420.92804 \r\n\t\t\tC 455.46762 420.42087 456.32816 419.35281 456.32816 418.11716 L 456.32816 377.29688 L 458.4375 377.29688 \r\n\t\t\tL 458.4375 421.2422 L 454.21875 421.2422 Z M 460.5469 420.92804 L 460.5469 420.92804 \r\n\t\t\tC 461.79578 420.42087 462.65625 419.35281 462.65625 418.11716 L 462.65625 377.29688 L 464.76566 377.29688 \r\n\t\t\tL 464.76566 421.2422 L 460.5469 421.2422 Z M 466.87503 420.92804 L 466.87503 420.92804 \r\n\t\t\tC 468.1239 420.42087 468.9844 419.35281 468.9844 418.11716 L 468.9844 377.29688 L 471.09378 377.29688 \r\n\t\t\tL 471.09378 421.2422 L 466.87503 421.2422 Z M 473.2032 420.92804 L 473.2032 420.92804 \r\n\t\t\tC 474.45203 420.42087 475.31256 419.35281 475.31256 418.11716 L 475.31256 377.29688 L 477.4219 377.29688 \r\n\t\t\tL 477.4219 421.2422 L 473.2032 421.2422 Z M 479.5313 420.92804 L 479.5313 420.92804 \r\n\t\t\tC 480.78018 420.42087 481.64066 419.35281 481.64066 418.11716 L 481.64066 377.29688 L 483.75006 377.29688 \r\n\t\t\tL 483.75006 421.2422 L 479.5313 421.2422 Z\" fill=\"black\" class=\"glyph\"/&gt;\r\n\t\t&lt;/g&gt;\r\n\t&lt;/g&gt;\r\n&lt;/svg&gt;</pre>\r\n</div>\r\n<div title=\"RandomColorPalettePlugin\" server.title=\"RandomColorPalettePlugin\" server.page.revision=\"1521872\" server.etag=\"&quot;system-plugins_public/RandomColorPalettePlugin/1521872:73392ac91c8b95a1d08d7144433ab0e6f06c6ea7&quot;\" modifier=\"jon\" creator=\"jon\" server.workspace=\"bags/system-plugins_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-plugins_public\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"c5b359abab5a1446d12be89e6ea608d2d73e4822\">\r\n<pre>/***\r\n|''Name''|RandomColorPalettePlugin|\r\n|''Description''|Adds a random color palette to TiddlyWiki|\r\n|''Author''|Jon Robson|\r\n|''Version''|1.4.0|\r\n|''Status''|stable|\r\n|''Source''|https://github.com/jdlrobson/TiddlyWikiPlugins/raw/master/plugins/RandomColorPalettePlugin/RandomColorPalettePlugin.js|\r\n|''License''|[[BSD|http://www.opensource.org/licenses/bsd-license.php]]|\r\n!Usage\r\n{{{\r\n&lt;&lt;RandomColorPalette&gt;&gt;\r\n}}}\r\nSets and saves a random color palette on execution\r\n\r\n{{{\r\n&lt;&lt;RandomColorPaletteButton&gt;&gt;\r\n}}}\r\nCreates a button, which when clicked will change the color palette\r\nMore information at http://macros.tiddlyspace.com/#%5B%5BRandomColorPaletteButton%20macro%5D%5D\r\n!Code\r\n***/\r\n//{{{\r\nRGB.prototype.toRGBString = function() {\r\n\treturn \"rgb(%0,%1,%2)\".format(parseInt(this.r * 255, 10),\r\n\t\tparseInt(this.g * 255, 10), parseInt(this.b * 255, 10))\r\n}\r\nfunction HSL_TO_RGB(h, s, l) { // h (hue) between 0 and 360, s (saturation) &amp; l (lightness) between 0 and 1\r\n\tvar c = l &lt;= 0.5 ? 2 * l * s : ( 2 - (2 * l)) * s;\r\n\tvar h1 = h / 60;\r\n\tvar x = c * (1 - Math.abs((h1 % 2) - 1)); \r\n\tvar r, g, b;\r\n\tif(typeof(h) == 'undefined') {\r\n\t\tr = 0;\r\n\t\tg = 0;\r\n\t\tb = 0;\r\n\t} else if(0 &lt;= h1 &amp;&amp; h1 &lt; 1) {\r\n\t\tr = c;\r\n\t\tg = x;\r\n\t\tb = 0;\r\n\t} else if(1 &lt;= h1 &amp;&amp; h1 &lt; 2) {\r\n\t\tr = x;\r\n\t\tg = c;\r\n\t\tb = 0;\r\n\t} else if(2 &lt;= h1 &amp;&amp; h1 &lt; 3) {\r\n\t\tr = 0;\r\n\t\tg = c;\r\n\t\tb = x;\r\n\t} else if(3 &lt;= h1 &amp;&amp; h1 &lt; 4) {\r\n\t\tr = 0;\r\n\t\tg = x;\r\n\t\tb = c;\r\n\t} else if(4 &lt;= h1 &amp;&amp; h1 &lt; 5) {\r\n\t\tr = x;\r\n\t\tg = 0;\r\n\t\tb = c;\r\n\t} else if(5 &lt;= h1 &amp;&amp; h1 &lt; 6) {\r\n\t\tr = c;\r\n\t\tg = 0;\r\n\t\tb = x;\r\n\t}\r\n\tm = l - (0.5 * c);\r\n\treturn new RGB(r + m, g + m, b + m);\r\n}\r\n\r\n(function($){\r\n\tvar macro = config.macros.RandomColorPalette = {\r\n\t\tmessagesOn: false, \r\n\t\tchangedPaletteText: \"We have assigned you a random theme by adjusting the [[ColorPalette]] tiddler.\\nDon't like it? Click &lt;&lt;RandomColorPalette&gt;&gt; for another one.\", \r\n\t\thandler: function(place, macroName, params, wikifier, paramString, tiddler) {\r\n\t\t\tparamString = paramString || \"\";\r\n\t\t\tvar options = macro.getOptions(paramString);\r\n\t\t\tmacro.generatePalette(options, true);\r\n\t\t},\r\n\t\toptionTypes: {\r\n\t\t\tfloats: [\"hue\", \"saturation\", \"darkest\", \"lightness\", \"huevariance\", \"dark\", \"pale\", \"light\", \"mid\",\r\n\t\t\t\t\"saturation_light\", \"saturation_pale\", \"saturation_mid\", \"saturation_dark\"\r\n\t\t\t]\r\n\t\t},\r\n\t\tgetOptions: function(paramString) {\r\n\t\t\tvar args = paramString.parseParams(\"name\", null, true, false, true)[0];\r\n\t\t\tvar options = {};\r\n\t\t\tvar numbers = macro.optionTypes.floats;\r\n\t\t\tfor(var i in args) {\r\n\t\t\t\toptions[i] = numbers.indexOf(i) &gt; -1 ? parseFloat(args[i][0], 10) : args[i][0];\r\n\t\t\t}\r\n\t\t\treturn options;\r\n\t\t},\r\n\t\tgenerateRandomNumber: function(min, max, info) {\r\n\t\t\tvar num = (Math.random() * 1);\r\n\t\t\tinfo = !info ? { attempts:0 } : info;\r\n\t\t\tinfo.attempts += 1;\r\n\t\t\tvar good = true;\r\n\t\t\tif(min == max) {\r\n\t\t\t\treturn max;\r\n\t\t\t}\r\n\t\t\tif(min &amp;&amp; num &lt; min) {\r\n\t\t\t\tgood = false;\r\n\t\t\t} else if(max &amp;&amp; num &gt; max) {\r\n\t\t\t\tgood = false;\r\n\t\t\t}\r\n\t\t\tif(!good) {\r\n\t\t\t\tif(info.attempts &lt; 5) {\r\n\t\t\t\t\treturn macro.generateRandomNumber(min, max, info);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(max) {\r\n\t\t\t\t\t\treturn max;\r\n\t\t\t\t\t} else if(min) {\r\n\t\t\t\t\t\treturn min;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn num;\r\n\t\t},\r\n\t\tgetExistingPalette: function(asJSON) {\r\n\t\t\tvar title = \"ColorPalette\";\r\n\t\t\tvar tiddlerText;\r\n\t\t\tif(store.tiddlerExists(title)) {\r\n\t\t\t\ttiddlerText = store.getTiddlerText(title);\r\n\t\t\t} else if(store.isShadowTiddler(title)){\r\n\t\t\t\ttiddlerText = config.shadowTiddlers[title];\r\n\t\t\t}\r\n\t\t\tif(asJSON) {\r\n\t\t\t\tvar json = {};\r\n\t\t\t\tif(tiddlerText) {\r\n\t\t\t\t\tvar lines = tiddlerText.split(\"\\n\");\r\n\t\t\t\t\tfor(var i = 0; i &lt; lines.length; i++) {\r\n\t\t\t\t\t\tvar definition = lines[i].split(\":\");\r\n\t\t\t\t\t\tif(definition.length == 2) {\r\n\t\t\t\t\t\t\tvar name = definition[0].trim();\r\n\t\t\t\t\t\t\tvar value = definition[1].trim();\r\n\t\t\t\t\t\t\tjson[name] = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn json;\r\n\t\t\t} else {\r\n\t\t\t\treturn tiddlerText;\r\n\t\t\t}\r\n\t\t},\r\n\t\tgeneratePalette: function(options, save) {\r\n\t\t\tvar outputRGB = options.rgb;\r\n\t\t\tvar palette = macro.getExistingPalette(true);\r\n\t\t\tvar hue = options.hue || Math.floor(Math.random() * 359);\r\n\t\t\tvar saturation = options.saturation || macro.generateRandomNumber(0.3, 0.7);\r\n\t\t\tvar dark = options.dark || options.darkest || macro.generateRandomNumber(0, 0.10);\r\n\t\t\tvar pale = options.pale || options.lightness || macro.generateRandomNumber(0.90, 1);\r\n\t\t\tvar delta = ( ( pale - dark ) / 3 );\r\n\t\t\tvar mid = options.mid || dark + delta;\r\n\t\t\tvar light = options.light || dark + (delta * 2);\r\n\t\t\tvar lightness_values = {Dark: dark, Mid: mid, Light: light, Pale: pale};\r\n\t\t\tvar saturation_values = {};\r\n\t\t\tfor(i in lightness_values) {\r\n\t\t\t\tif(true) {\r\n\t\t\t\t\tsaturation_values[i] = options[\"saturation_\" + i.toLowerCase()] || saturation;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar opposite_hue = (hue + 180) % 360;\r\n\t\t\tvar seed = options.huevariance || Math.floor((85 * Math.random()) + 5); // we want it to be at least 5 degrees\r\n\t\t\tvar huetwo = (opposite_hue + seed) % 360;\r\n\t\t\tvar huethree = (opposite_hue - seed) % 360;\r\n\t\t\tif(huetwo &lt; 0) {\r\n\t\t\t\thuetwo = 360 + huetwo;\r\n\t\t\t}\r\n\t\t\tif(huethree &lt; 0) {\r\n\t\t\t\thuethree = 360 + huethree;\r\n\t\t\t}\r\n\t\t\tfor(var j in lightness_values) {\r\n\t\t\t\tif(true) {\r\n\t\t\t\t\tvar saturation = saturation_values[j];\r\n\t\t\t\t\tpalette[\"Primary\" + j] = HSL_TO_RGB(hue, saturation, lightness_values[j]);\r\n\t\t\t\t\tpalette[\"Secondary\" + j] = HSL_TO_RGB(huetwo, saturation, lightness_values[j]);\r\n\t\t\t\t\tpalette[\"Tertiary\" + j] = HSL_TO_RGB(huethree, saturation, lightness_values[j]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tpalette.Background = HSL_TO_RGB(hue, saturation, 0.92);\r\n\t\t\tpalette.Foreground = HSL_TO_RGB(hue, saturation, 0.08);\r\n\t\t\tpalette.ColorPaletteParameters = [\"HSL([\", hue, \"|\", seed, \"], [\", saturation_values.Pale, \"|\",\r\n\t\t\t\tsaturation_values.Light, \"|\", saturation_values.Mid, \"|\", saturation_values.Dark, \"],\",\r\n\t\t\t\t\"[\", dark, \"|\", mid, \"|\", light, \"|\", pale, \"])\"].join(\"\");\r\n\t\t\t// construct new ColorPalette\r\n\t\t\tvar text = [\"/*{{{*/\\n\"];\r\n\t\t\tvar colorcode;\r\n\t\t\tfor(var id in palette) {\r\n\t\t\t\tif(true) {\r\n\t\t\t\t\tvar color = palette[id];\r\n\t\t\t\t\tcolorcode = outputRGB ? color.toRGBString() : color.toString();\r\n\t\t\t\t\ttext.push(\"%0: %1\\n\".format(id, colorcode));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ttext.push(\"/*}}}*/\");\r\n\t\t\ttext = text.join(\"\");\r\n\t\t\tif(save) {\r\n\t\t\t\tmacro.saveColorPalette(text);\r\n\t\t\t}\r\n\t\t\treturn text;\r\n\t\t},\r\n\t\tsaveColorPalette: function(text) {\r\n\t\t\tvar tid = store.getTiddler(\"ColorPalette\");\r\n\t\t\tif(!tid) {\r\n\t\t\t\ttid = new Tiddler(\"ColorPalette\");\r\n\t\t\t\ttid.fields = merge({}, config.defaultCustomFields);\r\n\t\t\t} // TODO: detect that the ColorPalette in the space comes from outside recipe\r\n\t\t\ttid.fields[\"server.page.revision\"] = \"false\"; // edit conflicts dont matter\r\n\r\n\t\t\t// save the color palette in tid\r\n\t\t\ttid = store.saveTiddler(tid.title, tid.title, text, tid.modifier, tid.modified,\r\n\t\t\t\ttid.tags, tid.fields, false, tid.created, tid.creator);\r\n\t\t\t// an interval is used to cope with users clicking on the palette button quickly.\r\n\t\t\tif(macro._nextSave) {\r\n\t\t\t\twindow.clearTimeout(macro._nextSave);\r\n\t\t\t}\r\n\t\t\tmacro._nextSave = window.setTimeout(function() {\r\n\t\t\t\t\tautoSaveChanges(null, [tid]);\r\n\t\t\t\t}, 2000);\r\n\t\t\t// temporary workaround for IE.\r\n\t\t\t$.twStylesheet.remove({ id: \"StyleSheetColors\" });\r\n\t\t\t$.twStylesheet.remove({ id: \"StyleSheet\" });\r\n\t\t\trefreshAll();\r\n\t\t\tmacro.reportChange();\r\n\t\t\treturn tid;\r\n\t\t},\r\n\t\treportChange: function() {\r\n\t\t\tif(macro.messagesOn) { // only display message once..\r\n\t\t\t\tvar msgPlace = getMessageDiv();\r\n\t\t\t\tif(!$(\".changedPalette\", msgPlace)[0]) {\r\n\t\t\t\t\tvar tempPlace = document.createElement(\"div\");\r\n\t\t\t\t\twikify(\"{{changedPalette{\" + macro.changedPaletteText + \"}}}\", tempPlace);\r\n\t\t\t\t\tmsgPlace.appendChild(tempPlace);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar btnMacro = config.macros.RandomColorPaletteButton = {\r\n\t\t\ttext: \"New ColorPalette\",\r\n\t\t\ttooltip: \"Generate a random colour scheme for your TiddlyWiki\",\r\n\t\t\tmakeButton: function(place, options) {\r\n\t\t\t\tvar btnHandler = function(ev) {\r\n\t\t\t\t\tvar t = $(ev.target);\r\n\t\t\t\t\tvar options = t.data(\"options\");\r\n\t\t\t\t\tmacro.generatePalette(options, true);\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t};\r\n\t\t\t\tvar btn = createTiddlyButton(place, this.text, this.tooltip, btnHandler);\r\n\t\t\t\t$(btn).data(\"options\", options);\r\n\t\t\t\treturn btn;\r\n\t\t\t},\r\n\t\t\thandler: function(place, macroName, params, wikifier, paramString, tiddler) {\r\n\t\t\t\tvar options = macro.getOptions(paramString);\r\n\t\t\t\tbtnMacro.makeButton(place, options);\r\n\t\t\t}\r\n\t};\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"closeTiddler\" server.title=\"closeTiddler\" server.page.revision=\"1521934\" server.etag=\"&quot;system-images_public/closeTiddler/1521934:e42fd9e7006ba0d92a9b891bd6789001d1647991&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-images_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-images_public\" server.permissions=\"read\" server.content-type=\"image/svg+xml\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch\" _hash=\"1ddacf68b541cb91b7b896c9c2934ec79e8997a0\">\r\n<pre>&lt;svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xl=\"http://www.w3.org/1999/xlink\" version=\"1.1\" viewBox=\"78 222 60 60\" \r\nwidth=\"30\" height=\"30\"&gt;\r\n&lt;g stroke=\"none\" stroke-opacity=\"1\" stroke-dasharray=\"none\" fill=\"none\" fill-opacity=\"1\"&gt;\r\n\t&lt;g&gt;\r\n\t\t&lt;path d=\"M 107.92718 244.14815 L 86.651474 222.89253 L 78.85206 230.69925 L 100.120415 251.9476 L 78.774 273.27396 \r\n\t\tL 86.57342 281.08075 L 107.927216 259.74707 L 129.39981 281.19946 L 137.19922 273.39267 L 115.73397 251.94763 \r\n\t\tL 137.121155 230.58054 L 129.32175 222.77374 Z\" fill=\"black\" class=\"glyph\"/&gt;\r\n\t&lt;/g&gt;\r\n&lt;/g&gt;\r\n&lt;/svg&gt;</pre>\r\n</div>\r\n<div title=\"TiddlyWebConfig\" server.title=\"TiddlyWebConfig\" server.page.revision=\"1521857\" server.etag=\"&quot;system/TiddlyWebConfig/1521857:1fdc12b02d34b0bdea7d09525e8257812aa8febb&quot;\" modifier=\"FND\" creator=\"FND\" server.workspace=\"bags/system\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20130924180405\" created=\"20130924180405\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"29e43eb7496ba0572556029d183cb3f434369f04\">\r\n<pre>/***\r\n|''Name''|TiddlyWebConfig|\r\n|''Description''|configuration settings for TiddlyWebWiki|\r\n|''Author''|FND|\r\n|''Version''|1.3.2|\r\n|''Status''|stable|\r\n|''Source''|http://svn.tiddlywiki.org/Trunk/association/plugins/TiddlyWebConfig.js|\r\n|''License''|[[BSD|http://www.opensource.org/licenses/bsd-license.php]]|\r\n|''Requires''|TiddlyWebAdaptor ServerSideSavingPlugin|\r\n|''Keywords''|serverSide TiddlyWeb|\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nif(!config.extensions.ServerSideSavingPlugin) {\r\n\tthrow \"Missing dependency: ServerSideSavingPlugin\";\r\n}\r\nif(!config.adaptors.tiddlyweb) {\r\n\tthrow \"Missing dependency: TiddlyWebAdaptor\";\r\n}\r\n\r\nif(window.location.protocol != \"file:\") {\r\n\tconfig.options.chkAutoSave = true;\r\n}\r\n\r\nvar adaptor = tiddler.getAdaptor();\r\nvar recipe = tiddler.fields[\"server.recipe\"];\r\nvar workspace = recipe ? \"recipes/\" + recipe : \"bags/common\";\r\n\r\nvar plugin = config.extensions.tiddlyweb = {\r\n\thost: tiddler.fields[\"server.host\"].replace(/\\/$/, \"\"),\r\n\tusername: null,\r\n\tstatus: {},\r\n\r\n\tgetStatus: null, // assigned later\r\n\tgetUserInfo: function(callback) {\r\n\t\tthis.getStatus(function(status) {\r\n\t\t\tcallback({\r\n\t\t\t\tname: plugin.username,\r\n\t\t\t\tanon: plugin.username ? plugin.username == \"GUEST\" : true\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\thasPermission: function(type, tiddler) {\r\n\t\tvar perms = tiddler.fields[\"server.permissions\"];\r\n\t\tif(perms) {\r\n\t\t\treturn perms.split(\", \").contains(type);\r\n\t\t} else {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconfig.defaultCustomFields = {\r\n\t\"server.type\": tiddler.getServerType(),\r\n\t\"server.host\": plugin.host,\r\n\t\"server.workspace\": workspace\r\n};\r\n\r\n// modify toolbar commands\r\n\r\nconfig.shadowTiddlers.ToolbarCommands = config.shadowTiddlers.ToolbarCommands.\r\n\treplace(\"syncing \", \"revisions syncing \");\r\n\r\nconfig.commands.saveTiddler.isEnabled = function(tiddler) {\r\n\treturn plugin.hasPermission(\"write\", tiddler) &amp;&amp; !tiddler.isReadOnly();\r\n};\r\n\r\nconfig.commands.deleteTiddler.isEnabled = function(tiddler) {\r\n\treturn !readOnly &amp;&amp; plugin.hasPermission(\"delete\", tiddler);\r\n};\r\n\r\n// hijack option macro to disable username editing\r\nvar _optionMacro = config.macros.option.handler;\r\nconfig.macros.option.handler = function(place, macroName, params, wikifier,\r\n\t\tparamString) {\r\n\tif(params[0] == \"txtUserName\") {\r\n\t\tparams[0] = \"options.\" + params[0];\r\n\t\tvar self = this;\r\n\t\tvar args = arguments;\r\n\t\targs[0] = $(\"&lt;span /&gt;\").appendTo(place)[0];\r\n\t\tplugin.getUserInfo(function(user) {\r\n\t\t\tconfig.macros.message.handler.apply(self, args);\r\n\t\t});\r\n\t} else {\r\n\t\t_optionMacro.apply(this, arguments);\r\n\t}\r\n};\r\n\r\n// hijack isReadOnly to take into account permissions and content type\r\nvar _isReadOnly = Tiddler.prototype.isReadOnly;\r\nTiddler.prototype.isReadOnly = function() {\r\n\treturn _isReadOnly.apply(this, arguments) ||\r\n\t\t!plugin.hasPermission(\"write\", this);\r\n};\r\n\r\nvar getStatus = function(callback) {\r\n\tif(plugin.status.version) {\r\n\t\tcallback(plugin.status);\r\n\t} else {\r\n\t\tvar self = getStatus;\r\n\t\tif(self.pending) {\r\n\t\t\tif(callback) {\r\n\t\t\t\tself.queue.push(callback);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tself.pending = true;\r\n\t\t\tself.queue = callback ? [callback] : [];\r\n\t\t\tvar _callback = function(context, userParams) {\r\n\t\t\t\tvar status = context.serverStatus || {};\r\n\t\t\t\tfor(var key in status) {\r\n\t\t\t\t\tif(key == \"username\") {\r\n\t\t\t\t\t\tplugin.username = status[key];\r\n\t\t\t\t\t\tconfig.macros.option.propagateOption(\"txtUserName\",\r\n\t\t\t\t\t\t\t\"value\", plugin.username, \"input\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tplugin.status[key] = status[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfor(var i = 0; i &lt; self.queue.length; i++) {\r\n\t\t\t\t\tself.queue[i](plugin.status);\r\n\t\t\t\t}\r\n\t\t\t\tdelete self.queue;\r\n\t\t\t\tdelete self.pending;\r\n\t\t\t};\r\n\t\t\tadaptor.getStatus({ host: plugin.host }, null, _callback);\r\n\t\t}\r\n\t}\r\n};\r\n(plugin.getStatus = getStatus)(); // XXX: hacky (arcane combo of assignment plus execution)\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"ToggleTiddlerPrivacyPlugin\" server.title=\"ToggleTiddlerPrivacyPlugin\" server.page.revision=\"1521863\" server.etag=\"&quot;system-plugins_public/ToggleTiddlerPrivacyPlugin/1521863:f43cfda2f776ebc199288f47b8d0e3905ff54c1f&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-plugins_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-plugins_public\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"3acf06056e188b31bcc3c42ec673a050886d64c4\">\r\n<pre>/***\r\n|''Name''|ToggleTiddlerPrivacyPlugin|\r\n|''Version''|0.7.1|\r\n|''Status''|@@beta@@|\r\n|''Description''|Allows you to set the privacy of new tiddlers and external tiddlers within an EditTemplate, and allows you to set a default privacy setting|\r\n|''CoreVersion''|2.6.1|\r\n|''Requires''|TiddlySpaceConfig|\r\n|''Source''|http://github.com/TiddlySpace/tiddlyspace/raw/master/src/plugins/ToggleTiddlerPrivacyPlugin.js|\r\n!Notes\r\nWhen used in conjunction with TiddlySpaceTiddlerIconsPlugin changing the privacy setting will also interact with any privacy icons.\r\n\r\nCurrently use of\r\n{{{&lt;&lt;setPrivacy defaultValue:public&gt;&gt;}}} is in conflict with {{{&lt;&lt;newTiddler fields:\"server.workspace:x_private\"&gt;&gt;}}}\r\n\r\nThere is an option, found in the tweak tab of the backstage, called txtPrivacyMode. Set this to either ''public'' or ''private'' depending on your security preference. If you choose not to set it then it will default to ''public''.\r\n!Params\r\ndefaultValue:[private|public]\r\nAllows you to set the default privacy value (Default is private)\r\n\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\n\tvar tiddlyspace = config.extensions.tiddlyspace,\r\n\t\tmacro;\r\n\tmacro = config.macros.setPrivacy = {\r\n\t\thandler: function(place, macroName, params, wikifier, paramString, tiddler) {\r\n\t\t\tif(readOnly) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar el = $(story.findContainingTiddler(place)),\r\n\t\t\t\targs = paramString.parseParams(\"name\",\r\n\t\t\t\t\tnull, true, false, true)[0],\r\n\t\t\t\tcontainer = $(\"&lt;div /&gt;\").\r\n\t\t\t\t\taddClass(\"privacySettings\").\r\n\t\t\t\t\tappendTo(place)[0],\r\n\t\t\t\tcurrentSpace = tiddlyspace.currentSpace.name,\r\n\t\t\t\tcurrentBag = tiddler ? tiddler.fields[\"server.bag\"] : false,\r\n\t\t\t\t// XXX: is the following reliable?\r\n\t\t\t\tisNewTiddler = el.hasClass(\"missing\") || !currentBag,\r\n\t\t\t\ttiddlerStatus = tiddlyspace.getTiddlerStatusType(tiddler),\r\n\t\t\t\tcustomFields = el.attr(\"tiddlyfields\"),\r\n\t\t\t\tdefaultValue = \"public\",\r\n\t\t\t\toptions = config.macros.tiddlerOrigin ?\r\n\t\t\t\t\t\tconfig.macros.tiddlerOrigin.getOptions(paramString) :\r\n\t\t\t\t\t\t{};\r\n\t\t\tcustomFields = customFields ? customFields.decodeHashMap() : {};\r\n\t\t\tif(isNewTiddler || ![\"public\", \"private\", \"unsyncedPrivate\",\r\n\t\t\t\t\t\"unsyncedPublic\"].contains(tiddlerStatus)) {\r\n\t\t\t\tif(args.defaultValue) {\r\n\t\t\t\t\tdefaultValue = args.defaultValue[0].toLowerCase();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdefaultValue = config.options.chkPrivateMode ?\r\n\t\t\t\t\t\t\t\"private\" : \"public\";\r\n\t\t\t\t}\r\n\t\t\t\tdefaultValue = defaultValue ?\r\n\t\t\t\t\t\t\"%0_%1\".format(currentSpace, defaultValue) :\r\n\t\t\t\t\t\tcustomFields[\"server.bag\"];\r\n\t\t\t\tthis.createRoundel(container, tiddler, currentSpace,\r\n\t\t\t\t\t\tdefaultValue, options);\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdateEditFields: function(tiddlerEl, bag) {\r\n\t\t\tvar saveBagField = $('[edit=\"server.bag\"]', tiddlerEl),\r\n\t\t\t\tsaveWorkspaceField = $('[edit=\"server.workspace\"]', tiddlerEl),\r\n\t\t\t\tinput = $(\"&lt;input /&gt;\").attr(\"type\", \"hidden\"),\r\n\t\t\t\tworkspace = \"bags/\" + bag;\r\n\t\t\tif(saveBagField.length === 0) {\r\n\t\t\t\tinput.clone().attr(\"edit\", \"server.bag\").val(bag).\r\n\t\t\t\t\tappendTo(tiddlerEl);\r\n\t\t\t} else {\r\n\t\t\t\tsaveBagField.val(bag);\r\n\t\t\t}\r\n\t\t\t// reset to prevent side effects\r\n\t\t\t$(tiddlerEl).attr(\"tiddlyFields\", \"\");\r\n\t\t\tif(saveWorkspaceField.length === 0) {\r\n\t\t\t\tinput.clone().attr(\"edit\", \"server.workspace\").\r\n\t\t\t\t\tval(workspace).appendTo(tiddlerEl);\r\n\t\t\t} else {\r\n\t\t\t\tsaveWorkspaceField.val(workspace);\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetBag: function(tiddlerEl, newBag, options) {\r\n\t\t\tvar bagStatus,\r\n\t\t\t\ttitle = $(tiddlerEl).attr(\"tiddler\"),\r\n\t\t\t\ttiddler = store.getTiddler(title),\r\n\t\t\t\toriginButton = $(\".originButton\", tiddlerEl)[0],\r\n\t\t\t\trefreshIcon,\r\n\t\t\t\tnewWorkspace = \"bags/\" + newBag,\r\n\t\t\t\trPrivate = $(\"input[type=radio].isPrivate\", tiddlerEl),\r\n\t\t\t\trPublic = $(\"input[type=radio].isPublic\", tiddlerEl);\r\n\t\t\trefreshIcon = function(type) {\r\n\t\t\t\tvar originMacro = config.macros.tiddlerOrigin;\r\n\t\t\t\tif(originButton &amp;&amp; originMacro) {\r\n\t\t\t\t\toptions.noclick = true;\r\n\t\t\t\t\toriginMacro.showPrivacyRoundel(tiddler, type,\r\n\t\t\t\t\t\t\toriginButton, options);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tmacro.updateEditFields(tiddlerEl, newBag);\r\n\t\t\tif(tiddler) {\r\n\t\t\t\ttiddler.fields[\"server.bag\"] = newBag;\r\n\t\t\t\t// for external tiddlers\r\n\t\t\t\ttiddler.fields[\"server.workspace\"] = newWorkspace;\r\n\t\t\t}\r\n\t\t\tif(newBag.indexOf(\"_public\") &gt; -1) {\r\n\t\t\t\trPrivate.attr(\"checked\", false);\r\n\t\t\t\trPublic.attr(\"checked\", true);\r\n\t\t\t\tbagStatus = \"public\";\r\n\t\t\t} else {\r\n\t\t\t\trPublic.attr(\"checked\", false); // explicitly do this for ie\r\n\t\t\t\trPrivate.attr(\"checked\", true);\r\n\t\t\t\tbagStatus = \"private\";\r\n\t\t\t}\r\n\t\t\trefreshIcon(bagStatus);\r\n\t\t},\r\n\t\tcreateRoundel: function(container, tiddler, currentSpace,\r\n\t\t\t\t\t\t\t   defaultValue, options) {\r\n\t\t\tvar privateBag = \"%0_private\".format(currentSpace),\r\n\t\t\t\tpublicBag = \"%0_public\".format(currentSpace),\r\n\t\t\t\trbtn = $(\"&lt;input /&gt;\").attr(\"type\", \"radio\").\r\n\t\t\t\t\tattr(\"name\", tiddler.title),\r\n\t\t\t\tel = story.findContainingTiddler(container);\r\n\t\t\trbtn.clone().val(\"private\").addClass(\"isPrivate\").\r\n\t\t\t\tappendTo(container);\r\n\t\t\t$(\"&lt;label /&gt;\").text(\"private\").appendTo(container); // TODO: i18n\r\n\t\t\trbtn.clone().val(\"public\").addClass(\"isPublic\")\r\n\t\t\t\t.appendTo(container);\r\n\t\t\t$(\"&lt;label /&gt;\").text(\"public\").appendTo(container); // TODO: i18n\r\n\t\t\t$(\"[type=radio]\", container).click(function(ev) {\r\n\t\t\t\tvar btn = $(ev.target);\r\n\t\t\t\ttiddler.fields[\"server.page.revision\"] = \"false\";\r\n\t\t\t\tif(btn.hasClass(\"isPrivate\")) { // private button clicked.\r\n\t\t\t\t\t$(el).addClass(\"isPrivate\").removeClass(\"isPublic\");\r\n\t\t\t\t\tmacro.setBag(el, privateBag, options);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(el).addClass(\"isPublic\").removeClass(\"isPrivate\");\r\n\t\t\t\t\tmacro.setBag(el, publicBag, options);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\twindow.setTimeout(function() {\r\n\t\t\t\tmacro.setBag(el, defaultValue, options);\r\n\t\t\t}, 100);\r\n\t\t\t// annoyingly this is needed as customFields are added to end of EditTemplate so are not present yet\r\n\t\t\t// and don't seem to respect any existing customFields.\r\n\t\t}\r\n\t};\r\n\r\n}(jQuery));\r\n//}}}</pre>\r\n</div>\r\n<div title=\"对与alphawiki和anwiki的比较\" server.title=\"对与alphawiki和anwiki的比较\" server.page.revision=\"2576590\" server.etag=\"&quot;pearl_public/%E5%AF%B9%E4%B8%8Ealphawiki%E5%92%8Canwiki%E7%9A%84%E6%AF%94%E8%BE%83/2576590:89b557a748fad48ea59cc343e8d5d67785b26aec&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20161025101640\" created=\"20161025101056\" tags=\"作业\" _hash=\"809a34d8e9230d4dd86b37c7ff7457aa7d7d282f\">\r\n<pre>一、\t对与alphawiki和anwiki的比较\r\n（1）一般特征比较：一般特征中大部分都是较为相同的，主要提出在许可证、编程语言、数据存储，及目标受众上略有差别，前者的编程语言除PHP外，还有javascriph后者只有PHP，数据存储上前者只有文件，后者除此外还有数据库，最后是关于受众群众的区别，前者针对私人用户，后者是基于比较专业内容与架构。\r\n（2）系统需求比较：基本相具有似，不同之处在于前者有根访问，后者没有。\r\n（3）数据存储：前者是用对文本文件进行存储，后者是用数据库进行存储。\r\n（4）安全与反垃圾邮件：基本相似，但后者有验证码功能。\r\n（5）开发与支持：主要差别在于代码存储器。前者有支持论坛，后者没有，后者有问题追踪器、邮件列表，前者没有。\r\n（6）共同特征：两者相似之处是预览、浏览历史、页面索引、插件系统。\r\n（7）特殊功能：除unicode支持相同外，其他的都具有差别，主要体现在界面语言、评论、冲突处理与搜索上。\r\n（8）链接：两者都有的链接有Freelinks、图片链接，后者除此外还有反向链接、windows的股票。\r\n（9）语法功能：相同之处在于HTML标记、内部评论、自定义风格。不同之处在于数学公式、表情符号图像，引用，脚本。\r\n（10）数据统计：前者有最近游客的统计，后者没有\r\n（11）输出：除HTML、CSS样式表、主题和皮肤、AUTO-TOC，原料出口相同外，其他都具有差别。\r\n（12）媒体文件：两者都具有嵌入式闪存、嵌入式视频、，除此外前者还有文件附件、SVG编辑。\r\n以上为alphawiki和anwiki比较论述。\r\n\r\n\r\n\r\n</pre>\r\n</div>\r\n<div title=\"Backstage\" server.title=\"Backstage\" server.page.revision=\"1521902\" server.etag=\"&quot;tiddlyspace/Backstage/1521902:672f5aa39a75172594e6fb78d3af703c9fe1fd0a&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeMissing excludeSearch\" _hash=\"374716f48c21298abb095093dce2176965648975\">\r\n<pre>!SpaceUnplugged\r\n{{unpluggedSpaceTab{\r\n{{wizard{\r\n&lt;&lt;image unsyncedIcon width:48&gt;&gt; Sync is currently unavailable in ~TiddlyWiki due to security constraints in modern browsers. Research is being done to build a suitable alternative. In the meantime if you have changed content in an offline ~TiddlyWiki, you can get your content back into ~TiddlySpace by using the ''import'' functionality from the backstage of the online wiki.\r\n}}}\r\n}}}\r\n\r\n!Menu\r\n&lt;&lt;message messages.memberStatus&gt;&gt; &lt;&lt;homeLink&gt;&gt;\r\n{{unsyncedList{&lt;&lt;message messages.syncListHeading&gt;&gt; &lt;&lt;list filter [is[unsynced]]&gt;&gt;}}}\r\n\r\nrunning TiddlySpace@glossary version &lt;&lt;message extensions.tiddlyweb.status.tiddlyspace_version&gt;&gt;\r\n{{autotable{\r\n&lt;&lt;tiddler Backstage##Resources&gt;&gt;\r\n}}}\r\n\r\n!Resources\r\n[[blog|@@blog]] [[documentation|@@docs]] [[featured spaces|@@featured]] \r\n\r\n!ImportExport\r\n&lt;&lt;fileImport&gt;&gt;\r\nYou can download this TiddlySpace as an offline TiddlyWiki:\r\n\r\n{{chunkyButton{&lt;&lt;exportSpace&gt;&gt;}}}\r\n\r\n!BackstageTiddlers\r\n|upload a &lt;&lt;message messages.privacySetting&gt;&gt; file: &lt;&lt;binaryUpload&gt;&gt;|&lt;&lt;closeAll&gt;&gt;&lt;&lt;permaview&gt;&gt;&lt;&lt;newTiddler&gt;&gt;&lt;&lt;newJournal \"DD MMM YYYY\" \"journal\"&gt;&gt;&lt;&lt;saveChanges&gt;&gt;|\r\n|&gt;|&lt;&lt;search&gt;&gt;|\r\n|&gt;|&lt;&lt;tiddler Backstage##Tiddlers&gt;&gt;|\r\n\r\n!Tiddlers\r\n&lt;&lt;tabs\r\n\ttxtMainTab\r\n\t\"Recent\" \"Recently edited tiddlers\" TabTimeline\r\n\t\"All\" \"All tiddlers\" TabAll\r\n\t\"Public\" \"All public tiddlers\" [[TiddlySpaceTabs##Public]]\r\n\t\"Private\" \"All private tiddlers\" [[TiddlySpaceTabs##Private]]\r\n\t\"Tags\" \"All tags\" TabTags\r\n\t\"Spaces\" \"Tiddlers grouped by space\" [[TiddlySpaceTabs##Spaces]]\r\n\t\"Missing\" \"Missing tiddlers\" TabMoreMissing\r\n\t\"Orphans\" \"Orphaned tiddlers\" TabMoreOrphans\r\n\t\"Shadows\" \"Shadowed tiddlers\" TabMoreShadowed\r\n&gt;&gt;\r\n\r\n!BatchOps\r\n&lt;&lt;tabs\r\n\ttxtPublisherTab\r\n\t\"Private\" \"Move tiddlers from private to public\" Backstage##BatchPrivate\r\n\t\"Public\" \"Move tiddlers from public to private\" Backstage##BatchPublic\r\n&gt;&gt;\r\n\r\n!BatchPrivate\r\n&lt;&lt;TiddlySpacePublisher type:private&gt;&gt;\r\n\r\n!BatchPublic\r\n&lt;&lt;TiddlySpacePublisher type:public&gt;&gt;\r\n\r\n!Plugins\r\n''Note:'' Many of these plugins are core TiddlySpace plugins and cannot be changed unless first cloned.\r\n\r\n&lt;&lt;tiddler PluginManager&gt;&gt;\r\n\r\n!Tweaks\r\nThese options change behavior in TiddlyWiki //only// and may be ineffective in TiddlySpace.\r\n\r\n&lt;&lt;tiddler AdvancedOptions&gt;&gt;</pre>\r\n</div>\r\n<div title=\"TiddlySpaceRevertRevision\" server.title=\"TiddlySpaceRevertRevision\" server.page.revision=\"1521871\" server.etag=\"&quot;system-plugins_public/TiddlySpaceRevertRevision/1521871:f40337dfed370d835ab861f6cc98db28c6c0d408&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-plugins_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-plugins_public\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeMissing excludeSearch systemConfig\" _hash=\"db2d6dc5a63b9262d62fb6ffe02dbe10fdd31feb\">\r\n<pre>/***\r\n|''Name''|TiddlySpaceRevertRevision|\r\n|''Description''|Revert to a previous revision|\r\n|''Author''|BenGillies|\r\n|''Version''|0.1|\r\n|''Status''|unstable|\r\n|''Source''|http://github.com/TiddlySpace/tiddlyspace|\r\n|''CodeRepository''|http://github.com/TiddlySpace/tiddlyspace|\r\n|''License''|[[BSD|http://www.opensource.org/licenses/bsd-license.php]]|\r\n|''CoreVersion''|2.6.0|\r\n|''Requires''|TiddlyWebAdaptor TiddlySpaceRevisionView|\r\n!Usage\r\nAdd a control button to revert to a particular revision.\r\n\r\nThe button must be called from within a revision, as generated by TiddlySpaceRevisionView\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nconfig.commands.revert = {\r\n\ttext: \"revert\",\r\n\ttooltip: \"make this revision the current one\",\r\n\thandler: function(ev, src, title) {\r\n\t\tvar revElem = story.getTiddler(title);\r\n\t\tvar tidToRevert = store.getTiddler($(revElem).attr(\"revName\"));\r\n\r\n\t\tvar revision = store.getTiddler(title);\r\n\t\tif ((revision) &amp;&amp; (tidToRevert)) {\r\n\t\t\ttidToRevert.text = revision.text;\r\n\t\t\tvar newFields = merge({}, revision.fields);\r\n\t\t\tfor (var fieldName in newFields) {\r\n\t\t\t\tif (fieldName.substr(0, 7) === \"server.\") {\r\n\t\t\t\t\tdelete newFields[fieldName];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tmerge(tidToRevert.fields, newFields);\r\n\t\t\ttidToRevert.tags = merge([], revision.tags);\r\n\t\t\ttidToRevert.fields.changecount = 1;\r\n\t\t\tdelete tidToRevert.fields.doNotSave;\r\n\r\n\t\t\tstore.saveTiddler(tidToRevert.title, tidToRevert.title,\r\n\t\t\t\ttidToRevert.text, null, null, tidToRevert.tags,\r\n\t\t\t\ttidToRevert.fields, false, tidToRevert.created, tidToRevert.creator);\r\n\r\n\t\t\tautoSaveChanges(true);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"saveTiddler\" server.title=\"saveTiddler\" server.page.revision=\"1521927\" server.etag=\"&quot;system-images_public/saveTiddler/1521927:784ffb7a7004df51a9be6254c08f29c6c1044ae8&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-images_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-images_public\" server.permissions=\"read\" server.content-type=\"image/svg+xml\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch\" _hash=\"461592520ce0f489a4d4a95f0dcb4e1e46d2f6e7\">\r\n<pre>&lt;svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xl=\"http://www.w3.org/1999/xlink\" version=\"1.1\" viewBox=\"2 724 68 55\" \r\nwidth=\"30\" height=\"30\"&gt;\r\n&lt;g stroke=\"none\" stroke-opacity=\"1\" stroke-dasharray=\"none\" fill=\"none\" fill-opacity=\"1\"&gt;\r\n\t&lt;g&gt;\r\n\t\t&lt;path d=\"M 2.25 756 L 11.25 747 L 24.75 760.4994 L 60.750004 724.4994 L 69.75 733.49902 \r\n\t\tL 24.749977 778.49976 Z\" fill=\"#101010\" class=\"glyph\"/&gt;\r\n\t&lt;/g&gt;\r\n&lt;/g&gt;\r\n&lt;/svg&gt;</pre>\r\n</div>\r\n<div title=\"日志\" server.title=\"日志\" server.page.revision=\"2564831\" server.etag=\"&quot;pearl_public/%E6%97%A5%E5%BF%97/2564831:64c4a11a24b8f7e0c618b4fd54c5fb9138308df4&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20160925052336\" created=\"20160925052324\" tags=\"\" _hash=\"b0e37941705966a37e2eccab8c51c502d48a65c2\">\r\n<pre> 日志\r\n&lt;html&gt;\r\n&lt;head&gt;\r\n      &lt;title&gt;第一个HTML代码&lt;/title&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n&lt;div align=\"center\"&gt;\r\n&lt;img src=\"http://p0.so.qhmsg.com/t01d02acc2127458705.jpg\" hight=\"300\" width=\"300\" &gt;&lt;br/&gt;\r\n&lt;/div&gt;\r\n&lt;hr width=\"800\" color=\"pink\" size\"10\"/&gt;\r\n\r\n&lt;/body&gt;\r\n&lt;/html&gt;\r\n</pre>\r\n</div>\r\n<div title=\"setDefaultTiddlers\" server.title=\"setDefaultTiddlers\" server.page.revision=\"1521878\" server.etag=\"&quot;system-info_public/setDefaultTiddlers/1521878:aa27e677a0f4776e2361f5034e9d2fa8578252d2&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-info_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-info_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch\" _hash=\"c632865df818925daec0d5040975797a27218e81\">\r\n<pre>Once you have some content then you may choose to determine a tiddler, or set of tiddlers to display each time you load ~TiddlySpace. This is determined by the [[DefaultTiddlers]].</pre>\r\n</div>\r\n<div title=\"_space\" server.title=\"_space\" server.page.revision=\"1521890\" server.etag=\"&quot;tiddlyspace/_space/1521890:e2771882a8d7c850519956b3f2370b7758443e7e&quot;\" modifier=\"None\" creator=\"None\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"text/html\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeMissing excludeSearch\" _hash=\"8c535528a72c980d5c68cc9ca28ef21cb040b270\">\r\n<pre>&lt;!DOCTYPE html&gt;\r\n&lt;html&gt;\r\n&lt;head&gt;\r\n\t&lt;meta http-equiv=\"Content-Type\" content=\"text/html;charset=utf-8\"&gt;\r\n\t&lt;title&gt;This Space&lt;/title&gt;\r\n\t&lt;link href=\"/bags/common/tiddlers/profile.css\" type='text/css' rel='stylesheet' &gt;\r\n\t&lt;link href=\"/bags/common/tiddlers/admin.css\" type='text/css' rel='stylesheet' &gt;\r\n\t&lt;!--[if lte IE 8]&gt;\r\n\t&lt;script type=\"text/javascript\" src=\"/bags/common/tiddlers/json2.js\"&gt;&lt;/script&gt;\r\n\t&lt;script type=\"text/javascript\" src=\"/bags/common/tiddlers/es5-shim.min.js\"&gt;&lt;/script&gt;\r\n\t&lt;![endif]--&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n&lt;div id=\"container\"&gt;\r\n\t&lt;div id=\"text-html\" class=\"main section\"&gt;\r\n\t\t&lt;a class=\"app\" href=\"/\"&gt;home&lt;/a&gt;\r\n\t\t&lt;div class=\"left\"&gt;\r\n\t\t&lt;h2&gt;About this space &lt;button class='toggleNext'&gt;&lt;/button&gt;&lt;/h2&gt;\r\n\t\t&lt;div id=\"siteinfo\"&gt;&lt;/div&gt;\r\n\t\t&lt;h2&gt;Site Icon&lt;/h2&gt;\r\n\t\t&lt;div&gt;\r\n\t\t\t&lt;img id=\"siteicon\" class=\"siteicon\"&gt;\r\n\t\t\t&lt;form id=\"upload\" method=\"POST\" enctype=\"multipart/form-data\"&gt;\r\n\t\t\t\t&lt;input type=\"hidden\" name=\"title\" value=\"SiteIcon\" /&gt;\r\n\t\t\t\t&lt;input type=\"hidden\" name=\"tags\" value=\"excludeLists\"&gt;\r\n\t\t\t\t&lt;input type=\"hidden\" name=\"csrf_token\" class=\"csrf\" /&gt;\r\n\t\t\t\t&lt;input type=\"file\" name=\"file\" accept=\"image/*\" /&gt;\r\n\t\t\t\t&lt;input class=\"btn\" type=\"submit\" value=\"upload\" /&gt;\r\n\t\t\t&lt;/form&gt;\r\n\t\t\t&lt;div id=\"dropzone\"&gt;Drop file here\r\n\t\t\t\t&lt;img class=\"notloading\" src=\"/bags/common/tiddlers/ajax-loader.gif\" alt=\"submitting SiteIcon\" /&gt;\r\n\t\t\t&lt;/div&gt;\r\n\t\t&lt;/div&gt;\r\n\t\t&lt;h2&gt;Vital Statistics&lt;/h2&gt;\r\n\t\t&lt;div id=\"info\"&gt;please wait while information is loaded about this space...&lt;/div&gt;\r\n\t\t&lt;button class=\"spacereset\"&gt;Reset Space&lt;/button&gt;\r\n\t\t&lt;div class=\"reset-confirm-wrap messageArea\"&gt;\r\n\t\t\t&lt;button class=\"close-btn\" title=\"cancel reset\"&gt;×&lt;/button&gt;\r\n\t\t\t&lt;p&gt;Are you sure you want to reset the space? You can't go back! This will remove all the content from the space!&lt;/p&gt;\r\n\t\t\t&lt;form class=\"cf\"&gt;\r\n\t\t\t\t&lt;label for=\"reset-confirm\"&gt;Enter the space name to confirm.&lt;/label&gt;\r\n\t\t\t\t&lt;input type=\"text\" name=\"reset-confirm\" class=\"reset-confirm-input inputBox\" /&gt;\r\n\t\t\t\t&lt;button type=\"submit\"&gt;Reset Now&lt;/button&gt;\r\n\t\t\t&lt;/form&gt;\r\n\t\t\t&lt;div class=\"reset-message-area\"&gt;\r\n\t\t\t\t&lt;p class=\"performing\"&gt;Resetting...&lt;/p&gt;\r\n\t\t\t\t&lt;p class=\"finished\"&gt;Reset Done!&lt;/p&gt;\r\n\t\t\t\t&lt;p class=\"recipe-error-msg\"&gt;Error removing includes. Please remove manually.&lt;/p&gt;\r\n\t\t\t&lt;/div&gt;\r\n\t\t&lt;/div&gt;\r\n\t\t&lt;/div&gt;\r\n\t\t&lt;div class=\"right\"&gt;\r\n\t\t&lt;div class=\"ts-membership\"&gt;\r\n\t\t\t&lt;h2&gt;\r\n\t\t\t\tAdd Member\r\n\t\t\t\t&lt;a href=\"http://docs.tiddlyspace.com/What%20is%20a%20member%3F\" title=\"What is a Member?\" class=\"help\"&gt;What is a Member?&lt;/a&gt;\r\n\t\t\t&lt;/h2&gt;\r\n\t\t\t&lt;div&gt;\r\n\t\t\t\t&lt;p&gt;Add a new member to your space by entering their name below. Enter a space name instead and prefix with @ to add everyone who is already a member of that space.&lt;/p&gt;\r\n\t\t\t\t&lt;form class=\"ts-members\"&gt;\r\n\t\t\t\t\t&lt;input class=\"inputBox\" type=\"text\" name=\"username\"&gt;\r\n\t\t\t\t\t&lt;input type=\"submit\" value=\"Add Member\" class=\"btn\" /&gt;\r\n\t\t\t\t&lt;/form&gt;\r\n\t\t\t&lt;/div&gt;\r\n\t\t\t&lt;h2&gt;\r\n\t\t\t\tExisting Members &lt;button class='toggleNext'&gt;&lt;/button&gt;\r\n\t\t\t&lt;/h2&gt;\r\n\t\t\t&lt;div&gt;\r\n\t\t\t\tYour space currently has the following members: \r\n\t\t\t\t&lt;ul class=\"ts-members\"&gt;&lt;/ul&gt;\r\n\t\t\t&lt;/div&gt;\r\n\t\t\t&lt;h2&gt;\r\n\t\t\t\tInclude Space\r\n\t\t\t\t&lt;a class=\"help\" href=\"http://docs.tiddlyspace.com/What%20is%20space%20inclusion%3F\" title=\"What is inclusion?\"&gt;What is Inclusion?&lt;/a&gt;\r\n\t\t\t&lt;/h2&gt;\r\n\t\t\t&lt;form class=\"ts-includes\"&gt;\r\n\t\t\t\t&lt;input class=\"inputBox\" type=\"text\" name=\"spacename\"&gt;\r\n\t\t\t\t&lt;input type=\"submit\" value=\"Include Space\" class=\"btn\" /&gt;\r\n\t\t\t&lt;/form&gt;\r\n\t\t&lt;/div&gt;\r\n\t\t&lt;div&gt;\r\n\t\t\t&lt;h2&gt;Included Spaces &lt;button class='toggleNext'&gt;&lt;/button&gt;&lt;/h2&gt;\r\n\t\t\t&lt;div&gt;\r\n\t\t\tThis space includes the following spaces:\r\n\t\t\t&lt;ul class=\"ts-includes\"&gt;&lt;/ul&gt;\r\n\t\t\t&lt;/div&gt;\r\n\t\t&lt;/div&gt;\r\n\t\t&lt;/div&gt;\r\n\t\t&lt;div class=\"clear\"&gt;&lt;/div&gt;\r\n\t&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;script src='/bags/common/tiddlers/backstage.js'&gt;&lt;/script&gt;\r\n&lt;script src='/bags/common/tiddlers/jquery.js'&gt;&lt;/script&gt;\r\n&lt;script src='/bags/tiddlyspace/tiddlers/chrjs'&gt;&lt;/script&gt;\r\n&lt;script src='/bags/common/tiddlers/chrjs.space'&gt;&lt;/script&gt;\r\n&lt;script src='/bags/common/tiddlers/chrjs.users'&gt;&lt;/script&gt;\r\n&lt;script src='/bags/common/tiddlers/chrjs.identities'&gt;&lt;/script&gt;\r\n&lt;script src='/bags/tiddlyspace/tiddlers/TiddlySpaceCSRF'&gt;&lt;/script&gt;\r\n&lt;script src='/bags/common/tiddlers/jquery-form.js'&gt;&lt;/script&gt;\r\n&lt;script src=\"/bags/common/tiddlers/siteiconupload.js\"&gt;&lt;/script&gt;\r\n&lt;script src=\"/bags/common/tiddlers/ts.js\"&gt;&lt;/script&gt;\r\n&lt;script src=\"/status.js\"&gt;&lt;/script&gt;\r\n&lt;script src=\"/bags/common/tiddlers/space.js\"&gt;&lt;/script&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;</pre>\r\n</div>\r\n<div title=\"robots\" server.title=\"robots\" server.page.revision=\"1521875\" server.etag=\"&quot;system-info_public/robots/1521875:7afb9721e95c16c18e87c6dcb2c1e84cdea60482&quot;\" modifier=\"None\" creator=\"None\" server.workspace=\"bags/system-info_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-info_public\" server.permissions=\"read\" server.content-type=\"text/plain\" modified=\"20130530195018\" created=\"20130530195018\" tags=\"excludeLists excludeSearch\" _hash=\"35333958a4be1e71dffd5f713170f41c5785914a\">\r\n<pre>User-agent: *\r\nDisallow: /bags\r\nDisallow: /recipes</pre>\r\n</div>\r\n<div title=\"ErrorHandler\" server.title=\"ErrorHandler\" server.page.revision=\"1521896\" server.etag=\"&quot;tiddlyspace/ErrorHandler/1521896:d51e40969847052b88a7caf5717f10c52c1d6896&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"ffff853197a5561dfaef34fd40efbb0c738fbc79\">\r\n<pre>/***\r\n|''Name''|ErrorHandlerPlugin|\r\n|''Version''|0.4.3|\r\n|''Author''|Jon Robson|\r\n|''Description''|Localised tiddler save errors including edit conflict resolution.|\r\n|''CoreVersion''|2.6.1|\r\n|''Requires''|TiddlySpaceConfig|\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nvar tiddlyspace = config.extensions.tiddlyspace;\r\nvar currentSpace = tiddlyspace.currentSpace.name;\r\ntiddlyspace.getLocalTitle = function(title, workspace, suffix) {\r\n\tvar endsWith = config.extensions.BinaryTiddlersPlugin.endsWith;\r\n\tif(!suffix) {\r\n\t\tvar isPublic = endsWith(workspace, \"_public\");\r\n\t\tsuffix = tiddlyspace.resolveSpaceName(workspace);\r\n\t\tif(currentSpace == suffix) {\r\n\t\t\tsuffix = isPublic ? \"public\" : \"private\";\r\n\t\t} else {\r\n\t\t\tsuffix = \"@%0\".format(suffix);\r\n\t\t}\r\n\t}\r\n\treturn \"%0 *(%1)*\".format(title, suffix);\r\n};\r\n\r\nvar sssp = config.extensions.ServerSideSavingPlugin;\r\n\r\nvar msgs = config.messages.editConflict = {\r\n\tloading: \"Loading..\",\r\n\tresolve: \"[[Edit Conflict]]@glossary: this tiddler may have been changed by someone else.\",\r\n\treviewDiff: \"review (recommended)\",\r\n\treviewDiffTooltip: \"review changes made to this tiddler\",\r\n\treviewDiffError: \"error retrieving revision.\",\r\n\tsave: \"overwrite\",\r\n\tsaveTooltip: \"make this revision the top revision of this tiddler\",\r\n\tdiscard: \"cancel\",\r\n\tdiscardTooltip: \"undo changes to this tiddler and get most recent version\",\r\n\tdiffTitle: \"%0\",\r\n\tdiffFieldTitle: \"%0 - fields\",\r\n\tdiffTextTitle: \"%0 - text\",\r\n\tupdating: \"updating your version...\",\r\n\tdiffHeader: [\"Review the changes that have been made whilst you were editing this tiddler. \",\r\n\t\t\"Fold relevant changes back into your version.\\n\",\r\n\t\t\"{{removed{Red}}} highlight shows content removed. \",\r\n\t\t\"{{added{Green}}} highlight shows content added.\\n\"].join(\"\"),\r\n\tdiffTextHeader: \"View changes in text\",\r\n\tdiffFieldsHeader: \"View changes in fields\"\r\n};\r\n\r\nvar plugin = config.extensions.errorHandler = {\r\n\tdiffTags: [\"excludeLists\", \"excludeMissing\", \"excludeSearch\"],\r\n\tdisplayMessage: function(message, tiddler, context) {\r\n\t\tvar desc = context &amp;&amp; context.httpStatus ? context.statusText :\r\n\t\t\tsssp.locale.connectionError;\r\n\t\tvar reportArea = plugin.reportError(tiddler.title);\r\n\t\tvar msg = $(\"&lt;div /&gt;\").appendTo(reportArea);\r\n\t\tif(message == \"saveConflict\") {\r\n\t\t\twikify(msgs.resolve, msg[0]);\r\n\t\t\tvar choiceArea = $(\"&lt;div /&gt;\").appendTo(reportArea)[0];\r\n\t\t\tplugin.editConflictHandler(choiceArea, tiddler);\r\n\t\t} else {\r\n\t\t\tmsg.text(sssp.locale[message].format(tiddler.title, desc));\r\n\t\t}\r\n\t},\r\n\teditConflictHandler: function(container, tiddler) {\r\n\t\tvar title = tiddler.title;\r\n\t\tvar myrev = tiddler.fields[\"server.page.revision\"];\r\n\t\t// note user now needs to edit, fix problem and save. \r\n\t\t// TODO: make sure this gets reset in save callback\r\n\t\tstore.getTiddler(title).fields[\"server.page.revision\"] = \"false\";\r\n\r\n\t\tvar diffBtn = createTiddlyButton(container, msgs.reviewDiff, msgs.reviewDiffTooltip, function(ev) {\r\n\t\t\tvar title = $(ev.target).data(\"title\");\r\n\t\t\tplugin.displayDiff(ev.target, store.getTiddler(title), myrev);\r\n\t\t});\r\n\t\tvar saveBtn = createTiddlyButton(container, msgs.save, msgs.saveTooltip, function(ev) {\r\n\t\t\t\tvar title = $(ev.target).data(\"title\");\r\n\t\t\t\tvar tid = store.saveTiddler(store.getTiddler(title));\r\n\t\t\t\tautoSaveChanges(null, [tid]);\r\n\t\t\t});\r\n\t\tvar ignoreBtn = createTiddlyButton(container, msgs.discard, msgs.discardTooltip, function(ev) {\r\n\t\t\tvar title = $(ev.target).text(msgs.updating).data(\"title\");\r\n\t\t\tplugin.resetToServerVersion(store.getTiddler(title));\r\n\t\t});\r\n\t\t$([diffBtn, ignoreBtn, saveBtn]).data(\"title\", title);\r\n\t},\r\n\tgetDiffTiddlerTexts: function(diffText) {\r\n\t\tvar chunks = diffText.split(\"\\n  \\n\");\r\n\t\tif(chunks.length &lt; 2) {\r\n\t\t\treturn [chunks[0], \"\"];\r\n\t\t} else {\r\n\t\t\tvar diffFieldsText = \"{{diff{\\n%0\\n}}}\".format(chunks[0]);\r\n\t\t\tdiffText = '{{diff{\\n%0\\n}}}'.format(chunks.splice(1, chunks.length).join(\"\\n\"));\r\n\t\t\treturn [diffText, diffFieldsText];\r\n\t\t}\r\n\t},\r\n\tmakeDiffTiddler: function(title, diff) {\r\n\t\tvar newTiddler = new Tiddler(title);\r\n\t\tvar tags = plugin.diffTags;\r\n\t\tnewTiddler.text = msgs.loading;\r\n\t\tnewTiddler.fields.doNotSave = true;\r\n\t\tnewTiddler.tags = diff ? tags.concat([\"diff\"]) : tags;\r\n\t\tnewTiddler = store.saveTiddler(newTiddler);\r\n\t\t$.extend(store.getTiddler(title).fields,\r\n\t\t\tconfig.defaultCustomFields); // allow option to save it\r\n\t\treturn newTiddler;\r\n\t},\r\n\tdisplayDiff: function(src, tiddler, latestRevision) {\r\n\t\tvar adaptor = tiddler.getAdaptor();\r\n\t\tvar title = tiddler.title;\r\n\t\tvar ts = new Date().formatString(\"0hh:0mm:0ss\");\r\n\t\tvar suffix = \"edit conflict %0\".format(ts);\r\n\t\tvar diffTitle = tiddlyspace.getLocalTitle(msgs.diffTitle.format(title), \"\", suffix);\r\n\t\tvar diffTextTitle = tiddlyspace.getLocalTitle(msgs.diffTextTitle.format(title), \"\", suffix);\r\n\t\tvar diffFieldsTitle = tiddlyspace.getLocalTitle(msgs.diffFieldTitle.format(title), \"\", suffix);\r\n\t\tplugin.makeDiffTiddler(diffTextTitle, true);\r\n\t\tplugin.makeDiffTiddler(diffFieldsTitle, true);\r\n\t\tvar newTiddler = plugin.makeDiffTiddler(diffTitle, false);\r\n\t\tnewTiddler.text = ['%0\\n&lt;&lt;slider chkViewDiffText \"%1\" \"%2\"&gt;&gt;\\n',\r\n\t\t\t'&lt;&lt;slider chkViewDiffField \"%3\" \"%4\"&gt;&gt;'].join(\"\").\r\n\t\t\tformat(msgs.diffHeader, diffTextTitle, msgs.diffTextHeader,\r\n\t\t\t\tdiffFieldsTitle, msgs.diffFieldsHeader);\r\n\t\tstore.saveTiddler(newTiddler);\r\n\r\n\t\tvar callback = function(r) {\r\n\t\t\tvar text = plugin.getDiffTiddlerTexts(r);\r\n\t\t\tstore.getTiddler(diffTextTitle).text = text[0];\r\n\t\t\tstore.getTiddler(diffFieldsTitle).text = text[1];\r\n\t\t\tstory.refreshTiddler(diffTitle, null, true);\r\n\t\t};\r\n\t\tvar workspace = \"bags/%0\".format(tiddler.fields[\"server.bag\"]);\r\n\t\tajaxReq({\r\n\t\t\ttype: \"get\",\r\n\t\t\tdataType: \"text\",\r\n\t\t\turl: \"/diff?format=unified&amp;rev1=%0/%1/%2&amp;rev2=%0/%1\".format(workspace, title, latestRevision),\r\n\t\t\tsuccess: callback,\r\n\t\t\terror: function() {\r\n\t\t\t\tdisplayMessage(msgs.reviewDiffError);\r\n\t\t\t}\r\n\t\t});\r\n\t\tstory.displayTiddler(src, diffTitle);\r\n\t},\r\n\tresetToServerVersion: function(tiddler) {\r\n\t\tvar adaptor = tiddler.getAdaptor();\r\n\t\tvar ctx = { \r\n\t\t\thost: tiddler.fields[\"server.host\"],\r\n\t\t\tworkspace: \"bags/\" + tiddler.fields[\"server.bag\"]\r\n\t\t};\r\n\t\tadaptor.getTiddler(tiddler.title, ctx, null, function(context) {\r\n\t\t\tstore.saveTiddler(context.tiddler);\r\n\t\t\tstory.refreshTiddler(tiddler.title);\r\n\t\t\tstore.setDirty(false);\r\n\t\t});\r\n\t},\r\n\treportError: function(title) {\r\n\t\tvar el = story.getTiddler(title);\r\n\t\tif(!el) {\r\n\t\t\tel = story.displayTiddler(null, title);\r\n\t\t}\r\n\t\treturn $(\"&lt;div /&gt;\").addClass(\"error annotation\").prependTo(el)[0];\r\n\t}\r\n};\r\n\r\nsssp.reportFailure = function(message, tiddler, context) {\r\n\tconfig.options.chkViewDiffText = config.options.chkViewDiffText === undefined ?\r\n\t\ttrue : config.options.chkViewDiffText;\r\n\tconfig.options.chkViewDiffFields = config.options.chkViewDiffFields || false;\r\n\tplugin.displayMessage(message, tiddler, context);\r\n};\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"写作\" server.title=\"写作\" server.page.revision=\"2576631\" server.etag=\"&quot;pearl_public/%E5%86%99%E4%BD%9C/2576631:9131c4b21d08a7d345a863ff426a362781d76511&quot;\" modifier=\"pearl\" creator=\"pearl\" server.workspace=\"bags/pearl_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"pearl_public\" server.permissions=\"read, write, create, delete\" server.content-type=\"\" modified=\"20161025103542\" created=\"20160914131850\" tags=\"\" _hash=\"f43847616736df6b68a630bf1b4cfcb2ce8ab5b8\">\r\n<pre>  \r\n\r\n</pre>\r\n</div>\r\n<div title=\"TiddlySpaceTiddlerIconsPlugin\" server.title=\"TiddlySpaceTiddlerIconsPlugin\" server.page.revision=\"1521862\" server.etag=\"&quot;system-plugins_public/TiddlySpaceTiddlerIconsPlugin/1521862:3d5881e9b533f1a598ab4cc2da2a00c344a4ee46&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-plugins_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-plugins_public\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"5c6cfebcd3cc3fd2df109c0d59735aaae48850b4\">\r\n<pre>/***\r\n|''Name''|TiddlySpaceTiddlerIconsPlugin|\r\n|''Version''|0.8.10|\r\n|''Status''|@@beta@@|\r\n|''Author''|Jon Robson|\r\n|''Description''|Provides ability to render SiteIcons and icons that correspond to the home location of given tiddlers|\r\n|''Source''|http://github.com/TiddlySpace/tiddlyspace/raw/master/src/plugins/TiddlySpaceTiddlerIconsPlugin.js|\r\n|''Requires''|TiddlySpaceConfig BinaryTiddlersPlugin ImageMacroPlugin TiddlySpacePublishingCommands|\r\n!Notes\r\n{{{&lt;&lt;tiddlerOrigin&gt;&gt;}}} shows the origin of the tiddler it is being run on.\r\nIn TiddlySpace terms this means it will determine whether the tiddler is external, public or private.\r\nWhere private it will analyse whether a public version exists and distinguish between the different scenarios.\r\nIf a tiddler is external, the SiteIcon of that external space will be shown\r\n\r\n!Parameters\r\nwidth / height : define a width or height of the outputted icon\r\nlabel: if label parameter is set to yes, a label will accompany the icon.\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nif(!config.macros.image) {\r\n\tthrow \"Missing dependency: ImageMacroPlugin\";\r\n}\r\n\r\nvar imageMacro = config.macros.image;\r\nvar tiddlyspace = config.extensions.tiddlyspace;\r\nvar tweb = config.extensions.tiddlyweb;\r\nvar cmds = config.commands;\r\nvar cmd = cmds.publishTiddler;\r\ntiddlyspace.resolveSpaceName = function(value) {\r\n\tvar endsWith = config.extensions.BinaryTiddlersPlugin.endsWith;\r\n\tif(value) {\r\n\t\tvalue = value.indexOf(\"bags/\") === 0 ? value.substr(5) : value;\r\n\t\tvalue = value.indexOf(\"recipes/\") === 0 ? value.substr(8) : value;\r\n\t\tif(value.indexOf(\"@\") === 0) {\r\n\t\t\tvalue = value.substr(1);\r\n\t\t}\r\n\t\tif(endsWith(value, \"_public\")) {\r\n\t\t\tvalue = value.substr(0, value.length - 7);\r\n\t\t} else if(endsWith(value, \"_private\")) {\r\n\t\t\tvalue = value.substr(0, value.length - 8);\r\n\t\t}\r\n\t\tvalue = value.toLowerCase();\r\n\t}\r\n\treturn value;\r\n};\r\n\r\ntiddlyspace.renderAvatar = function(place, value, options) {\r\n\toptions = options ? options : {};\r\n\toptions.labelOptions = options.labelOptions ? options.labelOptions : { include: false, height: 48, width: 48 };\r\n\toptions.imageOptions = options.imageOptions ? options.imageOptions : {};\r\n\toptions.imageOptions.altImage = \"/bags/common/tiddlers/defaultUserIcon\";\r\n\tvar container = $('&lt;div class=\"siteIcon\" /&gt;').appendTo(place);\r\n\tvalue = tiddlyspace.resolveSpaceName(value);\r\n\r\n\ttweb.getStatus(function(status) {\r\n\t\tvar link, noLabel;\r\n\t\tif(!value || value == config.views.wikified.defaultModifier ||\r\n\t\t\tvalue == config.views.wikified.shadowModifier) {\r\n\t\t\tvar icon = config.views.wikified.shadowModifier == value ? \"shadowIcon\" : \"missingIcon\";\r\n\t\t\tif(store.tiddlerExists(icon)) {\r\n\t\t\t\timageMacro.renderImage(container, icon, options.imageOptions);\r\n\t\t\t} else {\r\n\t\t\t\tnoLabel = true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar spaceURI;\r\n\t\t\tif(value != tiddlyspace.currentSpace.name) {\r\n\t\t\t\tspaceURI = options.notSpace ? tiddlyspace.getHost(status.server_host) :\r\n\t\t\t\t\ttiddlyspace.getHost(status.server_host, value);\r\n\t\t\t}\r\n\t\t\tlink = spaceURI ? $(\"&lt;a /&gt;\").attr(\"href\", spaceURI) : $(\"&lt;span /&gt;\");\r\n\t\t\tlink.text(value);\r\n\r\n\t\t\tvar imageOptions = options.imageOptions;\r\n\t\t\tif(options.spaceLink &amp;&amp; !imageOptions.link) {\r\n\t\t\t\timageOptions.link = spaceURI;\r\n\t\t\t}\r\n\t\t\tvar avatar = options.notSpace ? false : value;\r\n\t\t\tvar uri = tiddlyspace.getAvatar(status.server_host, avatar);\r\n\t\t\timageMacro.renderImage(container, uri, options.imageOptions);\r\n\t\t\tif(!value) {\r\n\t\t\t\tvalue = \"tiddlyspace\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!noLabel &amp;&amp; options.labelOptions.include) {\r\n\t\t\tvar prefix = $(\"&lt;span /&gt;\").text(options.labelOptions.prefix || \"\")[0];\r\n\t\t\tvar suffix = $(\"&lt;span /&gt;\").text(options.labelOptions.suffix || \"\")[0];\r\n\t\t\t$('&lt;div class=\"label\" /&gt;').append(prefix).append(link).\r\n\t\t\t\tappend(suffix).appendTo(container);\r\n\t\t}\r\n\t});\r\n\tif(value) {\r\n\t\tvar prefix = options.labelOptions.prefix || \"\";\r\n\t\tvar suffix = options.labelOptions.suffix || \"\";\r\n\t\tvar label = \"%0%1%2\".format(prefix, value, suffix);\r\n\t\t$(container).attr(\"title\", label);\r\n\t}\r\n};\r\n\r\nvar originMacro = config.macros.tiddlerOrigin = {\r\n\tlocale: {\r\n\t\t\"shadow\": \"shadow tiddler\",\r\n\t\t\"missing\": \"missing tiddler\",\r\n\t\t\"private\": \"private\",\r\n\t\t\"unknown\": \"unknown state\",\r\n\t\t\"public\": \"public\",\r\n\t\t\"unsyncedPrivate\": \"unsynced and private\",\r\n\t\t\"unsyncedPublic\": \"unsynced and public\",\r\n\t\texternalPrefix: \"from \",\r\n\t\texternalBagSuffix: \" bag\",\r\n\t\texternalSuffix: \" space\",\r\n\t\tpublishPrivateDeletePrivate: \"Are you sure you want to make this tiddler public?\",\r\n\t\tmoveToPrivate: \"Are you sure you want to make this tiddler private? Only members will be able to see it.\",\r\n\t\tpleaseWait: \"please wait..\",\r\n\t\tkeepPublic: \"keep public\",\r\n\t\tcannotPublishDirtyTiddler: \"The current tiddler is unsaved so cannot be published. Please save the tiddler first.\",\r\n\t\tkeepPrivate: \"keep private\",\r\n\t\tmakePublic: \"make public\",\r\n\t\tmakePrivate: \"make private\"\r\n\t},\r\n\thandler: function(place, macroName, params,wikifier, paramString, tiddler){\r\n\t\tvar adaptor = tiddler.getAdaptor();\r\n\t\tvar btn = $(\"&lt;div /&gt;\").addClass(\"originButton\").attr(\"params\", paramString).\r\n\t\t\tattr(\"refresh\", \"macro\").attr(\"macroName\", macroName).appendTo(place)[0];\r\n\t\t$(btn).data(\"tiddler\", tiddler);\r\n\t\toriginMacro.refresh(btn);\r\n\t},\r\n\trefresh: function(btn) {\r\n\t\t$(btn).empty();\r\n\t\tvar paramString = $(btn).attr(\"params\");\r\n\t\tvar tiddler = $(btn).data(\"tiddler\");\r\n\t\tvar options = originMacro.getOptions(paramString);\r\n\t\tvar type = tiddlyspace.getTiddlerStatusType(tiddler);\r\n\t\toriginMacro.renderIcon(tiddler, type, btn, options);\r\n\t},\r\n\tgetOptions: function(paramString) {\r\n\t\tparamString = \"%0 label:no width:48 height:48 spaceLink:yes preserveAspectRatio:yes\".format(paramString);\r\n\t\tvar parsedParams = paramString.parseParams(\"name\");\r\n\t\tvar params = parsedParams[0].name;\r\n\t\tvar options = {\r\n\t\t\tlabelOptions: originMacro._getLabelOptions(parsedParams),\r\n\t\t\timageOptions: imageMacro.getArguments(paramString, []),\r\n\t\t\tnoclick: parsedParams[0].interactive &amp;&amp;\r\n\t\t\t\tparsedParams[0].interactive[0] == \"no\" ? true : false\r\n\t\t};\r\n\t\tif(!options.noclick) {\r\n\t\t\tvar spaceLink = parsedParams[0].spaceLink;\r\n\t\t\toptions.spaceLink = spaceLink &amp;&amp; spaceLink[0] == \"no\" ? false : true;\r\n\t\t} else {\r\n\t\t\toptions.spaceLink = false;\r\n\t\t}\r\n\t\treturn options;\r\n\t},\r\n\t_getLabelOptions: function(parsedParams) {\r\n\t\tparsedParams = parsedParams[0];\r\n\t\tvar includeLabel = !parsedParams.label || ( parsedParams.label &amp;&amp; parsedParams.label[0] == \"yes\" );\r\n\t\tvar prefix = parsedParams.labelPrefix ? parsedParams.labelPrefix[0] : false;\r\n\t\tvar suffix = parsedParams.labelSuffix ? parsedParams.labelSuffix[0] : false;\r\n\t\treturn { include: includeLabel, suffix: suffix, prefix: prefix };\r\n\t},\r\n\t_isSpace: function(value) {\r\n\t\tvalue = value ? value : \"\";\r\n\t\tvar endsWith = config.extensions.BinaryTiddlersPlugin.endsWith;\r\n\t\tif(endsWith(value, \"_private\") || endsWith(value, \"_public\")) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t},\r\n\trenderIcon: function(tiddler, type, button, options) {\r\n\t\tvar locale = originMacro.locale;\r\n\t\toriginMacro.annotateTiddler(button, type);\r\n\t\tif(type != \"external\") {\r\n\t\t\toriginMacro.showPrivacyRoundel(tiddler, type, button,\r\n\t\t\t\toptions);\r\n\t\t} else {\r\n\t\t\tvar prefix = options.labelOptions.prefix, suffix = options.labelOptions.suffix;\r\n\t\t\tvar space = tiddler.fields[\"server.bag\"];\r\n\t\t\toptions.notSpace = !originMacro._isSpace(space);\r\n\t\t\toptions.labelOptions.prefix = prefix ? prefix : locale.externalPrefix;\r\n\t\t\toptions.labelOptions.suffix = suffix ? suffix : (options.notSpace ? locale.externalBagSuffix : locale.externalSuffix);\r\n\r\n\t\t\ttiddlyspace.renderAvatar(button, space, options);\r\n\t\t}\r\n\t},\r\n\tshowPrivacyRoundel: function(thisTiddler, privacyType, button, options) {\r\n\t\t// there is a public tiddler as well as the current tiddler!\r\n\t\t// TODO: not this is not enough.. we also need to check if the public tiddler is the same as..\r\n\t\t// .. the private tiddler to determine whether this is a draft\r\n\t\t// use of hashes would be useful here.\r\n\t\t$(button).empty();\r\n\t\tvar icon = \"%0Icon\".format(privacyType);\r\n\t\tif(privacyType.indexOf(\"unsynced\") === 0 &amp;&amp; !store.tiddlerExists(icon)) {\r\n\t\t\ticon = \"unsyncedIcon\";\r\n\t\t}\r\n\t\tif(privacyType == \"shadow\") {\r\n\t\t\tif(!store.tiddlerExists(icon)) {\r\n\t\t\t\ticon = \"bags/tiddlyspace/tiddlers/SiteIcon\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(privacyType == \"missing\" &amp;&amp; !store.tiddlerExists(icon)) {\r\n\t\t\treturn; // the user is not making use of the missingIcon\r\n\t\t} else {\r\n\t\t\timageMacro.renderImage(button, icon, options.imageOptions);\r\n\t\t\toriginMacro.showLabel(button, privacyType, options.labelOptions);\r\n\t\t\tvar cmd = originMacro.iconCommands[privacyType];\r\n\t\t\tif(cmd &amp;&amp; thisTiddler &amp;&amp; !options.noclick) {\r\n\t\t\t\t$(button).click(function(ev) {\r\n\t\t\t\t\tcmd(ev, thisTiddler);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tannotateTiddler: function(place, type) {\r\n\t\tvar tidEl = $(story.findContainingTiddler(place));\r\n\t\ttidEl.\r\n\t\t\tremoveClass(\"private public external privateAndPublic privateNotPublic shadow\").\r\n\t\t\taddClass(type);\r\n\t},\r\n\tshowLabel: function(button, type, options) {\r\n\t\tvar locale = originMacro.locale;\r\n\t\tvar label = options.label ? options.label : locale[type];\r\n\t\tlabel = label ? label : locale.unknown;\r\n\t\tif(options &amp;&amp; options.include) {\r\n\t\t\t$('&lt;div class=\"roundelLabel\" /&gt;').html(label).appendTo(button);\r\n\t\t}\r\n\t\t$(button).attr(\"title\", label);\r\n\t},\r\n\tconfirm: function(ev, msg, onYes, options) {\r\n\t\toptions = options ? options : {};\r\n\t\tonYes = onYes ? onYes : function(ev) {};\r\n\t\tvar btn = $(\".originButton\", $(ev.target).parents())[0];\r\n\t\tvar popup = Popup.create(btn);\r\n\t\t$(popup).addClass(\"confirmationPopup\");\r\n\t\t$(\"&lt;div /&gt;\").addClass(\"message\").text(msg).appendTo(popup);\r\n\t\t$(\"&lt;button /&gt;\").addClass(\"button\").text(options.yesLabel || \"yes\").appendTo(popup).click(onYes);\r\n\t\t$(\"&lt;button /&gt;\").addClass(\"button\").text(options.noLabel || \"no\").click(function(ev) {\r\n\t\t\tPopup.remove();\r\n\t\t}).appendTo(popup);\r\n\t\tPopup.show();\r\n\t\tev.stopPropagation();\r\n\t\treturn false;\r\n\t},\r\n\talert: function(ev, msg) {\r\n\t\tvar popup = Popup.create(ev.target);\r\n\t\t$(popup).addClass(\"confirmationPopup alert\");\r\n\t\t$(\"&lt;div /&gt;\").addClass(\"message\").text(msg).appendTo(popup);\r\n\t\tPopup.show();\r\n\t\tev.stopPropagation();\r\n\t},\r\n\treportDirty: function(el) {\r\n\t\toriginMacro.alert(el, originMacro.locale.cannotPublishDirtyTiddler);\r\n\t},\r\n\ticonCommands: {\r\n\t\t\"public\": function(ev, tiddler) {\r\n\t\t\tif(!readOnly) {\r\n\t\t\t\tvar locale = originMacro.locale;\r\n\t\t\t\tvar msg = locale.moveToPrivate;\r\n\t\t\t\tif(story.isDirty(tiddler.title)) {\r\n\t\t\t\t\toriginMacro.reportDirty(ev);\r\n\t\t\t\t} else {\r\n\t\t\t\t\toriginMacro.confirm(ev, msg, function(ev) {\r\n\t\t\t\t\t\tvar target = $(ev.target);\r\n\t\t\t\t\t\tvar onComplete = function(info) {};\r\n\t\t\t\t\t\tvar privateBag = cmd.toggleBag(tiddler, \"private\");\r\n\t\t\t\t\t\tcmd.moveTiddler(tiddler, {\r\n\t\t\t\t\t\t\ttitle: tiddler.title,\r\n\t\t\t\t\t\t\tfields: { \"server.bag\": privateBag }\r\n\t\t\t\t\t\t}, onComplete);\r\n\t\t\t\t\t}, { yesLabel: locale.makePrivate, noLabel: locale.keepPublic });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"private\": function(ev, tiddler) {\r\n\t\t\tif(!readOnly) {\r\n\t\t\t\tvar locale = originMacro.locale;\r\n\t\t\t\tvar adaptor = tiddler.getAdaptor();\r\n\t\t\t\tvar publishTo = tiddler.fields[\"publish.name\"] || tiddler.title;\r\n\t\t\t\tvar workspace = \"bags/%0\".format(tiddler.fields[\"server.bag\"]);\r\n\t\t\t\ttiddler.fields[\"server.workspace\"] = workspace;\r\n\t\t\t\tvar publicBag = cmd.toggleBag(tiddler, \"public\");\r\n\t\t\t\tvar msg;\r\n\t\t\t\tmsg = locale.publishPrivateDeletePrivate;\r\n\t\t\t\tvar title = tiddler.title;\r\n\t\t\t\tvar newTitle = publishTo || tiddler.title;\r\n\t\t\t\ttiddler.fields[\"server.page.revision\"] = \"false\";\r\n\t\t\t\tstore.addTiddler(tiddler);\r\n\t\t\t\tif(story.isDirty(tiddler.title)) {\r\n\t\t\t\t\toriginMacro.reportDirty(ev);\r\n\t\t\t\t} else {\r\n\t\t\t\t\toriginMacro.confirm(ev, msg, function(ev) {\r\n\t\t\t\t\t\tvar onComplete = function(info) {};\r\n\t\t\t\t\t\tcmd.moveTiddler(tiddler, {\r\n\t\t\t\t\t\t\ttitle: newTitle,\r\n\t\t\t\t\t\t\tfields: { \"server.bag\": publicBag }\r\n\t\t\t\t\t\t}, onComplete);\r\n\t\t\t\t\t}, { yesLabel: locale.makePublic, noLabel: locale.keepPrivate });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"ServerSideSavingPlugin\" server.title=\"ServerSideSavingPlugin\" server.page.revision=\"1521853\" server.etag=\"&quot;system/ServerSideSavingPlugin/1521853:66489c64a89ac12696e2b96a430f28201cbd1caf&quot;\" modifier=\"FND\" creator=\"FND\" server.workspace=\"bags/system\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20130924180405\" created=\"20130924180405\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"d72cde071d926d9c66939444817d7e8621d24d9c\">\r\n<pre>/***\r\n|''Name''|ServerSideSavingPlugin|\r\n|''Description''|server-side saving|\r\n|''Author''|FND|\r\n|''Version''|0.6.5|\r\n|''Status''|stable|\r\n|''Source''|http://svn.tiddlywiki.org/Trunk/association/plugins/ServerSideSavingPlugin.js|\r\n|''License''|[[BSD|http://www.opensource.org/licenses/bsd-license.php]]|\r\n|''CoreVersion''|2.5.3|\r\n|''Keywords''|serverSide|\r\n!Notes\r\nThis plugin relies on a dedicated adaptor to be present.\r\nThe specific nature of this plugin depends on the respective server.\r\n!Revision History\r\n!!v0.1 (2008-11-24)\r\n* initial release\r\n!!v0.2 (2008-12-01)\r\n* added support for local saving\r\n!!v0.3 (2008-12-03)\r\n* added Save to Web macro for manual synchronization\r\n!!v0.4 (2009-01-15)\r\n* removed ServerConfig dependency by detecting server type from the respective tiddlers\r\n!!v0.5 (2009-08-25)\r\n* raised CoreVersion to 2.5.3 to take advantage of core fixes\r\n!!v0.6 (2010-04-21)\r\n* added notification about cross-domain restrictions to ImportTiddlers\r\n!To Do\r\n* conflict detection/resolution\r\n* rename to ServerLinkPlugin?\r\n* document deletion/renaming convention\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nreadOnly = false; //# enable editing over HTTP\r\n\r\nvar plugin = config.extensions.ServerSideSavingPlugin = {};\r\n\r\nplugin.locale = {\r\n\tsaved: \"%0 saved successfully\",\r\n\tsaveError: \"Error saving %0: %1\",\r\n\tsaveConflict: \"Error saving %0: edit conflict\",\r\n\tdeleted: \"Removed %0\",\r\n\tdeleteError: \"Error removing %0: %1\",\r\n\tdeleteLocalError: \"Error removing %0 locally\",\r\n\tremovedNotice: \"This tiddler has been deleted.\",\r\n\tconnectionError: \"connection could not be established\",\r\n\thostError: \"Unable to import from this location due to cross-domain restrictions.\"\r\n};\r\n\r\nplugin.sync = function(tiddlers) {\r\n\ttiddlers = tiddlers &amp;&amp; tiddlers[0] ? tiddlers : store.getTiddlers();\r\n\t$.each(tiddlers, function(i, tiddler) {\r\n\t\tvar changecount = parseInt(tiddler.fields.changecount, 10);\r\n\t\tif(tiddler.fields.deleted === \"true\" &amp;&amp; changecount === 1) {\r\n\t\t\tplugin.removeTiddler(tiddler);\r\n\t\t} else if(tiddler.isTouched() &amp;&amp; !tiddler.doNotSave() &amp;&amp;\r\n\t\t\t\ttiddler.getServerType() &amp;&amp; tiddler.fields[\"server.host\"]) { // XXX: server.host could be empty string\r\n\t\t\tdelete tiddler.fields.deleted;\r\n\t\t\tplugin.saveTiddler(tiddler);\r\n\t\t}\r\n\t});\r\n};\r\n\r\nplugin.saveTiddler = function(tiddler) {\r\n\ttry {\r\n\t\tvar adaptor = this.getTiddlerServerAdaptor(tiddler);\r\n\t} catch(ex) {\r\n\t\treturn false;\r\n\t}\r\n\tvar context = {\r\n\t\ttiddler: tiddler,\r\n\t\tchangecount: tiddler.fields.changecount,\r\n\t\tworkspace: tiddler.fields[\"server.workspace\"]\r\n\t};\r\n\tvar serverTitle = tiddler.fields[\"server.title\"]; // indicates renames\r\n\tif(!serverTitle) {\r\n\t\ttiddler.fields[\"server.title\"] = tiddler.title;\r\n\t} else if(tiddler.title != serverTitle) {\r\n\t\treturn adaptor.moveTiddler({ title: serverTitle },\r\n\t\t\t{ title: tiddler.title }, context, null, this.saveTiddlerCallback);\r\n\t}\r\n\tvar req = adaptor.putTiddler(tiddler, context, {}, this.saveTiddlerCallback);\r\n\treturn req ? tiddler : false;\r\n};\r\n\r\nplugin.saveTiddlerCallback = function(context, userParams) {\r\n\tvar tiddler = context.tiddler;\r\n\tif(context.status) {\r\n\t\tif(tiddler.fields.changecount == context.changecount) { //# check for changes since save was triggered\r\n\t\t\ttiddler.clearChangeCount();\r\n\t\t} else if(tiddler.fields.changecount &gt; 0) {\r\n\t\t\ttiddler.fields.changecount -= context.changecount;\r\n\t\t}\r\n\t\tplugin.reportSuccess(\"saved\", tiddler);\r\n\t\tstore.setDirty(false);\r\n\t} else {\r\n\t\tif(context.httpStatus == 412) {\r\n\t\t\tplugin.reportFailure(\"saveConflict\", tiddler);\r\n\t\t} else {\r\n\t\t\tplugin.reportFailure(\"saveError\", tiddler, context);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nplugin.removeTiddler = function(tiddler) {\r\n\ttry {\r\n\t\tvar adaptor = this.getTiddlerServerAdaptor(tiddler);\r\n\t} catch(ex) {\r\n\t\treturn false;\r\n\t}\r\n\tvar context = {\r\n\t\thost: tiddler.fields[\"server.host\"],\r\n\t\tworkspace: tiddler.fields[\"server.workspace\"],\r\n\t\ttiddler: tiddler\r\n\t};\r\n\tvar req = adaptor.deleteTiddler(tiddler, context, {}, this.removeTiddlerCallback);\r\n\treturn req ? tiddler : false;\r\n};\r\n\r\nplugin.removeTiddlerCallback = function(context, userParams) {\r\n\tvar tiddler = context.tiddler;\r\n\tif(context.status) {\r\n\t\tif(tiddler.fields.deleted === \"true\") {\r\n\t\t\tstore.deleteTiddler(tiddler.title);\r\n\t\t} else {\r\n\t\t\tplugin.reportFailure(\"deleteLocalError\", tiddler);\r\n\t\t}\r\n\t\tplugin.reportSuccess(\"deleted\", tiddler);\r\n\t\tstore.setDirty(false);\r\n\t} else {\r\n\t\tplugin.reportFailure(\"deleteError\", tiddler, context);\r\n\t}\r\n};\r\n\r\nplugin.getTiddlerServerAdaptor = function(tiddler) { // XXX: rename?\r\n\tvar type = tiddler.fields[\"server.type\"] || config.defaultCustomFields[\"server.type\"];\r\n\treturn new config.adaptors[type]();\r\n};\r\n\r\nplugin.reportSuccess = function(msg, tiddler) {\r\n\tdisplayMessage(plugin.locale[msg].format([tiddler.title]));\r\n};\r\n\r\nplugin.reportFailure = function(msg, tiddler, context) {\r\n\tvar desc = (context &amp;&amp; context.httpStatus) ? context.statusText :\r\n\t\tplugin.locale.connectionError;\r\n\tdisplayMessage(plugin.locale[msg].format([tiddler.title, desc]));\r\n};\r\n\r\nconfig.macros.saveToWeb = { // XXX: hijack existing sync macro?\r\n\tlocale: { // TODO: merge with plugin.locale?\r\n\t\tbtnLabel: \"save to web\",\r\n\t\tbtnTooltip: \"synchronize changes\",\r\n\t\tbtnAccessKey: null\r\n\t},\r\n\r\n\thandler: function(place, macroName, params, wikifier, paramString, tiddler) {\r\n\t\tcreateTiddlyButton(place, this.locale.btnLabel, this.locale.btnTooltip,\r\n\t\t\tplugin.sync, null, null, this.locale.btnAccessKey);\r\n\t}\r\n};\r\n\r\n// hijack saveChanges to trigger remote saving\r\nvar _saveChanges = saveChanges;\r\nsaveChanges = function(onlyIfDirty, tiddlers) {\r\n\tif(window.location.protocol == \"file:\") {\r\n\t\t_saveChanges.apply(this, arguments);\r\n\t} else {\r\n\t\tplugin.sync(tiddlers);\r\n\t}\r\n};\r\n\r\n// override removeTiddler to flag tiddler as deleted -- XXX: use hijack to preserve compatibility?\r\nTiddlyWiki.prototype.removeTiddler = function(title) { // XXX: should override deleteTiddler instance method?\r\n\tvar tiddler = this.fetchTiddler(title);\r\n\tif(tiddler) {\r\n\t\ttiddler.tags = [\"excludeLists\", \"excludeSearch\", \"excludeMissing\"];\r\n\t\ttiddler.text = plugin.locale.removedNotice;\r\n\t\ttiddler.fields.deleted = \"true\"; // XXX: rename to removed/tiddlerRemoved?\r\n\t\ttiddler.fields.changecount = \"1\";\r\n\t\tthis.notify(title, true);\r\n\t\tthis.setDirty(true);\r\n\t}\r\n};\r\n\r\n// hijack ImportTiddlers wizard to handle cross-domain restrictions\r\nvar _onOpen = config.macros.importTiddlers.onOpen;\r\nconfig.macros.importTiddlers.onOpen = function(ev) {\r\n\tvar btn = $(resolveTarget(ev));\r\n\tvar url = btn.closest(\".wizard\").find(\"input[name=txtPath]\").val();\r\n\tif(window.location.protocol != \"file:\" &amp;&amp; url.indexOf(\"://\") != -1) {\r\n\t\tvar host = url.split(\"/\")[2];\r\n\t\tvar macro = config.macros.importTiddlers;\r\n\t\tif(host != window.location.host) {\r\n\t\t\tbtn.text(macro.cancelLabel).attr(\"title\", macro.cancelPrompt);\r\n\t\t\tbtn[0].onclick = macro.onCancel;\r\n\t\t\t$('&lt;span class=\"status\" /&gt;').text(plugin.locale.hostError).insertAfter(btn);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn _onOpen.apply(this, arguments);\r\n};\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"GroupByPlugin\" server.title=\"GroupByPlugin\" server.page.revision=\"1521873\" server.etag=\"&quot;system-plugins_public/GroupByPlugin/1521873:28a07e8d5e9d6ffd312506e9dd6083a8d4236767&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-plugins_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-plugins_public\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"d4f41fa53916a920347fbe97303966ebeed68945\">\r\n<pre>/***\r\n|''Name''|GroupByPlugin|\r\n|''Description''|Mimics allTags macro to provide ways of creating lists grouping tiddlers by any field|\r\n|''Version''|0.6.1|\r\n|''Author''|Jon Robson|\r\n|''Status''|beta|\r\n!Usage\r\n{{{&lt;&lt;groupBy tags&gt;&gt;}}}\r\nmimics allTags macro\r\n\r\n{{{&lt;&lt;groupBy server.bag&gt;&gt;}}}\r\ngroups by the server.bag field (this version contains TiddlySpace specific code for turning a bag into a space name)\r\n\r\n{{{groupBy modified dateFormat:\"YYYY\"}}}\r\ngroup tiddlers by year.\r\n\r\n{{{&lt;&lt;groupBy tags exclude:excludeLists exclude:systemConfig&gt;&gt;}}}\r\ngroup tiddlers by tag but exclude the tags with values excludeLists and systemConfig\r\n\r\nWithin that group you can also exclude things by filter\r\n{{{groupBy modifier filter:[tag[film]]}}}\r\nwill group tiddlers tagged with film by modifier.\r\n***/\r\n//{{{\r\n(function($) {\r\nvar taglocale = config.views.wikified.tag;\r\nvar macro = config.macros.groupBy = {\r\n\tlocale: {\r\n\t\ttooltip: \"all tiddlers in group %0\",\r\n\t\tnoTiddlers: \"no tiddlers\",\r\n\t\topenAllText: taglocale.openAllText,\r\n\t\topenAllTooltip: taglocale.openAllTooltip,\r\n\t\topenTiddler: \"open tiddler with title %0\"\r\n\t},\r\n\tmorpher: {\r\n\t\t// TODO: note currently the following 2 morphers are TiddlySpace specific and probably should be in separate plugin\r\n\t\t\"server.workspace\": function(value, options) {\r\n\t\t\treturn macro.morpher[\"server.bag\"](value.replace(\"bags/\", \"\").replace(\"recipes/\", \"\"));\r\n\t\t},\r\n\t\t\"server.bag\": function(value, options) {\r\n\t\t\tif(typeof(value) !== \"string\") {\r\n\t\t\t\treturn false;\r\n\t\t\t} else if(value.indexOf(\"_public\") === -1 &amp;&amp; value.indexOf(\"_private\") === -1) {\r\n\t\t\t\tvalue = \"*%0\".format(value); // add star for non-space bags.\r\n\t\t\t}\r\n\t\t\treturn value.replace(\"_public\", \"\").replace(\"_private\", \"\");\r\n\t\t},\r\n\t\tcreated: function(value, options) {\r\n\t\t\treturn value.formatString(options.dateFormat || \"DD MMM YYYY\");\r\n\t\t},\r\n\t\tmodified: function(value, options) {\r\n\t\t\treturn macro.morpher.created(value, options);\r\n\t\t}\r\n\t},\r\n\r\n\thandler: function(place, macroName, params, wikifier, paramString) {\r\n\t\tvar field = params[0] || \"server.workspace\";\r\n\t\tvar dateFormat = params[1] || \"DD MMM YYYY\";\r\n\t\tvar container = $(\"&lt;div /&gt;\").attr(\"macroName\", macroName).addClass(\"groupBy\").\r\n\t\t\tattr(\"refresh\", \"macro\").attr(\"fieldName\", field).\r\n\t\t\tattr(\"paramString\", paramString).\r\n\t\t\tattr(\"dateFormat\", dateFormat).appendTo(place)[0];\r\n\t\tmacro.refresh(container);\r\n\t},\r\n\tisTypeArray: function(value) {\r\n\t\tvar valueType = typeof value;\r\n\t\tif(valueType === \"object\" &amp;&amp; typeof value.length === \"number\" &amp;&amp;\r\n\t\t\t!(value.propertyIsEnumerable(\"length\")) &amp;&amp;\r\n\t\t\ttypeof value.splice === \"function\") { //is Array\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t},\r\n\t_onClickGroup: function(ev, options) {\r\n\t\tvar i, target = ev.target, locale = macro.locale;\r\n\t\tvar tiddlers = $(target).closest(\".templateContainer\").data(\"tiddlers\");\r\n\t\tvar popup = $(Popup.create(target)).addClass(\"taggedTiddlerList\")[0];\r\n\t\tvar value = $(target).attr(\"value\");\r\n\t\tvar openAll = createTiddlyButton($(\"&lt;li /&gt;\").appendTo(popup)[0],\r\n\t\t\tlocale.openAllText.format(value), locale.openAllTooltip);\r\n\t\t$(openAll).click(function(ev) {\r\n\t\t\tstory.displayTiddlers(ev.target, tiddlers);\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\tvar listBreak = $(\"&lt;li /&gt;\").addClass(\"listBreak\").html(\"&lt;div /&gt;\").appendTo(popup);\r\n\t\tfor(i = 0; i &lt; tiddlers.length; i++) {\r\n\t\t\tvar item = $(\"&lt;li /&gt;\").appendTo(popup)[0];\r\n\t\t\tvar template = store.getTiddlerText(options.template) || macro.template;\r\n\t\t\twikify(template, item, null, tiddlers[i]);\r\n\t\t}\r\n\t\tlistBreak.clone().appendTo(popup);\r\n\t\t$(createTiddlyLink($(\"&lt;li /&gt;\").appendTo(popup)[0], value, false)).\r\n\t\t\ttext(locale.openTiddler.format(value));\r\n\t\tPopup.show();\r\n\t\tev.stopPropagation();\r\n\t\treturn false;\r\n\t},\r\n\t_refresh: function(container, tiddlers, options) {\r\n\t\tvar totalGroups = 0, locale = macro.locale, i, j;\r\n\t\tvar excludeValues = options.exclude;\r\n\t\tvar values = {}, value_ids = [];\r\n\t\tvar field = options.field;\r\n\t\tvar morpher = macro.morpher[field] || function(value) {\r\n\t\t\treturn value;\r\n\t\t};\r\n\t\tfor(i = 0; i &lt; tiddlers.length; i++) {\r\n\t\t\tvar tiddler = tiddlers[i];\r\n\t\t\tvar value = tiddler[field] || tiddler.fields[field];\r\n\t\t\tvalue = macro.isTypeArray(value) ? value : [ value ];\r\n\t\t\tfor(j = 0; j &lt; value.length; j++) {\r\n\t\t\t\tvar v = morpher(value[j], options);\r\n\t\t\t\tif(v &amp;&amp; $.inArray(v, excludeValues) === -1) {\r\n\t\t\t\t\ttotalGroups += 1;\r\n\t\t\t\t\tif(!values[v]) {\r\n\t\t\t\t\t\tvalues[v] = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvalues[v].push(tiddler);\r\n\t\t\t\t\tvalue_ids.pushUnique(v);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar ul = $(\"&lt;ul /&gt;\").appendTo(container)[0];\r\n\t\tif(totalGroups === 0) {\r\n\t\t\t$(\"&lt;li /&gt;\").addClass(\"listTitle\").text(locale.noTiddlers);\r\n\t\t}\r\n\t\tvalue_ids = value_ids.sort();\r\n\t\tvar groupTemplate = store.getTiddlerText(options.groupTemplate);\r\n\t\tvar onClick = function(ev) {\r\n\t\t\tmacro._onClickGroup(ev, options);\r\n\t\t};\r\n\t\tfor(i = 0; i &lt; value_ids.length; i++) {\r\n\t\t\tvar title = value_ids[i];\r\n\t\t\tvar info = getTiddlyLinkInfo(title);\r\n\t\t\ttiddlers = values[title];\r\n\t\t\tvar btn = createTiddlyButton($(\"&lt;li /&gt;\").appendTo(ul)[0],\r\n\t\t\t\t\"%0 (%1)\".format(title, tiddlers.length), locale.tooltip.format(title), null, info.classes);\r\n\t\t\tif(groupTemplate) {\r\n\t\t\t\t$(btn).empty();\r\n\t\t\t\twikify(groupTemplate, btn, null, tiddlers[0]);\r\n\t\t\t}\r\n\t\t\t$(btn).click(onClick).attr(\"value\", title).attr(\"refresh\", \"link\").attr(\"tiddlyLink\", title);\r\n\t\t\t$(btn).addClass(\"templateContainer\").data(\"tiddlers\", tiddlers);\r\n\t\t}\r\n\t},\r\n\trefresh: function(container) {\r\n\t\tcontainer = $(container).empty();\r\n\t\tvar paramString = container.attr(\"paramString\");\r\n\t\tvar args = paramString.parseParams(\"name\", null, true, false, true)[0];\r\n\t\tvar options = { field: container.attr(\"fieldName\"), dateFormat: container.attr(\"dateFormat\"), exclude: args.exclude || [],\r\n\t\t\ttemplate: args.template ? args.template[0] : false, groupTemplate: args.groupTemplate ? args.groupTemplate[0] : \"\" };\r\n\t\tvar tiddlers = args.filter ? store.filterTiddlers(args.filter[0]) : store.getTiddlers(\"title\");\r\n\t\tmacro._refresh(container, tiddlers, options);\r\n\t},\r\n\ttemplate: \"&lt;&lt;view title link&gt;&gt;\"\r\n};\r\n\r\n}(jQuery));\r\n//}}}</pre>\r\n</div>\r\n<div title=\"TiddlySpaceViewTypes\" server.title=\"TiddlySpaceViewTypes\" server.page.revision=\"1521869\" server.etag=\"&quot;system-plugins_public/TiddlySpaceViewTypes/1521869:68ac55b4a217e048117c7b955f65602ea4552636&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-plugins_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-plugins_public\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"0a5a070cb32ab7b3dc724809555448e9948cf232\">\r\n<pre>/***\r\n|''Name''|TiddlySpaceViewTypes|\r\n|''Version''|0.6.0|\r\n|''Status''|@@beta@@|\r\n|''Description''|Provides TiddlySpace specific view types|\r\n|''Author''|Jon Robson|\r\n|''Source''|http://github.com/TiddlySpace/tiddlyspace/raw/master/src/plugins/TiddlySpaceViewTypes.js|\r\n|''Requires''|TiddlySpaceConfig TiddlySpaceTiddlerIconsPlugin|\r\n!Usage\r\nProvides replyLink, spaceLink and SiteIcon view types.\r\n!!SiteIcon view parameters\r\n* labelPrefix / labelSuffix : prefix or suffix the label with additional text. eg. labelPrefix:'modified by '\r\n* spaceLink: if set to \"yes\" will make any avatars link to the corresponding space. {{{&lt;&lt;originMacro spaceLink:yes&gt;&gt;}}}\r\n\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nvar tiddlyspace = config.extensions.tiddlyspace;\r\nvar originMacro = config.macros.tiddlerOrigin;\r\nvar tweb = config.extensions.tiddlyweb;\r\n\r\nconfig.macros.view.replyLink = {\r\n\tlocale: {\r\n\t\tlabel: \"Reply to this tiddler\"\r\n\t}\r\n};\r\n\r\nvar _replyButtons = [];\r\nvar _replyInitialised, _replyScriptLoaded;\r\nconfig.macros.view.views.replyLink = function(value, place, params, wikifier,\r\n\t\tparamString, tiddler) {\r\n\tvar valueField = params[0];\r\n\tvar imported;\r\n\tif(valueField == \"title\") { // special casing for imported tiddlers\r\n\t\tvar localTitle = tiddler.title;\r\n\t\tvar serverTitle = tiddler.fields[\"server.title\"];\r\n\t\tif(serverTitle &amp;&amp; localTitle != serverTitle) {\r\n\t\t\tvalue = serverTitle ? serverTitle : localTitle;\r\n\t\t\timported = true;\r\n\t\t}\r\n\t} else {\r\n\t\ttitle = tiddler[valueField] ? tiddler[valueField] : tiddler.fields[valueField];\r\n\t}\r\n\tvar args = paramString.parseParams(\"anon\")[0];\r\n\tvar label = (args.label) ? args.label : config.macros.view.replyLink.locale.label;\r\n\tvar space;\r\n\tif(tiddler) {\r\n\t\tvar bag = tiddler.fields[\"server.bag\"];\r\n\t\tspace = tiddlyspace.resolveSpaceName(bag);\r\n\t}\r\n\tvar container = $('&lt;span class=\"replyLink\" /&gt;').appendTo(place)[0];\r\n\r\n\ttweb.getUserInfo(function(user) {\r\n\t\tif ((!user.anon) &amp;&amp; ((space &amp;&amp; user.name != space &amp;&amp;\r\n\t\t\t\tuser.name != tiddlyspace.currentSpace.name) || imported)) {\r\n\t\t\tvar link = $(\"&lt;a /&gt;\")\r\n\t\t\t\t.text(config.macros.view.replyLink.locale.label)\r\n\t\t\t\t.appendTo(container)[0];\r\n\r\n\t\t\tif(typeof(createReplyButton) === \"undefined\") {\r\n\t\t\t\t_replyButtons.push(link);\r\n\t\t\t}\r\n\t\t\tif(_replyInitialised) {\r\n\t\t\t\tcreateReplyButton(link);\r\n\t\t\t} else if(!_replyScriptLoaded) {\r\n\t\t\t\t_replyScriptLoaded = true;\r\n\t\t\t\t$.getScript(\"/bags/common/tiddlers/_reply-button.js\",\r\n\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t_replyInitialised = true;\r\n\t\t\t\t\t\tfor(var i = 0; i &lt; _replyButtons.length; i++) {\r\n\t\t\t\t\t\t\tcreateReplyButton(_replyButtons[i]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t_replyButtons = [];\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n};\r\n\r\nconfig.macros.view.views.spaceLink = function(value, place, params, wikifier,\r\n\t\tparamString, tiddler) {\r\n\t\tvar spaceName = tiddlyspace.resolveSpaceName(value);\r\n\t\tvar isBag = params[0] == \"server.bag\" &amp;&amp; value === spaceName ? true : false;\r\n\t\tvar args = paramString.parseParams(\"anon\")[0];\r\n\t\tvar titleField = args.anon[2];\r\n\t\tvar labelField = args.labelField ? args.labelField[0] : false;\r\n\t\tvar label;\r\n\t\tif(labelField) {\r\n\t\t\tlabel = tiddler[labelField] ? tiddler[labelField] : tiddler.fields[labelField];\r\n\t\t} else {\r\n\t\t\tlabel = args.label ? args.label[0] : false;\r\n\t\t}\r\n\t\tvar title = tiddler[titleField] ? tiddler[titleField] : tiddler.fields[titleField];\r\n\r\n\t\tvar link = createSpaceLink(place, spaceName, title, label, isBag);\r\n\t\tif(args.external &amp;&amp; args.external[0] == \"no\") {\r\n\t\t\t$(link).click(function(ev) {\r\n\t\t\t\tvar el = $(ev.target);\r\n\t\t\t\tvar title = el.attr(\"tiddler\");\r\n\t\t\t\tvar bag = el.attr(\"bag\");\r\n\t\t\t\tvar space = el.attr(\"tiddlyspace\");\r\n\t\t\t\tbag = space ? space + \"_public\" : bag;\r\n\t\t\t\tif(title &amp;&amp; bag) {\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\ttiddlyspace.displayServerTiddler(el[0], title,\r\n\t\t\t\t\t\t\"bags/\" + bag);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t}\r\n};\r\n\r\nconfig.macros.view.views.SiteIcon = function(value, place, params, wikifier,\r\n\t\tparamString, tiddler) {\r\n\tvar options = originMacro.getOptions(paramString);\r\n\tif(!tiddler || value == \"None\") { // some core tiddlers lack modifier\r\n\t\tvalue = false;\r\n\t}\r\n\tvar field = params[0];\r\n\tif(field == \"server.bag\") {\r\n\t\toptions.notSpace = !originMacro._isSpace(value);\r\n\t}\r\n\ttiddlyspace.renderAvatar(place, value, options);\r\n};\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"DiffFormatter\" server.title=\"DiffFormatter\" server.page.revision=\"1521854\" server.etag=\"&quot;system/DiffFormatter/1521854:bea3f23ecb3bd03a8af09c65383cfcd47da2beb7&quot;\" modifier=\"FND\" creator=\"FND\" server.workspace=\"bags/system\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20130924180405\" created=\"20130924180405\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"2232cd0549946d29c475cec846de3378177301ae\">\r\n<pre>/***\r\n|''Name''|DiffFormatter|\r\n|''Description''|highlighting of text comparisons|\r\n|''Author''|FND|\r\n|''Version''|0.9.0|\r\n|''Status''|beta|\r\n|''Source''|http://svn.tiddlywiki.org/Trunk/contributors/FND/formatters/DiffFormatter.js|\r\n|''CodeRepository''|http://svn.tiddlywiki.org/Trunk/contributors/FND/|\r\n|''License''|[[BSD|http://www.opensource.org/licenses/bsd-license.php]]|\r\n|''Keywords''|formatting|\r\n!Description\r\nHighlights changes in a unified [[diff|http://en.wikipedia.org/wiki/Diff#Unified_format]].\r\n!Notes\r\nBased on Martin Budden's [[DiffFormatterPlugin|http://svn.tiddlywiki.org/Trunk/contributors/MartinBudden/formatters/DiffFormatterPlugin.js]].\r\n!Usage\r\nThe formatter is applied to blocks wrapped in &lt;html&gt;&lt;code&gt;{{{diff{..}}}&lt;/code&gt;&lt;/html&gt; within tiddlers tagged with \"diff\".\r\n!Revision History\r\n!!v0.9 (2010-04-07)\r\n* initial release; fork of DiffFormatterPlugin\r\n!StyleSheet\r\n.diff { white-space: pre; font-family: monospace; }\r\n.diff ins, .diff del { display: block; text-decoration: none; }\r\n.diff ins { background-color: #dfd; }\r\n.diff del { background-color: #fdd; }\r\n.diff .highlight { background-color: [[ColorPalette::SecondaryPale]]; }\r\n!Code\r\n***/\r\n//{{{\r\n(function() {\r\n\r\nconfig.shadowTiddlers.StyleSheetDiffFormatter = store.getTiddlerText(tiddler.title + \"##StyleSheet\");\r\nstore.addNotification(\"StyleSheetDiffFormatter\", refreshStyles);\r\n\r\nvar formatters = [{\r\n\t\tname: \"diffWrapper\",\r\n\t\tmatch: \"^\\\\{\\\\{diff\\\\{\\n\", // XXX: suboptimal\r\n\t\ttermRegExp: /(.*\\}\\}\\})$/mg,\r\n\t\thandler: function(w) {\r\n\t\t\tvar el = createTiddlyElement(w.output, \"div\", null, \"diff\");\r\n\t\t\tw.subWikifyTerm(el, this.termRegExp);\r\n\t\t}\r\n\t}, {\r\n\t\tname: \"diffRange\",\r\n\t\tmatch: \"^(?:@@|[+\\\\-]{3}) \",\r\n\t\tlookaheadRegExp: /^(?:@@|[+\\-]{3}) .*\\n/mg,\r\n\t\thandler: function(w) {\r\n\t\t\tcreateTiddlyElement(w.output, \"div\", null, \"highlight\").\r\n\t\t\t\tinnerHTML = \"&amp;#8230;\";\r\n\t\t\tthis.lookaheadRegExp.lastIndex = w.matchStart;\r\n\t\t\tvar lookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\t\tif(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) {\r\n\t\t\t\tw.nextMatch = this.lookaheadRegExp.lastIndex;\r\n\t\t\t}\r\n\t\t}\r\n\t}, {\r\n\t\tname: \"diffAdded\",\r\n\t\tmatch: \"^\\\\+\",\r\n\t\ttermRegExp: /(\\n)/mg,\r\n\t\thandler: function(w) {\r\n\t\t\tvar el = createTiddlyElement(w.output, \"ins\", null, \"added\");\r\n\t\t\tw.subWikifyTerm(el, this.termRegExp);\r\n\t\t}\r\n\t}, {\r\n\t\tname: \"diffRemoved\",\r\n\t\tmatch: \"^-\",\r\n\t\ttermRegExp: /(\\n)/mg,\r\n\t\thandler: function(w) {\r\n\t\t\tvar el = createTiddlyElement(w.output, \"del\", null, \"removed\");\r\n\t\t\tw.subWikifyTerm(el, this.termRegExp);\r\n\t\t}\r\n\t}\r\n];\r\n\r\nconfig.parsers.diffFormatter = new Formatter(formatters);\r\nconfig.parsers.diffFormatter.format = \"diff\";\r\nconfig.parsers.diffFormatter.formatTag = \"diff\";\r\n\r\n})();\r\n//}}}</pre>\r\n</div>\r\n<div title=\"saveDraft\" server.title=\"saveDraft\" server.page.revision=\"1521925\" server.etag=\"&quot;system-images_public/saveDraft/1521925:2f67dda0aa4a239305a7d58f3ea6a902a5c1e37e&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-images_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-images_public\" server.permissions=\"read\" server.content-type=\"image/svg+xml\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch\" _hash=\"8b5516d12e2aafb4aecd48f696fcb276e61ac468\">\r\n<pre>&lt;svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xl=\"http://www.w3.org/1999/xlink\" version=\"1.1\" viewBox=\"364 157 64 51\" width=\"30\" height=\"30\"&gt;&lt;g stroke=\"none\" stroke-opacity=\"1\" stroke-dasharray=\"none\" fill=\"none\" fill-opacity=\"1\"&gt;&lt;g&gt;&lt;path class=\"glyph\" d=\"M 364.50006 184.50061 L 386.99985 207.00037 L 396 198.00002 L 373.50003 175.50066 Z M 403.02295 181.97704 C 400.38693 179.34099 396.11307 179.34099 393.47702 181.97704 C 390.841 184.61307 390.841 188.88695 393.47702 191.52298 C 396.11307 194.15903 400.38693 194.15903 403.02295 191.52298 C 405.65906 188.88695 405.65906 184.61307 403.02295 181.97704 M 414.27298 170.72704 C 411.63693 168.091 407.36307 168.091 404.72702 170.72704 C 402.091 173.36308 402.091 177.63693 404.72702 180.27296 C 407.36307 182.90901 411.63693 182.90901 414.27298 180.27296 C 416.90903 177.63693 416.90903 173.36308 414.27298 170.72704 M 425.523 159.47705 C 422.88696 156.841 418.6131 156.841 415.97705 159.47705 C 413.341 162.11308 413.341 166.38695 415.97705 169.02295 C 418.6131 171.65903 422.88696 171.65903 425.523 169.02295 C 428.15906 166.38695 428.15906 162.11308 425.523 159.47705\" fill=\"#020202\"/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;</pre>\r\n</div>\r\n<div title=\"TiddlySpaceCloneCommand\" server.title=\"TiddlySpaceCloneCommand\" server.page.revision=\"1521898\" server.etag=\"&quot;tiddlyspace/TiddlySpaceCloneCommand/1521898:50bd29ba5bae421868197ab1529a3225b9f648c7&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/tiddlyspace\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"tiddlyspace\" server.permissions=\"read\" server.content-type=\"text/javascript\" modified=\"20131111192332\" created=\"20131111192332\" tags=\"excludeLists excludeSearch systemConfig\" _hash=\"3ecfd7c955dc674752681565ad0ed68f8fcad5d9\">\r\n<pre>/***\r\n|''Name''|TiddlySpaceCloneCommand|\r\n|''Version''|0.5.8|\r\n|''Description''|provides a toolbar command for cloning external tiddlers|\r\n|''Status''|stable|\r\n|''Source''|http://github.com/TiddlySpace/tiddlyspace/raw/master/src/plugins/TiddlySpaceCloneCommand.js|\r\n|''Requires''|TiddlySpaceConfig TiddlySpaceFilters|\r\n!Code\r\n***/\r\n//{{{\r\n(function($) {\r\n\r\nvar cmd = config.commands;\r\nvar tiddlyspace = config.extensions.tiddlyspace;\r\n\r\nvar fieldsCache = {};\r\n\r\ncmd.cloneTiddler = {\r\n\ttext: cmd.editTiddler.text,\r\n\ttooltip: \"Create a copy of this tiddler in the current space\",\r\n\terrorMsg: \"Error publishing %0: %1\",\r\n\r\n\tisEnabled: function(tiddler) {\r\n\t\treturn !config.filterHelpers.is.local(tiddler) &amp;&amp; !readOnly;\r\n\t},\r\n\thandler: function(ev, src, title) {\r\n\t\tvar tiddler = store.getTiddler(title);\r\n\t\tif(tiddler) {\r\n\t\t\tfieldsCache[title] = $.extend({}, tiddler.fields);\r\n\t\t\ttiddler.fields[\"server.workspace\"] = tiddlyspace.getCurrentWorkspace(config.options.chkPrivateMode ?\r\n\t\t\"private\" : \"public\");\r\n\t\t\ttiddler.fields[\"server.permissions\"] = \"read, write, create\"; // no delete\r\n\t\t\tdelete tiddler.fields[\"server.page.revision\"];\r\n\t\t\tdelete tiddler.fields[\"server.title\"];\r\n\t\t\tdelete tiddler.fields[\"server.etag\"];\r\n\t\t\t// special handling for pseudo-shadow tiddlers\r\n\t\t\tif(tiddlyspace.coreBags.contains(tiddler.fields[\"server.bag\"])) {\r\n\t\t\t\ttiddler.tags.remove(\"excludeLists\");\r\n\t\t\t}\r\n\t\t} else { // ensure workspace is the current space\r\n\t\t\tvar el = story.findContainingTiddler(src);\r\n\t\t\tel = $(el);\r\n\t\t\tvar fields = el.attr(\"tiddlyfields\");\r\n\t\t\tif(fields) { // inherited via TiddlyLink\r\n\t\t\t\tfields = fields.decodeHashMap();\r\n\t\t\t\tfields[\"server.workspace\"] = config.\r\n\t\t\t\t\tdefaultCustomFields[\"server.workspace\"];\r\n\t\t\t} else {\r\n\t\t\t\tfields = config.defaultCustomFields;\r\n\t\t\t}\r\n\t\t\tfields = String.encodeHashMap(fields);\r\n\t\t\tel.attr(\"tiddlyfields\", fields);\r\n\t\t}\r\n\t\tcmd.editTiddler.handler.apply(this, arguments);\r\n\t\tif(tiddler) {\r\n\t\t\ttiddler.fields[\"server.permissions\"] += \", delete\";\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n};\r\n\r\ncmd.editTiddler.isEnabled = function(tiddler) {\r\n\treturn !cmd.cloneTiddler.isEnabled.apply(this, arguments);\r\n};\r\n\r\n// hijack cancelTiddler to restore original fields\r\nvar _cancelHandler = cmd.cancelTiddler.handler;\r\ncmd.cancelTiddler.handler = function(ev, src, title) {\r\n\tvar tiddler = store.getTiddler(title);\r\n\tif(tiddler) {\r\n\t\ttiddler.fields = fieldsCache[title] || tiddler.fields;\r\n\t\tdelete fieldsCache[title];\r\n\t}\r\n\treturn _cancelHandler.apply(this, arguments);\r\n};\r\n\r\n// hijack saveTiddler to clear unused fields stash\r\nvar _saveHandler = cmd.saveTiddler.handler;\r\ncmd.saveTiddler.handler =  function(ev, src, title) {\r\n\tdelete fieldsCache[title];\r\n\treturn _saveHandler.apply(this, arguments);\r\n};\r\n\r\n})(jQuery);\r\n//}}}</pre>\r\n</div>\r\n<div title=\"SideBarTabs\" server.title=\"SideBarTabs\" server.page.revision=\"1521918\" server.etag=\"&quot;system-theme_public/SideBarTabs/1521918:de86a1c8a8e6226a40b9f38dd48a43b4baf98030&quot;\" modifier=\"osmosoft\" creator=\"osmosoft\" server.workspace=\"bags/system-theme_public\" server.type=\"tiddlyweb\" server.host=\"http://pearl.tiddlyspace.com\" server.recipe=\"pearl_private\" server.bag=\"system-theme_public\" server.permissions=\"read\" server.content-type=\"\" modified=\"20131111192330\" created=\"20131111192330\" tags=\"excludeLists excludeMissing excludeSearch\" _hash=\"6b74609cea4ddb529f42d3331e63b7775376af47\">\r\n<pre>&lt;&lt;tiddler Backstage##Tiddlers&gt;&gt;</pre>\r\n</div>\r\n</div>\r\n<!--POST-STOREAREA-->\r\n<!--POST-BODY-START-->\r\n\r\n<!--POST-BODY-END-->\r\n<script id=\"jsArea\" type=\"text/javascript\">\r\n//<![CDATA[\r\n\r\n//\r\n// Please note:\r\n//\r\n// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments\r\n//   in the project repository at https://github.com/TiddlyWiki/tiddlywiki\r\n//\r\n// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation\r\n//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev\r\n//\r\n// JSLint directives\r\n/*global jQuery:false, version:false */\r\n/*jslint bitwise:true, browser:true, confusion:true, eqeq:true, evil:true, forin:true, maxerr:100, plusplus:true, regexp:true, sloppy:true, sub:true, undef:true, unparam:true, vars:true, white:true */\r\n//--\r\n//-- Configuration repository\r\n//--\r\n\r\n// Miscellaneous options\r\nvar config = {\r\n\tnumRssItems: 20, // Number of items in the RSS feed\r\n\tanimDuration: 400, // Duration of UI animations in milliseconds\r\n\tcascadeFast: 20, // Speed for cascade animations (higher == slower)\r\n\tcascadeSlow: 60, // Speed for EasterEgg cascade animations\r\n\tcascadeDepth: 5, // Depth of cascade animation\r\n\tlocale: \"en\" // W3C language tag\r\n};\r\n\r\n// Hashmap of alternative parsers for the wikifier\r\nconfig.parsers = {};\r\n\r\n// Adaptors\r\nconfig.adaptors = {};\r\nconfig.defaultAdaptor = null;\r\n\r\n// Backstage tasks\r\nconfig.tasks = {};\r\n\r\n// Annotations\r\nconfig.annotations = {};\r\n\r\n// Custom fields to be automatically added to new tiddlers\r\nconfig.defaultCustomFields = {};\r\n\r\n// Messages\r\nconfig.messages = {\r\n\tmessageClose: {},\r\n\tdates: {},\r\n\ttiddlerPopup: {}\r\n};\r\n\r\n// Options that can be set in the options panel and/or cookies\r\nconfig.options = {\r\n\tchkRegExpSearch: false,\r\n\tchkCaseSensitiveSearch: false,\r\n\tchkIncrementalSearch: true,\r\n\tchkAnimate: true,\r\n\tchkSaveBackups: true,\r\n\tchkAutoSave: false,\r\n\tchkGenerateAnRssFeed: false,\r\n\tchkSaveEmptyTemplate: false,\r\n\tchkOpenInNewWindow: true,\r\n\tchkToggleLinks: false,\r\n\tchkHttpReadOnly: true,\r\n\tchkForceMinorUpdate: false,\r\n\tchkConfirmDelete: true,\r\n\tchkInsertTabs: false,\r\n\tchkUsePreForStorage: true, // Whether to use <pre> format for storage\r\n\tchkDisplayInstrumentation: false,\r\n\ttxtBackupFolder: \"\",\r\n\ttxtEditorFocus: \"text\",\r\n\ttxtMainTab: \"tabTimeline\",\r\n\ttxtMoreTab: \"moreTabAll\",\r\n\ttxtMaxEditRows: \"30\",\r\n\ttxtFileSystemCharSet: \"UTF-8\",\r\n\ttxtTheme: \"\"\r\n\t};\r\nconfig.optionsDesc = {};\r\n\r\nconfig.optionsSource = {};\r\n\r\n// Default tiddler templates\r\nvar DEFAULT_VIEW_TEMPLATE = 1;\r\nvar DEFAULT_EDIT_TEMPLATE = 2;\r\nconfig.tiddlerTemplates = {\r\n\t1: \"ViewTemplate\",\r\n\t2: \"EditTemplate\"\r\n};\r\n\r\n// More messages (rather a legacy layout that should not really be like this)\r\nconfig.views = {\r\n\twikified: {\r\n\t\ttag: {}\r\n\t},\r\n\teditor: {\r\n\t\ttagChooser: {}\r\n\t}\r\n};\r\n\r\n// Backstage tasks\r\nconfig.backstageTasks = [\"save\",\"importTask\",\"tweak\",\"upgrade\",\"plugins\"];\r\n\r\n// Extensions\r\nconfig.extensions = {};\r\n\r\n// Macros; each has a 'handler' member that is inserted later\r\nconfig.macros = {\r\n\ttoday: {},\r\n\tversion: {},\r\n\tsearch: {sizeTextbox: 15},\r\n\ttiddler: {},\r\n\ttag: {},\r\n\ttags: {},\r\n\ttagging: {},\r\n\ttimeline: {},\r\n\tallTags: {},\r\n\tlist: {\r\n\t\tall: {},\r\n\t\tmissing: {},\r\n\t\torphans: {},\r\n\t\tshadowed: {},\r\n\t\ttouched: {},\r\n\t\tfilter: {}\r\n\t},\r\n\tcloseAll: {},\r\n\tpermaview: {},\r\n\tsaveChanges: {},\r\n\tslider: {},\r\n\toption: {},\r\n\toptions: {},\r\n\tnewTiddler: {},\r\n\tnewJournal: {},\r\n\ttabs: {},\r\n\tgradient: {},\r\n\tmessage: {},\r\n\tview: {defaultView: \"text\"},\r\n\tedit: {},\r\n\ttagChooser: {},\r\n\ttoolbar: {},\r\n\tplugins: {},\r\n\trefreshDisplay: {},\r\n\timportTiddlers: {},\r\n\tupgrade: {\r\n\t\tsource: \"http://tiddlywiki-releases.tiddlyspace.com/upgrade\",\r\n\t\tbackupExtension: \"pre.core.upgrade\"\r\n\t},\r\n\tsync: {},\r\n\tannotations: {}\r\n};\r\n\r\n// Commands supported by the toolbar macro\r\nconfig.commands = {\r\n\tcloseTiddler: {},\r\n\tcloseOthers: {},\r\n\teditTiddler: {},\r\n\tsaveTiddler: {hideReadOnly: true},\r\n\tcancelTiddler: {},\r\n\tdeleteTiddler: {hideReadOnly: true},\r\n\tpermalink: {},\r\n\treferences: {type: \"popup\"},\r\n\tjump: {type: \"popup\"},\r\n\tsyncing: {type: \"popup\"},\r\n\tfields: {type: \"popup\"}\r\n};\r\n\r\n// Control of macro parameter evaluation\r\nconfig.evaluateMacroParameters = \"all\";\r\n\r\n// Basic regular expressions\r\nconfig.textPrimitives = {\r\n\tupperLetter: \"[A-Z\\u00c0-\\u00de\\u0150\\u0170]\",\r\n\tlowerLetter: \"[a-z0-9_\\\\-\\u00df-\\u00ff\\u0151\\u0171]\",\r\n\tanyLetter:   \"[A-Za-z0-9_\\\\-\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171]\",\r\n\tanyLetterStrict: \"[A-Za-z0-9\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171]\"\r\n};\r\nif(!((new RegExp(\"[\\u0150\\u0170]\",\"g\")).test(\"\\u0150\"))) {\r\n\tconfig.textPrimitives = {\r\n\t\tupperLetter: \"[A-Z\\u00c0-\\u00de]\",\r\n\t\tlowerLetter: \"[a-z0-9_\\\\-\\u00df-\\u00ff]\",\r\n\t\tanyLetter:   \"[A-Za-z0-9_\\\\-\\u00c0-\\u00de\\u00df-\\u00ff]\",\r\n\t\tanyLetterStrict: \"[A-Za-z0-9\\u00c0-\\u00de\\u00df-\\u00ff]\"\r\n\t};\r\n}\r\nconfig.textPrimitives.sliceSeparator = \"::\";\r\nconfig.textPrimitives.sectionSeparator = \"##\";\r\nconfig.textPrimitives.urlPattern = \"(?:file|http|https|mailto|ftp|irc|news|data):[^\\\\s'\\\"]+(?:/|\\\\b)\";\r\nconfig.textPrimitives.unWikiLink = \"~\";\r\nconfig.textPrimitives.wikiLink = \"(?:(?:\" + config.textPrimitives.upperLetter + \"+\" +\r\n\tconfig.textPrimitives.lowerLetter + \"+\" +\r\n\tconfig.textPrimitives.upperLetter +\r\n\tconfig.textPrimitives.anyLetter + \"*)|(?:\" +\r\n\tconfig.textPrimitives.upperLetter + \"{2,}\" +\r\n\tconfig.textPrimitives.lowerLetter + \"+))\";\r\n\r\nconfig.textPrimitives.cssLookahead = \"(?:(\" + config.textPrimitives.anyLetter + \"+)\\\\(([^\\\\)\\\\|\\\\n]+)(?:\\\\):))|(?:(\" + config.textPrimitives.anyLetter + \"+):([^;\\\\|\\\\n]+);)\";\r\nconfig.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,\"mg\");\r\n\r\nconfig.textPrimitives.brackettedLink = \"\\\\[\\\\[([^\\\\]]+)\\\\]\\\\]\";\r\nconfig.textPrimitives.titledBrackettedLink = \"\\\\[\\\\[([^\\\\[\\\\]\\\\|]+)\\\\|([^\\\\[\\\\]\\\\|]+)\\\\]\\\\]\";\r\nconfig.textPrimitives.tiddlerForcedLinkRegExp = new RegExp(\"(?:\" + config.textPrimitives.titledBrackettedLink + \")|(?:\" +\r\n\tconfig.textPrimitives.brackettedLink + \")|(?:\" +\r\n\tconfig.textPrimitives.urlPattern + \")\",\"mg\");\r\nconfig.textPrimitives.tiddlerAnyLinkRegExp = new RegExp(\"(\"+ config.textPrimitives.wikiLink + \")|(?:\" +\r\n\tconfig.textPrimitives.titledBrackettedLink + \")|(?:\" +\r\n\tconfig.textPrimitives.brackettedLink + \")|(?:\" +\r\n\tconfig.textPrimitives.urlPattern + \")\",\"mg\");\r\n\r\nconfig.glyphs = {\r\n\tcurrBrowser: null,\r\n\tbrowsers: [],\r\n\tcodes: {}\r\n};\r\n\r\n//--\r\n//-- Shadow tiddlers\r\n//--\r\n\r\nconfig.shadowTiddlers = {\r\n\tStyleSheet: \"\",\r\n\tMarkupPreHead: \"\",\r\n\tMarkupPostHead: \"\",\r\n\tMarkupPreBody: \"\",\r\n\tMarkupPostBody: \"\",\r\n\tTabTimeline: '<<timeline>>',\r\n\tTabAll: '<<list all>>',\r\n\tTabTags: '<<allTags excludeLists>>',\r\n\tTabMoreMissing: '<<list missing>>',\r\n\tTabMoreOrphans: '<<list orphans>>',\r\n\tTabMoreShadowed: '<<list shadowed>>',\r\n\tAdvancedOptions: '<<options>>',\r\n\tPluginManager: '<<plugins>>',\r\n\tSystemSettings: '',\r\n\tToolbarCommands: '|~ViewToolbar|closeTiddler closeOthers +editTiddler > fields syncing permalink references jump|\\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|',\r\n\tWindowTitle: '<<tiddler SiteTitle>> - <<tiddler SiteSubtitle>>'\r\n};\r\n\r\n// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.\r\nconfig.userAgent = navigator.userAgent.toLowerCase();\r\nconfig.browser = {\r\n\tisIE: config.userAgent.indexOf(\"msie\") != -1 && config.userAgent.indexOf(\"opera\") == -1,\r\n\tisGecko: navigator.product == \"Gecko\" && config.userAgent.indexOf(\"WebKit\") == -1,\r\n\tieVersion: /MSIE (\\d{1,2}.\\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg \"6.0\"\r\n\tisSafari: config.userAgent.indexOf(\"applewebkit\") != -1,\r\n\tisBadSafari: !((new RegExp(\"[\\u0150\\u0170]\",\"g\")).test(\"\\u0150\")),\r\n\tfirefoxDate: /gecko\\/(\\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as \"YYYYMMDD\"\r\n\tisOpera: config.userAgent.indexOf(\"opera\") != -1,\r\n\tisChrome: config.userAgent.indexOf('chrome') > -1,\r\n\tisLinux: config.userAgent.indexOf(\"linux\") != -1,\r\n\tisUnix: config.userAgent.indexOf(\"x11\") != -1,\r\n\tisMac: config.userAgent.indexOf(\"mac\") != -1,\r\n\tisWindows: config.userAgent.indexOf(\"win\") != -1\r\n};\r\n\r\nmerge(config.glyphs,{\r\n\tbrowsers: [\r\n\t\tfunction() {return config.browser.isIE;},\r\n\t\tfunction() {return true;}\r\n\t\t],\r\n\tcodes: {\r\n\t\tdownTriangle: [\"\\u25BC\",\"\\u25BE\"],\r\n\t\tdownArrow: [\"\\u2193\",\"\\u2193\"],\r\n\t\tbentArrowLeft: [\"\\u2190\",\"\\u21A9\"],\r\n\t\tbentArrowRight: [\"\\u2192\",\"\\u21AA\"]\r\n\t}\r\n});\r\n\r\n//--\r\n//-- Translateable strings\r\n//--\r\n\r\n// Strings in \"double quotes\" should be translated; strings in 'single quotes' should be left alone\r\n\r\nmerge(config.options,{\r\n\ttxtUserName: \"YourName\"});\r\n\r\nmerge(config.tasks,{\r\n\tsave: {text: \"save\", tooltip: \"Save your changes to this TiddlyWiki\"},\r\n\timportTask: {text: \"import\", tooltip: \"Import tiddlers and plugins from other TiddlyWiki files and servers\", content: '<<importTiddlers>>'},\r\n\ttweak: {text: \"tweak\", tooltip: \"Tweak the appearance and behaviour of TiddlyWiki\", content: '<<options>>'},\r\n\tupgrade: {text: \"upgrade\", tooltip: \"Upgrade TiddlyWiki core code\", content: '<<upgrade>>'},\r\n\tplugins: {text: \"plugins\", tooltip: \"Manage installed plugins\", content: '<<plugins>>'}\r\n});\r\n\r\n// Options that can be set in the options panel and/or cookies\r\nmerge(config.optionsDesc,{\r\n\ttxtUserName: \"Username for signing your edits\",\r\n\tchkRegExpSearch: \"Enable regular expressions for searches\",\r\n\tchkCaseSensitiveSearch: \"Case-sensitive searching\",\r\n\tchkIncrementalSearch: \"Incremental key-by-key searching\",\r\n\tchkAnimate: \"Enable animations\",\r\n\tchkSaveBackups: \"Keep backup file when saving changes\",\r\n\tchkAutoSave: \"Automatically save changes\",\r\n\tchkGenerateAnRssFeed: \"Generate an RSS feed when saving changes\",\r\n\tchkSaveEmptyTemplate: \"Generate an empty template when saving changes\",\r\n\tchkOpenInNewWindow: \"Open external links in a new window\",\r\n\tchkToggleLinks: \"Clicking on links to open tiddlers causes them to close\",\r\n\tchkHttpReadOnly: \"Hide editing features when viewed over HTTP\",\r\n\tchkForceMinorUpdate: \"Don't update modifier username and date when editing tiddlers\",\r\n\tchkConfirmDelete: \"Require confirmation before deleting tiddlers\",\r\n\tchkInsertTabs: \"Use the tab key to insert tab characters instead of moving between fields\",\r\n\ttxtBackupFolder: \"Name of folder to use for backups\",\r\n\ttxtMaxEditRows: \"Maximum number of rows in edit boxes\",\r\n\ttxtTheme: \"Name of the theme to use\",\r\n\ttxtFileSystemCharSet: \"Default character set for saving changes (Firefox/Mozilla only)\"});\r\n\r\nmerge(config.messages,{\r\n\tcustomConfigError: \"Problems were encountered loading plugins. See PluginManager for details\",\r\n\tpluginError: \"Error: %0\",\r\n\tpluginDisabled: \"Not executed because disabled via 'systemConfigDisable' tag\",\r\n\tpluginForced: \"Executed because forced via 'systemConfigForce' tag\",\r\n\tpluginVersionError: \"Not executed because this plugin needs a newer version of TiddlyWiki\",\r\n\tnothingSelected: \"Nothing is selected. You must select one or more items first\",\r\n\tsavedSnapshotError: \"It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#Download for details\",\r\n\tsubtitleUnknown: \"(unknown)\",\r\n\tundefinedTiddlerToolTip: \"The tiddler '%0' doesn't yet exist\",\r\n\tshadowedTiddlerToolTip: \"The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value\",\r\n\ttiddlerLinkTooltip: \"%0 - %1, %2\",\r\n\texternalLinkTooltip: \"External link to %0\",\r\n\tnoTags: \"There are no tagged tiddlers\",\r\n\tnotFileUrlError: \"You need to save this TiddlyWiki to a file before you can save changes\",\r\n\tcantSaveError: \"It's not possible to save changes. Possible reasons include:\\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\\n- the pathname to your TiddlyWiki file contains illegal characters\\n- the TiddlyWiki HTML file has been moved or renamed\",\r\n\tinvalidFileError: \"The original file '%0' does not appear to be a valid TiddlyWiki\",\r\n\tbackupSaved: \"Backup saved\",\r\n\tbackupFailed: \"Failed to save backup file\",\r\n\trssSaved: \"RSS feed saved\",\r\n\trssFailed: \"Failed to save RSS feed file\",\r\n\temptySaved: \"Empty template saved\",\r\n\temptyFailed: \"Failed to save empty template file\",\r\n\tmainSaved: \"Main TiddlyWiki file saved\",\r\n\tmainDownload: \"Downloading/saving main TiddlyWiki file\",\r\n\tmainDownloadManual: \"RIGHT CLICK HERE to download/save main TiddlyWiki file\",\r\n\tmainFailed: \"Failed to save main TiddlyWiki file. Your changes have not been saved\",\r\n\tmacroError: \"Error in macro <<%0>>\",\r\n\tmacroErrorDetails: \"Error while executing macro <<%0>>:\\n%1\",\r\n\tmissingMacro: \"No such macro\",\r\n\toverwriteWarning: \"A tiddler named '%0' already exists. Choose OK to overwrite it\",\r\n\tunsavedChangesWarning: \"WARNING! There are unsaved changes in TiddlyWiki\\n\\nChoose OK to save\\nChoose CANCEL to discard\",\r\n\tconfirmExit: \"--------------------------------\\n\\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\\n\\n--------------------------------\",\r\n\tsaveInstructions: \"SaveChanges\",\r\n\tunsupportedTWFormat: \"Unsupported TiddlyWiki format '%0'\",\r\n\ttiddlerSaveError: \"Error when saving tiddler '%0'\",\r\n\ttiddlerLoadError: \"Error when loading tiddler '%0'\",\r\n\twrongSaveFormat: \"Cannot save with storage format '%0'. Using standard format for save.\",\r\n\tinvalidFieldName: \"Invalid field name %0\",\r\n\tfieldCannotBeChanged: \"Field '%0' cannot be changed\",\r\n\tloadingMissingTiddler: \"Attempting to retrieve the tiddler '%0' from the '%1' server at:\\n\\n'%2' in the workspace '%3'\",\r\n\tupgradeDone: \"The upgrade to version %0 is now complete\\n\\nClick 'OK' to reload the newly upgraded TiddlyWiki\",\r\n\tinvalidCookie: \"Invalid cookie '%0'\"});\r\n\r\nmerge(config.messages.messageClose,{\r\n\ttext: \"close\",\r\n\ttooltip: \"close this message area\"});\r\n\r\nconfig.messages.backstage = {\r\n\topen: {text: \"backstage\", tooltip: \"Open the backstage area to perform authoring and editing tasks\"},\r\n\tclose: {text: \"close\", tooltip: \"Close the backstage area\"},\r\n\tprompt: \"backstage: \",\r\n\tdecal: {\r\n\t\tedit: {text: \"edit\", tooltip: \"Edit the tiddler '%0'\"}\r\n\t}\r\n};\r\n\r\nconfig.messages.listView = {\r\n\ttiddlerTooltip: \"Click for the full text of this tiddler\",\r\n\tpreviewUnavailable: \"(preview not available)\"\r\n};\r\n\r\nconfig.messages.dates.months = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\",\"December\"];\r\nconfig.messages.dates.days = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\r\nconfig.messages.dates.shortMonths = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\r\nconfig.messages.dates.shortDays = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\r\n// suffixes for dates, eg \"1st\",\"2nd\",\"3rd\"...\"30th\",\"31st\"\r\nconfig.messages.dates.daySuffixes = [\"st\",\"nd\",\"rd\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\r\n\t\t\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\r\n\t\t\"st\",\"nd\",\"rd\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\r\n\t\t\"st\"];\r\nconfig.messages.dates.am = \"am\";\r\nconfig.messages.dates.pm = \"pm\";\r\n\r\nmerge(config.messages.tiddlerPopup,{\r\n\t});\r\n\r\nmerge(config.views.wikified.tag,{\r\n\tlabelNoTags: \"no tags\",\r\n\tlabelTags: \"tags: \",\r\n\topenTag: \"Open tag '%0'\",\r\n\ttooltip: \"Show tiddlers tagged with '%0'\",\r\n\topenAllText: \"Open all\",\r\n\topenAllTooltip: \"Open all of these tiddlers\",\r\n\tpopupNone: \"No other tiddlers tagged with '%0'\"});\r\n\r\nmerge(config.views.wikified,{\r\n\tdefaultText: \"The tiddler '%0' doesn't yet exist. Double-click to create it\",\r\n\tdefaultModifier: \"(missing)\",\r\n\tshadowModifier: \"(built-in shadow tiddler)\",\r\n\tdateFormat: \"DD MMM YYYY\",\r\n\tcreatedPrompt: \"created\"});\r\n\r\nmerge(config.views.editor,{\r\n\ttagPrompt: \"Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing\",\r\n\tdefaultText: \"Type the text for '%0'\"});\r\n\r\nmerge(config.views.editor.tagChooser,{\r\n\ttext: \"tags\",\r\n\ttooltip: \"Choose existing tags to add to this tiddler\",\r\n\tpopupNone: \"There are no tags defined\",\r\n\ttagTooltip: \"Add the tag '%0'\"});\r\n\r\nmerge(config.messages,{\r\n\tsizeTemplates:\r\n\t\t[\r\n\t\t{unit: 1024*1024*1024, template: \"%0\\u00a0GB\"},\r\n\t\t{unit: 1024*1024, template: \"%0\\u00a0MB\"},\r\n\t\t{unit: 1024, template: \"%0\\u00a0KB\"},\r\n\t\t{unit: 1, template: \"%0\\u00a0B\"}\r\n\t\t]});\r\n\r\nmerge(config.macros.search,{\r\n\tlabel: \"search\",\r\n\tprompt: \"Search this TiddlyWiki\",\r\n\tplaceholder: \"\",\r\n\taccessKey: \"F\",\r\n\tsuccessMsg: \"%0 tiddlers found matching %1\",\r\n\tfailureMsg: \"No tiddlers found matching %0\"});\r\n\r\nmerge(config.macros.tagging,{\r\n\tlabel: \"tagging: \",\r\n\tlabelNotTag: \"not tagging\",\r\n\ttooltip: \"List of tiddlers tagged with '%0'\"});\r\n\r\nmerge(config.macros.timeline,{\r\n\tdateFormat: \"DD MMM YYYY\"});\r\n\r\nmerge(config.macros.allTags,{\r\n\ttooltip: \"Show tiddlers tagged with '%0'\",\r\n\tnoTags: \"There are no tagged tiddlers\"});\r\n\r\nconfig.macros.list.all.prompt = \"All tiddlers in alphabetical order\";\r\nconfig.macros.list.missing.prompt = \"Tiddlers that have links to them but are not defined\";\r\nconfig.macros.list.orphans.prompt = \"Tiddlers that are not linked to from any other tiddlers\";\r\nconfig.macros.list.shadowed.prompt = \"Tiddlers shadowed with default contents\";\r\nconfig.macros.list.touched.prompt = \"Tiddlers that have been modified locally\";\r\n\r\nmerge(config.macros.closeAll,{\r\n\tlabel: \"close all\",\r\n\tprompt: \"Close all displayed tiddlers (except any that are being edited)\"});\r\n\r\nmerge(config.macros.permaview,{\r\n\tlabel: \"permaview\",\r\n\tprompt: \"Link to an URL that retrieves all the currently displayed tiddlers\"});\r\n\r\nmerge(config.macros.saveChanges,{\r\n\tlabel: \"save changes\",\r\n\tprompt: \"Save all tiddlers to create a new TiddlyWiki\",\r\n\taccessKey: \"S\"});\r\n\r\nmerge(config.macros.newTiddler,{\r\n\tlabel: \"new tiddler\",\r\n\tprompt: \"Create a new tiddler\",\r\n\ttitle: \"New Tiddler\",\r\n\taccessKey: \"N\"});\r\n\r\nmerge(config.macros.newJournal,{\r\n\tlabel: \"new journal\",\r\n\tprompt: \"Create a new tiddler from the current date and time\",\r\n\taccessKey: \"J\"});\r\n\r\nmerge(config.macros.options,{\r\n\twizardTitle: \"Tweak advanced options\",\r\n\tstep1Title: \"These options are saved in cookies in your browser\",\r\n\tstep1Html: \"<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>\",\r\n\tunknownDescription: \"//(unknown)//\",\r\n\tlistViewTemplate: {\r\n\t\tcolumns: [\r\n\t\t\t{name: 'Option', field: 'option', title: \"Option\", type: 'String'},\r\n\t\t\t{name: 'Description', field: 'description', title: \"Description\", type: 'WikiText'},\r\n\t\t\t{name: 'Name', field: 'name', title: \"Name\", type: 'String'}\r\n\t\t\t],\r\n\t\trowClasses: [\r\n\t\t\t{className: 'lowlight', field: 'lowlight'}\r\n\t\t\t]}\r\n\t});\r\n\r\nmerge(config.macros.plugins,{\r\n\twizardTitle: \"Manage plugins\",\r\n\tstep1Title: \"Currently loaded plugins\",\r\n\tstep1Html: \"<input type='hidden' name='markList'></input>\", // DO NOT TRANSLATE\r\n\tskippedText: \"(This plugin has not been executed because it was added since startup)\",\r\n\tnoPluginText: \"There are no plugins installed\",\r\n\tconfirmDeleteText: \"Are you sure you want to delete these plugins:\\n\\n%0\",\r\n\tremoveLabel: \"remove systemConfig tag\",\r\n\tremovePrompt: \"Remove systemConfig tag\",\r\n\tdeleteLabel: \"delete\",\r\n\tdeletePrompt: \"Delete these tiddlers forever\",\r\n\tlistViewTemplate: {\r\n\t\tcolumns: [\r\n\t\t\t{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},\r\n\t\t\t{name: 'Tiddler', field: 'tiddler', title: \"Tiddler\", type: 'Tiddler'},\r\n\t\t\t{name: 'Description', field: 'Description', title: \"Description\", type: 'String'},\r\n\t\t\t{name: 'Version', field: 'Version', title: \"Version\", type: 'String'},\r\n\t\t\t{name: 'Size', field: 'size', tiddlerLink: 'size', title: \"Size\", type: 'Size'},\r\n\t\t\t{name: 'Forced', field: 'forced', title: \"Forced\", tag: 'systemConfigForce', type: 'TagCheckbox'},\r\n\t\t\t{name: 'Disabled', field: 'disabled', title: \"Disabled\", tag: 'systemConfigDisable', type: 'TagCheckbox'},\r\n\t\t\t{name: 'Executed', field: 'executed', title: \"Loaded\", type: 'Boolean', trueText: \"Yes\", falseText: \"No\"},\r\n\t\t\t{name: 'Startup Time', field: 'startupTime', title: \"Startup Time\", type: 'String'},\r\n\t\t\t{name: 'Error', field: 'error', title: \"Status\", type: 'Boolean', trueText: \"Error\", falseText: \"OK\"},\r\n\t\t\t{name: 'Log', field: 'log', title: \"Log\", type: 'StringList'}\r\n\t\t\t],\r\n\t\trowClasses: [\r\n\t\t\t{className: 'error', field: 'error'},\r\n\t\t\t{className: 'warning', field: 'warning'}\r\n\t\t\t]},\r\n\tlistViewTemplateReadOnly: {\r\n\t\tcolumns: [\r\n\t\t\t{name: 'Tiddler', field: 'tiddler', title: \"Tiddler\", type: 'Tiddler'},\r\n\t\t\t{name: 'Description', field: 'Description', title: \"Description\", type: 'String'},\r\n\t\t\t{name: 'Version', field: 'Version', title: \"Version\", type: 'String'},\r\n\t\t\t{name: 'Size', field: 'size', tiddlerLink: 'size', title: \"Size\", type: 'Size'},\r\n\t\t\t{name: 'Executed', field: 'executed', title: \"Loaded\", type: 'Boolean', trueText: \"Yes\", falseText: \"No\"},\r\n\t\t\t{name: 'Startup Time', field: 'startupTime', title: \"Startup Time\", type: 'String'},\r\n\t\t\t{name: 'Error', field: 'error', title: \"Status\", type: 'Boolean', trueText: \"Error\", falseText: \"OK\"},\r\n\t\t\t{name: 'Log', field: 'log', title: \"Log\", type: 'StringList'}\r\n\t\t\t],\r\n\t\trowClasses: [\r\n\t\t\t{className: 'error', field: 'error'},\r\n\t\t\t{className: 'warning', field: 'warning'}\r\n\t\t\t]}\r\n\t});\r\n\r\nmerge(config.macros.toolbar,{\r\n\tmoreLabel: \"more\",\r\n\tmorePrompt: \"Show additional commands\",\r\n\tlessLabel: \"less\",\r\n\tlessPrompt: \"Hide additional commands\",\r\n\tseparator: \"|\"\r\n\t});\r\n\r\nmerge(config.macros.refreshDisplay,{\r\n\tlabel: \"refresh\",\r\n\tprompt: \"Redraw the entire TiddlyWiki display\"\r\n\t});\r\n\r\nmerge(config.macros.importTiddlers,{\r\n\treadOnlyWarning: \"You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL\",\r\n\twizardTitle: \"Import tiddlers from another file or server\",\r\n\tstep1Title: \"Step 1: Locate the server or TiddlyWiki file\",\r\n\tstep1Html: \"Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>\",\r\n\topenLabel: \"open\",\r\n\topenPrompt: \"Open the connection to this file or server\",\r\n\tstatusOpenHost: \"Opening the host\",\r\n\tstatusGetWorkspaceList: \"Getting the list of available workspaces\",\r\n\tstep2Title: \"Step 2: Choose the workspace\",\r\n\tstep2Html: \"Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>\",\r\n\tcancelLabel: \"cancel\",\r\n\tcancelPrompt: \"Cancel this import\",\r\n\tstatusOpenWorkspace: \"Opening the workspace\",\r\n\tstatusGetTiddlerList: \"Getting the list of available tiddlers\",\r\n\terrorGettingTiddlerList: \"Error getting list of tiddlers, click Cancel to try again\",\r\n\terrorGettingTiddlerListHttp404: \"Error retrieving tiddlers from url, please ensure the url exists. Click Cancel to try again.\",\r\n\terrorGettingTiddlerListHttp: \"Error retrieving tiddlers from url, please ensure this url exists and is <a href='http://enable-cors.org/'>CORS</a> enabled\",\r\n\terrorGettingTiddlerListFile: \"Error retrieving tiddlers from local file, please make sure the file is in the same directory as your TiddlyWiki. Click Cancel to try again.\",\r\n\tstep3Title: \"Step 3: Choose the tiddlers to import\",\r\n\tstep3Html: \"<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>\",\r\n\timportLabel: \"import\",\r\n\timportPrompt: \"Import these tiddlers\",\r\n\tconfirmOverwriteText: \"Are you sure you want to overwrite these tiddlers:\\n\\n%0\",\r\n\tstep4Title: \"Step 4: Importing %0 tiddler(s)\",\r\n\tstep4Html: \"<input type='hidden' name='markReport'></input>\", // DO NOT TRANSLATE\r\n\tdoneLabel: \"done\",\r\n\tdonePrompt: \"Close this wizard\",\r\n\tstatusDoingImport: \"Importing tiddlers\",\r\n\tstatusDoneImport: \"All tiddlers imported\",\r\n\tsystemServerNamePattern: \"%2 on %1\",\r\n\tsystemServerNamePatternNoWorkspace: \"%1\",\r\n\tconfirmOverwriteSaveTiddler: \"The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged\",\r\n\tserverSaveTemplate: \"|''Type:''|%0|\\n|''URL:''|%1|\\n|''Workspace:''|%2|\\n\\nThis tiddler was automatically created to record the details of this server\",\r\n\tserverSaveModifier: \"(System)\",\r\n\tlistViewTemplate: {\r\n\t\tcolumns: [\r\n\t\t\t{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},\r\n\t\t\t{name: 'Tiddler', field: 'tiddler', title: \"Tiddler\", type: 'Tiddler'},\r\n\t\t\t{name: 'Size', field: 'size', tiddlerLink: 'size', title: \"Size\", type: 'Size'},\r\n\t\t\t{name: 'Tags', field: 'tags', title: \"Tags\", type: 'Tags'}\r\n\t\t\t],\r\n\t\trowClasses: [\r\n\t\t\t]}\r\n\t});\r\n\r\nmerge(config.macros.upgrade,{\r\n\twizardTitle: \"Upgrade TiddlyWiki core code\",\r\n\tstep1Title: \"Update or repair this TiddlyWiki to the latest release\",\r\n\tstep1Html: \"You are about to upgrade to the latest release of the TiddlyWiki core code (from <a href='%0' class='externalLink' target='_blank'>%1</a>). Your content will be preserved across the upgrade.<br><br>Note that core upgrades have been known to interfere with older plugins. If you run into problems with the upgraded file, see <a href='http://www.tiddlywiki.org/wiki/CoreUpgrades' class='externalLink' target='_blank'>http://www.tiddlywiki.org/wiki/CoreUpgrades</a>\",\r\n\terrorCantUpgrade: \"Unable to upgrade this TiddlyWiki. You can only perform upgrades on TiddlyWiki files stored locally\",\r\n\terrorNotSaved: \"You must save changes before you can perform an upgrade\",\r\n\tstep2Title: \"Confirm the upgrade details\",\r\n\tstep2Html_downgrade: \"You are about to downgrade to TiddlyWiki version %0 from %1.<br><br>Downgrading to an earlier version of the core code is not recommended\",\r\n\tstep2Html_restore: \"This TiddlyWiki appears to be already using the latest version of the core code (%0).<br><br>You can continue to upgrade anyway to ensure that the core code hasn't been corrupted or damaged\",\r\n\tstep2Html_upgrade: \"You are about to upgrade to TiddlyWiki version %0 from %1\",\r\n\tupgradeLabel: \"upgrade\",\r\n\tupgradePrompt: \"Prepare for the upgrade process\",\r\n\tstatusPreparingBackup: \"Preparing backup\",\r\n\tstatusSavingBackup: \"Saving backup file\",\r\n\terrorSavingBackup: \"There was a problem saving the backup file\",\r\n\tstatusLoadingCore: \"Loading core code\",\r\n\terrorLoadingCore: \"Error loading the core code\",\r\n\terrorCoreFormat: \"Error with the new core code\",\r\n\tstatusSavingCore: \"Saving the new core code\",\r\n\tstatusReloadingCore: \"Reloading the new core code\",\r\n\tstartLabel: \"start\",\r\n\tstartPrompt: \"Start the upgrade process\",\r\n\tcancelLabel: \"cancel\",\r\n\tcancelPrompt: \"Cancel the upgrade process\",\r\n\tstep3Title: \"Upgrade cancelled\",\r\n\tstep3Html: \"You have cancelled the upgrade process\"\r\n\t});\r\n\r\nmerge(config.macros.annotations,{\r\n\t});\r\n\r\nmerge(config.commands.closeTiddler,{\r\n\ttext: \"close\",\r\n\ttooltip: \"Close this tiddler\"});\r\n\r\nmerge(config.commands.closeOthers,{\r\n\ttext: \"close others\",\r\n\ttooltip: \"Close all other tiddlers\"});\r\n\r\nmerge(config.commands.editTiddler,{\r\n\ttext: \"edit\",\r\n\ttooltip: \"Edit this tiddler\",\r\n\treadOnlyText: \"view\",\r\n\treadOnlyTooltip: \"View the source of this tiddler\"});\r\n\r\nmerge(config.commands.saveTiddler,{\r\n\ttext: \"done\",\r\n\ttooltip: \"Save changes to this tiddler\"});\r\n\r\nmerge(config.commands.cancelTiddler,{\r\n\ttext: \"cancel\",\r\n\ttooltip: \"Undo changes to this tiddler\",\r\n\twarning: \"Are you sure you want to abandon your changes to '%0'?\",\r\n\treadOnlyText: \"done\",\r\n\treadOnlyTooltip: \"View this tiddler normally\"});\r\n\r\nmerge(config.commands.deleteTiddler,{\r\n\ttext: \"delete\",\r\n\ttooltip: \"Delete this tiddler\",\r\n\twarning: \"Are you sure you want to delete '%0'?\"});\r\n\r\nmerge(config.commands.permalink,{\r\n\ttext: \"permalink\",\r\n\ttooltip: \"Permalink for this tiddler\"});\r\n\r\nmerge(config.commands.references,{\r\n\ttext: \"references\",\r\n\ttooltip: \"Show tiddlers that link to this one\",\r\n\tpopupNone: \"No references\"});\r\n\r\nmerge(config.commands.jump,{\r\n\ttext: \"jump\",\r\n\ttooltip: \"Jump to another open tiddler\"});\r\n\r\nmerge(config.commands.fields,{\r\n\ttext: \"fields\",\r\n\ttooltip: \"Show the extended fields of this tiddler\",\r\n\temptyText: \"There are no extended fields for this tiddler\",\r\n\tlistViewTemplate: {\r\n\t\tcolumns: [\r\n\t\t\t{name: 'Field', field: 'field', title: \"Field\", type: 'String'},\r\n\t\t\t{name: 'Value', field: 'value', title: \"Value\", type: 'String'}\r\n\t\t\t],\r\n\t\trowClasses: [\r\n\t\t\t],\r\n\t\tbuttons: [\r\n\t\t\t]}});\r\n\r\nmerge(config.shadowTiddlers,{\r\n\tDefaultTiddlers: \"[[GettingStarted]]\",\r\n\tMainMenu: \"[[GettingStarted]]\",\r\n\tSiteTitle: \"My TiddlyWiki\",\r\n\tSiteSubtitle: \"a reusable non-linear personal web notebook\",\r\n\tSiteUrl: \"\",\r\n\tSideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal \"DD MMM YYYY\" \"journal\">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel \"options \\u00bb\" \"Change TiddlyWiki advanced options\">>',\r\n\tSideBarTabs: '<<tabs txtMainTab \"Timeline\" \"Timeline\" TabTimeline \"All\" \"All tiddlers\" TabAll \"Tags\" \"All tags\" TabTags \"More\" \"More lists\" TabMore>>',\r\n\tTabMore: '<<tabs txtMoreTab \"Missing\" \"Missing tiddlers\" TabMoreMissing \"Orphans\" \"Orphaned tiddlers\" TabMoreOrphans \"Shadowed\" \"Shadowed tiddlers\" TabMoreShadowed>>'\r\n\t});\r\n\r\nmerge(config.annotations,{\r\n\tAdvancedOptions: \"This shadow tiddler provides access to several advanced options\",\r\n\tColorPalette: \"These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface\",\r\n\tDefaultTiddlers: \"The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up\",\r\n\tEditTemplate: \"The HTML template in this shadow tiddler determines how tiddlers look while they are being edited\",\r\n\tGettingStarted: \"This shadow tiddler provides basic usage instructions\",\r\n\tImportTiddlers: \"This shadow tiddler provides access to importing tiddlers\",\r\n\tMainMenu: \"This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen\",\r\n\tMarkupPreHead: \"This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file\",\r\n\tMarkupPostHead: \"This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file\",\r\n\tMarkupPreBody: \"This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file\",\r\n\tMarkupPostBody: \"This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately after the script block\",\r\n\tOptionsPanel: \"This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar\",\r\n\tPageTemplate: \"The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout\",\r\n\tPluginManager: \"This shadow tiddler provides access to the plugin manager\",\r\n\tSideBarOptions: \"This shadow tiddler is used as the contents of the option panel in the right-hand sidebar\",\r\n\tSideBarTabs: \"This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar\",\r\n\tSiteSubtitle: \"This shadow tiddler is used as the second part of the page title\",\r\n\tSiteTitle: \"This shadow tiddler is used as the first part of the page title\",\r\n\tSiteUrl: \"This shadow tiddler should be set to the full target URL for publication\",\r\n\tStyleSheetColors: \"This shadow tiddler contains CSS definitions related to the color of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler\",\r\n\tStyleSheet: \"This tiddler can contain custom CSS definitions\",\r\n\tStyleSheetLayout: \"This shadow tiddler contains CSS definitions related to the layout of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler\",\r\n\tStyleSheetLocale: \"This shadow tiddler contains CSS definitions related to the translation locale\",\r\n\tStyleSheetPrint: \"This shadow tiddler contains CSS definitions for printing\",\r\n\tSystemSettings: \"This tiddler is used to store configuration options for this TiddlyWiki document\",\r\n\tTabAll: \"This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar\",\r\n\tTabMore: \"This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar\",\r\n\tTabMoreMissing: \"This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar\",\r\n\tTabMoreOrphans: \"This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar\",\r\n\tTabMoreShadowed: \"This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar\",\r\n\tTabTags: \"This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar\",\r\n\tTabTimeline: \"This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar\",\r\n\tToolbarCommands: \"This shadow tiddler determines which commands are shown in tiddler toolbars\",\r\n\tViewTemplate: \"The HTML template in this shadow tiddler determines how tiddlers look\"\r\n\t});\r\n//--\r\n//-- Main\r\n//--\r\n\r\nvar params = null; // Command line parameters\r\nvar store = null; // TiddlyWiki storage\r\nvar story = null; // Main story\r\nvar formatter = null; // Default formatters for the wikifier\r\nvar anim = typeof Animator == \"function\" ? new Animator() : null; // Animation engine\r\nvar readOnly = false; // Whether we're in readonly mode\r\nvar highlightHack = null; // Embarrassing hack department...\r\nvar hadConfirmExit = false; // Don't warn more than once\r\nvar safeMode = false; // Disable all plugins and cookies\r\nvar showBackstage; // Whether to include the backstage area\r\nvar installedPlugins = []; // Information filled in when plugins are executed\r\nvar startingUp = false; // Whether we're in the process of starting up\r\nvar pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()\r\n\r\n// Whether this file can be saved back to the same location [Preemption]\r\nwindow.allowSave = window.allowSave || function(l)\r\n{\r\n\treturn true;\r\n}\r\n\r\n// Whether this file is being viewed locally\r\nwindow.isLocal = function()\r\n{\r\n\treturn (document.location.protocol == \"file:\");\r\n}\r\n\r\n// Whether to use the JavaSaver applet\r\nvar useJavaSaver = window.isLocal() && (config.browser.isSafari || config.browser.isOpera);\r\n\r\n// Allow preemption code a chance to tweak config and useJavaSaver [Preemption]\r\nif (window.tweakConfig) window.tweakConfig();\r\n\r\nif(!window || !window.console) {\r\n\tconsole = {tiddlywiki:true,log:function(message) {displayMessage(message);}};\r\n}\r\n\r\n// Starting up\r\nfunction main()\r\n{\r\n\twindow.originalHTML=recreateOriginal();\r\n\r\n\tvar t10,t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();\r\n\tstartingUp = true;\r\n\tvar doc = jQuery(document);\r\n\tjQuery.noConflict();\r\n\twindow.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};\r\n\tparams = getParameters();\r\n\tif(params)\r\n\t\tparams = params.parseParams(\"open\",null,false);\r\n\tstore = new TiddlyWiki({config:config});\r\n\tinvokeParamifier(params,\"oninit\");\r\n\tstory = new Story(\"tiddlerDisplay\",\"tiddler\");\r\n\taddEvent(document,\"click\",Popup.onDocumentClick);\r\n\tsaveTest();\r\n\tvar s;\r\n\tfor(s=0; s<config.notifyTiddlers.length; s++)\r\n\t\tstore.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);\r\n\tt1 = new Date();\r\n\tloadShadowTiddlers();\r\n\tdoc.trigger(\"loadShadows\");\r\n\tt2 = new Date();\r\n\tstore.loadFromDiv(\"storeArea\",\"store\",true);\r\n\tdoc.trigger(\"loadTiddlers\");\r\n\tloadOptions();\r\n\tt3 = new Date();\r\n\tinvokeParamifier(params,\"onload\");\r\n\tt4 = new Date();\r\n\treadOnly = window.isLocal() ? false : config.options.chkHttpReadOnly;\r\n\tvar pluginProblem = loadPlugins(\"systemConfig\");\r\n\tdoc.trigger(\"loadPlugins\");\r\n\tt5 = new Date();\r\n\tformatter = new Formatter(config.formatters);\r\n\tinvokeParamifier(params,\"onconfig\");\r\n\tstory.switchTheme(config.options.txtTheme);\r\n\tshowBackstage = showBackstage !== undefined ? showBackstage : !readOnly;\r\n\tt6 = new Date();\r\n\tvar m;\r\n\tfor(m in config.macros) {\r\n\t\tif(config.macros[m].init)\r\n\t\t\tconfig.macros[m].init();\r\n\t}\r\n\tt7 = new Date();\r\n\tstore.notifyAll();\r\n\tt8 = new Date();\r\n\trestart();\r\n\trefreshDisplay();\r\n\tt9 = new Date();\r\n\tif(pluginProblem) {\r\n\t\tstory.displayTiddler(null,\"PluginManager\");\r\n\t\tdisplayMessage(config.messages.customConfigError);\r\n\t}\r\n\tif(showBackstage)\r\n\t\tbackstage.init();\r\n\tt10 = new Date();\r\n\tif(config.options.chkDisplayInstrumentation) {\r\n\t\tdisplayMessage(\"LoadShadows \" + (t2-t1) + \" ms\");\r\n\t\tdisplayMessage(\"LoadFromDiv \" + (t3-t2) + \" ms\");\r\n\t\tdisplayMessage(\"LoadPlugins \" + (t5-t4) + \" ms\");\r\n\t\tdisplayMessage(\"Macro init \" + (t7-t6) + \" ms\");\r\n\t\tdisplayMessage(\"Notify \" + (t8-t7) + \" ms\");\r\n\t\tdisplayMessage(\"Restart \" + (t9-t8) + \" ms\");\r\n\t\tdisplayMessage(\"Total: \" + (t10-t0) + \" ms\");\r\n\t}\r\n\tstartingUp = false;\r\n\tdoc.trigger(\"startup\");\r\n}\r\n\r\n// Called on unload. All functions called conditionally since they themselves may have been unloaded.\r\nfunction unload()\r\n{\r\n\tif(window.checkUnsavedChanges)\r\n\t\tcheckUnsavedChanges();\r\n\tif(window.scrubNodes)\r\n\t\tscrubNodes(document.body);\r\n}\r\n\r\n// Restarting\r\nfunction restart()\r\n{\r\n\tinvokeParamifier(params,\"onstart\");\r\n\tif(story.isEmpty()) {\r\n\t\tstory.displayDefaultTiddlers();\r\n\t}\r\n\twindow.scrollTo(0,0);\r\n}\r\n\r\nfunction saveTest()\r\n{\r\n\tvar s = document.getElementById(\"saveTest\");\r\n\tif(s.hasChildNodes())\r\n\t\talert(config.messages.savedSnapshotError);\r\n\ts.appendChild(document.createTextNode(\"savetest\"));\r\n}\r\n\r\nfunction loadShadowTiddlers()\r\n{\r\n\tvar shadows = new TiddlyWiki();\r\n\tshadows.loadFromDiv(\"shadowArea\",\"shadows\",true);\r\n\tshadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});\r\n}\r\n\r\nfunction loadPlugins(tag)\r\n{\r\n\tif(safeMode)\r\n\t\treturn false;\r\n\tvar tiddlers = store.getTaggedTiddlers(tag);\r\n\ttiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : 1);});\r\n\tvar toLoad = [];\r\n\tvar nLoaded = 0;\r\n\tvar map = {};\r\n\tvar nPlugins = tiddlers.length;\r\n\tinstalledPlugins = [];\r\n\tvar i;\r\n\tfor(i=0; i<nPlugins; i++) {\r\n\t\tvar p = getPluginInfo(tiddlers[i]);\r\n\t\tinstalledPlugins[i] = p;\r\n\t\tvar n = p.Name || p.title;\r\n\t\tif(n)\r\n\t\t\tmap[n] = p;\r\n\t\tn = p.Source;\r\n\t\tif(n)\r\n\t\t\tmap[n] = p;\r\n\t}\r\n\tvar visit = function(p) {\r\n\t\tif(!p || p.done)\r\n\t\t\treturn;\r\n\t\tp.done = 1;\r\n\t\tvar reqs = p.Requires;\r\n\t\tif(reqs) {\r\n\t\t\treqs = reqs.readBracketedList();\r\n\t\t\tvar i;\r\n\t\t\tfor(i=0; i<reqs.length; i++)\r\n\t\t\t\tvisit(map[reqs[i]]);\r\n\t\t}\r\n\t\ttoLoad.push(p);\r\n\t};\r\n\tfor(i=0; i<nPlugins; i++)\r\n\t\tvisit(installedPlugins[i]);\r\n\tfor(i=0; i<toLoad.length; i++) {\r\n\t\tp = toLoad[i];\r\n\t\tpluginInfo = p;\r\n\t\ttiddler = p.tiddler;\r\n\t\tif(isPluginExecutable(p)) {\r\n\t\t\tif(isPluginEnabled(p)) {\r\n\t\t\t\tp.executed = true;\r\n\t\t\t\tvar startTime = new Date();\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif(tiddler.text)\r\n\t\t\t\t\t\twindow.eval(tiddler.text);\r\n\t\t\t\t\tnLoaded++;\r\n\t\t\t\t} catch(ex) {\r\n\t\t\t\t\tp.log.push(config.messages.pluginError.format([exceptionText(ex)]));\r\n\t\t\t\t\tp.error = true;\r\n\t\t\t\t\tif(!console.tiddlywiki) {\r\n\t\t\t\t\t\tconsole.log(\"error evaluating \" + tiddler.title, ex);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpluginInfo.startupTime = String((new Date()) - startTime) + \"ms\";\r\n\t\t\t} else {\r\n\t\t\t\tnPlugins--;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tp.warning = true;\r\n\t\t}\r\n\t}\r\n\treturn nLoaded != nPlugins;\r\n}\r\n\r\nfunction getPluginInfo(tiddler)\r\n{\r\n\tvar p = store.getTiddlerSlices(tiddler.title,[\"Name\",\"Description\",\"Version\",\"Requires\",\"CoreVersion\",\"Date\",\"Source\",\"Author\",\"License\",\"Browsers\"]);\r\n\tp.tiddler = tiddler;\r\n\tp.title = tiddler.title;\r\n\tp.log = [];\r\n\treturn p;\r\n}\r\n\r\n// Check that a particular plugin is valid for execution\r\nfunction isPluginExecutable(plugin)\r\n{\r\n\tif(plugin.tiddler.isTagged(\"systemConfigForce\")) {\r\n\t\tplugin.log.push(config.messages.pluginForced);\r\n\t\treturn true;\r\n\t}\r\n\tif(plugin[\"CoreVersion\"]) {\r\n\t\tvar coreVersion = plugin[\"CoreVersion\"].split(\".\");\r\n\t\tvar w = parseInt(coreVersion[0],10) - version.major;\r\n\t\tif(w == 0 && coreVersion[1])\r\n\t\t\tw = parseInt(coreVersion[1],10) - version.minor;\r\n\t\tif(w == 0 && coreVersion[2])\r\n\t\t\tw = parseInt(coreVersion[2],10) - version.revision;\r\n\t\tif(w > 0) {\r\n\t\t\tplugin.log.push(config.messages.pluginVersionError);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nfunction isPluginEnabled(plugin)\r\n{\r\n\tif(plugin.tiddler.isTagged(\"systemConfigDisable\")) {\r\n\t\tplugin.log.push(config.messages.pluginDisabled);\r\n\t\treturn false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\n//--\r\n//-- Paramifiers\r\n//--\r\n\r\nfunction getParameters()\r\n{\r\n\tvar p = null;\r\n\tif(window.location.hash) {\r\n\t\tp = decodeURIComponent(window.location.hash.substr(1));\r\n\t\tif(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < \"20051111\")\r\n\t\t\tp = convertUTF8ToUnicode(p);\r\n\t}\r\n\treturn p;\r\n}\r\n\r\nfunction invokeParamifier(params,handler)\r\n{\r\n\tif(!params || params.length == undefined || params.length <= 1)\r\n\t\treturn;\r\n\tvar i;\r\n\tfor(i=1; i<params.length; i++) {\r\n\t\tvar p = config.paramifiers[params[i].name];\r\n\t\tif(p && p[handler] instanceof Function)\r\n\t\t\tp[handler](params[i].value);\r\n\t\telse {\r\n\t\t\tvar h = config.optionHandlers[params[i].name.substr(0,3)];\r\n\t\t\tif(h && h.set instanceof Function)\r\n\t\t\t\th.set(params[i].name,params[i].value);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconfig.paramifiers = {};\r\n\r\nconfig.paramifiers.start = {\r\n\toninit: function(v) {\r\n\t\tsafeMode = v.toLowerCase() == \"safe\";\r\n\t}\r\n};\r\n\r\nconfig.paramifiers.open = {\r\n\tonstart: function(v) {\r\n\t\tif(!readOnly || store.tiddlerExists(v) || store.isShadowTiddler(v))\r\n\t\t\tstory.displayTiddler(\"bottom\",v,null,false,null);\r\n\t}\r\n};\r\n\r\nconfig.paramifiers.story = {\r\n\tonstart: function(v) {\r\n\t\tvar list = store.getTiddlerText(v,\"\").parseParams(\"open\",null,false);\r\n\t\tinvokeParamifier(list,\"onstart\");\r\n\t}\r\n};\r\n\r\nconfig.paramifiers.search = {\r\n\tonstart: function(v) {\r\n\t\tstory.search(v,false,false);\r\n\t}\r\n};\r\n\r\nconfig.paramifiers.searchRegExp = {\r\n\tonstart: function(v) {\r\n\t\tstory.prototype.search(v,false,true);\r\n\t}\r\n};\r\n\r\nconfig.paramifiers.tag = {\r\n\tonstart: function(v) {\r\n\t\tstory.displayTiddlers(null,store.filterTiddlers(\"[tag[\"+v+\"]]\"),null,false,null);\r\n\t}\r\n};\r\n\r\nconfig.paramifiers.newTiddler = {\r\n\tonstart: function(v) {\r\n\t\tvar args = v.parseParams(\"anon\", null, null)[0];\r\n\t\tvar title = args.title ? args.title[0] : v;\r\n\t\tvar customFields = args.fields ? args.fields[0] : null;\r\n\t\tif(!readOnly) {\r\n\t\t\tstory.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,customFields);\r\n\t\t\tstory.focusTiddler(title,\"text\");\r\n\t\t\tvar i,tags = args.tag || [];\r\n\t\t\tfor(i=0;i<tags.length;i++) {\r\n\t\t\t\tstory.setTiddlerTag(title,tags[i],+1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconfig.paramifiers.newJournal = {\r\n\tonstart: function(v) {\r\n\t\tif(!readOnly) {\r\n\t\t\tvar now = new Date();\r\n\t\t\tvar title = now.formatString(v.trim());\r\n\t\t\tstory.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);\r\n\t\t\tstory.focusTiddler(title,\"text\");\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconfig.paramifiers.readOnly = {\r\n\tonconfig: function(v) {\r\n\t\tvar p = v.toLowerCase();\r\n\t\treadOnly = p == \"yes\" ? true : (p == \"no\" ? false : readOnly);\r\n\t}\r\n};\r\n\r\nconfig.paramifiers.theme = {\r\n\tonconfig: function(v) {\r\n\t\tstory.switchTheme(v);\r\n\t}\r\n};\r\n\r\nconfig.paramifiers.upgrade = {\r\n\tonstart: function(v) {\r\n\t\tupgradeFrom(v);\r\n\t}\r\n};\r\n\r\nconfig.paramifiers.recent= {\r\n\tonstart: function(v) {\r\n\t\tvar titles=[];\r\n\t\tvar i,tiddlers=store.getTiddlers(\"modified\",\"excludeLists\").reverse();\r\n\t\tfor(i=0; i<v && i<tiddlers.length; i++)\r\n\t\t\ttitles.push(tiddlers[i].title);\r\n\t\tstory.displayTiddlers(null,titles);\r\n\t}\r\n};\r\n\r\nconfig.paramifiers.filter = {\r\n\tonstart: function(v) {\r\n\t\tstory.displayTiddlers(null,store.filterTiddlers(v),null,false);\r\n\t}\r\n};\r\n\r\n//--\r\n//-- Formatter helpers\r\n//--\r\n\r\nfunction Formatter(formatters)\r\n{\r\n\tvar n;\r\n\tthis.formatters = [];\r\n\tvar pattern = [];\r\n\tfor(n=0; n<formatters.length; n++) {\r\n\t\tpattern.push(\"(\" + formatters[n].match + \")\");\r\n\t\tthis.formatters.push(formatters[n]);\r\n\t}\r\n\tthis.formatterRegExp = new RegExp(pattern.join(\"|\"),\"mg\");\r\n}\r\n\r\nconfig.formatterHelpers = {\r\n\r\n\tcreateElementAndWikify: function(w)\r\n\t{\r\n\t\tw.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);\r\n\t},\r\n\r\n\tinlineCssHelper: function(w)\r\n\t{\r\n\t\tvar styles = [];\r\n\t\tconfig.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;\r\n\t\tvar lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);\r\n\t\twhile(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {\r\n\t\t\tvar s,v;\r\n\t\t\tif(lookaheadMatch[1]) {\r\n\t\t\t\ts = lookaheadMatch[1].unDash();\r\n\t\t\t\tv = lookaheadMatch[2];\r\n\t\t\t} else {\r\n\t\t\t\ts = lookaheadMatch[3].unDash();\r\n\t\t\t\tv = lookaheadMatch[4];\r\n\t\t\t}\r\n\t\t\tif(s==\"bgcolor\")\r\n\t\t\t\ts = \"backgroundColor\";\r\n\t\t\tif(s==\"float\")\r\n\t\t\t\ts = \"cssFloat\";\r\n\t\t\tstyles.push({style: s, value: v});\r\n\t\t\tw.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;\r\n\t\t\tconfig.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;\r\n\t\t\tlookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);\r\n\t\t}\r\n\t\treturn styles;\r\n\t},\r\n\r\n\tapplyCssHelper: function(e,styles)\r\n\t{\r\n\t\tvar t;\r\n\t\tfor(t=0; t< styles.length; t++) {\r\n\t\t\ttry {\r\n\t\t\t\te.style[styles[t].style] = styles[t].value;\r\n\t\t\t} catch (ex) {\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tenclosedTextHelper: function(w)\r\n\t{\r\n\t\tthis.lookaheadRegExp.lastIndex = w.matchStart;\r\n\t\tvar lookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\tif(lookaheadMatch && lookaheadMatch.index == w.matchStart) {\r\n\t\t\tvar text = lookaheadMatch[1];\r\n\t\t\tif(config.browser.isIE && (config.browser.ieVersion[1] < 10))\r\n\t\t\t\ttext = text.replace(/\\n/g,\"\\r\");\r\n\t\t\tcreateTiddlyElement(w.output,this.element,null,null,text);\r\n\t\t\tw.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;\r\n\t\t}\r\n\t},\r\n\r\n\tisExternalLink: function(link)\r\n\t{\r\n\t\tif(store.tiddlerExists(link) || store.isShadowTiddler(link)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar urlRegExp = new RegExp(config.textPrimitives.urlPattern,\"mg\");\r\n\t\tif(urlRegExp.exec(link)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif(link.indexOf(\".\")!=-1 || link.indexOf(\"\\\\\")!=-1 || link.indexOf(\"/\")!=-1 || link.indexOf(\"#\")!=-1) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n};\r\n\r\n//--\r\n//-- Standard formatters\r\n//--\r\n\r\nconfig.formatters = [\r\n{\r\n\tname: \"table\",\r\n\tmatch: \"^\\\\|(?:[^\\\\n]*)\\\\|(?:[fhck]?)$\",\r\n\tlookaheadRegExp: /^\\|([^\\n]*)\\|([fhck]?)$/mg,\r\n\trowTermRegExp: /(\\|(?:[fhck]?)$\\n?)/mg,\r\n\tcellRegExp: /(?:\\|([^\\n\\|]*)\\|)|(\\|[fhck]?$\\n?)/mg,\r\n\tcellTermRegExp: /((?:\\x20*)\\|)/mg,\r\n\trowTypes: {\"c\":\"caption\", \"h\":\"thead\", \"\":\"tbody\", \"f\":\"tfoot\"},\r\n\thandler: function(w)\r\n\t{\r\n\t\tvar table = createTiddlyElement(w.output,\"table\",null,\"twtable\");\r\n\t\tvar prevColumns = [];\r\n\t\tvar currRowType = null;\r\n\t\tvar rowContainer;\r\n\t\tvar rowCount = 0;\r\n\t\tvar onmouseover = function() {jQuery(this).addClass(\"hoverRow\");};\r\n\t\tvar onmouseout = function() {jQuery(this).removeClass(\"hoverRow\");};\r\n\t\tw.nextMatch = w.matchStart;\r\n\t\tthis.lookaheadRegExp.lastIndex = w.nextMatch;\r\n\t\tvar lookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\twhile(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {\r\n\t\t\tvar nextRowType = lookaheadMatch[2];\r\n\t\t\tif(nextRowType == \"k\") {\r\n\t\t\t\ttable.className = lookaheadMatch[1];\r\n\t\t\t\tw.nextMatch += lookaheadMatch[0].length+1;\r\n\t\t\t} else {\r\n\t\t\t\tif(nextRowType != currRowType) {\r\n\t\t\t\t\trowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);\r\n\t\t\t\t\tcurrRowType = nextRowType;\r\n\t\t\t\t}\r\n\t\t\t\tif(currRowType == \"c\") {\r\n\t\t\t\t\t// Caption\r\n\t\t\t\t\tw.nextMatch++;\r\n\t\t\t\t\tif(rowContainer != table.firstChild)\r\n\t\t\t\t\t\ttable.insertBefore(rowContainer,table.firstChild);\r\n\t\t\t\t\trowContainer.setAttribute(\"align\",rowCount == 0?\"top\":\"bottom\");\r\n\t\t\t\t\tw.subWikifyTerm(rowContainer,this.rowTermRegExp);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar theRow = createTiddlyElement(rowContainer,\"tr\",null,rowCount%2?\"oddRow\":\"evenRow\");\r\n\t\t\t\t\ttheRow.onmouseover = onmouseover;\r\n\t\t\t\t\ttheRow.onmouseout = onmouseout;\r\n\t\t\t\t\tthis.rowHandler(w,theRow,prevColumns);\r\n\t\t\t\t\trowCount++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.lookaheadRegExp.lastIndex = w.nextMatch;\r\n\t\t\tlookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\t}\r\n\t},\r\n\trowHandler: function(w,e,prevColumns)\r\n\t{\r\n\t\tvar col = 0;\r\n\t\tvar colSpanCount = 1;\r\n\t\tvar prevCell = null;\r\n\t\tthis.cellRegExp.lastIndex = w.nextMatch;\r\n\t\tvar cellMatch = this.cellRegExp.exec(w.source);\r\n\t\twhile(cellMatch && cellMatch.index == w.nextMatch) {\r\n\t\t\tif(cellMatch[1] == \"~\") {\r\n\t\t\t\t// Rowspan\r\n\t\t\t\tvar last = prevColumns[col];\r\n\t\t\t\tif(last) {\r\n\t\t\t\t\tlast.rowSpanCount++;\r\n\t\t\t\t\tlast.element.setAttribute(\"rowspan\",last.rowSpanCount);\r\n\t\t\t\t\tlast.element.setAttribute(\"rowSpan\",last.rowSpanCount); // Needed for IE\r\n\t\t\t\t\tlast.element.valign = \"center\";\r\n\t\t\t\t\tif(colSpanCount > 1) {\r\n\t\t\t\t\t\tlast.element.setAttribute(\"colspan\",colSpanCount);\r\n\t\t\t\t\t\tlast.element.setAttribute(\"colSpan\",colSpanCount); // Needed for IE\r\n\t\t\t\t\t\tcolSpanCount = 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tw.nextMatch = this.cellRegExp.lastIndex-1;\r\n\t\t\t} else if(cellMatch[1] == \">\") {\r\n\t\t\t\t// Colspan\r\n\t\t\t\tcolSpanCount++;\r\n\t\t\t\tw.nextMatch = this.cellRegExp.lastIndex-1;\r\n\t\t\t} else if(cellMatch[2]) {\r\n\t\t\t\t// End of row\r\n\t\t\t\tif(prevCell && colSpanCount > 1) {\r\n\t\t\t\t\tprevCell.setAttribute(\"colspan\",colSpanCount);\r\n\t\t\t\t\tprevCell.setAttribute(\"colSpan\",colSpanCount); // Needed for IE\r\n\t\t\t\t}\r\n\t\t\t\tw.nextMatch = this.cellRegExp.lastIndex;\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\t// Cell\r\n\t\t\t\tw.nextMatch++;\r\n\t\t\t\tvar styles = config.formatterHelpers.inlineCssHelper(w);\r\n\t\t\t\tvar spaceLeft = false;\r\n\t\t\t\tvar chr = w.source.substr(w.nextMatch,1);\r\n\t\t\t\twhile(chr == \" \") {\r\n\t\t\t\t\tspaceLeft = true;\r\n\t\t\t\t\tw.nextMatch++;\r\n\t\t\t\t\tchr = w.source.substr(w.nextMatch,1);\r\n\t\t\t\t}\r\n\t\t\t\tvar cell;\r\n\t\t\t\tif(chr == \"!\") {\r\n\t\t\t\t\tcell = createTiddlyElement(e,\"th\");\r\n\t\t\t\t\tw.nextMatch++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcell = createTiddlyElement(e,\"td\");\r\n\t\t\t\t}\r\n\t\t\t\tprevCell = cell;\r\n\t\t\t\tprevColumns[col] = {rowSpanCount:1,element:cell};\r\n\t\t\t\tif(colSpanCount > 1) {\r\n\t\t\t\t\tcell.setAttribute(\"colspan\",colSpanCount);\r\n\t\t\t\t\tcell.setAttribute(\"colSpan\",colSpanCount); // Needed for IE\r\n\t\t\t\t\tcolSpanCount = 1;\r\n\t\t\t\t}\r\n\t\t\t\tconfig.formatterHelpers.applyCssHelper(cell,styles);\r\n\t\t\t\tw.subWikifyTerm(cell,this.cellTermRegExp);\r\n\t\t\t\tif(w.matchText.substr(w.matchText.length-2,1) == \" \") // spaceRight\r\n\t\t\t\t\tcell.align = spaceLeft ? \"center\" : \"left\";\r\n\t\t\t\telse if(spaceLeft)\r\n\t\t\t\t\tcell.align = \"right\";\r\n\t\t\t\tw.nextMatch--;\r\n\t\t\t}\r\n\t\t\tcol++;\r\n\t\t\tthis.cellRegExp.lastIndex = w.nextMatch;\r\n\t\t\tcellMatch = this.cellRegExp.exec(w.source);\r\n\t\t}\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"heading\",\r\n\tmatch: \"^!{1,6}\",\r\n\ttermRegExp: /(\\n)/mg,\r\n\thandler: function(w)\r\n\t{\r\n\t\tw.subWikifyTerm(createTiddlyElement(w.output,\"h\" + w.matchLength),this.termRegExp);\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"list\",\r\n\tmatch: \"^(?:[\\\\*#;:]+)\",\r\n\tlookaheadRegExp: /^(?:(?:(\\*)|(#)|(;)|(:))+)/mg,\r\n\ttermRegExp: /(\\n)/mg,\r\n\thandler: function(w)\r\n\t{\r\n\t\tvar stack = [w.output];\r\n\t\tvar currLevel = 0, currType = null;\r\n\t\tvar listLevel, listType, itemType, baseType;\r\n\t\tw.nextMatch = w.matchStart;\r\n\t\tthis.lookaheadRegExp.lastIndex = w.nextMatch;\r\n\t\tvar lookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\twhile(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {\r\n\t\t\tif(lookaheadMatch[1]) {\r\n\t\t\t\tlistType = \"ul\";\r\n\t\t\t\titemType = \"li\";\r\n\t\t\t} else if(lookaheadMatch[2]) {\r\n\t\t\t\tlistType = \"ol\";\r\n\t\t\t\titemType = \"li\";\r\n\t\t\t} else if(lookaheadMatch[3]) {\r\n\t\t\t\tlistType = \"dl\";\r\n\t\t\t\titemType = \"dt\";\r\n\t\t\t} else if(lookaheadMatch[4]) {\r\n\t\t\t\tlistType = \"dl\";\r\n\t\t\t\titemType = \"dd\";\r\n\t\t\t}\r\n\t\t\tif(!baseType)\r\n\t\t\t\tbaseType = listType;\r\n\t\t\tlistLevel = lookaheadMatch[0].length;\r\n\t\t\tw.nextMatch += lookaheadMatch[0].length;\r\n\t\t\tvar t;\r\n\t\t\tif(listLevel > currLevel) {\r\n\t\t\t\tfor(t=currLevel; t<listLevel; t++) {\r\n\t\t\t\t\tvar target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;\r\n\t\t\t\t\tstack.push(createTiddlyElement(target,listType));\r\n\t\t\t\t}\r\n\t\t\t} else if(listType!=baseType && listLevel==1) {\r\n\t\t\t\tw.nextMatch -= lookaheadMatch[0].length;\r\n\t\t\t\treturn;\r\n\t\t\t} else if(listLevel < currLevel) {\r\n\t\t\t\tfor(t=currLevel; t>listLevel; t--)\r\n\t\t\t\t\tstack.pop();\r\n\t\t\t} else if(listLevel == currLevel && listType != currType) {\r\n\t\t\t\tstack.pop();\r\n\t\t\t\tstack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));\r\n\t\t\t}\r\n\t\t\tcurrLevel = listLevel;\r\n\t\t\tcurrType = listType;\r\n\t\t\tvar e = createTiddlyElement(stack[stack.length-1],itemType);\r\n\t\t\tw.subWikifyTerm(e,this.termRegExp);\r\n\t\t\tthis.lookaheadRegExp.lastIndex = w.nextMatch;\r\n\t\t\tlookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\t}\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"quoteByBlock\",\r\n\tmatch: \"^<<<\\\\n\",\r\n\ttermRegExp: /(^<<<(\\n|$))/mg,\r\n\telement: \"blockquote\",\r\n\thandler: config.formatterHelpers.createElementAndWikify\r\n},\r\n\r\n{\r\n\tname: \"quoteByLine\",\r\n\tmatch: \"^>+\",\r\n\tlookaheadRegExp: /^>+/mg,\r\n\ttermRegExp: /(\\n)/mg,\r\n\telement: \"blockquote\",\r\n\thandler: function(w)\r\n\t{\r\n\t\tvar stack = [w.output];\r\n\t\tvar currLevel = 0;\r\n\t\tvar newLevel = w.matchLength;\r\n\t\tvar t,matched;\r\n\t\tdo {\r\n\t\t\tif(newLevel > currLevel) {\r\n\t\t\t\tfor(t=currLevel; t<newLevel; t++)\r\n\t\t\t\t\tstack.push(createTiddlyElement(stack[stack.length-1],this.element));\r\n\t\t\t} else if(newLevel < currLevel) {\r\n\t\t\t\tfor(t=currLevel; t>newLevel; t--)\r\n\t\t\t\t\tstack.pop();\r\n\t\t\t}\r\n\t\t\tcurrLevel = newLevel;\r\n\t\t\tw.subWikifyTerm(stack[stack.length-1],this.termRegExp);\r\n\t\t\tcreateTiddlyElement(stack[stack.length-1],\"br\");\r\n\t\t\tthis.lookaheadRegExp.lastIndex = w.nextMatch;\r\n\t\t\tvar lookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\t\tmatched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;\r\n\t\t\tif(matched) {\r\n\t\t\t\tnewLevel = lookaheadMatch[0].length;\r\n\t\t\t\tw.nextMatch += lookaheadMatch[0].length;\r\n\t\t\t}\r\n\t\t} while(matched);\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"rule\",\r\n\tmatch: \"^----+$\\\\n?|<hr ?/?>\\\\n?\",\r\n\thandler: function(w)\r\n\t{\r\n\t\tcreateTiddlyElement(w.output,\"hr\");\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"monospacedByLine\",\r\n\tmatch: \"^(?:/\\\\*\\\\{\\\\{\\\\{\\\\*/|\\\\{\\\\{\\\\{|//\\\\{\\\\{\\\\{|<!--\\\\{\\\\{\\\\{-->)\\\\n\",\r\n\telement: \"pre\",\r\n\thandler: function(w)\r\n\t{\r\n\t\tswitch(w.matchText) {\r\n\t\tcase \"/*{{{*/\\n\": // CSS\r\n\t\t\tthis.lookaheadRegExp = /\\/\\*\\{\\{\\{\\*\\/\\n*((?:^[^\\n]*\\n)+?)(\\n*^\\f*\\/\\*\\}\\}\\}\\*\\/$\\n?)/mg;\r\n\t\t\tbreak;\r\n\t\tcase \"{{{\\n\": // monospaced block\r\n\t\t\tthis.lookaheadRegExp = /^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\f*\\}\\}\\}$\\n?)/mg;\r\n\t\t\tbreak;\r\n\t\tcase \"//{{{\\n\": // plugin\r\n\t\t\tthis.lookaheadRegExp = /^\\/\\/\\{\\{\\{\\n\\n*((?:^[^\\n]*\\n)+?)(\\n*^\\f*\\/\\/\\}\\}\\}$\\n?)/mg;\r\n\t\t\tbreak;\r\n\t\tcase \"<!--{{{-->\\n\": //template\r\n\t\t\tthis.lookaheadRegExp = /<!--\\{\\{\\{-->\\n*((?:^[^\\n]*\\n)+?)(\\n*^\\f*<!--\\}\\}\\}-->$\\n?)/mg;\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tconfig.formatterHelpers.enclosedTextHelper.call(this,w);\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"wikifyComment\",\r\n\tmatch: \"^(?:/\\\\*\\\\*\\\\*|<!---)\\\\n\",\r\n\thandler: function(w)\r\n\t{\r\n\t\tvar termRegExp = (w.matchText == \"/***\\n\") ? (/(^\\*\\*\\*\\/\\n)/mg) : (/(^--->\\n)/mg);\r\n\t\tw.subWikifyTerm(w.output,termRegExp);\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"macro\",\r\n\tmatch: \"<<\",\r\n\tlookaheadRegExp: /<<([^>\\s]+)(?:\\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,\r\n\thandler: function(w)\r\n\t{\r\n\t\tthis.lookaheadRegExp.lastIndex = w.matchStart;\r\n\t\tvar lookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\tif(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {\r\n\t\t\tw.nextMatch = this.lookaheadRegExp.lastIndex;\r\n\t\t\tinvokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);\r\n\t\t}\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"prettyLink\",\r\n\tmatch: \"\\\\[\\\\[\",\r\n\tlookaheadRegExp: /\\[\\[(.*?)(?:\\|(~)?(.*?))?\\]\\]/mg,\r\n\thandler: function(w)\r\n\t{\r\n\t\tthis.lookaheadRegExp.lastIndex = w.matchStart;\r\n\t\tvar lookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\tif(lookaheadMatch && lookaheadMatch.index == w.matchStart) {\r\n\t\t\tvar e;\r\n\t\t\tvar text = lookaheadMatch[1];\r\n\t\t\tif(lookaheadMatch[3]) {\r\n\t\t\t\t// Pretty bracketted link\r\n\t\t\t\tvar link = lookaheadMatch[3];\r\n\t\t\t\te = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link)) ?\r\n\t\t\t\t\t\tcreateExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);\r\n\t\t\t} else {\r\n\t\t\t\t// Simple bracketted link\r\n\t\t\t\te = createTiddlyLink(w.output,text,false,null,w.isStatic,w.tiddler);\r\n\t\t\t}\r\n\t\t\tcreateTiddlyText(e,text);\r\n\t\t\tw.nextMatch = this.lookaheadRegExp.lastIndex;\r\n\t\t}\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"wikiLink\",\r\n\tmatch: config.textPrimitives.unWikiLink+\"?\"+config.textPrimitives.wikiLink,\r\n\thandler: function(w)\r\n\t{\r\n\t\tif(w.matchText.substr(0,1) == config.textPrimitives.unWikiLink) {\r\n\t\t\tw.outputText(w.output,w.matchStart+1,w.nextMatch);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(w.matchStart > 0) {\r\n\t\t\tvar preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,\"mg\");\r\n\t\t\tpreRegExp.lastIndex = w.matchStart-1;\r\n\t\t\tvar preMatch = preRegExp.exec(w.source);\r\n\t\t\tif(preMatch.index == w.matchStart-1) {\r\n\t\t\t\tw.outputText(w.output,w.matchStart,w.nextMatch);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(w.autoLinkWikiWords || store.isShadowTiddler(w.matchText)) {\r\n\t\t\tvar link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);\r\n\t\t\tw.outputText(link,w.matchStart,w.nextMatch);\r\n\t\t} else {\r\n\t\t\tw.outputText(w.output,w.matchStart,w.nextMatch);\r\n\t\t}\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"urlLink\",\r\n\tmatch: config.textPrimitives.urlPattern,\r\n\thandler: function(w)\r\n\t{\r\n\t\tw.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"image\",\r\n\tmatch: \"\\\\[[<>]?[Ii][Mm][Gg]\\\\[\",\r\n\tlookaheadRegExp: /\\[([<]?)(>?)[Ii][Mm][Gg]\\[(?:([^\\|\\]]+)\\|)?([^\\[\\]\\|]+)\\](?:\\[([^\\]]*)\\])?\\]/mg,\r\n\thandler: function(w)\r\n\t{\r\n\t\tthis.lookaheadRegExp.lastIndex = w.matchStart;\r\n\t\tvar lookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\tif(lookaheadMatch && lookaheadMatch.index == w.matchStart) {\r\n\t\t\tvar e = w.output;\r\n\t\t\tif(lookaheadMatch[5]) {\r\n\t\t\t\tvar link = lookaheadMatch[5];\r\n\t\t\t\te = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);\r\n\t\t\t\tjQuery(e).addClass(\"imageLink\");\r\n\t\t\t}\r\n\t\t\tvar img = createTiddlyElement(e,\"img\");\r\n\t\t\tif(lookaheadMatch[1])\r\n\t\t\t\timg.align = \"left\";\r\n\t\t\telse if(lookaheadMatch[2])\r\n\t\t\t\timg.align = \"right\";\r\n\t\t\tif(lookaheadMatch[3]) {\r\n\t\t\t\timg.title = lookaheadMatch[3];\r\n\t\t\t\timg.setAttribute(\"alt\",lookaheadMatch[3]);\r\n\t\t\t}\r\n\t\t\timg.src = lookaheadMatch[4];\r\n\t\t\tw.nextMatch = this.lookaheadRegExp.lastIndex;\r\n\t\t}\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"html\",\r\n\tmatch: \"<[Hh][Tt][Mm][Ll]>\",\r\n\tlookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\\n)*?)<\\/[Hh][Tt][Mm][Ll]>/mg,\r\n\thandler: function(w)\r\n\t{\r\n\t\tthis.lookaheadRegExp.lastIndex = w.matchStart;\r\n\t\tvar lookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\tif(lookaheadMatch && lookaheadMatch.index == w.matchStart) {\r\n\t\t\tcreateTiddlyElement(w.output,\"span\").innerHTML = lookaheadMatch[1];\r\n\t\t\tw.nextMatch = this.lookaheadRegExp.lastIndex;\r\n\t\t}\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"commentByBlock\",\r\n\tmatch: \"/%\",\r\n\tlookaheadRegExp: /\\/%((?:.|\\n)*?)%\\//mg,\r\n\thandler: function(w)\r\n\t{\r\n\t\tthis.lookaheadRegExp.lastIndex = w.matchStart;\r\n\t\tvar lookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\tif(lookaheadMatch && lookaheadMatch.index == w.matchStart)\r\n\t\t\tw.nextMatch = this.lookaheadRegExp.lastIndex;\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"characterFormat\",\r\n\tmatch: \"''|//|__|\\\\^\\\\^|~~|--(?!\\\\s|$)|\\\\{\\\\{\\\\{\",\r\n\thandler: function(w)\r\n\t{\r\n\t\tswitch(w.matchText) {\r\n\t\tcase \"''\":\r\n\t\t\tw.subWikifyTerm(w.output.appendChild(document.createElement(\"strong\")),/('')/mg);\r\n\t\t\tbreak;\r\n\t\tcase \"//\":\r\n\t\t\tw.subWikifyTerm(createTiddlyElement(w.output,\"em\"),/(\\/\\/)/mg);\r\n\t\t\tbreak;\r\n\t\tcase \"__\":\r\n\t\t\tw.subWikifyTerm(createTiddlyElement(w.output,\"u\"),/(__)/mg);\r\n\t\t\tbreak;\r\n\t\tcase \"^^\":\r\n\t\t\tw.subWikifyTerm(createTiddlyElement(w.output,\"sup\"),/(\\^\\^)/mg);\r\n\t\t\tbreak;\r\n\t\tcase \"~~\":\r\n\t\t\tw.subWikifyTerm(createTiddlyElement(w.output,\"sub\"),/(~~)/mg);\r\n\t\t\tbreak;\r\n\t\tcase \"--\":\r\n\t\t\tw.subWikifyTerm(createTiddlyElement(w.output,\"strike\"),/(--)/mg);\r\n\t\t\tbreak;\r\n\t\tcase \"{{{\":\r\n\t\t\tvar lookaheadRegExp = /\\{\\{\\{((?:.|\\n)*?)\\}\\}\\}/mg;\r\n\t\t\tlookaheadRegExp.lastIndex = w.matchStart;\r\n\t\t\tvar lookaheadMatch = lookaheadRegExp.exec(w.source);\r\n\t\t\tif(lookaheadMatch && lookaheadMatch.index == w.matchStart) {\r\n\t\t\t\tcreateTiddlyElement(w.output,\"code\",null,null,lookaheadMatch[1]);\r\n\t\t\t\tw.nextMatch = lookaheadRegExp.lastIndex;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"customFormat\",\r\n\tmatch: \"@@|\\\\{\\\\{\",\r\n\thandler: function(w)\r\n\t{\r\n\t\tswitch(w.matchText) {\r\n\t\tcase \"@@\":\r\n\t\t\tvar e = createTiddlyElement(w.output,\"span\");\r\n\t\t\tvar styles = config.formatterHelpers.inlineCssHelper(w);\r\n\t\t\tif(styles.length == 0)\r\n\t\t\t\te.className = \"marked\";\r\n\t\t\telse\r\n\t\t\t\tconfig.formatterHelpers.applyCssHelper(e,styles);\r\n\t\t\tw.subWikifyTerm(e,/(@@)/mg);\r\n\t\t\tbreak;\r\n\t\tcase \"{{\":\r\n\t\t\tvar lookaheadRegExp = /\\{\\{[\\s]*([\\w]+[\\s\\w]*)[\\s]*\\{(\\n?)/mg;\r\n\t\t\tlookaheadRegExp.lastIndex = w.matchStart;\r\n\t\t\tvar lookaheadMatch = lookaheadRegExp.exec(w.source);\r\n\t\t\tif(lookaheadMatch) {\r\n\t\t\t\tw.nextMatch = lookaheadRegExp.lastIndex;\r\n\t\t\t\te = createTiddlyElement(w.output,lookaheadMatch[2] == \"\\n\" ? \"div\" : \"span\",null,lookaheadMatch[1]);\r\n\t\t\t\tw.subWikifyTerm(e,/(\\}\\}\\})/mg);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"mdash\",\r\n\tmatch: \"--\",\r\n\thandler: function(w)\r\n\t{\r\n\t\tcreateTiddlyElement(w.output,\"span\").innerHTML = \"&mdash;\";\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"lineBreak\",\r\n\tmatch: \"\\\\n|<br ?/?>\",\r\n\thandler: function(w)\r\n\t{\r\n\t\tcreateTiddlyElement(w.output,\"br\");\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"rawText\",\r\n\tmatch: \"\\\"{3}|<nowiki>\",\r\n\tlookaheadRegExp: /(?:\\\"{3}|<nowiki>)((?:.|\\n)*?)(?:\\\"{3}|<\\/nowiki>)/mg,\r\n\thandler: function(w)\r\n\t{\r\n\t\tthis.lookaheadRegExp.lastIndex = w.matchStart;\r\n\t\tvar lookaheadMatch = this.lookaheadRegExp.exec(w.source);\r\n\t\tif(lookaheadMatch && lookaheadMatch.index == w.matchStart) {\r\n\t\t\tcreateTiddlyElement(w.output,\"span\",null,null,lookaheadMatch[1]);\r\n\t\t\tw.nextMatch = this.lookaheadRegExp.lastIndex;\r\n\t\t}\r\n\t}\r\n},\r\n\r\n{\r\n\tname: \"htmlEntitiesEncoding\",\r\n\tmatch: \"(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)\",\r\n\thandler: function(w)\r\n\t{\r\n\t\tcreateTiddlyElement(w.output,\"span\").innerHTML = w.matchText;\r\n\t}\r\n}\r\n\r\n];\r\n\r\n//--\r\n//-- Wikifier\r\n//--\r\n\r\nfunction getParser(tiddler,format)\r\n{\r\n\tif(tiddler) {\r\n\t\tif(!format)\r\n\t\t\tformat = tiddler.fields[\"wikiformat\"];\r\n\t\tvar i;\r\n\t\tif(format) {\r\n\t\t\tfor(i in config.parsers) {\r\n\t\t\t\tif(format == config.parsers[i].format)\r\n\t\t\t\t\treturn config.parsers[i];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor(i in config.parsers) {\r\n\t\t\t\tif(tiddler.isTagged(config.parsers[i].formatTag))\r\n\t\t\t\t\treturn config.parsers[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn formatter;\r\n}\r\n\r\nfunction Wikifier(source,formatter,highlightRegExp,tiddler)\r\n{\r\n\tthis.source = source;\r\n\tthis.output = null;\r\n\tthis.formatter = formatter;\r\n\tthis.nextMatch = 0;\r\n\tthis.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;\r\n\tthis.highlightRegExp = highlightRegExp;\r\n\tthis.highlightMatch = null;\r\n\tthis.isStatic = false;\r\n\tif(highlightRegExp) {\r\n\t\thighlightRegExp.lastIndex = 0;\r\n\t\tthis.highlightMatch = highlightRegExp.exec(source);\r\n\t}\r\n\tthis.tiddler = tiddler;\r\n}\r\n\r\nWikifier.prototype.wikifyPlain = function()\r\n{\r\n\tvar e = createTiddlyElement(document.body,\"div\");\r\n\te.style.display = \"none\";\r\n\tthis.subWikify(e);\r\n\tvar text = jQuery(e).text();\r\n\tjQuery(e).remove();\r\n\treturn text;\r\n};\r\n\r\nWikifier.prototype.subWikify = function(output,terminator)\r\n{\r\n\ttry {\r\n\t\tif(terminator)\r\n\t\t\tthis.subWikifyTerm(output,new RegExp(\"(\" + terminator + \")\",\"mg\"));\r\n\t\telse\r\n\t\t\tthis.subWikifyUnterm(output);\r\n\t} catch(ex) {\r\n\t\tshowException(ex);\r\n\t}\r\n};\r\n\r\nWikifier.prototype.subWikifyUnterm = function(output)\r\n{\r\n\tvar oldOutput = this.output;\r\n\tthis.output = output;\r\n\tthis.formatter.formatterRegExp.lastIndex = this.nextMatch;\r\n\tvar formatterMatch = this.formatter.formatterRegExp.exec(this.source);\r\n\twhile(formatterMatch) {\r\n\t\t// Output any text before the match\r\n\t\tif(formatterMatch.index > this.nextMatch)\r\n\t\t\tthis.outputText(this.output,this.nextMatch,formatterMatch.index);\r\n\t\t// Set the match parameters for the handler\r\n\t\tthis.matchStart = formatterMatch.index;\r\n\t\tthis.matchLength = formatterMatch[0].length;\r\n\t\tthis.matchText = formatterMatch[0];\r\n\t\tthis.nextMatch = this.formatter.formatterRegExp.lastIndex;\r\n\t\tvar t;\r\n\t\tfor(t=1; t<formatterMatch.length; t++) {\r\n\t\t\tif(formatterMatch[t]) {\r\n\t\t\t\tthis.formatter.formatters[t-1].handler(this);\r\n\t\t\t\tthis.formatter.formatterRegExp.lastIndex = this.nextMatch;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tformatterMatch = this.formatter.formatterRegExp.exec(this.source);\r\n\t}\r\n\tif(this.nextMatch < this.source.length) {\r\n\t\tthis.outputText(this.output,this.nextMatch,this.source.length);\r\n\t\tthis.nextMatch = this.source.length;\r\n\t}\r\n\tthis.output = oldOutput;\r\n};\r\n\r\nWikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)\r\n{\r\n\tvar oldOutput = this.output;\r\n\tthis.output = output;\r\n\tterminatorRegExp.lastIndex = this.nextMatch;\r\n\tvar terminatorMatch = terminatorRegExp.exec(this.source);\r\n\tthis.formatter.formatterRegExp.lastIndex = this.nextMatch;\r\n\tvar formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);\r\n\twhile(terminatorMatch || formatterMatch) {\r\n\t\tif(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {\r\n\t\t\tif(terminatorMatch.index > this.nextMatch)\r\n\t\t\t\tthis.outputText(this.output,this.nextMatch,terminatorMatch.index);\r\n\t\t\tthis.matchText = terminatorMatch[1];\r\n\t\t\tthis.matchLength = terminatorMatch[1].length;\r\n\t\t\tthis.matchStart = terminatorMatch.index;\r\n\t\t\tthis.nextMatch = this.matchStart + this.matchLength;\r\n\t\t\tthis.output = oldOutput;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(formatterMatch.index > this.nextMatch)\r\n\t\t\tthis.outputText(this.output,this.nextMatch,formatterMatch.index);\r\n\t\tthis.matchStart = formatterMatch.index;\r\n\t\tthis.matchLength = formatterMatch[0].length;\r\n\t\tthis.matchText = formatterMatch[0];\r\n\t\tthis.nextMatch = this.formatter.formatterRegExp.lastIndex;\r\n\t\tvar t;\r\n\t\tfor(t=1; t<formatterMatch.length; t++) {\r\n\t\t\tif(formatterMatch[t]) {\r\n\t\t\t\tthis.formatter.formatters[t-1].handler(this);\r\n\t\t\t\tthis.formatter.formatterRegExp.lastIndex = this.nextMatch;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tterminatorRegExp.lastIndex = this.nextMatch;\r\n\t\tterminatorMatch = terminatorRegExp.exec(this.source);\r\n\t\tformatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);\r\n\t}\r\n\tif(this.nextMatch < this.source.length) {\r\n\t\tthis.outputText(this.output,this.nextMatch,this.source.length);\r\n\t\tthis.nextMatch = this.source.length;\r\n\t}\r\n\tthis.output = oldOutput;\r\n};\r\n\r\nWikifier.prototype.outputText = function(place,startPos,endPos)\r\n{\r\n\twhile(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {\r\n\t\tif(this.highlightMatch.index > startPos) {\r\n\t\t\tcreateTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));\r\n\t\t\tstartPos = this.highlightMatch.index;\r\n\t\t}\r\n\t\tvar highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);\r\n\t\tcreateTiddlyElement(place,\"span\",null,\"highlight\",this.source.substring(startPos,highlightEnd));\r\n\t\tstartPos = highlightEnd;\r\n\t\tif(startPos >= this.highlightRegExp.lastIndex)\r\n\t\t\tthis.highlightMatch = this.highlightRegExp.exec(this.source);\r\n\t}\r\n\tif(startPos < endPos) {\r\n\t\tcreateTiddlyText(place,this.source.substring(startPos,endPos));\r\n\t}\r\n};\r\n\r\nfunction wikify(source,output,highlightRegExp,tiddler)\r\n{\r\n\tif(source) {\r\n\t\tvar wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);\r\n\t\tvar t0 = new Date();\r\n\t\twikifier.subWikify(output);\r\n\t\tif(tiddler && config.options.chkDisplayInstrumentation)\r\n\t\t\tdisplayMessage(\"wikify:\" +tiddler.title+ \" in \" + (new Date()-t0) + \" ms\");\r\n\t}\r\n}\r\n\r\nfunction wikifyStatic(source,highlightRegExp,tiddler,format)\r\n{\r\n\tvar e = createTiddlyElement(document.body,\"pre\");\r\n\te.style.display = \"none\";\r\n\tvar html = \"\";\r\n\tif(source && source != \"\") {\r\n\t\tif(!tiddler)\r\n\t\t\ttiddler = new Tiddler(\"temp\");\r\n\t\tvar wikifier = new Wikifier(source,getParser(tiddler,format),highlightRegExp,tiddler);\r\n\t\twikifier.isStatic = true;\r\n\t\twikifier.subWikify(e);\r\n\t\thtml = e.innerHTML;\r\n\t\tjQuery(e).remove();\r\n\t}\r\n\treturn html;\r\n}\r\n\r\nfunction wikifyPlainText(text,limit,tiddler)\r\n{\r\n\tif(limit > 0)\r\n\t\ttext = text.substr(0,limit);\r\n\tvar wikifier = new Wikifier(text,formatter,null,tiddler);\r\n\treturn wikifier.wikifyPlain();\r\n}\r\n\r\nfunction highlightify(source,output,highlightRegExp,tiddler)\r\n{\r\n\tif(source) {\r\n\t\tvar wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);\r\n\t\twikifier.outputText(output,0,source.length);\r\n\t}\r\n}\r\n\r\n//--\r\n//-- Macro definitions\r\n//--\r\n\r\nfunction invokeMacro(place,macro,params,wikifier,tiddler)\r\n{\r\n\ttry {\r\n\t\tvar m = config.macros[macro];\r\n\t\tif(m && m.handler) {\r\n\t\t\tvar tiddlerElem = story.findContainingTiddler(place);\r\n\t\t\twindow.tiddler = tiddlerElem ? store.getTiddler(tiddlerElem.getAttribute(\"tiddler\")) : null;\r\n\t\t\twindow.place = place;\r\n\t\t\tvar allowEval = true;\r\n\t\t\tif(config.evaluateMacroParameters==\"system\") {\r\n\t\t\t\tif(!tiddler || tiddler.tags.indexOf(\"systemAllowEval\") == -1) {\r\n\t\t\t\t\tallowEval = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tm.handler(place,macro,m.noPreParse?null:params.readMacroParams(!allowEval),wikifier,params,tiddler);\r\n\t\t} else {\r\n\t\t\tcreateTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));\r\n\t\t}\r\n\t} catch(ex) {\r\n\t\tcreateTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));\r\n\t}\r\n}\r\n\r\nconfig.macros.version.handler = function(place)\r\n{\r\n\tjQuery(\"<span/>\").text(formatVersion()).appendTo(place);\r\n};\r\n\r\nconfig.macros.today.handler = function(place,macroName,params)\r\n{\r\n\tvar now = new Date();\r\n\tvar text = params[0] ? now.formatString(params[0].trim()) : now.toLocaleString();\r\n\tjQuery(\"<span/>\").text(text).appendTo(place);\r\n};\r\n\r\nconfig.macros.list.template = \"<<view title link>>\";\r\nconfig.macros.list.handler = function(place,macroName,params,wikifier,paramString)\r\n{\r\n\tvar list = document.createElement(\"ul\");\r\n\tjQuery(list).attr({ refresh: \"macro\", macroName: macroName }).data(\"params\", paramString);\r\n\tplace.appendChild(list);\r\n\tthis.refresh(list);\r\n};\r\n\r\nconfig.macros.list.refresh = function(list) {\r\n\tvar paramString = jQuery(list).data(\"params\");\r\n\tvar params = paramString.readMacroParams();\r\n\tvar args = paramString.parseParams(\"anon\", null, null)[0];\r\n\tvar type = args.anon ? args.anon[0] : \"all\";\r\n\tjQuery(list).empty().addClass(\"list list-\" + type);\r\n\tvar template = args.template ? store.getTiddlerText(args.template[0]) : false;\r\n\tif(!template) {\r\n\t\ttemplate = config.macros.list.template;\r\n\t}\r\n\tif(this[type].prompt)\r\n\t\tcreateTiddlyElement(list,\"li\",null,\"listTitle\",this[type].prompt);\r\n\tvar results;\r\n\tif(this[type].handler)\r\n\t\tresults = this[type].handler(params);\r\n\tvar t;\r\n\tfor(t = 0; t < results.length; t++) {\r\n\t\tvar li = document.createElement(\"li\");\r\n\t\tlist.appendChild(li);\r\n\t\tvar tiddler = results[t];\r\n\t\tif(typeof(tiddler) == 'string') { // deal with missing etc..\r\n\t\t\t\ttiddler = store.getTiddler(tiddler) || new Tiddler(tiddler);\r\n\t\t}\r\n\t\twikify(template, li, null, tiddler);\r\n\t}\r\n\tif(results.length === 0 && args.emptyMessage) {\r\n\t\tjQuery(list).addClass(\"emptyList\");\r\n\t\tjQuery(\"<li />\").text(args.emptyMessage[0]).appendTo(list);\r\n\t}\r\n};\r\n\r\nconfig.macros.list.all.handler = function(params)\r\n{\r\n\treturn store.reverseLookup(\"tags\",\"excludeLists\",false,\"title\");\r\n};\r\n\r\nconfig.macros.list.missing.handler = function(params)\r\n{\r\n\treturn store.getMissingLinks();\r\n};\r\n\r\nconfig.macros.list.orphans.handler = function(params)\r\n{\r\n\treturn store.getOrphans();\r\n};\r\n\r\nconfig.macros.list.shadowed.handler = function(params)\r\n{\r\n\treturn store.getShadowed();\r\n};\r\n\r\nconfig.macros.list.touched.handler = function(params)\r\n{\r\n\treturn store.getTouched();\r\n};\r\n\r\nconfig.macros.list.filter.handler = function(params)\r\n{\r\n\tvar filter = params[1];\r\n\tvar results = [];\r\n\tif(filter) {\r\n\t\tvar tiddlers = store.filterTiddlers(filter);\r\n\t\tvar t;\r\n\t\tfor(t=0; t<tiddlers.length; t++)\r\n\t\t\tresults.push(tiddlers[t].title);\r\n\t}\r\n\treturn results;\r\n};\r\n\r\nconfig.macros.allTags.handler = function(place,macroName,params)\r\n{\r\n\tvar tags = store.getTags(params[0]);\r\n\tvar ul = createTiddlyElement(place,\"ul\");\r\n\tif(tags.length == 0)\r\n\t\tcreateTiddlyElement(ul,\"li\",null,\"listTitle\",this.noTags);\r\n\tvar t;\r\n\tfor(t=0; t<tags.length; t++) {\r\n\t\tvar title = tags[t][0];\r\n\t\tvar info = getTiddlyLinkInfo(title);\r\n\t\tvar li = createTiddlyElement(ul,\"li\");\r\n\t\tvar btn = createTiddlyButton(li,title + \" (\" + tags[t][1] + \")\",this.tooltip.format([title]),onClickTag,info.classes);\r\n\t\tbtn.setAttribute(\"tag\",title);\r\n\t\tbtn.setAttribute(\"refresh\",\"link\");\r\n\t\tbtn.setAttribute(\"tiddlyLink\",title);\r\n\t\tif(params[1]) {\r\n\t\t\tbtn.setAttribute(\"sortby\",params[1]);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nvar macro = config.macros.timeline;\r\nmerge(macro, {\r\n\thandler: function(place,macroName,params, wikifier, paramString, tiddler) {\r\n\t\tvar container = jQuery(\"<div />\").attr(\"params\", paramString).\r\n\t\t\tattr(\"macroName\", macroName).appendTo(place)[0];\r\n\t\tmacro.refresh(container);\r\n\t},\r\n\trefresh: function(container) {\r\n\t\tjQuery(container).attr(\"refresh\", \"macro\").empty();\r\n\t\tvar paramString = jQuery(container).attr(\"params\");\r\n\t\tvar args = paramString.parseParams(\"anon\", null, null)[0];\r\n\t\tvar params = args.anon || [];\r\n\r\n\t\tvar field = params[0] || \"modified\";\r\n\t\tvar prefix = field.charAt(0);\r\n\t\tvar no_prefix_field = prefix === \"-\" || prefix === \"+\" ? field.substr(1, field.length) : field;\r\n\t\tvar dateFormat = params[2] || this.dateFormat;\r\n\t\tvar groupTemplate = macro.groupTemplate.format(no_prefix_field, dateFormat);\r\n\t\tgroupTemplate = args.groupTemplate ? store.getTiddlerText(args.groupTemplate[0]) || groupTemplate :\r\n\t\t\tgroupTemplate;\r\n\r\n\t\tvar itemTemplate = macro.itemTemplate;\r\n\t\titemTemplate = args.template ? store.getTiddlerText(args.template[0]) || itemTemplate :\r\n\t\t\titemTemplate;\r\n\r\n\t\tvar tiddlers = args.filter ? store.sortTiddlers(store.filterTiddlers(args.filter[0]), field) :\r\n\t\t\tstore.reverseLookup(\"tags\", \"excludeLists\", false, field);\r\n\t\tvar lastGroup = \"\", ul;\r\n\t\tvar last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1],10)) : 0;\r\n\t\tvar t;\r\n\t\tfor(t=tiddlers.length-1; t>=last; t--) {\r\n\t\t\tvar tiddler = tiddlers[t];\r\n\t\t\tvar theGroup = wikifyPlainText(groupTemplate,0,tiddler);\r\n\t\t\tif(typeof(ul) == \"undefined\" || theGroup != lastGroup) {\r\n\t\t\t\tul = document.createElement(\"ul\");\r\n\t\t\t\tjQuery(ul).addClass(\"timeline\");\r\n\t\t\t\tcontainer.appendChild(ul);\r\n\t\t\t\tcreateTiddlyElement(ul,\"li\",null,\"listTitle\",theGroup);\r\n\t\t\t\tlastGroup = theGroup;\r\n\t\t\t}\r\n\t\t\tvar item = createTiddlyElement(ul,\"li\",null,\"listLink\");\r\n\t\t\twikify(itemTemplate,item,null,tiddler);\r\n\t\t}\r\n\t},\r\n\tgroupTemplate: \"<<view %0 date '%1'>>\", \r\n\titemTemplate: \"<<view title link>>\"\r\n});\r\n\r\nconfig.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)\r\n{\r\n\tvar allowEval = true;\r\n\tvar stack = config.macros.tiddler.tiddlerStack;\r\n\tif(stack.length > 0 && config.evaluateMacroParameters == \"system\") {\r\n\t\t// included tiddler and \"system\" evaluation required, so check tiddler tagged appropriately\r\n\t\tvar title = stack[stack.length-1];\r\n\t\tvar pos = title.indexOf(config.textPrimitives.sectionSeparator);\r\n\t\tif(pos != -1) {\r\n\t\t\ttitle = title.substr(0,pos); // get the base tiddler title\r\n\t\t}\r\n\t\tvar t = store.getTiddler(title);\r\n\t\tif(!t || t.tags.indexOf(\"systemAllowEval\") == -1) {\r\n\t\t\tallowEval = false;\r\n\t\t}\r\n\t}\r\n\tparams = paramString.parseParams(\"name\",null,allowEval,false,true);\r\n\tvar names = params[0][\"name\"];\r\n\tvar tiddlerName = names[0];\r\n\tvar className = names[1] || null;\r\n\tvar args = params[0][\"with\"];\r\n\tvar wrapper = createTiddlyElement(place,\"span\",null,className,null,{\r\n\t\trefresh: \"content\", tiddler: tiddlerName\r\n\t});\r\n\tif(args!==undefined)\r\n\t\twrapper.setAttribute(\"args\",\"[[\"+args.join(\"]] [[\")+\"]]\");\r\n\tthis.transclude(wrapper,tiddlerName,args);\r\n};\r\n\r\nconfig.macros.tiddler.transclude = function(wrapper,tiddlerName,args)\r\n{\r\n\tvar text = store.getTiddlerText(tiddlerName);\r\n\tif(!text)\r\n\t\treturn;\r\n\tvar stack = config.macros.tiddler.tiddlerStack;\r\n\tif(stack.indexOf(tiddlerName) !== -1)\r\n\t\treturn;\r\n\tstack.push(tiddlerName);\r\n\ttry {\r\n\t\tif(typeof args == \"string\")\r\n\t\t\targs = args.readBracketedList();\r\n\t\tvar n = args ? Math.min(args.length,9) : 0;\r\n\t\tvar i;\r\n\t\tfor(i=0; i<n; i++) {\r\n\t\t\tvar placeholderRE = new RegExp(\"\\\\$\" + (i + 1),\"mg\");\r\n\t\t\ttext = text.replace(placeholderRE,args[i]);\r\n\t\t}\r\n\t\tconfig.macros.tiddler.renderText(wrapper,text,tiddlerName);\r\n\t} finally {\r\n\t\tstack.pop();\r\n\t}\r\n};\r\n\r\nconfig.macros.tiddler.renderText = function(place,text,tiddlerName)\r\n{\r\n\twikify(text,place,null,store.getTiddler(tiddlerName));\r\n};\r\n\r\nconfig.macros.tiddler.tiddlerStack = [];\r\n\r\nconfig.macros.tag.handler = function(place,macroName,params)\r\n{\r\n\tvar btn = createTagButton(place,params[0],null,params[1],params[2]);\r\n\tif(params[3]) {\r\n\t\tbtn.setAttribute('sortby',params[3]);\r\n\t}\r\n};\r\n\r\nconfig.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)\r\n{\r\n\tparams = paramString.parseParams(\"anon\",null,true,false,false);\r\n\tvar ul = createTiddlyElement(place,\"ul\");\r\n\tvar title = getParam(params,\"anon\",\"\");\r\n\tif(title && store.tiddlerExists(title))\r\n\t\ttiddler = store.getTiddler(title);\r\n\tvar sep = getParam(params,\"sep\",\" \");\r\n\tvar lingo = config.views.wikified.tag;\r\n\tvar label = null;\r\n\tvar t;\r\n\tfor(t=0; t<tiddler.tags.length; t++) {\r\n\t\tvar tag = store.getTiddler(tiddler.tags[t]);\r\n\t\tif(!tag || !tag.tags.contains(\"excludeLists\")) {\r\n\t\t\tif(!label)\r\n\t\t\t\tlabel = createTiddlyElement(ul,\"li\",null,\"listTitle\",lingo.labelTags.format([tiddler.title]));\r\n\t\t\tcreateTagButton(createTiddlyElement(ul,\"li\"),tiddler.tags[t],tiddler.title);\r\n\t\t\tif(t<tiddler.tags.length-1)\r\n\t\t\t\tcreateTiddlyText(ul,sep);\r\n\t\t}\r\n\t}\r\n\tif(!label)\r\n\t\tcreateTiddlyElement(ul,\"li\",null,\"listTitle\",lingo.labelNoTags.format([tiddler.title]));\r\n};\r\n\r\nconfig.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)\r\n{\r\n\tparams = paramString.parseParams(\"anon\",null,true,false,false);\r\n\tvar ul = createTiddlyElement(place,\"ul\");\r\n\tvar title = getParam(params,\"anon\",\"\");\r\n\tif(title == \"\" && tiddler instanceof Tiddler)\r\n\t\ttitle = tiddler.title;\r\n\tvar sep = getParam(params,\"sep\",\" \");\r\n\tul.setAttribute(\"title\",this.tooltip.format([title]));\r\n\tvar sortby = getParam(params,\"sortBy\",false);\r\n\tvar tagged = store.getTaggedTiddlers(title,sortby);\r\n\tvar prompt = tagged.length == 0 ? this.labelNotTag : this.label;\r\n\tcreateTiddlyElement(ul,\"li\",null,\"listTitle\",prompt.format([title,tagged.length]));\r\n\tvar t;\r\n\tfor(t=0; t<tagged.length; t++) {\r\n\t\tcreateTiddlyLink(createTiddlyElement(ul,\"li\"),tagged[t].title,true);\r\n\t\tif(t<tagged.length-1)\r\n\t\t\tcreateTiddlyText(ul,sep);\r\n\t}\r\n};\r\n\r\nconfig.macros.closeAll.handler = function(place)\r\n{\r\n\tcreateTiddlyButton(place,this.label,this.prompt,this.onClick);\r\n};\r\n\r\nconfig.macros.closeAll.onClick = function(e)\r\n{\r\n\tstory.closeAllTiddlers();\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.permaview.handler = function(place)\r\n{\r\n\tcreateTiddlyButton(place,this.label,this.prompt,this.onClick);\r\n};\r\n\r\nconfig.macros.permaview.onClick = function(e)\r\n{\r\n\tstory.permaView();\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.saveChanges.handler = function(place,macroName,params)\r\n{\r\n\tif(!readOnly)\r\n\t\tcreateTiddlyButton(place,params[0] || this.label,params[1] || this.prompt,this.onClick,null,null,this.accessKey);\r\n};\r\n\r\nconfig.macros.saveChanges.onClick = function(e)\r\n{\r\n\tsaveChanges();\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.slider.onClickSlider = function(ev)\r\n{\r\n\tvar n = this.nextSibling;\r\n\tvar cookie = n.getAttribute(\"cookie\");\r\n\tvar isOpen = n.style.display != \"none\";\r\n\tif(config.options.chkAnimate && anim && typeof Slider == \"function\")\r\n\t\tanim.startAnimating(new Slider(n,!isOpen,null,\"none\"));\r\n\telse\r\n\t\tn.style.display = isOpen ? \"none\" : \"block\";\r\n\tconfig.options[cookie] = !isOpen;\r\n\tsaveOption(cookie);\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.slider.createSlider = function(place,cookie,title,tooltip)\r\n{\r\n\tvar c = cookie || \"\";\r\n\tcreateTiddlyButton(place,title,tooltip,this.onClickSlider);\r\n\tvar panel = createTiddlyElement(null,\"div\",null,\"sliderPanel\");\r\n\tpanel.setAttribute(\"cookie\",c);\r\n\tpanel.style.display = config.options[c] ? \"block\" : \"none\";\r\n\tplace.appendChild(panel);\r\n\treturn panel;\r\n};\r\n\r\nconfig.macros.slider.handler = function(place,macroName,params)\r\n{\r\n\tvar panel = this.createSlider(place,params[0],params[2],params[3]);\r\n\tvar text = store.getTiddlerText(params[1]);\r\n\tpanel.setAttribute(\"refresh\",\"content\");\r\n\tpanel.setAttribute(\"tiddler\",params[1]);\r\n\tif(text)\r\n\t\twikify(text,panel,null,store.getTiddler(params[1]));\r\n};\r\n\r\n// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>\r\nconfig.macros.gradient.handler = function(place,macroName,params,wikifier,paramString,tiddler)\r\n{\r\n\tvar panel = wikifier ? createTiddlyElement(place,\"div\",null,\"gradient\") : place;\r\n\tpanel.style.position = \"relative\";\r\n\tpanel.style.overflow = \"hidden\";\r\n\tpanel.style.zIndex = \"0\";\r\n\tif(wikifier) {\r\n\t\tvar styles = config.formatterHelpers.inlineCssHelper(wikifier);\r\n\t\tconfig.formatterHelpers.applyCssHelper(panel,styles);\r\n\t}\r\n\tparams = paramString.parseParams(\"color\");\r\n\tvar locolors = [], hicolors = [];\r\n\tvar t;\r\n\tfor(t=2; t<params.length; t++) {\r\n\t\tvar c = params[t].value;\r\n\t\tif(params[t].name == \"snap\") {\r\n\t\t\thicolors[hicolors.length-1] = c;\r\n\t\t} else {\r\n\t\t\tlocolors.push(c);\r\n\t\t\thicolors.push(c);\r\n\t\t}\r\n\t}\r\n\tdrawGradient(panel,params[1].value != \"vert\",locolors,hicolors);\r\n\tif(wikifier)\r\n\t\twikifier.subWikify(panel,\">>\");\r\n\tif(document.all) {\r\n\t\tpanel.style.height = \"100%\";\r\n\t\tpanel.style.width = \"100%\";\r\n\t}\r\n};\r\n\r\nconfig.macros.message.handler = function(place,macroName,params)\r\n{\r\n\tif(params[0]) {\r\n\t\tvar names = params[0].split(\".\");\r\n\t\tvar lookupMessage = function(root,nameIndex) {\r\n\t\t\t\tif(root[names[nameIndex]]) {\r\n\t\t\t\t\tif(nameIndex < names.length-1)\r\n\t\t\t\t\t\treturn (lookupMessage(root[names[nameIndex]],nameIndex+1));\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\treturn root[names[nameIndex]];\r\n\t\t\t\t} else\r\n\t\t\t\t\treturn null;\r\n\t\t\t};\r\n\t\tvar m = lookupMessage(config,0);\r\n\t\tif(m == null)\r\n\t\t\tm = lookupMessage(window,0);\r\n\t\tcreateTiddlyText(place,m.toString().format(params.splice(1)));\r\n\t}\r\n};\r\n\r\n\r\nconfig.macros.view.depth = 0;\r\nconfig.macros.view.values = [];\r\nconfig.macros.view.views = {\r\n\ttext: function(value,place,params,wikifier,paramString,tiddler) {\r\n\t\thighlightify(value,place,highlightHack,tiddler);\r\n\t},\r\n\tlink: function(value,place,params,wikifier,paramString,tiddler) {\r\n\t\tcreateTiddlyLink(place,value,true);\r\n\t},\r\n\twikified: function(value,place,params,wikifier,paramString,tiddler) {\r\n\t\tif(config.macros.view.depth>50)\r\n\t\t\treturn;\r\n\t\tif(config.macros.view.depth>0) {\r\n\t\t\tif (value==config.macros.view.values[config.macros.view.depth-1]) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tconfig.macros.view.values[config.macros.view.depth] = value;\r\n\t\tconfig.macros.view.depth++;\r\n\t\tif(params[2])\r\n\t\t\tvalue=params[2].unescapeLineBreaks().format([value]);\r\n\t\twikify(value,place,highlightHack,tiddler);\r\n\t\tconfig.macros.view.depth--;\r\n\t\tconfig.macros.view.values[config.macros.view.depth] = null;\r\n\t},\r\n\tdate: function(value,place,params,wikifier,paramString,tiddler) {\r\n\t\tvalue = Date.convertFromYYYYMMDDHHMM(value);\r\n\t\tcreateTiddlyText(place,value.formatString(params[2] || config.views.wikified.dateFormat));\r\n\t}\r\n};\r\n\r\nconfig.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)\r\n{\r\n\tif((tiddler instanceof Tiddler) && params[0]) {\r\n\t\tvar value = store.getValue(tiddler,params[0]);\r\n\t\tif(value) {\r\n\t\t\tvar type = params[1] || config.macros.view.defaultView;\r\n\t\t\tvar handler = config.macros.view.views[type];\r\n\t\t\tif(handler)\r\n\t\t\t\thandler(value,place,params,wikifier,paramString,tiddler);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconfig.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)\r\n{\r\n\tvar field = params[0];\r\n\tvar rows = params[1] || 0;\r\n\tvar defVal = params[2] || '';\r\n\tif((tiddler instanceof Tiddler) && field) {\r\n\t\tstory.setDirty(tiddler.title,true);\r\n\t\tvar e,v;\r\n\t\tif(field != \"text\" && !rows) {\r\n\t\t\te = createTiddlyElement(null,\"input\",null,null,null,{\r\n\t\t\t\ttype: \"text\", edit: field, size: \"40\", autocomplete: \"off\"\r\n\t\t\t});\r\n\t\t\te.value = store.getValue(tiddler,field) || defVal;\r\n\t\t\tplace.appendChild(e);\r\n\t\t} else {\r\n\t\t\tvar wrapper1 = createTiddlyElement(null,\"fieldset\",null,\"fieldsetFix\");\r\n\t\t\tvar wrapper2 = createTiddlyElement(wrapper1,\"div\");\r\n\t\t\te = createTiddlyElement(wrapper2,\"textarea\");\r\n\t\t\te.value = v = store.getValue(tiddler,field) || defVal;\r\n\t\t\trows = rows || 10;\r\n\t\t\tvar lines = v.match(/\\n/mg);\r\n\t\t\tvar maxLines = Math.max(parseInt(config.options.txtMaxEditRows,10),5);\r\n\t\t\tif(lines != null && lines.length > rows)\r\n\t\t\t\trows = lines.length + 5;\r\n\t\t\trows = Math.min(rows,maxLines);\r\n\t\t\te.setAttribute(\"rows\",rows);\r\n\t\t\te.setAttribute(\"edit\",field);\r\n\t\t\tplace.appendChild(wrapper1);\r\n\t\t}\r\n\t\tif(tiddler.isReadOnly()) {\r\n\t\t\te.setAttribute(\"readOnly\",\"readOnly\");\r\n\t\t\tjQuery(e).addClass(\"readOnly\");\r\n\t\t}\r\n\t\treturn e;\r\n\t}\r\n};\r\n\r\nconfig.macros.tagChooser.onClick = function(ev)\r\n{\r\n\tvar e = ev || window.event;\r\n\tvar lingo = config.views.editor.tagChooser;\r\n\tvar popup = Popup.create(this);\r\n\tvar tags = store.getTags(this.getAttribute(\"tags\"));\r\n\tif(tags.length == 0)\r\n\t\tjQuery(\"<li/>\").text(lingo.popupNone).appendTo(popup);\r\n\tvar t;\r\n\tfor(t=0; t<tags.length; t++) {\r\n\t\tvar tag = createTiddlyButton(createTiddlyElement(popup,\"li\"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);\r\n\t\ttag.setAttribute(\"tag\",tags[t][0]);\r\n\t\ttag.setAttribute(\"tiddler\",this.getAttribute(\"tiddler\"));\r\n\t}\r\n\tPopup.show();\r\n\te.cancelBubble = true;\r\n\tif(e.stopPropagation) e.stopPropagation();\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.tagChooser.onTagClick = function(ev)\r\n{\r\n\tvar e = ev || window.event;\r\n\tif(e.metaKey || e.ctrlKey) stopEvent(e); //# keep popup open on CTRL-click\r\n\tvar tag = this.getAttribute(\"tag\");\r\n\tvar title = this.getAttribute(\"tiddler\");\r\n\tif(!readOnly)\r\n\t\tstory.setTiddlerTag(title,tag,0);\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)\r\n{\r\n\tif(tiddler instanceof Tiddler) {\r\n\t\tvar lingo = config.views.editor.tagChooser;\r\n\t\tvar btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);\r\n\t\tbtn.setAttribute(\"tiddler\",tiddler.title);\r\n\t\tbtn.setAttribute(\"tags\",params[0]);\r\n\t}\r\n};\r\n\r\nconfig.macros.refreshDisplay.handler = function(place)\r\n{\r\n\tcreateTiddlyButton(place,this.label,this.prompt,this.onClick);\r\n};\r\n\r\nconfig.macros.refreshDisplay.onClick = function(e)\r\n{\r\n\trefreshAll();\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.annotations.handler = function(place,macroName,params,wikifier,paramString,tiddler)\r\n{\r\n\tvar title = tiddler ? tiddler.title : null;\r\n\tvar a = title ? config.annotations[title] : null;\r\n\tif(!tiddler || !title || !a)\r\n\t\treturn;\r\n\tvar text = a.format([title]);\r\n\twikify(text,createTiddlyElement(place,\"div\",null,\"annotation\"),null,tiddler);\r\n};\r\n//--\r\n//-- NewTiddler and NewJournal macros\r\n//--\r\n\r\nconfig.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)\r\n{\r\n\tvar tags = [];\r\n\tvar t;\r\n\tfor(t=1; t<params.length; t++) {\r\n\t\tif((params[t].name == \"anon\" && t != 1) || (params[t].name == \"tag\"))\r\n\t\t\ttags.push(params[t].value);\r\n\t}\r\n\tlabel = getParam(params,\"label\",label);\r\n\tprompt = getParam(params,\"prompt\",prompt);\r\n\taccessKey = getParam(params,\"accessKey\",accessKey);\r\n\tnewFocus = getParam(params,\"focus\",newFocus);\r\n\tvar customFields = getParam(params,\"fields\",\"\");\r\n\tif(!customFields && !store.isShadowTiddler(title))\r\n\t\tcustomFields = String.encodeHashMap(config.defaultCustomFields);\r\n\tvar btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);\r\n\tbtn.setAttribute(\"newTitle\",title);\r\n\tbtn.setAttribute(\"isJournal\",isJournal ? \"true\" : \"false\");\r\n\tif(tags.length > 0)\r\n\t\tbtn.setAttribute(\"params\",tags.join(\"|\"));\r\n\tbtn.setAttribute(\"newFocus\",newFocus);\r\n\tbtn.setAttribute(\"newTemplate\",getParam(params,\"template\",DEFAULT_EDIT_TEMPLATE));\r\n\tif(customFields !== \"\")\r\n\t\tbtn.setAttribute(\"customFields\",customFields);\r\n\tvar text = getParam(params,\"text\");\r\n\tif(text !== undefined)\r\n\t\tbtn.setAttribute(\"newText\",text);\r\n\treturn btn;\r\n};\r\n\r\nconfig.macros.newTiddler.onClickNewTiddler = function()\r\n{\r\n\tvar title = this.getAttribute(\"newTitle\");\r\n\tif(this.getAttribute(\"isJournal\") == \"true\") {\r\n\t\ttitle = new Date().formatString(title.trim());\r\n\t}\r\n\tvar params = this.getAttribute(\"params\");\r\n\tvar tags = params ? params.split(\"|\") : [];\r\n\tvar focus = this.getAttribute(\"newFocus\");\r\n\tvar template = this.getAttribute(\"newTemplate\");\r\n\tvar customFields = this.getAttribute(\"customFields\");\r\n\tif(!customFields && !store.isShadowTiddler(title))\r\n\t\tcustomFields = String.encodeHashMap(config.defaultCustomFields);\r\n\tstory.displayTiddler(null,title,template,false,null,null);\r\n\tvar tiddlerElem = story.getTiddler(title);\r\n\tif(customFields)\r\n\t\tstory.addCustomFields(tiddlerElem,customFields);\r\n\tvar text = this.getAttribute(\"newText\");\r\n\tif(typeof text == \"string\" && story.getTiddlerField(title,\"text\"))\r\n\t\tstory.getTiddlerField(title,\"text\").value = text.format([title]);\r\n\tvar t;\r\n\tfor(t=0;t<tags.length;t++)\r\n\t\tstory.setTiddlerTag(title,tags[t],+1);\r\n\tstory.focusTiddler(title,focus);\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString)\r\n{\r\n\tif(!readOnly) {\r\n\t\tparams = paramString.parseParams(\"anon\",null,true,false,false);\r\n\t\tvar title = params[1] && params[1].name == \"anon\" ? params[1].value : this.title;\r\n\t\ttitle = getParam(params,\"title\",title);\r\n\t\tthis.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,\"title\",false);\r\n\t}\r\n};\r\n\r\nconfig.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString)\r\n{\r\n\tif(!readOnly) {\r\n\t\tparams = paramString.parseParams(\"anon\",null,true,false,false);\r\n\t\tvar title = params[1] && params[1].name == \"anon\" ? params[1].value : config.macros.timeline.dateFormat;\r\n\t\ttitle = getParam(params,\"title\",title);\r\n\t\tconfig.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,\"text\",true);\r\n\t}\r\n};\r\n\r\n//--\r\n//-- Search macro\r\n//--\r\n\r\nconfig.macros.search.handler = function(place,macroName,params,wikifier,paramString,tiddler)\r\n{\r\n\tparams = paramString.parseParams(\"anon\",null,false,false,false);\r\n\tcreateTiddlyButton(place,this.label,this.prompt,this.onClick,\"searchButton\");\r\n\tvar txt = createTiddlyElement(null,\"input\",null,\"txtOptionInput searchField\");\r\n\ttxt.value = getParam(params,\"anon\",\"\");\r\n\tif(config.browser.isSafari) {\r\n\t\ttxt.setAttribute(\"type\",\"search\");\r\n\t\ttxt.setAttribute(\"results\",\"5\");\r\n\t} else {\r\n\t\ttxt.setAttribute(\"type\",\"text\");\r\n\t}\r\n\tplace.appendChild(txt);\r\n\ttxt.onkeyup = this.onKeyPress;\r\n\ttxt.onfocus = this.onFocus;\r\n\ttxt.setAttribute(\"size\",this.sizeTextbox);\r\n\ttxt.setAttribute(\"accessKey\",getParam(params,\"accesskey\",this.accessKey));\r\n\ttxt.setAttribute(\"autocomplete\",\"off\");\r\n\ttxt.setAttribute(\"lastSearchText\",\"\");\r\n\ttxt.setAttribute(\"placeholder\",getParam(params,\"placeholder\",this.placeholder));\r\n};\r\n\r\n// Global because there's only ever one outstanding incremental search timer\r\nconfig.macros.search.timeout = null;\r\n\r\nconfig.macros.search.doSearch = function(txt)\r\n{\r\n\tif(txt.value.length > 0) {\r\n\t\tstory.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);\r\n\t\ttxt.setAttribute(\"lastSearchText\",txt.value);\r\n\t}\r\n};\r\n\r\nconfig.macros.search.onClick = function(e)\r\n{\r\n\tconfig.macros.search.doSearch(this.nextSibling);\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.search.onKeyPress = function(ev)\r\n{\r\n\tvar me = config.macros.search;\r\n\tvar e = ev || window.event;\r\n\tswitch(e.keyCode) {\r\n\t\tcase 9: // Tab\r\n\t\t\treturn;\r\n\t\tcase 13: // Ctrl-Enter\r\n\t\tcase 10: // Ctrl-Enter on IE PC\r\n\t\t\tme.doSearch(this);\r\n\t\t\tbreak;\r\n\t\tcase 27: // Escape\r\n\t\t\tthis.value = \"\";\r\n\t\t\tclearMessage();\r\n\t\t\tbreak;\r\n\t}\r\n\tif(config.options.chkIncrementalSearch) {\r\n\t\tif(this.value.length > 2) {\r\n\t\t\tif(this.value != this.getAttribute(\"lastSearchText\")) {\r\n\t\t\t\tif(me.timeout) {\r\n\t\t\t\t\tclearTimeout(me.timeout);\r\n\t\t\t\t}\r\n\t\t\t\tvar txt = this;\r\n\t\t\t\tme.timeout = setTimeout(function() {me.doSearch(txt);},500);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(me.timeout) {\r\n\t\t\t\tclearTimeout(me.timeout);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconfig.macros.search.onFocus = function(e)\r\n{\r\n\tthis.select();\r\n};\r\n\r\n//--\r\n//-- Tabs macro\r\n//--\r\n\r\nconfig.macros.tabs.handler = function(place,macroName,params)\r\n{\r\n\tvar cookie = params[0];\r\n\tvar numTabs = (params.length-1)/3;\r\n\tvar wrapper = createTiddlyElement(null,\"div\",null,\"tabsetWrapper \" + cookie);\r\n\tvar tabset = createTiddlyElement(wrapper,\"div\",null,\"tabset\");\r\n\ttabset.setAttribute(\"cookie\",cookie);\r\n\tvar validTab = false;\r\n\tvar t;\r\n\tfor(t=0; t<numTabs; t++) {\r\n\t\tvar label = params[t*3+1];\r\n\t\tvar prompt = params[t*3+2];\r\n\t\tvar content = params[t*3+3];\r\n\t\tvar tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,\"tab tabUnselected\");\r\n\t\tcreateTiddlyElement(tab,\"span\",null,null,\" \",{style:\"font-size:0pt;line-height:0px\"});\r\n\t\ttab.setAttribute(\"tab\",label);\r\n\t\ttab.setAttribute(\"content\",content);\r\n\t\ttab.title = prompt;\r\n\t\tif(config.options[cookie] == label)\r\n\t\t\tvalidTab = true;\r\n\t}\r\n\tif(!validTab)\r\n\t\tconfig.options[cookie] = params[1];\r\n\tplace.appendChild(wrapper);\r\n\tthis.switchTab(tabset,config.options[cookie]);\r\n};\r\n\r\nconfig.macros.tabs.onClickTab = function(e)\r\n{\r\n\tconfig.macros.tabs.switchTab(this.parentNode,this.getAttribute(\"tab\"));\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.tabs.switchTab = function(tabset,tab)\r\n{\r\n\tvar cookie = tabset.getAttribute(\"cookie\");\r\n\tvar theTab = null;\r\n\tvar nodes = tabset.childNodes;\r\n\tvar t;\r\n\tfor(t=0; t<nodes.length; t++) {\r\n\t\tif(nodes[t].getAttribute && nodes[t].getAttribute(\"tab\") == tab) {\r\n\t\t\ttheTab = nodes[t];\r\n\t\t\ttheTab.className = \"tab tabSelected\";\r\n\t\t} else {\r\n\t\t\tnodes[t].className = \"tab tabUnselected\";\r\n\t\t}\r\n\t}\r\n\tif(theTab) {\r\n\t\tif(tabset.nextSibling && tabset.nextSibling.className == \"tabContents\")\r\n\t\t\tjQuery(tabset.nextSibling).remove();\r\n\t\tvar tabContent = createTiddlyElement(null,\"div\",null,\"tabContents\");\r\n\t\ttabset.parentNode.insertBefore(tabContent,tabset.nextSibling);\r\n\t\tvar contentTitle = theTab.getAttribute(\"content\");\r\n\t\twikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));\r\n\t\tif(cookie) {\r\n\t\t\tconfig.options[cookie] = tab;\r\n\t\t\tsaveOption(cookie);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n//--\r\n//-- Tiddler toolbar\r\n//--\r\n\r\n// Create a toolbar command button\r\nconfig.macros.toolbar.createCommand = function(place,commandName,tiddler,className)\r\n{\r\n\tif(typeof commandName != \"string\") {\r\n\t\tvar c = null;\r\n\t\tvar t;\r\n\t\tfor(t in config.commands) {\r\n\t\t\tif(config.commands[t] == commandName)\r\n\t\t\t\tc = t;\r\n\t\t}\r\n\t\tcommandName = c;\r\n\t}\r\n\tif((tiddler instanceof Tiddler) && (typeof commandName == \"string\")) {\r\n\t\tvar command = config.commands[commandName];\r\n\t\tif(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler)) {\r\n\t\t\tvar text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);\r\n\t\t\tvar tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);\r\n\t\t\tvar cmd = command.type == \"popup\" ? this.onClickPopup : this.onClickCommand;\r\n\t\t\tvar btn = createTiddlyButton(null,text,tooltip,cmd);\r\n\t\t\tbtn.setAttribute(\"commandName\",commandName);\r\n\t\t\tbtn.setAttribute(\"tiddler\",tiddler.title);\r\n\t\t\tjQuery(btn).addClass(\"command_\" + commandName);\r\n\t\t\tif(className)\r\n\t\t\t\tjQuery(btn).addClass(className);\r\n\t\t\tplace.appendChild(btn);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconfig.macros.toolbar.isCommandEnabled = function(command,tiddler)\r\n{\r\n\tvar title = tiddler.title;\r\n\tvar ro = tiddler.isReadOnly();\r\n\tvar shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);\r\n\treturn (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);\r\n};\r\n\r\nconfig.macros.toolbar.getCommandText = function(command,tiddler)\r\n{\r\n\treturn (tiddler.isReadOnly() && command.readOnlyText) || command.text;\r\n};\r\n\r\nconfig.macros.toolbar.getCommandTooltip = function(command,tiddler)\r\n{\r\n\treturn (tiddler.isReadOnly() && command.readOnlyTooltip) || command.tooltip;\r\n};\r\n\r\nconfig.macros.toolbar.onClickCommand = function(ev)\r\n{\r\n\tvar e = ev || window.event;\r\n\te.cancelBubble = true;\r\n\tif(e.stopPropagation) e.stopPropagation();\r\n\tvar command = config.commands[this.getAttribute(\"commandName\")];\r\n\treturn command.handler(e,this,this.getAttribute(\"tiddler\"));\r\n};\r\n\r\nconfig.macros.toolbar.onClickPopup = function(ev)\r\n{\r\n\tvar e = ev || window.event;\r\n\te.cancelBubble = true;\r\n\tif(e.stopPropagation) e.stopPropagation();\r\n\tvar popup = Popup.create(this);\r\n\tvar command = config.commands[this.getAttribute(\"commandName\")];\r\n\tvar title = this.getAttribute(\"tiddler\");\r\n\tpopup.setAttribute(\"tiddler\",title);\r\n\tcommand.handlePopup(popup,title);\r\n\tPopup.show();\r\n\treturn false;\r\n};\r\n\r\n// Invoke the first command encountered from a given place that is tagged with a specified class\r\nconfig.macros.toolbar.invokeCommand = function(place,className,event)\r\n{\r\n\tvar children = place.getElementsByTagName(\"a\");\r\n\tvar t;\r\n\tfor(t=0; t<children.length; t++) {\r\n\t\tvar c = children[t];\r\n\t\tif(jQuery(c).hasClass(className) && c.getAttribute && c.getAttribute(\"commandName\")) {\r\n\t\t\tif(c.onclick instanceof Function)\r\n\t\t\t\tc.onclick.call(c,event);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconfig.macros.toolbar.onClickMore = function(ev)\r\n{\r\n\tvar e = this.nextSibling;\r\n\te.style.display = \"inline\";\r\n\tthis.style.display = \"none\";\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.toolbar.onClickLess = function(ev)\r\n{\r\n\tvar e = this.parentNode;\r\n\tvar m = e.previousSibling;\r\n\te.style.display = \"none\";\r\n\tm.style.display = \"inline\";\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)\r\n{\r\n\tvar t;\r\n\tfor(t=0; t<params.length; t++) {\r\n\t\tvar btn;\r\n\t\tvar c = params[t];\r\n\t\tswitch(c) {\r\n\t\tcase \"!\":\r\n\t\t\tcreateTiddlyText(place,this.separator);\r\n\t\t\tbreak;\r\n\t\tcase \"*\":\r\n\t\t\tcreateTiddlyElement(place,\"br\");\r\n\t\t\tbreak;\r\n\t\tcase \"<\":\r\n\t\t\tbtn = createTiddlyButton(place,this.lessLabel,this.lessPrompt,config.macros.toolbar.onClickLess);\r\n\t\t\tjQuery(btn).addClass(\"lessCommand\");\r\n\t\t\tbreak;\r\n\t\tcase \">\":\r\n\t\t\tbtn = createTiddlyButton(place,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);\r\n\t\t\tjQuery(btn).addClass(\"moreCommand\");\r\n\t\t\tvar e = createTiddlyElement(place,\"span\",null,\"moreCommand\");\r\n\t\t\te.style.display = \"none\";\r\n\t\t\tplace = e;\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tvar className = \"\";\r\n\t\t\tswitch(c.substr(0,1)) {\r\n\t\t\tcase \"+\":\r\n\t\t\t\tclassName = \"defaultCommand\";\r\n\t\t\t\tc = c.substr(1);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"-\":\r\n\t\t\t\tclassName = \"cancelCommand\";\r\n\t\t\t\tc = c.substr(1);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif(config.commands[c]) {\r\n\t\t\t\tthis.createCommand(place,c,tiddler,className);\r\n\t\t\t} else {\r\n\t\t\t\tthis.customCommand(place,c,wikifier,tiddler);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n};\r\n\r\n// Overrideable function to extend toolbar handler\r\nconfig.macros.toolbar.customCommand = function(place,command,wikifier,tiddler)\r\n{\r\n};\r\n\r\n//--\r\n//-- Menu and toolbar commands\r\n//--\r\n\r\nconfig.commands.closeTiddler.handler = function(event,src,title)\r\n{\r\n\tif(story.isDirty(title) && !readOnly) {\r\n\t\tif(!confirm(config.commands.cancelTiddler.warning.format([title])))\r\n\t\t\treturn false;\r\n\t}\r\n\tstory.setDirty(title,false);\r\n\tstory.closeTiddler(title,true);\r\n\treturn false;\r\n};\r\n\r\nconfig.commands.closeOthers.handler = function(event,src,title)\r\n{\r\n\tstory.closeAllTiddlers(title);\r\n\treturn false;\r\n};\r\n\r\nconfig.commands.editTiddler.handler = function(event,src,title)\r\n{\r\n\tclearMessage();\r\n\tvar tiddlerElem = story.getTiddler(title);\r\n\tvar fields = tiddlerElem.getAttribute(\"tiddlyFields\");\r\n\tstory.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,fields);\r\n\tvar e = story.getTiddlerField(title,config.options.txtEditorFocus||\"text\");\r\n\tif(e) {\r\n\t\tsetCaretPosition(e,0);\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nconfig.commands.saveTiddler.handler = function(event,src,title)\r\n{\r\n\tvar newTitle = story.saveTiddler(title,event.shiftKey);\r\n\tif(newTitle)\r\n\t\tstory.displayTiddler(null,newTitle);\r\n\treturn false;\r\n};\r\n\r\nconfig.commands.cancelTiddler.handler = function(event,src,title)\r\n{\r\n\tif(story.hasChanges(title) && !readOnly) {\r\n\t\tif(!confirm(this.warning.format([title])))\r\n\t\t\treturn false;\r\n\t}\r\n\tstory.setDirty(title,false);\r\n\tstory.displayTiddler(null,title);\r\n\treturn false;\r\n};\r\n\r\nconfig.commands.deleteTiddler.handler = function(event,src,title)\r\n{\r\n\tvar deleteIt = true;\r\n\tif(config.options.chkConfirmDelete)\r\n\t\tdeleteIt = confirm(this.warning.format([title]));\r\n\tif(deleteIt) {\r\n\t\tstore.removeTiddler(title);\r\n\t\tstory.closeTiddler(title,true);\r\n\t\tautoSaveChanges();\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nconfig.commands.permalink.handler = function(event,src,title)\r\n{\r\n\tvar t = encodeURIComponent(String.encodeTiddlyLink(title));\r\n\tif(window.location.hash != t)\r\n\t\twindow.location.hash = t;\r\n\treturn false;\r\n};\r\n\r\nconfig.commands.references.handlePopup = function(popup,title)\r\n{\r\n\tvar references = store.getReferringTiddlers(title);\r\n\tvar c = false;\r\n\tvar r;\r\n\tfor(r=0; r<references.length; r++) {\r\n\t\tif(references[r].title != title && !references[r].isTagged(\"excludeLists\")) {\r\n\t\t\tcreateTiddlyLink(createTiddlyElement(popup,\"li\"),references[r].title,true);\r\n\t\t\tc = true;\r\n\t\t}\r\n\t}\r\n\tif(!c)\r\n\t\tcreateTiddlyElement(popup,\"li\",null,\"disabled\",this.popupNone);\r\n};\r\n\r\nconfig.commands.jump.handlePopup = function(popup,title)\r\n{\r\n\tstory.forEachTiddler(function(title,element) {\r\n\t\tcreateTiddlyLink(createTiddlyElement(popup,\"li\"),title,true,null,false,null,true);\r\n\t\t});\r\n};\r\n\r\nconfig.commands.fields.handlePopup = function(popup,title)\r\n{\r\n\tvar tiddler = store.fetchTiddler(title);\r\n\tif(!tiddler)\r\n\t\treturn;\r\n\tvar items = [];\r\n\tstore.forEachField(tiddler,function(tiddler,fieldName,value){items.push({field:fieldName,value:value});},true);\r\n\titems.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});\r\n\tif(items.length > 0)\r\n\t\tListView.create(popup,items,this.listViewTemplate);\r\n\telse\r\n\t\tcreateTiddlyElement(popup,\"div\",null,null,this.emptyText);\r\n};\r\n\r\n//--\r\n//-- Tiddler() object\r\n//--\r\n\r\nfunction Tiddler(title)\r\n{\r\n\tthis.title = title;\r\n\tthis.text = \"\";\r\n\tthis.creator = null;\r\n\tthis.modifier = null;\r\n\tthis.created = new Date();\r\n\tthis.modified = this.created;\r\n\tthis.links = [];\r\n\tthis.linksUpdated = false;\r\n\tthis.tags = [];\r\n\tthis.fields = {};\r\n\treturn this;\r\n}\r\n\r\nTiddler.prototype.getLinks = function()\r\n{\r\n\tif(this.linksUpdated==false)\r\n\t\tthis.changed();\r\n\treturn this.links;\r\n};\r\n\r\n// Returns the fields that are inherited in string field:\"value\" field2:\"value2\" format\r\nTiddler.prototype.getInheritedFields = function()\r\n{\r\n\tvar f = {};\r\n\tvar i;\r\n\tfor(i in this.fields) {\r\n\t\tif(i==\"server.host\" || i==\"server.workspace\" || i==\"wikiformat\"|| i==\"server.type\") {\r\n\t\t\tf[i] = this.fields[i];\r\n\t\t}\r\n\t}\r\n\treturn String.encodeHashMap(f);\r\n};\r\n\r\n// Increment the changeCount of a tiddler\r\nTiddler.prototype.incChangeCount = function()\r\n{\r\n\tvar c = this.fields['changecount'];\r\n\tc = c ? parseInt(c,10) : 0;\r\n\tthis.fields['changecount'] = String(c+1);\r\n};\r\n\r\n// Clear the changeCount of a tiddler\r\nTiddler.prototype.clearChangeCount = function()\r\n{\r\n\tif(this.fields['changecount']) {\r\n\t\tdelete this.fields['changecount'];\r\n\t}\r\n};\r\n\r\nTiddler.prototype.doNotSave = function()\r\n{\r\n\treturn this.fields['doNotSave'];\r\n};\r\n\r\n// Returns true if the tiddler has been updated since the tiddler was created or downloaded\r\nTiddler.prototype.isTouched = function()\r\n{\r\n\tvar changecount = this.fields.changecount || 0;\r\n\treturn changecount > 0;\r\n};\r\n\r\n// Change the text and other attributes of a tiddler\r\nTiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields,creator)\r\n{\r\n\tthis.assign(title,text,modifier,modified,tags,created,fields,creator);\r\n\tthis.changed();\r\n\treturn this;\r\n};\r\n\r\n// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call\r\nTiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields,creator)\r\n{\r\n\tif(title != undefined)\r\n\t\tthis.title = title;\r\n\tif(text != undefined)\r\n\t\tthis.text = text;\r\n\tif(modifier != undefined)\r\n\t\tthis.modifier = modifier;\r\n\tif(modified != undefined)\r\n\t\tthis.modified = modified;\r\n\tif(creator != undefined)\r\n\t\tthis.creator = creator;\r\n\tif(created != undefined)\r\n\t\tthis.created = created;\r\n\tif(fields != undefined)\r\n\t\tthis.fields = fields;\r\n\tif(tags != undefined)\r\n\t\tthis.tags = (typeof tags == \"string\") ? tags.readBracketedList() : tags;\r\n\telse if(this.tags == undefined)\r\n\t\tthis.tags = [];\r\n\treturn this;\r\n};\r\n\r\n// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)\r\nTiddler.prototype.getTags = function()\r\n{\r\n\treturn String.encodeTiddlyLinkList(this.tags);\r\n};\r\n\r\n// Test if a tiddler carries a tag\r\nTiddler.prototype.isTagged = function(tag)\r\n{\r\n\treturn this.tags.indexOf(tag) != -1;\r\n};\r\n\r\n// Static method to convert \"\\n\" to newlines, \"\\s\" to \"\\\"\r\nTiddler.unescapeLineBreaks = function(text)\r\n{\r\n\treturn text ? text.unescapeLineBreaks() : \"\";\r\n};\r\n\r\n// Convert newlines to \"\\n\", \"\\\" to \"\\s\"\r\nTiddler.prototype.escapeLineBreaks = function()\r\n{\r\n\treturn this.text.escapeLineBreaks();\r\n};\r\n\r\n// Updates the secondary information (like links[] array) after a change to a tiddler\r\nTiddler.prototype.changed = function()\r\n{\r\n\tthis.links = [];\r\n\tvar text = this.text;\r\n\t// remove 'quoted' text before scanning tiddler source\r\n\ttext = text.replace(/\\/%((?:.|\\n)*?)%\\//g,\"\").\r\n\t\treplace(/\\{{3}((?:.|\\n)*?)\\}{3}/g,\"\").\r\n\t\treplace(/\"\"\"((?:.|\\n)*?)\"\"\"/g,\"\").\r\n\t\treplace(/<nowiki\\>((?:.|\\n)*?)<\\/nowiki\\>/g,\"\").\r\n\t\treplace(/<html\\>((?:.|\\n)*?)<\\/html\\>/g,\"\").\r\n\t\treplace(/<script((?:.|\\n)*?)<\\/script\\>/g,\"\");\r\n\tvar t = this.autoLinkWikiWords() ? 0 : 1;\r\n\tvar tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;\r\n\ttiddlerLinkRegExp.lastIndex = 0;\r\n\tvar formatMatch = tiddlerLinkRegExp.exec(text);\r\n\twhile(formatMatch) {\r\n\t\tvar lastIndex = tiddlerLinkRegExp.lastIndex;\r\n\t\tif(t==0 && formatMatch[1] && formatMatch[1] != this.title) {\r\n\t\t\t// wikiWordLink\r\n\t\t\tif(formatMatch.index > 0) {\r\n\t\t\t\tvar preRegExp = new RegExp(config.textPrimitives.unWikiLink+\"|\"+config.textPrimitives.anyLetter,\"mg\");\r\n\t\t\t\tpreRegExp.lastIndex = formatMatch.index-1;\r\n\t\t\t\tvar preMatch = preRegExp.exec(text);\r\n\t\t\t\tif(preMatch.index != formatMatch.index-1)\r\n\t\t\t\t\tthis.links.pushUnique(formatMatch[1]);\r\n\t\t\t} else {\r\n\t\t\t\tthis.links.pushUnique(formatMatch[1]);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(formatMatch[2-t] && !config.formatterHelpers.isExternalLink(formatMatch[3-t])) // titledBrackettedLink\r\n\t\t\tthis.links.pushUnique(formatMatch[3-t]);\r\n\t\telse if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink\r\n\t\t\tthis.links.pushUnique(formatMatch[4-t]);\r\n\t\ttiddlerLinkRegExp.lastIndex = lastIndex;\r\n\t\tformatMatch = tiddlerLinkRegExp.exec(text);\r\n\t}\r\n\tthis.linksUpdated = true;\r\n};\r\n\r\nTiddler.prototype.getSubtitle = function()\r\n{\r\n\tvar modifier = this.modifier;\r\n\tif(!modifier)\r\n\t\tmodifier = config.messages.subtitleUnknown || \"\";\r\n\tvar modified = this.modified;\r\n\tif(modified)\r\n\t\tmodified = modified.toLocaleString();\r\n\telse\r\n\t\tmodified = config.messages.subtitleUnknown || \"\";\r\n\tvar f = config.messages.tiddlerLinkTooltip || \"%0 - %1, %2\";\r\n\treturn f.format([this.title,modifier,modified]);\r\n};\r\n\r\nTiddler.prototype.isReadOnly = function()\r\n{\r\n\treturn readOnly;\r\n};\r\n\r\nTiddler.prototype.autoLinkWikiWords = function()\r\n{\r\n\treturn !(this.isTagged(\"systemConfig\") || this.isTagged(\"excludeMissing\"));\r\n};\r\n\r\nTiddler.prototype.getServerType = function()\r\n{\r\n\tvar serverType = null;\r\n\tif(this.fields['server.type'])\r\n\t\tserverType = this.fields['server.type'];\r\n\tif(!serverType)\r\n\t\tserverType = this.fields['wikiformat'];\r\n\tif(serverType && !config.adaptors[serverType])\r\n\t\tserverType = null;\r\n\treturn serverType;\r\n};\r\n\r\nTiddler.prototype.getAdaptor = function()\r\n{\r\n\tvar serverType = this.getServerType();\r\n\treturn serverType ? new config.adaptors[serverType]() : null;\r\n};\r\n\r\n//--\r\n//-- TiddlyWiki instance contains TiddlerS\r\n//--\r\n\r\nfunction TiddlyWiki(params)\r\n{\r\n\tvar tiddlers = {}; // Hashmap by name of tiddlers\r\n\tif(params && params.config) {\r\n\t\tthis.config = config;\r\n\t}\r\n\tthis.tiddlersUpdated = false;\r\n\tthis.namedNotifications = []; // Array of {name:,notify:} of notification functions\r\n\tthis.notificationLevel = 0;\r\n\tthis.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.\r\n\tthis.clear = function() {\r\n\t\ttiddlers = {};\r\n\t\tthis.setDirty(false);\r\n\t};\r\n\tthis.fetchTiddler = function(title) {\r\n\t\tvar t = tiddlers[title];\r\n\t\treturn t instanceof Tiddler ? t : null;\r\n\t};\r\n\tthis.deleteTiddler = function(title) {\r\n\t\tdelete this.slices[title];\r\n\t\tdelete tiddlers[title];\r\n\t};\r\n\tthis.addTiddler = function(tiddler) {\r\n\t\tdelete this.slices[tiddler.title];\r\n\t\ttiddlers[tiddler.title] = tiddler;\r\n\t};\r\n\tthis.forEachTiddler = function(callback) {\r\n\t\tvar t;\r\n\t\tfor(t in tiddlers) {\r\n\t\t\tvar tiddler = tiddlers[t];\r\n\t\t\tif(tiddler instanceof Tiddler)\r\n\t\t\t\tcallback.call(this,t,tiddler);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nTiddlyWiki.prototype.setDirty = function(dirty)\r\n{\r\n\tthis.dirty = dirty;\r\n};\r\n\r\nTiddlyWiki.prototype.isDirty = function()\r\n{\r\n\treturn this.dirty;\r\n};\r\n\r\nTiddlyWiki.prototype.tiddlerExists = function(title)\r\n{\r\n\tvar t = this.fetchTiddler(title);\r\n\treturn t != undefined;\r\n};\r\n\r\nTiddlyWiki.prototype.isShadowTiddler = function(title)\r\n{\r\n\treturn config.shadowTiddlers[title] === undefined ? false : true;\r\n};\r\n\r\nTiddlyWiki.prototype.isAvailable = function(title) {\r\n\tif (!title)\r\n\t\treturn false;\r\n\tvar s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;\r\n\tif(s!=-1)\r\n\t\ttitle = title.substr(0,s);\r\n\treturn this.tiddlerExists(title) || this.isShadowTiddler(title);\r\n};\r\n\r\nTiddlyWiki.prototype.createTiddler = function(title)\r\n{\r\n\tvar tiddler = this.fetchTiddler(title);\r\n\tif(!tiddler) {\r\n\t\ttiddler = new Tiddler(title);\r\n\t\tthis.addTiddler(tiddler);\r\n\t\tthis.setDirty(true);\r\n\t}\r\n\treturn tiddler;\r\n};\r\n\r\nTiddlyWiki.prototype.getTiddler = function(title)\r\n{\r\n\tvar t = this.fetchTiddler(title);\r\n\tif(t != undefined)\r\n\t\treturn t;\r\n\telse\r\n\t\treturn null;\r\n};\r\n\r\nTiddlyWiki.prototype.getShadowTiddlerText = function(title)\r\n{\r\n\tif(typeof config.shadowTiddlers[title] == \"string\")\r\n\t\treturn config.shadowTiddlers[title];\r\n\telse\r\n\t\treturn \"\";\r\n};\r\n\r\n// Retrieve tiddler contents\r\nTiddlyWiki.prototype.getTiddlerText = function(title,defaultText)\r\n{\r\n\tif(!title)\r\n\t\treturn defaultText;\r\n\tvar pos = title.indexOf(config.textPrimitives.sectionSeparator);\r\n\tvar section = null;\r\n\tif(pos != -1) {\r\n\t\tsection = title.substr(pos + config.textPrimitives.sectionSeparator.length);\r\n\t\ttitle = title.substr(0,pos);\r\n\t}\r\n\tpos = title.indexOf(config.textPrimitives.sliceSeparator);\r\n\tif(pos != -1) {\r\n\t\tvar slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));\r\n\t\tif(slice)\r\n\t\t\treturn slice;\r\n\t}\r\n\tvar tiddler = this.fetchTiddler(title);\r\n\tvar text = tiddler ? tiddler.text : null;\r\n\tif(!tiddler && this.isShadowTiddler(title)) {\r\n\t\ttext = this.getShadowTiddlerText(title);\r\n\t}\r\n\tif(text) {\r\n\t\tif(!section)\r\n\t\t\treturn text;\r\n\t\tvar re = new RegExp(\"(^!{1,6}[ \\t]*\" + section.escapeRegExp() + \"[ \\t]*\\n)\",\"mg\");\r\n\t\tre.lastIndex = 0;\r\n\t\tvar match = re.exec(text);\r\n\t\tif(match) {\r\n\t\t\tvar t = text.substr(match.index+match[1].length);\r\n\t\t\tvar re2 = /^!/mg;\r\n\t\t\tre2.lastIndex = 0;\r\n\t\t\tmatch = re2.exec(t); //# search for the next heading\r\n\t\t\tif(match)\r\n\t\t\t\tt = t.substr(0,match.index-1);//# don't include final \\n\r\n\t\t\treturn t;\r\n\t\t}\r\n\t\treturn defaultText;\r\n\t}\r\n\tif(defaultText != undefined)\r\n\t\treturn defaultText;\r\n\treturn null;\r\n};\r\n\r\nTiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)\r\n{\r\n\tvar bracketRegExp = new RegExp(\"(?:\\\\[\\\\[([^\\\\]]+)\\\\]\\\\])\",\"mg\");\r\n\tvar text = this.getTiddlerText(title,null);\r\n\tif(text == null)\r\n\t\treturn defaultText;\r\n\tvar textOut = [];\r\n\tvar match,lastPos = 0;\r\n\tdo {\r\n\t\tmatch = bracketRegExp.exec(text);\r\n\t\tif(match) {\r\n\t\t\ttextOut.push(text.substr(lastPos,match.index-lastPos));\r\n\t\t\tif(match[1]) {\r\n\t\t\t\tif(depth <= 0)\r\n\t\t\t\t\ttextOut.push(match[1]);\r\n\t\t\t\telse\r\n\t\t\t\t\ttextOut.push(this.getRecursiveTiddlerText(match[1],\"\",depth-1));\r\n\t\t\t}\r\n\t\t\tlastPos = match.index + match[0].length;\r\n\t\t} else {\r\n\t\t\ttextOut.push(text.substr(lastPos));\r\n\t\t}\r\n\t} while(match);\r\n\treturn textOut.join(\"\");\r\n};\r\n\r\n//TiddlyWiki.prototype.slicesRE = /(?:^([\\'\\/]{0,2})~?([\\.\\w]+)\\:\\1[\\t\\x20]*([^\\n]+)[\\t\\x20]*$)|(?:^\\|([\\'\\/]{0,2})~?([\\.\\w]+)\\:?\\4\\|[\\t\\x20]*([^\\n]+)[\\t\\x20]*\\|$)/gm;\r\nTiddlyWiki.prototype.slicesRE = /(?:^([\\'\\/]{0,2})~?([\\.\\w]+)\\:\\1[\\t\\x20]*([^\\n]*)[\\t\\x20]*$)|(?:^\\|([\\'\\/]{0,2})~?([\\.\\w]+)\\:?\\4\\|[\\t\\x20]*([^\\|\\n]*)[\\t\\x20]*\\|$)/gm;\r\n// @internal\r\nTiddlyWiki.prototype.calcAllSlices = function(title)\r\n{\r\n\tvar slices = {};\r\n\tvar text = this.getTiddlerText(title,\"\");\r\n\tthis.slicesRE.lastIndex = 0;\r\n\tvar m = this.slicesRE.exec(text);\r\n\twhile(m) {\r\n\t\tif(m[2])\r\n\t\t\tslices[m[2]] = m[3];\r\n\t\telse\r\n\t\t\tslices[m[5]] = m[6];\r\n\t\tm = this.slicesRE.exec(text);\r\n\t}\r\n\treturn slices;\r\n};\r\n\r\n// Returns the slice of text of the given name\r\nTiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)\r\n{\r\n\tvar slices = this.slices[title];\r\n\tif(!slices) {\r\n\t\tslices = this.calcAllSlices(title);\r\n\t\tthis.slices[title] = slices;\r\n\t}\r\n\treturn slices[sliceName];\r\n};\r\n\r\n// Build an hashmap of the specified named slices of a tiddler\r\nTiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)\r\n{\r\n\tvar t,r = {};\r\n\tfor(t=0; t<sliceNames.length; t++) {\r\n\t\tvar slice = this.getTiddlerSlice(title,sliceNames[t]);\r\n\t\tif(slice)\r\n\t\t\tr[sliceNames[t]] = slice;\r\n\t}\r\n\treturn r;\r\n};\r\n\r\nTiddlyWiki.prototype.suspendNotifications = function()\r\n{\r\n\tthis.notificationLevel--;\r\n};\r\n\r\nTiddlyWiki.prototype.resumeNotifications = function()\r\n{\r\n\tthis.notificationLevel++;\r\n};\r\n\r\n// Invoke the notification handlers for a particular tiddler\r\nTiddlyWiki.prototype.notify = function(title,doBlanket)\r\n{\r\n\tif(!this.notificationLevel) {\r\n\t    var t;\r\n\t\tfor(t=0; t<this.namedNotifications.length; t++) {\r\n\t\t\tvar n = this.namedNotifications[t];\r\n\t\t\tif((n.name == null && doBlanket) || (n.name == title))\r\n\t\t\t\tn.notify(title);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n// Invoke the notification handlers for all tiddlers\r\nTiddlyWiki.prototype.notifyAll = function()\r\n{\r\n\tif(!this.notificationLevel) {\r\n\t    var t;\r\n\t\tfor(t=0; t<this.namedNotifications.length; t++) {\r\n\t\t\tvar n = this.namedNotifications[t];\r\n\t\t\tif(n.name)\r\n\t\t\t\tn.notify(n.name);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n// Add a notification handler to a tiddler\r\nTiddlyWiki.prototype.addNotification = function(title,fn)\r\n{\r\n\tvar i;\r\n\tfor(i=0; i<this.namedNotifications.length; i++) {\r\n\t\tif((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))\r\n\t\t\treturn this;\r\n\t}\r\n\tthis.namedNotifications.push({name: title, notify: fn});\r\n\treturn this;\r\n};\r\n\r\nTiddlyWiki.prototype.removeTiddler = function(title)\r\n{\r\n\tvar tiddler = this.fetchTiddler(title);\r\n\tif(tiddler) {\r\n\t\tthis.deleteTiddler(title);\r\n\t\tthis.notify(title,true);\r\n\t\tthis.setDirty(true);\r\n\t}\r\n};\r\n\r\n// Reset the sync status of a freshly synced tiddler\r\nTiddlyWiki.prototype.resetTiddler = function(title)\r\n{\r\n\tvar tiddler = this.fetchTiddler(title);\r\n\tif(tiddler) {\r\n\t\ttiddler.clearChangeCount();\r\n\t\tthis.notify(title,true);\r\n\t\tthis.setDirty(true);\r\n\t}\r\n};\r\n\r\nTiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)\r\n{\r\n\tvar tiddler = this.fetchTiddler(title);\r\n\tif(tiddler) {\r\n\t\tvar t = tiddler.tags.indexOf(tag);\r\n\t\tif(t != -1)\r\n\t\t\ttiddler.tags.splice(t,1);\r\n\t\tif(status)\r\n\t\t\ttiddler.tags.push(tag);\r\n\t\ttiddler.changed();\r\n\t\ttiddler.incChangeCount();\r\n\t\tthis.notify(title,true);\r\n\t\tthis.setDirty(true);\r\n\t}\r\n};\r\n\r\nTiddlyWiki.prototype.addTiddlerFields = function(title,fields)\r\n{\r\n\tvar tiddler = this.fetchTiddler(title);\r\n\tif(!tiddler)\r\n\t\treturn;\r\n\tmerge(tiddler.fields,fields);\r\n\ttiddler.changed();\r\n\ttiddler.incChangeCount();\r\n\tthis.notify(title,true);\r\n\tthis.setDirty(true);\r\n};\r\n\r\n// Store tiddler in TiddlyWiki instance\r\nTiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created,creator)\r\n{\r\n\tvar tiddler;\r\n\tif(title instanceof Tiddler) {\r\n\t\ttiddler = title;\r\n\t\ttiddler.fields = merge(merge({},tiddler.fields),config.defaultCustomFields,true);\r\n\t\ttitle = tiddler.title;\r\n\t\tnewTitle = title;\r\n\t} else {\r\n\t\ttiddler = this.fetchTiddler(title);\r\n\t\tif(tiddler) {\r\n\t\t\tcreated = created || tiddler.created; // Preserve created date\r\n\t\t\tcreator = creator || tiddler.creator;\r\n\t\t\tthis.deleteTiddler(title);\r\n\t\t} else {\r\n\t\t\tcreated = created || modified;\r\n\t\t\ttiddler = new Tiddler();\r\n\t\t}\r\n\t\tfields = merge(merge({},fields),config.defaultCustomFields,true);\r\n\t\ttiddler.set(newTitle,newBody,modifier,modified,tags,created,fields,creator);\r\n\t}\r\n\tthis.addTiddler(tiddler);\r\n\tif(clearChangeCount)\r\n\t\ttiddler.clearChangeCount();\r\n\telse\r\n\t\ttiddler.incChangeCount();\r\n\tif(title != newTitle)\r\n\t\tthis.notify(title,true);\r\n\tthis.notify(newTitle,true);\r\n\tthis.setDirty(true);\r\n\treturn tiddler;\r\n};\r\n\r\nTiddlyWiki.prototype.incChangeCount = function(title)\r\n{\r\n\tvar tiddler = this.fetchTiddler(title);\r\n\tif(tiddler)\r\n\t\ttiddler.incChangeCount();\r\n};\r\n\r\nTiddlyWiki.prototype.getLoader = function()\r\n{\r\n\tif(!this.loader)\r\n\t\tthis.loader = new TW21Loader();\r\n\treturn this.loader;\r\n};\r\n\r\nTiddlyWiki.prototype.getSaver = function()\r\n{\r\n\tif(!this.saver)\r\n\t\tthis.saver = new TW21Saver();\r\n\treturn this.saver;\r\n};\r\n\r\n// Return all tiddlers formatted as an HTML string\r\nTiddlyWiki.prototype.allTiddlersAsHtml = function()\r\n{\r\n\treturn this.getSaver().externalize(store);\r\n};\r\n\r\n// Load contents of a TiddlyWiki from an HTML DIV\r\nTiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)\r\n{\r\n\tthis.idPrefix = idPrefix;\r\n\tvar storeElem = (typeof src == \"string\") ? document.getElementById(src) : src;\r\n\tif(!storeElem)\r\n\t\treturn;\r\n\tvar tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);\r\n\tthis.setDirty(false);\r\n\tif(!noUpdate) {\r\n\t\tvar i;\r\n\t\tfor(i = 0;i<tiddlers.length; i++)\r\n\t\t\ttiddlers[i].changed();\r\n\t}\r\n\tjQuery(document).trigger(\"loadTiddlers\");\r\n};\r\n\r\n// Load contents of a TiddlyWiki from a string\r\n// Returns null if there's an error\r\nTiddlyWiki.prototype.importTiddlyWiki = function(text)\r\n{\r\n\tvar posDiv = locateStoreArea(text);\r\n\tif(!posDiv)\r\n\t\treturn null;\r\n\tvar content = \"<\" + \"html><\" + \"body>\" + text.substring(posDiv[0],posDiv[1] + endSaveArea.length) + \"<\" + \"/body><\" + \"/html>\";\r\n\t// Create the iframe\r\n\tvar iframe = document.createElement(\"iframe\");\r\n\tiframe.style.display = \"none\";\r\n\tdocument.body.appendChild(iframe);\r\n\tvar doc = iframe.document;\r\n\tif(iframe.contentDocument)\r\n\t\tdoc = iframe.contentDocument; // For NS6\r\n\telse if(iframe.contentWindow)\r\n\t\tdoc = iframe.contentWindow.document; // For IE5.5 and IE6\r\n\t// Put the content in the iframe\r\n\tdoc.open();\r\n\tdoc.writeln(content);\r\n\tdoc.close();\r\n\t// Load the content into a TiddlyWiki() object\r\n\tvar storeArea = doc.getElementById(\"storeArea\");\r\n\tthis.loadFromDiv(storeArea,\"store\");\r\n\t// Get rid of the iframe\r\n\tiframe.parentNode.removeChild(iframe);\r\n\treturn this;\r\n};\r\n\r\nTiddlyWiki.prototype.updateTiddlers = function()\r\n{\r\n\tthis.tiddlersUpdated = true;\r\n\tthis.forEachTiddler(function(title,tiddler) {\r\n\t\ttiddler.changed();\r\n\t});\r\n};\r\n\r\n// Return an array of tiddlers matching a search regular expression\r\nTiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag,match)\r\n{\r\n\tvar candidates = this.reverseLookup(\"tags\",excludeTag,!!match);\r\n\tvar t,results = [];\r\n\tfor(t=0; t<candidates.length; t++) {\r\n\t\tif((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))\r\n\t\t\tresults.push(candidates[t]);\r\n\t}\r\n\tif(!sortField)\r\n\t\tsortField = \"title\";\r\n\tresults.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});\r\n\treturn results;\r\n};\r\n\r\n// Returns a list of all tags in use\r\n//   excludeTag - if present, excludes tags that are themselves tagged with excludeTag\r\n// Returns an array of arrays where [tag][0] is the name of the tag and [tag][1] is the number of occurances\r\nTiddlyWiki.prototype.getTags = function(excludeTag)\r\n{\r\n\tvar results = [];\r\n\tthis.forEachTiddler(function(title,tiddler) {\r\n\t    var g,c;\r\n\t\tfor(g=0; g<tiddler.tags.length; g++) {\r\n\t\t\tvar tag = tiddler.tags[g];\r\n\t\t\tvar n = true;\r\n\t\t\tfor(c=0; c<results.length; c++) {\r\n\t\t\t\tif(results[c][0] == tag) {\r\n\t\t\t\t\tn = false;\r\n\t\t\t\t\tresults[c][1]++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(n && excludeTag) {\r\n\t\t\t\tvar t = this.fetchTiddler(tag);\r\n\t\t\t\tif(t && t.isTagged(excludeTag))\r\n\t\t\t\t\tn = false;\r\n\t\t\t}\r\n\t\t\tif(n)\r\n\t\t\t\tresults.push([tag,1]);\r\n\t\t}\r\n\t});\r\n\tresults.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});\r\n\treturn results;\r\n};\r\n\r\n// Return an array of the tiddlers that are tagged with a given tag\r\nTiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)\r\n{\r\n\treturn this.reverseLookup(\"tags\",tag,true,sortField);\r\n};\r\n\r\nTiddlyWiki.prototype.getValueTiddlers = function(field,value,sortField)\r\n{\r\n\treturn this.reverseLookup(field,value,true,sortField);\r\n};\r\n\r\n// Return an array of the tiddlers that link to a given tiddler\r\nTiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)\r\n{\r\n\tif(!this.tiddlersUpdated)\r\n\t\tthis.updateTiddlers();\r\n\treturn this.reverseLookup(\"links\",title,true,sortField);\r\n};\r\n\r\n// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, \"links\" or \"tags\")\r\n// lookupMatch == true to match tiddlers, false to exclude tiddlers\r\nTiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)\r\n{\r\n\tvar results = [];\r\n\tthis.forEachTiddler(function(title,tiddler) {\r\n\t\tvar f = !lookupMatch;\r\n\t\tvar values;\r\n\t\tif([\"links\", \"tags\"].contains(lookupField)) {\r\n\t\t\tvalues = tiddler[lookupField];\r\n\t\t} else {\r\n\t\t\tvar accessor = TiddlyWiki.standardFieldAccess[lookupField];\r\n\t\t\tif(accessor) {\r\n\t\t\t\tvalues = [ accessor.get(tiddler) ];\r\n\t\t\t} else {\r\n\t\t\t\tvalues = tiddler.fields[lookupField] ? [tiddler.fields[lookupField]] : [];\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar lookup;\r\n\t\tfor(lookup=0; lookup<values.length; lookup++) {\r\n\t\t\tif(values[lookup] == lookupValue)\r\n\t\t\t\tf = lookupMatch;\r\n\t\t}\r\n\t\tif(f)\r\n\t\t\tresults.push(tiddler);\r\n\t});\r\n\tif(!sortField)\r\n\t\tsortField = \"title\";\r\n\treturn this.sortTiddlers(results,sortField);\r\n};\r\n\r\n// Return the tiddlers as a sorted array\r\nTiddlyWiki.prototype.getTiddlers = function(field,excludeTag)\r\n{\r\n\tvar results = [];\r\n\tthis.forEachTiddler(function(title,tiddler) {\r\n\t\tif(excludeTag == undefined || !tiddler.isTagged(excludeTag))\r\n\t\t\tresults.push(tiddler);\r\n\t});\r\n\tif(field)\r\n\t\tresults.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});\r\n\treturn results;\r\n};\r\n\r\n// Return array of names of tiddlers that are referred to but not defined\r\nTiddlyWiki.prototype.getMissingLinks = function()\r\n{\r\n\tif(!this.tiddlersUpdated)\r\n\t\tthis.updateTiddlers();\r\n\tvar results = [];\r\n\tthis.forEachTiddler(function (title,tiddler) {\r\n\t\tif(tiddler.isTagged(\"excludeMissing\") || tiddler.isTagged(\"systemConfig\"))\r\n\t\t\treturn;\r\n\t\tvar n;\r\n\t\tfor(n=0; n<tiddler.links.length;n++) {\r\n\t\t\tvar link = tiddler.links[n];\r\n\t\t\tif(this.getTiddlerText(link,null) == null && !this.isShadowTiddler(link) && !config.macros[link])\r\n\t\t\t\tresults.pushUnique(link);\r\n\t\t}\r\n\t});\r\n\tresults.sort();\r\n\treturn results;\r\n};\r\n\r\n// Return an array of names of tiddlers that are defined but not referred to\r\nTiddlyWiki.prototype.getOrphans = function()\r\n{\r\n\tvar results = [];\r\n\tthis.forEachTiddler(function (title,tiddler) {\r\n\t\tif(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged(\"excludeLists\"))\r\n\t\t\tresults.push(title);\r\n\t});\r\n\tresults.sort();\r\n\treturn results;\r\n};\r\n\r\n// Return an array of names of all the shadow tiddlers\r\nTiddlyWiki.prototype.getShadowed = function()\r\n{\r\n\tvar t,results = [];\r\n\tfor(t in config.shadowTiddlers) {\r\n\t\tif(this.isShadowTiddler(t))\r\n\t\t\tresults.push(t);\r\n\t}\r\n\tresults.sort();\r\n\treturn results;\r\n};\r\n\r\n// Return an array of tiddlers that have been touched since they were downloaded or created\r\nTiddlyWiki.prototype.getTouched = function()\r\n{\r\n\tvar results = [];\r\n\tthis.forEachTiddler(function(title,tiddler) {\r\n\t\tif(tiddler.isTouched())\r\n\t\t\tresults.push(tiddler);\r\n\t\t});\r\n\tresults.sort();\r\n\treturn results;\r\n};\r\n\r\n// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist\r\nTiddlyWiki.prototype.resolveTiddler = function(tiddler)\r\n{\r\n\tvar t = (typeof tiddler == \"string\") ? this.getTiddler(tiddler) : tiddler;\r\n\treturn t instanceof Tiddler ? t : null;\r\n};\r\n\r\n// Sort a list of tiddlers\r\nTiddlyWiki.prototype.sortTiddlers = function(tiddlers,field)\r\n{\r\n\tvar asc = +1;\r\n\tswitch(field.substr(0,1)) {\r\n\tcase \"-\":\r\n\t\tasc = -1;\r\n\t\tfield = field.substr(1);\r\n\t\tbreak;\r\n\tcase \"+\":\r\n\t\tfield = field.substr(1);\r\n\t\tbreak;\r\n\t}\r\n\tif(TiddlyWiki.standardFieldAccess[field]) {\r\n\t\tif(field==\"title\") {\r\n\t\t\ttiddlers.sort(function(a,b) {return a[field].toLowerCase() < b[field].toLowerCase() ? -asc : (a[field].toLowerCase() == b[field].toLowerCase() ? 0 : asc);});\r\n\t\t} else {\r\n\t\t\ttiddlers.sort(function(a,b) {return a[field] < b[field] ? -asc : (a[field] == b[field] ? 0 : asc);});\r\n\t\t}\r\n\t} else {\r\n\t\ttiddlers.sort(function(a,b) {return a.fields[field] < b.fields[field] ? -asc : (a.fields[field] == b.fields[field] ? 0 : +asc);});\r\n\t}\r\n\treturn tiddlers;\r\n};\r\n\r\n//--\r\n//-- Filter a list of tiddlers\r\n//--\r\n\r\nconfig.filters = {\r\n\ttiddler: function(results,match) {\r\n\t\tvar title = match[1]||match[4];\r\n\t\tvar tiddler = this.fetchTiddler(title);\r\n\t\tif(tiddler) {\r\n\t\t\tresults.pushUnique(tiddler);\r\n\t\t} else if(this.isShadowTiddler(title)) {\r\n\t\t\ttiddler = new Tiddler();\r\n\t\t\ttiddler.set(title,this.getTiddlerText(title));\r\n\t\t\tresults.pushUnique(tiddler);\r\n\t\t} else {\r\n\t\t\tresults.pushUnique(new Tiddler(title));\r\n\t\t}\r\n\t\treturn results;\r\n\t},\r\n\ttag: function(results,match) {\r\n\t\tvar m,matched = this.getTaggedTiddlers(match[3]);\r\n\t\tfor(m=0; m<matched.length; m++) {\r\n\t\t\tresults.pushUnique(matched[m]);\r\n\t\t}\r\n\t\treturn results;\r\n\t},\r\n\tsort: function(results,match) {\r\n\t\treturn this.sortTiddlers(results,match[3]);\r\n\t},\r\n\tlimit: function(results,match) {\r\n\t\treturn results.slice(0,parseInt(match[3],10));\r\n\t},\r\n\tfield: function(results,match) {\r\n\t\tvar m,matched = this.getValueTiddlers(match[2],match[3]);\r\n\t\tfor (m = 0; m < matched.length; m++) {\r\n\t\t\tresults.pushUnique(matched[m]);\r\n\t\t}\r\n\t\treturn results;\r\n\t}\r\n};\r\n\r\n// Filter a list of tiddlers\r\nTiddlyWiki.prototype.filterTiddlers = function(filter)\r\n{\r\n\tvar re = /([^\\s\\[\\]]+)|(?:\\[([ \\w\\.\\-]+)\\[([^\\]]+)\\]\\])|(?:\\[\\[([^\\]]+)\\]\\])/mg;\r\n\r\n\tvar results = [];\r\n\tif(filter) {\r\n\t\tvar match = re.exec(filter);\r\n\t\twhile(match) {\r\n\t\t\tvar handler = (match[1]||match[4])?'tiddler':config.filters[match[2]]?match[2]:'field';\r\n\t\t\tresults = config.filters[handler].call(this,results,match);\r\n\t\t\tmatch = re.exec(filter);\r\n\t\t}\r\n\t}\r\n\treturn results;\r\n};\r\n// Returns true if path is a valid field name (path),\r\n// i.e. a sequence of identifiers, separated by \".\"\r\nTiddlyWiki.isValidFieldName = function(name)\r\n{\r\n\tvar match = /[a-zA-Z_]\\w*(\\.[a-zA-Z_]\\w*)*/.exec(name);\r\n\treturn match && (match[0] == name);\r\n};\r\n\r\n// Throws an exception when name is not a valid field name.\r\nTiddlyWiki.checkFieldName = function(name)\r\n{\r\n\tif(!TiddlyWiki.isValidFieldName(name))\r\n\t\tthrow config.messages.invalidFieldName.format([name]);\r\n};\r\n\r\nfunction StringFieldAccess(n,readOnly)\r\n{\r\n\tthis.set = readOnly ?\r\n\t\t\tfunction(t,v) {if(v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :\r\n\t\t\tfunction(t,v) {if(v != t[n]) {t[n] = v; return true;}};\r\n\tthis.get = function(t) {return t[n];};\r\n}\r\n\r\nfunction DateFieldAccess(n)\r\n{\r\n\tthis.set = function(t,v) {\r\n\t\tvar d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);\r\n\t\tif(d != t[n]) {\r\n\t\t\tt[n] = d; return true;\r\n\t\t}\r\n\t};\r\n\tthis.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};\r\n}\r\n\r\nfunction LinksFieldAccess(n)\r\n{\r\n\tthis.set = function(t,v) {\r\n\t\tvar s = (typeof v == \"string\") ? v.readBracketedList() : v;\r\n\t\tif(s.toString() != t[n].toString()) {\r\n\t\t\tt[n] = s; return true;\r\n\t\t}\r\n\t};\r\n\tthis.get = function(t) {return String.encodeTiddlyLinkList(t[n]);};\r\n}\r\n\r\nTiddlyWiki.standardFieldAccess = {\r\n\t// The set functions return true when setting the data has changed the value.\r\n\t\"title\":    new StringFieldAccess(\"title\",true),\r\n\t// Handle the \"tiddler\" field name as the title\r\n\t\"tiddler\":  new StringFieldAccess(\"title\",true),\r\n\t\"text\":     new StringFieldAccess(\"text\"),\r\n\t\"modifier\": new StringFieldAccess(\"modifier\"),\r\n\t\"modified\": new DateFieldAccess(\"modified\"),\r\n\t\"creator\":  new StringFieldAccess(\"creator\"),\r\n\t\"created\":  new DateFieldAccess(\"created\"),\r\n\t\"tags\":     new LinksFieldAccess(\"tags\")\r\n};\r\n\r\nTiddlyWiki.isStandardField = function(name)\r\n{\r\n\treturn TiddlyWiki.standardFieldAccess[name] != undefined;\r\n};\r\n\r\n// Sets the value of the given field of the tiddler to the value.\r\n// Setting an ExtendedField's value to null or undefined removes the field.\r\n// Setting a namespace to undefined removes all fields of that namespace.\r\n// The fieldName is case-insensitive.\r\n// All values will be converted to a string value.\r\nTiddlyWiki.prototype.setValue = function(tiddler,fieldName,value)\r\n{\r\n\tTiddlyWiki.checkFieldName(fieldName);\r\n\tvar t = this.resolveTiddler(tiddler);\r\n\tif(!t)\r\n\t\treturn;\r\n\tfieldName = fieldName.toLowerCase();\r\n\tvar isRemove = (value === undefined) || (value === null);\r\n\tvar accessor = TiddlyWiki.standardFieldAccess[fieldName];\r\n\tif(accessor) {\r\n\t\tif(isRemove)\r\n\t\t\t// don't remove StandardFields\r\n\t\t\treturn;\r\n\t\tvar h = TiddlyWiki.standardFieldAccess[fieldName];\r\n\t\tif(!h.set(t,value))\r\n\t\t\treturn;\r\n\t} else {\r\n\t\tvar oldValue = t.fields[fieldName];\r\n\t\tif(isRemove) {\r\n\t\t\tif(oldValue !== undefined) {\r\n\t\t\t\t// deletes a single field\r\n\t\t\t\tdelete t.fields[fieldName];\r\n\t\t\t} else {\r\n\t\t\t\t// no concrete value is defined for the fieldName\r\n\t\t\t\t// so we guess this is a namespace path.\r\n\t\t\t\t// delete all fields in a namespace\r\n\t\t\t\tvar re = new RegExp(\"^\"+fieldName+\"\\\\.\");\r\n\t\t\t\tvar dirty = false;\r\n\t\t\t\tvar n;\r\n\t\t\t\tfor(n in t.fields) {\r\n\t\t\t\t\tif(n.match(re)) {\r\n\t\t\t\t\t\tdelete t.fields[n];\r\n\t\t\t\t\t\tdirty = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(!dirty)\r\n\t\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// the \"normal\" set case. value is defined (not null/undefined)\r\n\t\t\t// For convenience provide a nicer conversion Date->String\r\n\t\t\tvalue = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);\r\n\t\t\tif(oldValue == value)\r\n\t\t\t\treturn;\r\n\t\t\tt.fields[fieldName] = value;\r\n\t\t}\r\n\t}\r\n\t// When we are here the tiddler/store really was changed.\r\n\tthis.notify(t.title,true);\r\n\tif(!fieldName.match(/^temp\\./))\r\n\t\tthis.setDirty(true);\r\n};\r\n\r\n// Returns the value of the given field of the tiddler.\r\n// The fieldName is case-insensitive.\r\n// Will only return String values (or undefined).\r\nTiddlyWiki.prototype.getValue = function(tiddler,fieldName)\r\n{\r\n\tvar t = this.resolveTiddler(tiddler);\r\n\tif(!t)\r\n\t\treturn undefined;\r\n\tif(fieldName.indexOf(config.textPrimitives.sectionSeparator) === 0 || fieldName.indexOf(config.textPrimitives.sliceSeparator) === 0) {\r\n\t\tvar sliceType = fieldName.substr(0, 2);\r\n\t\tvar sliceName = fieldName.substring(2);\r\n\t\treturn store.getTiddlerText(\"%0%1%2\".format(t.title,sliceType,sliceName));\r\n\t} else {\r\n\t\tfieldName = fieldName.toLowerCase();\r\n\t\tvar accessor = TiddlyWiki.standardFieldAccess[fieldName];\r\n\t\tif(accessor) {\r\n\t\t\treturn accessor.get(t);\r\n\t\t}\r\n\t}\r\n\treturn t.fields[fieldName];\r\n};\r\n\r\n// Calls the callback function for every field in the tiddler.\r\n// When callback function returns a non-false value the iteration stops\r\n// and that value is returned.\r\n// The order of the fields is not defined.\r\n// @param callback a function(tiddler,fieldName,value).\r\nTiddlyWiki.prototype.forEachField = function(tiddler,callback,onlyExtendedFields)\r\n{\r\n\tvar t = this.resolveTiddler(tiddler);\r\n\tif(!t)\r\n\t\treturn undefined;\r\n\tvar n,result;\r\n\tfor(n in t.fields) {\r\n\t\tresult = callback(t,n,t.fields[n]);\r\n\t\tif(result)\r\n\t\t\treturn result;\r\n\t\t}\r\n\tif(onlyExtendedFields)\r\n\t\treturn undefined;\r\n\tfor(n in TiddlyWiki.standardFieldAccess) {\r\n\t\tif(n != \"tiddler\") {\r\n\t\t\t// even though the \"title\" field can also be referenced through the name \"tiddler\"\r\n\t\t\t// we only visit this field once.\r\n\t\t\tresult = callback(t,n,TiddlyWiki.standardFieldAccess[n].get(t));\r\n\t\t\tif(result)\r\n\t\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n\treturn undefined;\r\n};\r\n\r\n//--\r\n//-- Story functions\r\n//--\r\n\r\nfunction Story(containerId,idPrefix)\r\n{\r\n\tthis.container = containerId;\r\n\tthis.idPrefix = idPrefix;\r\n\tthis.highlightRegExp = null;\r\n\tthis.tiddlerId = function(title) {\r\n\t\ttitle = title.replace(/_/g, \"__\").replace(/ /g, \"_\");\r\n\t\tvar id = this.idPrefix + title;\r\n\t\treturn id==this.container ? this.idPrefix + \"_\" + title : id;\r\n\t};\r\n\tthis.containerId = function() {\r\n\t\treturn this.container;\r\n\t};\r\n}\r\n\r\nStory.prototype.getTiddler = function(title)\r\n{\r\n\treturn document.getElementById(this.tiddlerId(title));\r\n};\r\n\r\nStory.prototype.getContainer = function()\r\n{\r\n\treturn document.getElementById(this.containerId());\r\n};\r\n\r\nStory.prototype.forEachTiddler = function(fn)\r\n{\r\n\tvar place = this.getContainer();\r\n\tif(!place)\r\n\t\treturn;\r\n\tvar e = place.firstChild;\r\n\twhile(e) {\r\n\t\tvar n = e.nextSibling;\r\n\t\tvar title = e.getAttribute(\"tiddler\");\r\n\t\tif(title) {\r\n\t\t\tfn.call(this,title,e);\r\n\t\t}\r\n\t\te = n;\r\n\t}\r\n};\r\n\r\nStory.prototype.displayDefaultTiddlers = function()\r\n{\r\n\tthis.displayTiddlers(null,store.filterTiddlers(store.getTiddlerText(\"DefaultTiddlers\")));\r\n};\r\n\r\nStory.prototype.displayTiddlers = function(srcElement,titles,template,animate,unused,customFields,toggle)\r\n{\r\n\tvar t;\r\n\tfor(t = titles.length-1;t>=0;t--)\r\n\t\tthis.displayTiddler(srcElement,titles[t],template,animate,unused,customFields);\r\n};\r\n\r\nStory.prototype.displayTiddler = function(srcElement,tiddler,template,animate,unused,customFields,toggle,animationSrc)\r\n{\r\n\tvar title = (tiddler instanceof Tiddler) ? tiddler.title : tiddler;\r\n\tvar tiddlerElem = this.getTiddler(title);\r\n\tif(tiddlerElem) {\r\n\t\tif(toggle) {\r\n\t\t\tif(tiddlerElem.getAttribute(\"dirty\") != \"true\")\r\n\t\t\t\tthis.closeTiddler(title,true);\r\n\t\t} else {\r\n\t\t\tthis.refreshTiddler(title,template,false,customFields);\r\n\t\t}\r\n\t} else {\r\n\t\tvar place = this.getContainer();\r\n\t\tvar before = this.positionTiddler(srcElement);\r\n\t\ttiddlerElem = this.createTiddler(place,before,title,template,customFields);\r\n\t}\r\n\tif(animationSrc && typeof animationSrc !== \"string\") {\r\n\t\tsrcElement = animationSrc;\r\n\t}\r\n\tif(srcElement && typeof srcElement !== \"string\") {\r\n\t\tif(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Zoomer == \"function\" && typeof Scroller == \"function\")\r\n\t\t\tanim.startAnimating(new Zoomer(title,srcElement,tiddlerElem),new Scroller(tiddlerElem));\r\n\t\telse\r\n\t\t\twindow.scrollTo(0,ensureVisible(tiddlerElem));\r\n\t}\r\n\treturn tiddlerElem;\r\n};\r\n\r\nStory.prototype.positionTiddler = function(srcElement)\r\n{\r\n\tvar place = this.getContainer();\r\n\tvar before = null;\r\n\tif(typeof srcElement == \"string\") {\r\n\t\tswitch(srcElement) {\r\n\t\tcase \"top\":\r\n\t\t\tbefore = place.firstChild;\r\n\t\t\tbreak;\r\n\t\tcase \"bottom\":\r\n\t\t\tbefore = null;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t} else {\r\n\t\tvar after = this.findContainingTiddler(srcElement);\r\n\t\tif(after == null) {\r\n\t\t\tbefore = place.firstChild;\r\n\t\t} else if(after.nextSibling) {\r\n\t\t\tbefore = after.nextSibling;\r\n\t\t\tif(before.nodeType != 1)\r\n\t\t\t\tbefore = null;\r\n\t\t}\r\n\t}\r\n\treturn before;\r\n};\r\n\r\nStory.prototype.createTiddler = function(place,before,title,template,customFields)\r\n{\r\n\tvar tiddlerElem = createTiddlyElement(null,\"div\",this.tiddlerId(title),\"tiddler\");\r\n\ttiddlerElem.setAttribute(\"refresh\",\"tiddler\");\r\n\tif(customFields)\r\n\t\ttiddlerElem.setAttribute(\"tiddlyFields\",customFields);\r\n\tplace.insertBefore(tiddlerElem,before);\r\n\tvar defaultText = null;\r\n\tif(!store.tiddlerExists(title) && !store.isShadowTiddler(title))\r\n\t\tdefaultText = this.loadMissingTiddler(title,customFields);\r\n\tthis.refreshTiddler(title,template,false,customFields,defaultText);\r\n\treturn tiddlerElem;\r\n};\r\n\r\nStory.prototype.loadMissingTiddler = function(title,fields,callback)\r\n{\r\n\tvar getTiddlerCallback = function(context)\r\n\t{\r\n\t\tif(context.status) {\r\n\t\t\tvar t = context.tiddler;\r\n\t\t\tif(!t.created)\r\n\t\t\t\tt.created = new Date();\r\n\t\t\tif(!t.modified)\r\n\t\t\t\tt.modified = t.created;\r\n\t\t\tvar dirty = store.isDirty();\r\n\t\t\tcontext.tiddler = store.saveTiddler(t.title,t.title,t.text,t.modifier,t.modified,t.tags,t.fields,true,t.created,t.creator);\r\n\t\t\tif(!window.allowSave())\r\n\t\t\t\tstore.setDirty(dirty);\r\n\t\t\tautoSaveChanges();\r\n\t\t} else {\r\n\t\t\tstory.refreshTiddler(context.title,null,true);\r\n\t\t}\r\n\t\tcontext.adaptor.close();\r\n\t\tif(callback) {\r\n\t\t\tcallback(context);\r\n\t\t}\r\n\t};\r\n\tvar tiddler = new Tiddler(title);\r\n\ttiddler.fields = typeof fields == \"string\" ? fields.decodeHashMap() : fields||{};\r\n\tvar context = {serverType:tiddler.getServerType()};\r\n\tif(!context.serverType)\r\n\t\treturn \"\";\r\n\tcontext.host = tiddler.fields['server.host'];\r\n\tcontext.workspace = tiddler.fields['server.workspace'];\r\n\tvar adaptor = new config.adaptors[context.serverType]();\r\n\tadaptor.getTiddler(title,context,null,getTiddlerCallback);\r\n\treturn config.messages.loadingMissingTiddler.format([title,context.serverType,context.host,context.workspace]);\r\n};\r\n\r\nStory.prototype.chooseTemplateForTiddler = function(title,template)\r\n{\r\n\tif(!template)\r\n\t\ttemplate = DEFAULT_VIEW_TEMPLATE;\r\n\tif(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)\r\n\t\ttemplate = config.tiddlerTemplates[template];\r\n\treturn template;\r\n};\r\n\r\nStory.prototype.getTemplateForTiddler = function(title,template,tiddler)\r\n{\r\n\treturn store.getRecursiveTiddlerText(template,null,10);\r\n};\r\n\r\nStory.prototype.refreshTiddler = function(title,template,force,customFields,defaultText)\r\n{\r\n\tvar tiddlerElem = this.getTiddler(title);\r\n\tif(tiddlerElem) {\r\n\t\tif(tiddlerElem.getAttribute(\"dirty\") == \"true\" && !force)\r\n\t\t\treturn tiddlerElem;\r\n\t\ttemplate = this.chooseTemplateForTiddler(title,template);\r\n\t\tvar currTemplate = tiddlerElem.getAttribute(\"template\");\r\n\t\tif((template != currTemplate) || force) {\r\n\t\t\tvar tiddler = store.getTiddler(title);\r\n\t\t\tif(!tiddler) {\r\n\t\t\t\ttiddler = new Tiddler();\r\n\t\t\t\tif(store.isShadowTiddler(title)) {\r\n\t\t\t\t\tvar tags = [];\r\n\t\t\t\t\ttiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,tags,version.date);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar text = template==\"EditTemplate\" ?\r\n\t\t\t\t\t\t\t\tconfig.views.editor.defaultText.format([title]) :\r\n\t\t\t\t\t\t\t\tconfig.views.wikified.defaultText.format([title]);\r\n\t\t\t\t\ttext = defaultText || text;\r\n\t\t\t\t\tvar fields = customFields ? customFields.decodeHashMap() : null;\r\n\t\t\t\t\ttiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date,fields);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ttiddlerElem.setAttribute(\"tags\",tiddler.tags.join(\" \"));\r\n\t\t\ttiddlerElem.setAttribute(\"tiddler\",title);\r\n\t\t\ttiddlerElem.setAttribute(\"template\",template);\r\n\t\t\ttiddlerElem.onmouseover = this.onTiddlerMouseOver;\r\n\t\t\ttiddlerElem.onmouseout = this.onTiddlerMouseOut;\r\n\t\t\ttiddlerElem.ondblclick = this.onTiddlerDblClick;\r\n\t\t\ttiddlerElem[window.event?\"onkeydown\":\"onkeypress\"] = this.onTiddlerKeyPress;\r\n\t\t\ttiddlerElem.innerHTML = this.getTemplateForTiddler(title,template,tiddler);\r\n\t\t\tapplyHtmlMacros(tiddlerElem,tiddler);\r\n\t\t\tif(store.getTaggedTiddlers(title).length > 0)\r\n\t\t\t\tjQuery(tiddlerElem).addClass(\"isTag\");\r\n\t\t\telse\r\n\t\t\t\tjQuery(tiddlerElem).removeClass(\"isTag\");\r\n\t\t\tif(store.tiddlerExists(title)) {\r\n\t\t\t\tjQuery(tiddlerElem).removeClass(\"shadow\");\r\n\t\t\t\tjQuery(tiddlerElem).removeClass(\"missing\");\r\n\t\t\t} else {\r\n\t\t\t\tjQuery(tiddlerElem).addClass(store.isShadowTiddler(title) ? \"shadow\" : \"missing\");\r\n\t\t\t}\r\n\t\t\tif(customFields)\r\n\t\t\t\tthis.addCustomFields(tiddlerElem,customFields);\r\n\t\t}\r\n\t}\r\n\treturn tiddlerElem;\r\n};\r\n\r\nStory.prototype.addCustomFields = function(place,customFields)\r\n{\r\n\tvar fields = customFields.decodeHashMap();\r\n\tvar w = createTiddlyElement(place,\"div\",null,\"customFields\");\r\n\tw.style.display = \"none\";\r\n\tvar t;\r\n\tfor(t in fields) {\r\n\t\tvar e = document.createElement(\"input\");\r\n\t\te.setAttribute(\"type\",\"text\");\r\n\t\te.setAttribute(\"value\",fields[t]);\r\n\t\tw.appendChild(e);\r\n\t\te.setAttribute(\"edit\",t);\r\n\t}\r\n};\r\n\r\nStory.prototype.refreshAllTiddlers = function(force)\r\n{\r\n\tvar e = this.getContainer().firstChild;\r\n\twhile(e) {\r\n\t\tvar template = e.getAttribute(\"template\");\r\n\t\tif(template && e.getAttribute(\"dirty\") != \"true\") {\r\n\t\t\tthis.refreshTiddler(e.getAttribute(\"tiddler\"),force ? null : template,true);\r\n\t\t}\r\n\t\te = e.nextSibling;\r\n\t}\r\n};\r\n\r\nStory.prototype.onTiddlerMouseOver = function(e)\r\n{\r\n\tjQuery(this).addClass(\"selected\");\r\n};\r\n\r\nStory.prototype.onTiddlerMouseOut = function(e)\r\n{\r\n\tjQuery(this).removeClass(\"selected\");\r\n};\r\n\r\nStory.prototype.onTiddlerDblClick = function(ev)\r\n{\r\n\tvar e = ev || window.event;\r\n\tvar target = resolveTarget(e);\r\n\tif(target && target.nodeName.toLowerCase() != \"input\" && target.nodeName.toLowerCase() != \"textarea\") {\r\n\t\tif(document.selection && document.selection.empty)\r\n\t\t\tdocument.selection.empty();\r\n\t\tconfig.macros.toolbar.invokeCommand(this,\"defaultCommand\",e);\r\n\t\te.cancelBubble = true;\r\n\t\tif(e.stopPropagation) e.stopPropagation();\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nStory.prototype.onTiddlerKeyPress = function(ev)\r\n{\r\n\tvar e = ev || window.event;\r\n\tclearMessage();\r\n\tvar consume = false;\r\n\tvar title = this.getAttribute(\"tiddler\");\r\n\tvar target = resolveTarget(e);\r\n\tswitch(e.keyCode) {\r\n\tcase 9: // Tab\r\n\t\tvar ed = story.getTiddlerField(title,\"text\");\r\n\t\tif(target.tagName.toLowerCase() == \"input\" && ed.value==config.views.editor.defaultText.format([title])) {\r\n\t\t\t// moving from input field and editor still contains default text, so select it\r\n\t\t\ted.focus();\r\n\t\t\ted.select();\r\n\t\t\tconsume = true;\r\n\t\t}\r\n\t\tif(config.options.chkInsertTabs && target.tagName.toLowerCase() == \"textarea\") {\r\n\t\t\treplaceSelection(target,String.fromCharCode(9));\r\n\t\t\tconsume = true;\r\n\t\t}\r\n\t\tif(config.isOpera) {\r\n\t\t\ttarget.onblur = function() {\r\n\t\t\t\tthis.focus();\r\n\t\t\t\tthis.onblur = null;\r\n\t\t\t};\r\n\t\t}\r\n\t\tbreak;\r\n\tcase 13: // Ctrl-Enter\r\n\tcase 10: // Ctrl-Enter on IE PC\r\n\tcase 77: // Ctrl-Enter is \"M\" on some platforms\r\n\t\tif(e.ctrlKey) {\r\n\t\t\tblurElement(this);\r\n\t\t\tconfig.macros.toolbar.invokeCommand(this,\"defaultCommand\",e);\r\n\t\t\tconsume = true;\r\n\t\t}\r\n\t\tbreak;\r\n\tcase 27: // Escape\r\n\t\tblurElement(this);\r\n\t\tconfig.macros.toolbar.invokeCommand(this,\"cancelCommand\",e);\r\n\t\tconsume = true;\r\n\t\tbreak;\r\n\t}\r\n\te.cancelBubble = consume;\r\n\tif(consume) {\r\n\t\tif(e.stopPropagation) e.stopPropagation(); // Stop Propagation\r\n\t\te.returnValue = true; // Cancel The Event in IE\r\n\t\tif(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz\r\n\t}\r\n\treturn !consume;\r\n};\r\n\r\nStory.prototype.getTiddlerField = function(title,field)\r\n{\r\n\tvar tiddlerElem = this.getTiddler(title);\r\n\tvar e = null;\r\n\tif(tiddlerElem) {\r\n\t\tvar t,children = tiddlerElem.getElementsByTagName(\"*\");\r\n\t\tfor(t=0; t<children.length; t++) {\r\n\t\t\tvar c = children[t];\r\n\t\t\tif(c.tagName.toLowerCase() == \"input\" || c.tagName.toLowerCase() == \"textarea\") {\r\n\t\t\t\tif(!e)\r\n\t\t\t\t\te = c;\r\n\t\t\t\tif(c.getAttribute(\"edit\") == field)\r\n\t\t\t\t\te = c;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn e;\r\n};\r\n\r\nStory.prototype.focusTiddler = function(title,field)\r\n{\r\n\tvar e = this.getTiddlerField(title,field);\r\n\tif(e) {\r\n\t\te.focus();\r\n\t\te.select();\r\n\t}\r\n};\r\n\r\nStory.prototype.blurTiddler = function(title)\r\n{\r\n\tvar tiddlerElem = this.getTiddler(title);\r\n\tif(tiddlerElem && tiddlerElem.focus && tiddlerElem.blur) {\r\n\t\ttiddlerElem.focus();\r\n\t\ttiddlerElem.blur();\r\n\t}\r\n};\r\n\r\nStory.prototype.setTiddlerField = function(title,tag,mode,field)\r\n{\r\n\tvar c = this.getTiddlerField(title,field);\r\n\tvar tags = c.value.readBracketedList();\r\n\ttags.setItem(tag,mode);\r\n\tc.value = String.encodeTiddlyLinkList(tags);\r\n};\r\n\r\nStory.prototype.setTiddlerTag = function(title,tag,mode)\r\n{\r\n\tthis.setTiddlerField(title,tag,mode,\"tags\");\r\n};\r\n\r\nStory.prototype.closeTiddler = function(title,animate,unused)\r\n{\r\n\tvar tiddlerElem = this.getTiddler(title);\r\n\tif(tiddlerElem) {\r\n\t\tclearMessage();\r\n\t\tthis.scrubTiddler(tiddlerElem);\r\n\t\tif(config.options.chkAnimate && animate && anim && typeof Slider == \"function\")\r\n\t\t\tanim.startAnimating(new Slider(tiddlerElem,false,null,\"all\"));\r\n\t\telse {\r\n\t\t\tjQuery(tiddlerElem).remove();\r\n\t\t}\r\n\t}\r\n};\r\n\r\nStory.prototype.scrubTiddler = function(tiddlerElem)\r\n{\r\n\ttiddlerElem.id = null;\r\n};\r\n\r\nStory.prototype.setDirty = function(title,dirty)\r\n{\r\n\tvar tiddlerElem = this.getTiddler(title);\r\n\tif(tiddlerElem)\r\n\t\ttiddlerElem.setAttribute(\"dirty\",dirty ? \"true\" : \"false\");\r\n};\r\n\r\nStory.prototype.isDirty = function(title)\r\n{\r\n\tvar tiddlerElem = this.getTiddler(title);\r\n\tif(tiddlerElem)\r\n\t\treturn tiddlerElem.getAttribute(\"dirty\") == \"true\";\r\n\treturn null;\r\n};\r\n\r\nStory.prototype.areAnyDirty = function()\r\n{\r\n\tvar r = false;\r\n\tthis.forEachTiddler(function(title,element) {\r\n\t\tif(this.isDirty(title))\r\n\t\t\tr = true;\r\n\t});\r\n\treturn r;\r\n};\r\n\r\nStory.prototype.closeAllTiddlers = function(exclude)\r\n{\r\n\tclearMessage();\r\n\tthis.forEachTiddler(function(title,element) {\r\n\t\tif((title != exclude) && element.getAttribute(\"dirty\") != \"true\")\r\n\t\t\tthis.closeTiddler(title);\r\n\t});\r\n\twindow.scrollTo(0,ensureVisible(this.container));\r\n};\r\n\r\nStory.prototype.isEmpty = function()\r\n{\r\n\tvar place = this.getContainer();\r\n\treturn place && place.firstChild == null;\r\n};\r\n\r\nStory.prototype.search = function(text,useCaseSensitive,useRegExp)\r\n{\r\n\tthis.closeAllTiddlers();\r\n\thighlightHack = new RegExp(useRegExp ? text : text.escapeRegExp(),useCaseSensitive ? \"mg\" : \"img\");\r\n\tvar matches = store.search(highlightHack,\"title\",\"excludeSearch\");\r\n\tthis.displayTiddlers(null,matches);\r\n\thighlightHack = null;\r\n\tvar q = useRegExp ? \"/\" : \"'\";\r\n\tif(matches.length > 0)\r\n\t\tdisplayMessage(config.macros.search.successMsg.format([matches.length.toString(),q + text + q]));\r\n\telse\r\n\t\tdisplayMessage(config.macros.search.failureMsg.format([q + text + q]));\r\n};\r\n\r\nStory.prototype.findContainingTiddler = function(e)\r\n{\r\n\twhile(e && !jQuery(e).hasClass(\"tiddler\")) {\r\n\t\te = jQuery(e).hasClass(\"popup\") && Popup.stack[0] ? Popup.stack[0].root : e.parentNode;\r\n\t}\r\n\treturn e;\r\n};\r\n\r\nStory.prototype.gatherSaveFields = function(e,fields)\r\n{\r\n\tif(e && e.getAttribute) {\r\n\t\tvar f = e.getAttribute(\"edit\");\r\n\t\tif(f)\r\n\t\t\tfields[f] = e.value.replace(/\\r/mg,\"\");\r\n\t\tif(e.hasChildNodes()) {\r\n\t\t\tvar t,c = e.childNodes;\r\n\t\t\tfor(t=0; t<c.length; t++)\r\n\t\t\t\tthis.gatherSaveFields(c[t],fields);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nStory.prototype.hasChanges = function(title)\r\n{\r\n\tvar e = this.getTiddler(title);\r\n\tif(e) {\r\n\t\tvar fields = {};\r\n\t\tthis.gatherSaveFields(e,fields);\r\n\t\tif(store.fetchTiddler(title)) {\r\n\t\t    var n;\r\n\t\t\tfor(n in fields) {\r\n\t\t\t\tif(store.getValue(title,n) != fields[n]) //# tiddler changed\r\n\t\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(store.isShadowTiddler(title) && store.getShadowTiddlerText(title) == fields.text) { //# not checking for title or tags\r\n\t\t\t\treturn false;\r\n\t\t\t} else { //# changed shadow or new tiddler\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nStory.prototype.saveTiddler = function(title,minorUpdate)\r\n{\r\n\tvar tiddlerElem = this.getTiddler(title);\r\n\tif(tiddlerElem) {\r\n\t\tvar fields = {};\r\n\t\tthis.gatherSaveFields(tiddlerElem,fields);\r\n\t\tvar newTitle = fields.title || title;\r\n\t\tif(!store.tiddlerExists(newTitle)) {\r\n\t\t\tnewTitle = newTitle.trim();\r\n\t\t\tvar creator = config.options.txtUserName;\r\n\t\t}\r\n\t\tif(store.tiddlerExists(newTitle) && newTitle != title) {\r\n\t\t\tif(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))\r\n\t\t\t\treturn null;\r\n\t\t\t\ttitle = newTitle;\r\n\t\t}\r\n\t\tif(newTitle != title)\r\n\t\t\tthis.closeTiddler(newTitle,false);\r\n\t\ttiddlerElem.id = this.tiddlerId(newTitle);\r\n\t\ttiddlerElem.setAttribute(\"tiddler\",newTitle);\r\n\t\ttiddlerElem.setAttribute(\"template\",DEFAULT_VIEW_TEMPLATE);\r\n\t\ttiddlerElem.setAttribute(\"dirty\",\"false\");\r\n\t\tif(config.options.chkForceMinorUpdate)\r\n\t\t\tminorUpdate = !minorUpdate;\r\n\t\tif(!store.tiddlerExists(newTitle))\r\n\t\t\tminorUpdate = false;\r\n\t\tvar newDate = new Date();\r\n\t\tif(store.tiddlerExists(title)) {\r\n\t\t\tvar t = store.fetchTiddler(title);\r\n\t\t\tvar extendedFields = t.fields;\r\n\t\t\tcreator = t.creator;\r\n\t\t} else {\r\n\t\t\textendedFields = merge({},config.defaultCustomFields);\r\n\t\t}\r\n\t\tvar n;\r\n\t\tfor(n in fields) {\r\n\t\t\tif(!TiddlyWiki.isStandardField(n))\r\n\t\t\t\textendedFields[n] = fields[n];\r\n\t\t}\r\n\t\tvar tiddler = store.saveTiddler(title,newTitle,fields.text,minorUpdate ? undefined : config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags,extendedFields,null,null,creator);\r\n\t\tautoSaveChanges(null,[tiddler]);\r\n\t\treturn newTitle;\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nStory.prototype.permaView = function()\r\n{\r\n\tvar links = [];\r\n\tthis.forEachTiddler(function(title,element) {\r\n\t\tlinks.push(String.encodeTiddlyLink(title));\r\n\t});\r\n\tvar t = encodeURIComponent(links.join(\" \"));\r\n\tif(t == \"\")\r\n\t\tt = \"#\";\r\n\tif(window.location.hash != t)\r\n\t\twindow.location.hash = t;\r\n};\r\n\r\nStory.prototype.switchTheme = function(theme)\r\n{\r\n\tif(safeMode)\r\n\t\treturn;\r\n\r\n\tvar getSlice = function(theme,slice) {\r\n\t\tvar r;\r\n\t\tif(readOnly)\r\n\t\t\tr = store.getTiddlerSlice(theme,slice+\"ReadOnly\") || store.getTiddlerSlice(theme,\"Web\"+slice);\r\n\t\tr = r || store.getTiddlerSlice(theme,slice);\r\n\t\tif(r && r.indexOf(config.textPrimitives.sectionSeparator)==0)\r\n\t\t\tr = theme + r;\r\n\t\treturn store.isAvailable(r) ? r : slice;\r\n\t};\r\n\r\n\tvar replaceNotification = function(i,name,theme,slice) {\r\n\t\tvar newName = getSlice(theme,slice);\r\n\t\tif(name!=newName && store.namedNotifications[i].name==name) {\r\n\t\t\tstore.namedNotifications[i].name = newName;\r\n\t\t\treturn newName;\r\n\t\t}\r\n\t\treturn name;\r\n\t};\r\n\r\n\tvar pt = config.refresherData.pageTemplate;\r\n\tvar vi = DEFAULT_VIEW_TEMPLATE;\r\n\tvar vt = config.tiddlerTemplates[vi];\r\n\tvar ei = DEFAULT_EDIT_TEMPLATE;\r\n\tvar et = config.tiddlerTemplates[ei];\r\n\r\n\tvar i;\r\n\tfor(i=0; i<config.notifyTiddlers.length; i++) {\r\n\t\tvar name = config.notifyTiddlers[i].name;\r\n\t\tswitch(name) {\r\n\t\tcase \"PageTemplate\":\r\n\t\t\tconfig.refresherData.pageTemplate = replaceNotification(i,config.refresherData.pageTemplate,theme,name);\r\n\t\t\tbreak;\r\n\t\tcase \"StyleSheet\":\r\n\t\t\tremoveStyleSheet(config.refresherData.styleSheet);\r\n\t\t\tconfig.refresherData.styleSheet = replaceNotification(i,config.refresherData.styleSheet,theme,name);\r\n\t\t\tbreak;\r\n\t\tcase \"ColorPalette\":\r\n\t\t\tconfig.refresherData.colorPalette = replaceNotification(i,config.refresherData.colorPalette,theme,name);\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tconfig.tiddlerTemplates[vi] = getSlice(theme,\"ViewTemplate\");\r\n\tconfig.tiddlerTemplates[ei] = getSlice(theme,\"EditTemplate\");\r\n\tif(!startingUp) {\r\n\t\tif(config.refresherData.pageTemplate!=pt || config.tiddlerTemplates[vi]!=vt || config.tiddlerTemplates[ei]!=et) {\r\n\t\t\trefreshAll();\r\n\t\t\tthis.refreshAllTiddlers(true);\r\n\t\t} else {\r\n\t\t\tsetStylesheet(store.getRecursiveTiddlerText(config.refresherData.styleSheet,\"\",10),config.refreshers.styleSheet);\r\n\t\t}\r\n\t\tconfig.options.txtTheme = theme;\r\n\t\tsaveOption(\"txtTheme\");\r\n\t}\r\n};\r\n\r\n//--\r\n//-- Backstage\r\n//--\r\n// Backstage tasks\r\nconfig.tasks.save.action = saveChanges;\r\n\r\nvar backstage = {\r\n\tarea: null,\r\n\ttoolbar: null,\r\n\tbutton: null,\r\n\tshowButton: null,\r\n\thideButton: null,\r\n\tcloak: null,\r\n\tpanel: null,\r\n\tpanelBody: null,\r\n\tpanelFooter: null,\r\n\tcurrTabName: null,\r\n\tcurrTabElem: null,\r\n\tcontent: null,\r\n\r\n\tinit: function() {\r\n\t\tvar cmb = config.messages.backstage;\r\n\t\tthis.area = document.getElementById(\"backstageArea\");\r\n\t\tthis.toolbar = jQuery(\"#backstageToolbar\").empty()[0];\r\n\t\tthis.button = jQuery(\"#backstageButton\").empty()[0];\r\n\t\tthis.button.style.display = \"block\";\r\n\t\tvar t = cmb.open.text + \" \" + glyph(\"bentArrowLeft\");\r\n\t\tthis.showButton = createTiddlyButton(this.button,t,cmb.open.tooltip,\r\n\t\t\t\t\t\tfunction(e) {backstage.show(); return false;},null,\"backstageShow\");\r\n\t\tt = glyph(\"bentArrowRight\") + \" \" + cmb.close.text;\r\n\t\tthis.hideButton = createTiddlyButton(this.button,t,cmb.close.tooltip,\r\n\t\t\t\t\t\tfunction(e) {backstage.hide(); return false;},null,\"backstageHide\");\r\n\t\tthis.cloak = document.getElementById(\"backstageCloak\");\r\n\t\tthis.panel = document.getElementById(\"backstagePanel\");\r\n\t\tthis.panelFooter = createTiddlyElement(this.panel,\"div\",null,\"backstagePanelFooter\");\r\n\t\tthis.panelBody = createTiddlyElement(this.panel,\"div\",null,\"backstagePanelBody\");\r\n\t\tthis.cloak.onmousedown = function(e) {backstage.switchTab(null);};\r\n\t\tcreateTiddlyText(this.toolbar,cmb.prompt);\r\n\t\tfor(t=0; t<config.backstageTasks.length; t++) {\r\n\t\t\tvar taskName = config.backstageTasks[t];\r\n\t\t\tvar task = config.tasks[taskName];\r\n\t\t\tvar handler = task.action ? this.onClickCommand : this.onClickTab;\r\n\t\t\tvar text = task.text + (task.action ? \"\" : glyph(\"downTriangle\"));\r\n\t\t\tvar btn = createTiddlyButton(this.toolbar,text,task.tooltip,handler,\"backstageTab\");\r\n\t\t\tjQuery(btn).addClass(task.action ? \"backstageAction\" : \"backstageTask\");\r\n\t\t\tbtn.setAttribute(\"task\", taskName);\r\n\t\t\t}\r\n\t\tthis.content = document.getElementById(\"contentWrapper\");\r\n\t\tif(config.options.chkBackstage)\r\n\t\t\tthis.show();\r\n\t\telse\r\n\t\t\tthis.hide();\r\n\t},\r\n\r\n\tisVisible: function() {\r\n\t\treturn this.area ? this.area.style.display == \"block\" : false;\r\n\t},\r\n\r\n\tshow: function() {\r\n\t\tthis.area.style.display = \"block\";\r\n\t\tif(anim && config.options.chkAnimate) {\r\n\t\t\tbackstage.toolbar.style.left = findWindowWidth() + \"px\";\r\n\t\t\tvar p = [{style: \"left\", start: findWindowWidth(), end: 0, template: \"%0px\"}];\r\n\t\t\tanim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));\r\n\t\t} else {\r\n\t\t\tbackstage.area.style.left = \"0px\";\r\n\t\t}\r\n\t\tjQuery(this.showButton).hide();\r\n\t\tjQuery(this.hideButton).show();\r\n\t\tconfig.options.chkBackstage = true;\r\n\t\tsaveOption(\"chkBackstage\");\r\n\t\tjQuery(this.content).addClass(\"backstageVisible\");\r\n\t},\r\n\r\n\thide: function() {\r\n\t\tif(this.currTabElem) {\r\n\t\t\tthis.switchTab(null);\r\n\t\t} else {\r\n\t\t\tbackstage.toolbar.style.left = \"0px\";\r\n\t\t\tif(anim && config.options.chkAnimate) {\r\n\t\t\t\tvar p = [{style: \"left\", start: 0, end: findWindowWidth(), template: \"%0px\"}];\r\n\t\t\t\tvar c = function(element,properties) {backstage.area.style.display = \"none\";};\r\n\t\t\t\tanim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));\r\n\t\t\t} else {\r\n\t\t\t\tthis.area.style.display = \"none\";\r\n\t\t\t}\r\n\t\t\tthis.showButton.style.display = \"block\";\r\n\t\t\tthis.hideButton.style.display = \"none\";\r\n\t\t\tconfig.options.chkBackstage = false;\r\n\t\t\tsaveOption(\"chkBackstage\");\r\n\t\t\tjQuery(this.content).removeClass(\"backstageVisible\");\r\n\t\t}\r\n\t},\r\n\r\n\tonClickCommand: function(e) {\r\n\t\tvar task = config.tasks[this.getAttribute(\"task\")];\r\n\t\tif(task.action) {\r\n\t\t\tbackstage.switchTab(null);\r\n\t\t\ttask.action();\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\tonClickTab: function(e) {\r\n\t\tbackstage.switchTab(this.getAttribute(\"task\"));\r\n\t\treturn false;\r\n\t},\r\n\r\n\t// Switch to a given tab, or none if null is passed\r\n\tswitchTab: function(tabName) {\r\n\t\tvar tabElem = null;\r\n\t\tvar e = this.toolbar.firstChild;\r\n\t\twhile(e) {\r\n\t\t\tif(e.getAttribute && e.getAttribute(\"task\") == tabName)\r\n\t\t\t\ttabElem = e;\r\n\t\t\te = e.nextSibling;\r\n\t\t}\r\n\t\tif(tabName == backstage.currTabName) {\r\n\t\t\tbackstage.hidePanel();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(backstage.currTabElem) {\r\n\t\t\tjQuery(this.currTabElem).removeClass(\"backstageSelTab\");\r\n\t\t}\r\n\t\tif(tabElem && tabName) {\r\n\t\t\tbackstage.preparePanel();\r\n\t\t\tjQuery(tabElem).addClass(\"backstageSelTab\");\r\n\t\t\tvar task = config.tasks[tabName];\r\n\t\t\twikify(task.content,backstage.panelBody,null,null);\r\n\t\t\tbackstage.showPanel();\r\n\t\t} else if(backstage.currTabElem) {\r\n\t\t\tbackstage.hidePanel();\r\n\t\t}\r\n\t\tbackstage.currTabName = tabName;\r\n\t\tbackstage.currTabElem = tabElem;\r\n\t},\r\n\r\n\tisPanelVisible: function() {\r\n\t\treturn backstage.panel ? backstage.panel.style.display == \"block\" : false;\r\n\t},\r\n\r\n\tpreparePanel: function() {\r\n\t\tbackstage.cloak.style.height = findDocHeight() + \"px\";\r\n\t\tbackstage.cloak.style.display = \"block\";\r\n\t\tjQuery(backstage.panelBody).empty();\r\n\t\treturn backstage.panelBody;\r\n\t},\r\n\r\n\tshowPanel: function() {\r\n\t\tbackstage.panel.style.display = \"block\";\r\n\t\tif(anim && config.options.chkAnimate) {\r\n\t\t\tbackstage.panel.style.top = (-backstage.panel.offsetHeight) + \"px\";\r\n\t\t\tvar p = [{style: \"top\", start: -backstage.panel.offsetHeight, end: 0, template: \"%0px\"}];\r\n\t\t\tanim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));\r\n\t\t} else {\r\n\t\t\tbackstage.panel.style.top = \"0px\";\r\n\t\t}\r\n\t\treturn backstage.panelBody;\r\n\t},\r\n\r\n\thidePanel: function() {\r\n\t\tif(backstage.currTabElem)\r\n\t\t\tjQuery(backstage.currTabElem).removeClass(\"backstageSelTab\");\r\n\t\tbackstage.currTabElem = null;\r\n\t\tbackstage.currTabName = null;\r\n\t\tif(anim && config.options.chkAnimate) {\r\n\t\t\tvar p = [\r\n\t\t\t\t{style: \"top\", start: 0, end: -(backstage.panel.offsetHeight), template: \"%0px\"},\r\n\t\t\t\t{style: \"display\", atEnd: \"none\"}\r\n\t\t\t];\r\n\t\t\tvar c = function(element,properties) {backstage.cloak.style.display = \"none\";};\r\n\t\t\tanim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));\r\n\t\t} else {\r\n\t\t\tjQuery([backstage.panel,backstage.cloak]).hide();\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconfig.macros.backstage = {};\r\n\r\nconfig.macros.backstage.handler = function(place,macroName,params)\r\n{\r\n\tvar backstageTask = config.tasks[params[0]];\r\n\tif(backstageTask)\r\n\t\tcreateTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {backstage.switchTab(params[0]); return false;});\r\n};\r\n\r\n//--\r\n//-- ImportTiddlers macro\r\n//--\r\n\r\nconfig.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)\r\n{\r\n\tif(readOnly) {\r\n\t\tcreateTiddlyElement(place,\"div\",null,\"marked\",this.readOnlyWarning);\r\n\t\treturn;\r\n\t}\r\n\tvar w = new Wizard();\r\n\tw.createWizard(place,this.wizardTitle);\r\n\tthis.restart(w);\r\n};\r\n\r\nconfig.macros.importTiddlers.onCancel = function(e)\r\n{\r\n\tvar wizard = new Wizard(this);\r\n\twizard.clear();\r\n\tconfig.macros.importTiddlers.restart(wizard);\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.importTiddlers.onClose = function(e)\r\n{\r\n\tbackstage.hidePanel();\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.importTiddlers.restart = function(wizard)\r\n{\r\n\tvar me = config.macros.importTiddlers;\r\n\twizard.addStep(this.step1Title,this.step1Html);\r\n\tvar t,s = wizard.getElement(\"selTypes\");\r\n\tfor(t in config.adaptors) {\r\n\t\tvar e = createTiddlyElement(s,\"option\",null,null,config.adaptors[t].serverLabel || t);\r\n\t\te.value = t;\r\n\t}\r\n\tif(config.defaultAdaptor)\r\n\t\ts.value = config.defaultAdaptor;\r\n\ts = wizard.getElement(\"selFeeds\");\r\n\tvar feeds = this.getFeeds();\r\n\tfor(t in feeds) {\r\n\t\te = createTiddlyElement(s,\"option\",null,null,t);\r\n\t\te.value = t;\r\n\t}\r\n\twizard.setValue(\"feeds\",feeds);\r\n\ts.onchange = me.onFeedChange;\r\n\tvar fileInput = wizard.getElement(\"txtBrowse\");\r\n\tfileInput.onchange = me.onBrowseChange;\r\n\tfileInput.onkeyup = me.onBrowseChange;\r\n\twizard.setButtons([{caption: this.openLabel, tooltip: this.openPrompt, onClick: me.onOpen}]);\r\n\twizard.formElem.action = \"javascript:;\";\r\n\twizard.formElem.onsubmit = function() {\r\n\t\tif(!this.txtPath || this.txtPath.value.length) //# check for manually entered path in first step\r\n\t\t\tthis.lastChild.firstChild.onclick();\r\n\t};\r\n};\r\n\r\nconfig.macros.importTiddlers.getFeeds = function()\r\n{\r\n\tvar feeds = {};\r\n\tvar t,tagged = store.getTaggedTiddlers(\"systemServer\",\"title\");\r\n\tfor(t=0; t<tagged.length; t++) {\r\n\t\tvar title = tagged[t].title;\r\n\t\tvar serverType = store.getTiddlerSlice(title,\"Type\");\r\n\t\tif(!serverType)\r\n\t\t\tserverType = \"file\";\r\n\t\tfeeds[title] = {title: title,\r\n\t\t\t\t\t\turl: store.getTiddlerSlice(title,\"URL\"),\r\n\t\t\t\t\t\tworkspace: store.getTiddlerSlice(title,\"Workspace\"),\r\n\t\t\t\t\t\tworkspaceList: store.getTiddlerSlice(title,\"WorkspaceList\"),\r\n\t\t\t\t\t\ttiddlerFilter: store.getTiddlerSlice(title,\"TiddlerFilter\"),\r\n\t\t\t\t\t\tserverType: serverType,\r\n\t\t\t\t\t\tdescription: store.getTiddlerSlice(title,\"Description\")};\r\n\t}\r\n\treturn feeds;\r\n};\r\n\r\nconfig.macros.importTiddlers.onFeedChange = function(e)\r\n{\r\n\tvar wizard = new Wizard(this);\r\n\tvar selTypes = wizard.getElement(\"selTypes\");\r\n\tvar fileInput = wizard.getElement(\"txtPath\");\r\n\tvar feeds = wizard.getValue(\"feeds\");\r\n\tvar f = feeds[this.value];\r\n\tif(f) {\r\n\t\tselTypes.value = f.serverType;\r\n\t\tfileInput.value = f.url;\r\n\t\twizard.setValue(\"feedName\",f.serverType);\r\n\t\twizard.setValue(\"feedHost\",f.url);\r\n\t\twizard.setValue(\"feedWorkspace\",f.workspace);\r\n\t\twizard.setValue(\"feedWorkspaceList\",f.workspaceList);\r\n\t\twizard.setValue(\"feedTiddlerFilter\",f.tiddlerFilter);\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.importTiddlers.onBrowseChange = function(e)\r\n{\r\n\tvar wizard = new Wizard(this);\r\n\tvar file = this.value;\r\n\tfile = file.replace(/^C:\\\\fakepath\\\\/i,''); // remove fakepath (chrome/opera/safari)\r\n\tif(this.files && this.files[0]) {\r\n\t\ttry {\r\n\t\t\tnetscape.security.PrivilegeManager.enablePrivilege(\"UniversalFileRead\");\r\n\t\t\tfile = this.files[0].fileName; // REQUIRES PRIVILEGES.. NULL otherwise\r\n\t\t} catch (ex) {\r\n\t\t\t// non-priv fallback: combine filename with path to current document\r\n\t\t\tvar path=getLocalPath(document.location.href);\r\n\t\t\tvar slashpos=path.lastIndexOf('/'); if (slashpos==-1) slashpos=path.lastIndexOf('\\\\'); \r\n\t\t\tif (slashpos!=-1) path=path.substr(0,slashpos+1); // remove filename, leave trailing \tslash\r\n\t\t\tfile=path+file;\r\n\t\t}\r\n\t}\r\n\tvar fileInput = wizard.getElement(\"txtPath\");\r\n\tfileInput.value = config.macros.importTiddlers.getURLFromLocalPath(file);\r\n\tvar serverType = wizard.getElement(\"selTypes\");\r\n\tserverType.value = \"file\";\r\n\treturn true;\r\n};\r\n\r\nconfig.macros.importTiddlers.getURLFromLocalPath = function(v)\r\n{\r\n\tif(!v || !v.length)\r\n\t\treturn v;\r\n\tv = v.replace(/\\\\/g,\"/\"); // use \"/\" for cross-platform consistency\r\n\tvar u;\r\n\tvar t = v.split(\":\");\r\n\tvar p = t[1] || t[0]; // remove drive letter (if any)\r\n\tif(t[1] && (t[0] == \"http\" || t[0] == \"https\" || t[0] == \"file\")) {\r\n\t\tu = v;\r\n\t} else if(p.substr(0,1)==\"/\") {\r\n\t\tu = document.location.protocol + \"//\" + document.location.hostname + (t[1] ? \"/\" : \"\") + v;\r\n\t} else {\r\n\t\tvar c = document.location.href.replace(/\\\\/g,\"/\");\r\n\t\tvar pos = c.lastIndexOf(\"/\");\r\n\t\tif(pos!=-1)\r\n\t\t\tc = c.substr(0,pos); // remove filename\r\n\t\tu = c + \"/\" + p;\r\n\t}\r\n\treturn u;\r\n};\r\n\r\nconfig.macros.importTiddlers.onOpen = function(e)\r\n{\r\n\tvar me = config.macros.importTiddlers;\r\n\tvar wizard = new Wizard(this);\r\n\tvar fileInput = wizard.getElement(\"txtPath\");\r\n\tvar url = fileInput.value;\r\n\tvar serverType = wizard.getElement(\"selTypes\").value || config.defaultAdaptor;\r\n\tvar adaptor = new config.adaptors[serverType]();\r\n\twizard.setValue(\"adaptor\",adaptor);\r\n\twizard.setValue(\"serverType\",serverType);\r\n\twizard.setValue(\"host\",url);\r\n\tadaptor.openHost(url,null,wizard,me.onOpenHost);\r\n\twizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenHost);\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.importTiddlers.onOpenHost = function(context,wizard)\r\n{\r\n\tvar me = config.macros.importTiddlers;\r\n\tvar adaptor = wizard.getValue(\"adaptor\");\r\n\tif(context.status !== true)\r\n\t\tdisplayMessage(\"Error in importTiddlers.onOpenHost: \" + context.statusText);\r\n\tadaptor.getWorkspaceList(context,wizard,me.onGetWorkspaceList);\r\n\twizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusGetWorkspaceList);\r\n};\r\n\r\nconfig.macros.importTiddlers.onGetWorkspaceList = function(context,wizard)\r\n{\r\n\tvar me = config.macros.importTiddlers;\r\n\tif(context.status !== true)\r\n\t\tdisplayMessage(\"Error in importTiddlers.onGetWorkspaceList: \" + context.statusText);\r\n\twizard.setValue(\"context\",context);\r\n\tvar workspace = wizard.getValue(\"feedWorkspace\");\r\n\tif(!workspace && context.workspaces.length==1)\r\n\t\tworkspace = context.workspaces[0].title;\r\n\tif(workspace) {\r\n\t\tcontext.adaptor.openWorkspace(workspace,context,wizard,me.onOpenWorkspace);\r\n\t\twizard.setValue(\"workspace\",workspace);\r\n\t\twizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenWorkspace);\r\n\t\treturn;\r\n\t}\r\n\twizard.addStep(me.step2Title,me.step2Html);\r\n\tvar t,s = wizard.getElement(\"selWorkspace\");\r\n\ts.onchange = me.onWorkspaceChange;\r\n\tfor(t=0; t<context.workspaces.length; t++) {\r\n\t\tvar e = createTiddlyElement(s,\"option\",null,null,context.workspaces[t].title);\r\n\t\te.value = context.workspaces[t].title;\r\n\t}\r\n\tvar workspaceList = wizard.getValue(\"feedWorkspaceList\");\r\n\tif(workspaceList) {\r\n\t\tvar n,list = workspaceList.parseParams(\"workspace\",null,false,true);\r\n\t\tfor(n=1; n<list.length; n++) {\r\n\t\t\tif(context.workspaces.findByField(\"title\",list[n].value) == null) {\r\n\t\t\t\te = createTiddlyElement(s,\"option\",null,null,list[n].value);\r\n\t\t\t\te.value = list[n].value;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif(workspace) {\r\n\t\tt = wizard.getElement(\"txtWorkspace\");\r\n\t\tt.value = workspace;\r\n\t}\r\n\twizard.setButtons([{caption: me.openLabel, tooltip: me.openPrompt, onClick: me.onChooseWorkspace}]);\r\n};\r\n\r\nconfig.macros.importTiddlers.onWorkspaceChange = function(e)\r\n{\r\n\tvar wizard = new Wizard(this);\r\n\tvar t = wizard.getElement(\"txtWorkspace\");\r\n\tt.value = this.value;\r\n\tthis.selectedIndex = 0;\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.importTiddlers.onChooseWorkspace = function(e)\r\n{\r\n\tvar me = config.macros.importTiddlers;\r\n\tvar wizard = new Wizard(this);\r\n\tvar adaptor = wizard.getValue(\"adaptor\");\r\n\tvar workspace = wizard.getElement(\"txtWorkspace\").value;\r\n\twizard.setValue(\"workspace\",workspace);\r\n\tvar context = wizard.getValue(\"context\");\r\n\tadaptor.openWorkspace(workspace,context,wizard,me.onOpenWorkspace);\r\n\twizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenWorkspace);\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.importTiddlers.onOpenWorkspace = function(context,wizard)\r\n{\r\n\tvar me = config.macros.importTiddlers;\r\n\tif(context.status !== true)\r\n\t\tdisplayMessage(\"Error in importTiddlers.onOpenWorkspace: \" + context.statusText);\r\n\tvar adaptor = wizard.getValue(\"adaptor\");\r\n\tvar browse=wizard.getElement(\"txtBrowse\");\r\n\tif (browse.files) context.file=browse.files[0]; // for HTML5 FileReader\r\n\tadaptor.getTiddlerList(context,wizard,me.onGetTiddlerList,wizard.getValue(\"feedTiddlerFilter\"));\r\n\twizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusGetTiddlerList);\r\n};\r\n\r\nconfig.macros.importTiddlers.onGetTiddlerList = function(context,wizard)\r\n{\r\n\tvar me = config.macros.importTiddlers;\r\n\tif(context.status !== true) {\r\n\t\tvar error = context.statusText||me.errorGettingTiddlerList;\r\n\t\tif(context.host.indexOf(\"file://\") === 0) {\r\n\t\t\terror = me.errorGettingTiddlerListFile;\r\n\t\t} else {\r\n\t\t\terror = context.xhr && context.xhr.status == 404 ? me.errorGettingTiddlerListHttp404 :\r\n\t\t\t\tme.errorGettingTiddlerListHttp;\r\n\t\t}\r\n\t\twizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],\"\");\r\n\t\tjQuery(\"span.status\", wizard.footerEl).html(error); // so error message can be html\r\n\t\treturn;\r\n\t}\r\n\t// Extract data for the listview\r\n\tvar listedTiddlers = [];\r\n\tif(context.tiddlers) {\r\n\t\tvar n;\r\n\t\tfor(n=0; n<context.tiddlers.length; n++) {\r\n\t\t\tvar tiddler = context.tiddlers[n];\r\n\t\t\tlistedTiddlers.push({\r\n\t\t\t\ttitle: tiddler.title,\r\n\t\t\t\tmodified: tiddler.modified,\r\n\t\t\t\tmodifier: tiddler.modifier,\r\n\t\t\t\ttext: tiddler.text ? wikifyPlainText(tiddler.text,100) : \"\",\r\n\t\t\t\ttags: tiddler.tags,\r\n\t\t\t\tsize: tiddler.text ? tiddler.text.length : 0,\r\n\t\t\t\ttiddler: tiddler\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tlistedTiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});\r\n\t// Display the listview\r\n\twizard.addStep(me.step3Title,me.step3Html);\r\n\tvar markList = wizard.getElement(\"markList\");\r\n\tvar listWrapper = document.createElement(\"div\");\r\n\tmarkList.parentNode.insertBefore(listWrapper,markList);\r\n\tvar listView = ListView.create(listWrapper,listedTiddlers,me.listViewTemplate);\r\n\twizard.setValue(\"listView\",listView);\r\n\twizard.setValue(\"context\",context);\r\n\tvar txtSaveTiddler = wizard.getElement(\"txtSaveTiddler\");\r\n\ttxtSaveTiddler.value = me.generateSystemServerName(wizard);\r\n\twizard.setButtons([\r\n\t\t\t{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel},\r\n\t\t\t{caption: me.importLabel, tooltip: me.importPrompt, onClick: me.doImport}\r\n\t\t]);\r\n};\r\n\r\nconfig.macros.importTiddlers.generateSystemServerName = function(wizard)\r\n{\r\n\tvar serverType = wizard.getValue(\"serverType\");\r\n\tvar host = wizard.getValue(\"host\");\r\n\tvar workspace = wizard.getValue(\"workspace\");\r\n\tvar pattern = config.macros.importTiddlers[workspace ? \"systemServerNamePattern\" : \"systemServerNamePatternNoWorkspace\"];\r\n\treturn pattern.format([serverType,host,workspace]);\r\n};\r\n\r\nconfig.macros.importTiddlers.saveServerTiddler = function(wizard)\r\n{\r\n\tvar me = config.macros.importTiddlers;\r\n\tvar txtSaveTiddler = wizard.getElement(\"txtSaveTiddler\").value;\r\n\tif(store.tiddlerExists(txtSaveTiddler)) {\r\n\t\tif(!confirm(me.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))\r\n\t\t\treturn;\r\n\t\tstore.suspendNotifications();\r\n\t\tstore.removeTiddler(txtSaveTiddler);\r\n\t\tstore.resumeNotifications();\r\n\t}\r\n\tvar serverType = wizard.getValue(\"serverType\");\r\n\tvar host = wizard.getValue(\"host\");\r\n\tvar workspace = wizard.getValue(\"workspace\");\r\n\tvar text = me.serverSaveTemplate.format([serverType,host,workspace]);\r\n\tstore.saveTiddler(txtSaveTiddler,txtSaveTiddler,text,me.serverSaveModifier,new Date(),[\"systemServer\"]);\r\n};\r\n\r\nconfig.macros.importTiddlers.doImport = function(e)\r\n{\r\n\tvar me = config.macros.importTiddlers;\r\n\tvar wizard = new Wizard(this);\r\n\tif(wizard.getElement(\"chkSave\").checked)\r\n\t\tme.saveServerTiddler(wizard);\r\n\tvar chkSync = wizard.getElement(\"chkSync\").checked;\r\n\twizard.setValue(\"sync\",chkSync);\r\n\tvar listView = wizard.getValue(\"listView\");\r\n\tvar rowNames = ListView.getSelectedRows(listView);\r\n\tvar adaptor = wizard.getValue(\"adaptor\");\r\n\tvar overwrite = [];\r\n\tvar t;\r\n\tfor(t=0; t<rowNames.length; t++) {\r\n\t\tif(store.tiddlerExists(rowNames[t]))\r\n\t\t\toverwrite.push(rowNames[t]);\r\n\t}\r\n\tif(overwrite.length > 0) {\r\n\t\tif(!confirm(me.confirmOverwriteText.format([overwrite.join(\", \")])))\r\n\t\t\treturn false;\r\n\t}\r\n\twizard.addStep(me.step4Title.format([rowNames.length]),me.step4Html);\r\n\tfor(t=0; t<rowNames.length; t++) {\r\n\t\tvar link = document.createElement(\"div\");\r\n\t\tcreateTiddlyLink(link,rowNames[t],true);\r\n\t\tvar place = wizard.getElement(\"markReport\");\r\n\t\tplace.parentNode.insertBefore(link,place);\r\n\t}\r\n\twizard.setValue(\"remainingImports\",rowNames.length);\r\n\twizard.setButtons([\r\n\t\t\t{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}\r\n\t\t],me.statusDoingImport);\r\n\tvar wizardContext = wizard.getValue(\"context\");\r\n\tvar tiddlers = wizardContext ? wizardContext.tiddlers : [];\r\n\tfor(t=0; t<rowNames.length; t++) {\r\n\t\tvar context = {\r\n\t\t\tallowSynchronous:true,\r\n\t\t\ttiddler:tiddlers[tiddlers.findByField(\"title\",rowNames[t])]\r\n\t\t};\r\n\t\tadaptor.getTiddler(rowNames[t],context,wizard,me.onGetTiddler);\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.importTiddlers.onGetTiddler = function(context,wizard)\r\n{\r\n\tvar me = config.macros.importTiddlers;\r\n\tif(!context.status)\r\n\t\tdisplayMessage(\"Error in importTiddlers.onGetTiddler: \" + context.statusText);\r\n\tvar tiddler = context.tiddler;\r\n\tstore.suspendNotifications();\r\n\tstore.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);\r\n\tif(!wizard.getValue(\"sync\")) {\r\n\t\tstore.setValue(tiddler.title,'server',null);\r\n\t}\r\n\tstore.resumeNotifications();\r\n\tif(!context.isSynchronous)\r\n\t\tstore.notify(tiddler.title,true);\r\n\tvar remainingImports = wizard.getValue(\"remainingImports\")-1;\r\n\twizard.setValue(\"remainingImports\",remainingImports);\r\n\tif(remainingImports == 0) {\r\n\t\tif(context.isSynchronous) {\r\n\t\t\tstore.notifyAll();\r\n\t\t\trefreshDisplay();\r\n\t\t}\r\n\t\twizard.setButtons([\r\n\t\t\t\t{caption: me.doneLabel, tooltip: me.donePrompt, onClick: me.onClose}\r\n\t\t\t],me.statusDoneImport);\r\n\t\tautoSaveChanges();\r\n\t}\r\n};\r\n\r\n//--\r\n//-- Upgrade macro\r\n//--\r\n\r\nconfig.macros.upgrade.handler = function(place)\r\n{\r\n\tvar w = new Wizard();\r\n\tw.createWizard(place,this.wizardTitle);\r\n\tw.addStep(this.step1Title,this.step1Html.format([this.source,this.source]));\r\n\tw.setButtons([{caption: this.upgradeLabel, tooltip: this.upgradePrompt, onClick: this.onClickUpgrade}]);\r\n};\r\n\r\nconfig.macros.upgrade.onClickUpgrade = function(e)\r\n{\r\n\tvar me = config.macros.upgrade;\r\n\tvar w = new Wizard(this);\r\n\tif(!window.allowSave()) {\r\n\t\talert(me.errorCantUpgrade);\r\n\t\treturn false;\r\n\t}\r\n\tif(story.areAnyDirty() || store.isDirty()) {\r\n\t\talert(me.errorNotSaved);\r\n\t\treturn false;\r\n\t}\r\n\tvar localPath = getLocalPath(document.location.toString());\r\n\tvar backupPath = getBackupPath(localPath,me.backupExtension);\r\n\tw.setValue(\"backupPath\",backupPath);\r\n\tw.setButtons([],me.statusPreparingBackup);\r\n\tvar original = loadOriginal(localPath);\r\n\tw.setButtons([],me.statusSavingBackup);\r\n\tvar backup = copyFile(backupPath,localPath);\r\n\tif(!backup)\r\n\t\tbackup = saveFile(backupPath,original);\r\n\tif(!backup) {\r\n\t\tw.setButtons([],me.errorSavingBackup);\r\n\t\talert(me.errorSavingBackup);\r\n\t\treturn false;\r\n\t}\r\n\tw.setButtons([],me.statusLoadingCore);\r\n\tvar options = {\r\n\t\ttype:\"GET\",\r\n\t\turl:me.source,\r\n\t\tprocessData:false,\r\n\t\tsuccess:function(data,textStatus,jqXHR) {\r\n\t\t\tme.onLoadCore(true,w,jqXHR.responseText,me.source,jqXHR);\r\n\t\t},\r\n\t\terror:function(jqXHR,textStatus,errorThrown) {\r\n\t\t\tme.onLoadCore(false,w,null,me.source,jqXHR);\r\n\t\t}\r\n\t};\r\n\tajaxReq(options);\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.upgrade.onLoadCore = function(status,params,responseText,url,xhr)\r\n{\r\n\tvar me = config.macros.upgrade;\r\n\tvar w = params;\r\n\tvar errMsg;\r\n\tif(!status)\r\n\t\terrMsg = me.errorLoadingCore;\r\n\tvar newVer = me.extractVersion(responseText);\r\n\tif(!newVer)\r\n\t\terrMsg = me.errorCoreFormat;\r\n\tif(errMsg) {\r\n\t\tw.setButtons([],errMsg);\r\n\t\talert(errMsg);\r\n\t\treturn;\r\n\t}\r\n\tvar onStartUpgrade = function(e) {\r\n\t\tw.setButtons([],me.statusSavingCore);\r\n\t\tvar localPath = getLocalPath(document.location.toString());\r\n\t\tsaveFile(localPath,responseText);\r\n\t\tw.setButtons([],me.statusReloadingCore);\r\n\t\tvar backupPath = w.getValue(\"backupPath\");\r\n\t\tvar newLoc = document.location.toString() + \"?time=\" + new Date().convertToYYYYMMDDHHMM() + \"#upgrade:[[\" + encodeURI(backupPath) + \"]]\";\r\n\t\twindow.setTimeout(function () {window.location = newLoc;},10);\r\n\t};\r\n\tvar step2 = [me.step2Html_downgrade,me.step2Html_restore,me.step2Html_upgrade][compareVersions(version,newVer) + 1];\r\n\tw.addStep(me.step2Title,step2.format([formatVersion(newVer),formatVersion(version)]));\r\n\tw.setButtons([{caption: me.startLabel, tooltip: me.startPrompt, onClick: onStartUpgrade},{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}]);\r\n};\r\n\r\nconfig.macros.upgrade.onCancel = function(e)\r\n{\r\n\tvar me = config.macros.upgrade;\r\n\tvar w = new Wizard(this);\r\n\tw.addStep(me.step3Title,me.step3Html);\r\n\tw.setButtons([]);\r\n\treturn false;\r\n};\r\n\r\nconfig.macros.upgrade.extractVersion = function(upgradeFile)\r\n{\r\n\tvar re = /^var version = \\{title: \"([^\"]+)\", major: (\\d+), minor: (\\d+), revision: (\\d+)(, beta: (\\d+)){0,1}, date: new Date\\(\"([^\"]+)\"\\)/mg;\r\n\tvar m = re.exec(upgradeFile);\r\n\treturn m ? {title: m[1], major: m[2], minor: m[3], revision: m[4], beta: m[6], date: new Date(m[7])} : null;\r\n};\r\n\r\nfunction upgradeFrom(path)\r\n{\r\n\tvar importStore = new TiddlyWiki();\r\n\tvar tw = loadFile(path);\r\n\tif(window.netscape !== undefined)\r\n\t\ttw = convertUTF8ToUnicode(tw);\r\n\timportStore.importTiddlyWiki(tw);\r\n\timportStore.forEachTiddler(function(title,tiddler) {\r\n\t\tif(!store.getTiddler(title)) {\r\n\t\t\tstore.addTiddler(tiddler);\r\n\t\t}\r\n\t});\r\n\trefreshDisplay();\r\n\tsaveChanges(); //# To create appropriate Markup* sections\r\n\talert(config.messages.upgradeDone.format([formatVersion()]));\r\n\twindow.location = window.location.toString().substr(0,window.location.toString().lastIndexOf(\"?\"));\r\n}\r\n\r\n//--\r\n//-- Manager UI for groups of tiddlers\r\n//--\r\n\r\nconfig.macros.plugins.handler = function(place,macroName,params,wikifier,paramString)\r\n{\r\n\tvar wizard = new Wizard();\r\n\twizard.createWizard(place,this.wizardTitle);\r\n\twizard.addStep(this.step1Title,this.step1Html);\r\n\tvar markList = wizard.getElement(\"markList\");\r\n\tvar listWrapper = document.createElement(\"div\");\r\n\tmarkList.parentNode.insertBefore(listWrapper,markList);\r\n\tlistWrapper.setAttribute(\"refresh\",\"macro\");\r\n\tlistWrapper.setAttribute(\"macroName\",\"plugins\");\r\n\tlistWrapper.setAttribute(\"params\",paramString);\r\n\tthis.refresh(listWrapper,paramString);\r\n};\r\n\r\nconfig.macros.plugins.refresh = function(listWrapper,params)\r\n{\r\n\tvar me = config.macros.plugins;\r\n\tvar wizard = new Wizard(listWrapper);\r\n\tvar selectedRows = [];\r\n\tListView.forEachSelector(listWrapper,function(e,rowName) {\r\n\t\t\tif(e.checked)\r\n\t\t\t\tselectedRows.push(e.getAttribute(\"rowName\"));\r\n\t\t});\r\n\tjQuery(listWrapper).empty();\r\n\tparams = params.parseParams(\"anon\");\r\n\tvar plugins = installedPlugins.slice(0);\r\n\tvar t,tiddler,p;\r\n\tvar configTiddlers = store.getTaggedTiddlers(\"systemConfig\");\r\n\tfor(t=0; t<configTiddlers.length; t++) {\r\n\t\ttiddler = configTiddlers[t];\r\n\t\tif(plugins.findByField(\"title\",tiddler.title) == null) {\r\n\t\t\tp = getPluginInfo(tiddler);\r\n\t\t\tp.executed = false;\r\n\t\t\tp.log.splice(0,0,this.skippedText);\r\n\t\t\tplugins.push(p);\r\n\t\t}\r\n\t}\r\n\tfor(t=0; t<plugins.length; t++) {\r\n\t\tp = plugins[t];\r\n\t\tp.size = p.tiddler.text ? p.tiddler.text.length : 0;\r\n\t\tp.forced = p.tiddler.isTagged(\"systemConfigForce\");\r\n\t\tp.disabled = p.tiddler.isTagged(\"systemConfigDisable\");\r\n\t\tp.Selected = selectedRows.indexOf(plugins[t].title) != -1;\r\n\t}\r\n\tif(plugins.length == 0) {\r\n\t\tcreateTiddlyElement(listWrapper,\"em\",null,null,this.noPluginText);\r\n\t\twizard.setButtons([]);\r\n\t} else {\r\n\t\tvar template = readOnly ? this.listViewTemplateReadOnly : this.listViewTemplate;\r\n\t\tvar listView = ListView.create(listWrapper,plugins,template,this.onSelectCommand);\r\n\t\twizard.setValue(\"listView\",listView);\r\n\t\tif(!readOnly) {\r\n\t\t\twizard.setButtons([\r\n\t\t\t\t{caption: me.removeLabel, tooltip: me.removePrompt, onClick: me.doRemoveTag},\r\n\t\t\t\t{caption: me.deleteLabel, tooltip: me.deletePrompt, onClick: me.doDelete}\r\n\t\t\t]);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconfig.macros.plugins.doRemoveTag = function(e)\r\n{\r\n\tvar wizard = new Wizard(this);\r\n\tvar listView = wizard.getValue(\"listView\");\r\n\tvar rowNames = ListView.getSelectedRows(listView);\r\n\tif(rowNames.length == 0) {\r\n\t\talert(config.messages.nothingSelected);\r\n\t} else {\r\n\t\tvar t;\r\n\t\tfor(t=0; t<rowNames.length; t++) {\r\n\t\t\tstore.setTiddlerTag(rowNames[t],false,\"systemConfig\");\r\n\t\t}\r\n\t\tautoSaveChanges();\r\n\t}\r\n};\r\n\r\nconfig.macros.plugins.doDelete = function(e)\r\n{\r\n\tvar wizard = new Wizard(this);\r\n\tvar listView = wizard.getValue(\"listView\");\r\n\tvar rowNames = ListView.getSelectedRows(listView);\r\n\tif(rowNames.length == 0) {\r\n\t\talert(config.messages.nothingSelected);\r\n\t} else {\r\n\t\tif(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(\", \")]))) {\r\n\t\t\tvar t;\r\n\t\t\tfor(t=0; t<rowNames.length; t++) {\r\n\t\t\t\tstore.removeTiddler(rowNames[t]);\r\n\t\t\t\tstory.closeTiddler(rowNames[t],true);\r\n\t\t\t}\r\n\t\t}\r\n\t\tautoSaveChanges();\r\n\t}\r\n};\r\n\r\n//--\r\n//-- Message area\r\n//--\r\n\r\nfunction getMessageDiv()\r\n{\r\n\tvar msgArea = document.getElementById(\"messageArea\");\r\n\tif(!msgArea)\r\n\t\treturn null;\r\n\tif(!msgArea.hasChildNodes())\r\n\t\tcreateTiddlyButton(createTiddlyElement(msgArea,\"div\",null,\"messageToolbar\"),\r\n\t\t\tconfig.messages.messageClose.text,\r\n\t\t\tconfig.messages.messageClose.tooltip,\r\n\t\t\tclearMessage);\r\n\tmsgArea.style.display = \"block\";\r\n\treturn createTiddlyElement(msgArea,\"div\");\r\n}\r\n\r\nfunction displayMessage(text,linkText)\r\n{\r\n\tvar e = getMessageDiv();\r\n\tif(!e) {\r\n\t\talert(text);\r\n\t\treturn;\r\n\t}\r\n\tif(linkText) {\r\n\t\tvar link = createTiddlyElement(e,\"a\",null,null,text);\r\n\t\tlink.href = linkText;\r\n\t\tlink.target = \"_blank\";\r\n\t} else {\r\n\t\te.appendChild(document.createTextNode(text));\r\n\t}\r\n}\r\n\r\nfunction clearMessage()\r\n{\r\n\tvar msgArea = document.getElementById(\"messageArea\");\r\n\tif(msgArea) {\r\n\t\tjQuery(msgArea).empty();\r\n\t\tmsgArea.style.display = \"none\";\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n//--\r\n//-- Refresh mechanism\r\n//--\r\n\r\nconfig.notifyTiddlers = [\r\n\t{name: \"SystemSettings\", notify: onSystemSettingsChange},\r\n\t{name: \"StyleSheetLayout\", notify: refreshStyles},\r\n\t{name: \"StyleSheetColors\", notify: refreshStyles},\r\n\t{name: \"StyleSheet\", notify: refreshStyles},\r\n\t{name: \"StyleSheetPrint\", notify: refreshStyles},\r\n\t{name: \"PageTemplate\", notify: refreshPageTemplate},\r\n\t{name: \"SiteTitle\", notify: refreshPageTitle},\r\n\t{name: \"SiteSubtitle\", notify: refreshPageTitle},\r\n\t{name: \"WindowTitle\", notify: refreshPageTitle},\r\n\t{name: \"ColorPalette\", notify: refreshColorPalette},\r\n\t{name: null, notify: refreshDisplay}\r\n];\r\n\r\nconfig.refreshers = {\r\n\tlink: function(e,changeList)\r\n\t\t{\r\n\t\tvar title = e.getAttribute(\"tiddlyLink\");\r\n\t\trefreshTiddlyLink(e,title);\r\n\t\treturn true;\r\n\t\t},\r\n\r\n\ttiddler: function(e,changeList)\r\n\t\t{\r\n\t\tvar title = e.getAttribute(\"tiddler\");\r\n\t\tvar template = e.getAttribute(\"template\");\r\n\t\tif(changeList && (changeList.indexOf && changeList.indexOf(title) != -1) && !story.isDirty(title))\r\n\t\t\tstory.refreshTiddler(title,template,true);\r\n\t\telse\r\n\t\t\trefreshElements(e,changeList);\r\n\t\treturn true;\r\n\t\t},\r\n\r\n\tcontent: function(e,changeList)\r\n\t\t{\r\n\t\tvar title = e.getAttribute(\"tiddler\");\r\n\t\tvar force = e.getAttribute(\"force\");\r\n\t\tvar args = e.getAttribute(\"args\");\r\n\t\tif(force != null || changeList == null || (changeList.indexOf && changeList.indexOf(title) != -1)) {\r\n\t\t\tjQuery(e).empty();\r\n\t\t\tconfig.macros.tiddler.transclude(e,title,args);\r\n\t\t\treturn true;\r\n\t\t} else\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\tmacro: function(e,changeList)\r\n\t\t{\r\n\t\tvar macro = e.getAttribute(\"macroName\");\r\n\t\tvar params = e.getAttribute(\"params\");\r\n\t\tif(macro)\r\n\t\t\tmacro = config.macros[macro];\r\n\t\tif(macro && macro.refresh)\r\n\t\t\tmacro.refresh(e,params);\r\n\t\treturn true;\r\n\t\t}\r\n};\r\n\r\nconfig.refresherData = {\r\n\tstyleSheet: \"StyleSheet\",\r\n\tdefaultStyleSheet: \"StyleSheet\",\r\n\tpageTemplate: \"PageTemplate\",\r\n\tdefaultPageTemplate: \"PageTemplate\",\r\n\tcolorPalette: \"ColorPalette\",\r\n\tdefaultColorPalette: \"ColorPalette\"\r\n};\r\n\r\nfunction refreshElements(root,changeList)\r\n{\r\n\tvar c,nodes = root.childNodes;\r\n\tfor(c=0; c<nodes.length; c++) {\r\n\t\tvar e = nodes[c], type = null;\r\n\t\tif(e.getAttribute && (e.tagName ? e.tagName != \"IFRAME\" : true))\r\n\t\t\ttype = e.getAttribute(\"refresh\");\r\n\t\tvar refresher = config.refreshers[type];\r\n\t\tvar refreshed = false;\r\n\t\tif(refresher != undefined)\r\n\t\t\trefreshed = refresher(e,changeList);\r\n\t\tif(e.hasChildNodes() && !refreshed)\r\n\t\t\trefreshElements(e,changeList);\r\n\t}\r\n}\r\n\r\nfunction applyHtmlMacros(root,tiddler)\r\n{\r\n\tvar e = root.firstChild;\r\n\twhile(e) {\r\n\t\tvar nextChild = e.nextSibling;\r\n\t\tif(e.getAttribute) {\r\n\t\t\tvar macro = e.getAttribute(\"macro\");\r\n\t\t\tif(macro) {\r\n\t\t\t\te.removeAttribute(\"macro\");\r\n\t\t\t\tvar params = \"\";\r\n\t\t\t\tvar p = macro.indexOf(\" \");\r\n\t\t\t\tif(p != -1) {\r\n\t\t\t\t\tparams = macro.substr(p+1);\r\n\t\t\t\t\tmacro = macro.substr(0,p);\r\n\t\t\t\t}\r\n\t\t\t\tinvokeMacro(e,macro,params,null,tiddler);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(e.hasChildNodes())\r\n\t\t\tapplyHtmlMacros(e,tiddler);\r\n\t\te = nextChild;\r\n\t}\r\n}\r\n\r\nfunction refreshPageTemplate(title)\r\n{\r\n\tvar stash = jQuery(\"<div/>\").appendTo(\"body\").hide()[0];\r\n\tvar display = story.getContainer();\r\n\tvar nodes,t;\r\n\tif(display) {\r\n\t\tnodes = display.childNodes;\r\n\t\tfor(t=nodes.length-1; t>=0; t--)\r\n\t\t\tstash.appendChild(nodes[t]);\r\n\t}\r\n\tvar wrapper = document.getElementById(\"contentWrapper\");\r\n\r\n\tif(!title || !store.isAvailable(title))\r\n\t\ttitle = config.refresherData.pageTemplate;\r\n\tif(!store.isAvailable(title))\r\n\t\ttitle = config.refresherData.defaultPageTemplate; //# this one is always avaialable\r\n\twrapper.innerHTML = store.getRecursiveTiddlerText(title,null,10);\r\n\tapplyHtmlMacros(wrapper);\r\n\trefreshElements(wrapper);\r\n\tdisplay = story.getContainer();\r\n\tjQuery(display).empty();\r\n\tif(!display)\r\n\t\tdisplay = createTiddlyElement(wrapper,\"div\",story.containerId());\r\n\tnodes = stash.childNodes;\r\n\tfor(t=nodes.length-1; t>=0; t--)\r\n\t\tdisplay.appendChild(nodes[t]);\r\n\tjQuery(stash).remove();\r\n}\r\n\r\nfunction refreshDisplay(hint)\r\n{\r\n\tif(typeof hint == \"string\")\r\n\t\thint = [hint];\r\n\tvar e = document.getElementById(\"contentWrapper\");\r\n\trefreshElements(e,hint);\r\n\tif(backstage.isPanelVisible()) {\r\n\t\te = document.getElementById(\"backstage\");\r\n\t\trefreshElements(e,hint);\r\n\t}\r\n}\r\n\r\nfunction refreshPageTitle()\r\n{\r\n\tdocument.title = getPageTitle();\r\n}\r\n\r\nfunction getPageTitle()\r\n{\r\n\treturn wikifyPlainText(store.getTiddlerText(\"WindowTitle\",\"\"),null,tiddler);\r\n}\r\n\r\nfunction refreshStyles(title,doc)\r\n{\r\n\tsetStylesheet(title == null ? \"\" : store.getRecursiveTiddlerText(title,\"\",10),title,doc || document);\r\n}\r\n\r\nfunction refreshColorPalette(title)\r\n{\r\n\tif(!startingUp)\r\n\t\trefreshAll();\r\n}\r\n\r\nfunction refreshAll()\r\n{\r\n\trefreshPageTemplate();\r\n\trefreshDisplay();\r\n\trefreshStyles(\"StyleSheetLayout\");\r\n\trefreshStyles(\"StyleSheetColors\");\r\n\trefreshStyles(config.refresherData.styleSheet);\r\n\trefreshStyles(\"StyleSheetPrint\");\r\n}\r\n\r\n//--\r\n//-- Option handling\r\n//--\r\n\r\nconfig.optionHandlers = {\r\n\t'txt': {\r\n\t\tget: function(name) {return encodeCookie(config.options[name].toString());},\r\n\t\tset: function(name,value) {config.options[name] = decodeCookie(value);}\r\n\t},\r\n\t'chk': {\r\n\t\tget: function(name) {return config.options[name] ? 'true' : 'false';},\r\n\t\tset: function(name,value) {config.options[name] = value == 'true';}\r\n\t}\r\n};\r\n\r\nfunction setOption(name,value)\r\n{\r\n\tvar optType = name.substr(0,3);\r\n\tif(config.optionHandlers[optType] && config.optionHandlers[optType].set)\r\n\t\tconfig.optionHandlers[optType].set(name,value);\r\n}\r\n\r\n// Gets the value of an option as a string. Most code should just read from config.options.* directly\r\nfunction getOption(name)\r\n{\r\n\tvar optType = name.substr(0,3);\r\n\treturn config.optionHandlers[optType] && config.optionHandlers[optType].get ? config.optionHandlers[optType].get(name) : null;\r\n}\r\n\r\nfunction loadOptions()\r\n{\r\n\tif(safeMode)\r\n\t\treturn;\r\n\tloadCookies();\r\n\tloadSystemSettings();\r\n}\r\n// @Deprecated; retained for backwards compatibility\r\nvar loadOptionsCookie = loadOptions;\r\n\r\nfunction getCookies()\r\n{\r\n\tvar cookieList = document.cookie.split(';');\r\n\tvar i,cookies = {};\r\n\tfor(i=0; i<cookieList.length; i++) {\r\n\t\tvar p = cookieList[i].indexOf('=');\r\n\t\tif(p != -1) {\r\n\t\t\tvar name = cookieList[i].substr(0,p).trim();\r\n\t\t\tvar value = cookieList[i].substr(p+1).trim();\r\n\t\t\tcookies[name] = value;\r\n\t\t}\r\n\t}\r\n\treturn cookies;\r\n}\r\n\r\nfunction loadCookies()\r\n{\r\n\tvar i,cookies = getCookies();\r\n\tif(cookies['TiddlyWiki']) {\r\n\t\tcookies = cookies['TiddlyWiki'].decodeHashMap();\r\n\t}\r\n\tfor(i in cookies) {\r\n\t\tif(config.optionsSource[i] != 'setting') {\r\n\t\t\tsetOption(i,cookies[i]);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction loadSystemSettings()\r\n{\r\n\tvar key,settings = store.calcAllSlices('SystemSettings');\r\n\tconfig.optionsSource = {};\r\n\tfor(key in settings) {\r\n\t\tsetOption(key,settings[key]);\r\n\t\tconfig.optionsSource[key] = 'setting';\r\n\t}\r\n}\r\n\r\nfunction onSystemSettingsChange()\r\n{\r\n\tif(!startingUp) {\r\n\t\tloadSystemSettings();\r\n\t}\r\n}\r\n\r\nfunction saveOption(name)\r\n{\r\n\tif(safeMode)\r\n\t\treturn;\r\n\tif(name.match(/[()\\s]/g, '_')) {\r\n\t\talert(config.messages.invalidCookie.format([name]));\r\n\t\treturn;\r\n\t}\r\n\tsaveCookie(name);\r\n\tif(config.optionsSource[name] == 'setting') {\r\n\t\tsaveSystemSetting(name,true);\r\n\t}\r\n}\r\n// @Deprecated; retained for backwards compatibility\r\nvar saveOptionCookie = saveOption;\r\n\r\nfunction removeCookie(name)\r\n{\r\n\tdocument.cookie = name + '=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;';\r\n}\r\n\r\nfunction saveCookie(name)\r\n{\r\n\tvar key,cookies = {};\r\n\tfor(key in config.options) {\r\n\t\tvar value = getOption(key);\r\n\t\tvalue = value == null ? 'false' : value;\r\n\t\tcookies[key] = value;\r\n\t}\r\n\tdocument.cookie = 'TiddlyWiki=' + String.encodeHashMap(cookies) + '; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/';\r\n\tcookies = getCookies();\r\n\tvar c;\r\n\tfor(c in cookies) {\r\n\t\tvar optType = c.substr(0,3);\r\n\t\tif(config.optionHandlers[optType])\r\n\t\t\tremoveCookie(c);\r\n\t}\r\n}\r\n\r\nvar systemSettingSave;\r\nfunction commitSystemSettings(storeWasDirty)\r\n{\r\n\tif(systemSettingSave) {\r\n\t\twindow.clearTimeout(systemSettingSave);\r\n\t}\r\n\tsystemSettingSave = window.setTimeout(function() {\r\n\t\tvar tiddler = store.getTiddler('SystemSettings');\r\n\t\tautoSaveChanges(null,[tiddler]);\r\n\t}, 1000);\r\n}\r\n\r\nfunction saveSystemSetting(name,saveFile)\r\n{\r\n\tvar title = 'SystemSettings';\r\n\tvar slice = store.getTiddlerSlice(title,name);\r\n\tif(readOnly || slice === getOption(name)) {\r\n\t\treturn; //# don't save if read-only or the option hasn't changed\r\n\t}\r\n\tvar slices = store.calcAllSlices(title);\r\n\tvar key;\r\n\tfor(key in config.optionsSource) {\r\n\t\tvar value = getOption(key) || '';\r\n\t\tif(slices[key] !== value) {\r\n\t\t\tslices[key] = value;\r\n\t\t}\r\n\t}\r\n\tvar text = [];\r\n\tfor(key in slices) {\r\n\t\ttext.push('%0: %1'.format([key,slices[key]]));\r\n\t}\r\n\ttext = text.sort().join('\\n');\r\n\tvar storeWasDirty = store.isDirty();\r\n\tvar tiddler = store.getTiddler(title);\r\n\tif(tiddler) {\r\n\t\ttiddler.text = text;\r\n\t\ttiddler = store.saveTiddler(tiddler);\r\n\t} else {\r\n\t\ttiddler = store.saveTiddler(title,title,text,'System',new Date(),['excludeLists'],config.defaultCustomFields);\r\n\t}\r\n\tif(saveFile) {\r\n\t\tcommitSystemSettings(storeWasDirty);\r\n\t}\r\n}\r\n\r\nfunction encodeCookie(s)\r\n{\r\n\treturn escape(convertUnicodeToHtmlEntities(s));\r\n}\r\n\r\nfunction decodeCookie(s)\r\n{\r\n\ts = unescape(s);\r\n\tvar re = /&#[0-9]{1,5};/g;\r\n\treturn s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,'')));});\r\n}\r\n\r\nconfig.macros.option.genericCreate = function(place,type,opt,className,desc)\r\n{\r\n\tvar typeInfo = config.macros.option.types[type];\r\n\tvar c = document.createElement(typeInfo.elementType);\r\n\tif(typeInfo.typeValue)\r\n\t\tc.setAttribute('type',typeInfo.typeValue);\r\n\tc[typeInfo.eventName] = typeInfo.onChange;\r\n\tc.setAttribute('option',opt);\r\n\tc.className = className || typeInfo.className;\r\n\tif(config.optionsDesc[opt])\r\n\t\tc.setAttribute('title',config.optionsDesc[opt]);\r\n\tplace.appendChild(c);\r\n\tif(desc != 'no')\r\n\t\tcreateTiddlyText(place,config.optionsDesc[opt] || opt);\r\n\tc[typeInfo.valueField] = config.options[opt];\r\n\treturn c;\r\n};\r\n\r\nconfig.macros.option.genericOnChange = function(e)\r\n{\r\n\tvar opt = this.getAttribute('option');\r\n\tif(opt) {\r\n\t\tvar optType = opt.substr(0,3);\r\n\t\tvar handler = config.macros.option.types[optType];\r\n\t\tif(handler.elementType && handler.valueField)\r\n\t\t\tconfig.macros.option.propagateOption(opt,handler.valueField,this[handler.valueField],handler.elementType,this);\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nconfig.macros.option.types = {\r\n\t'txt': {\r\n\t\telementType: 'input',\r\n\t\tvalueField: 'value',\r\n\t\teventName: 'onchange',\r\n\t\tclassName: 'txtOptionInput',\r\n\t\tcreate: config.macros.option.genericCreate,\r\n\t\tonChange: config.macros.option.genericOnChange\r\n\t},\r\n\t'chk': {\r\n\t\telementType: 'input',\r\n\t\tvalueField: 'checked',\r\n\t\teventName: 'onclick',\r\n\t\tclassName: 'chkOptionInput',\r\n\t\ttypeValue: 'checkbox',\r\n\t\tcreate: config.macros.option.genericCreate,\r\n\t\tonChange: config.macros.option.genericOnChange\r\n\t}\r\n};\r\n\r\nconfig.macros.option.propagateOption = function(opt,valueField,value,elementType,elem)\r\n{\r\n\tconfig.options[opt] = value;\r\n\tsaveOption(opt);\r\n\tvar t,nodes = document.getElementsByTagName(elementType);\r\n\tfor(t=0; t<nodes.length; t++) {\r\n\t\tvar optNode = nodes[t].getAttribute('option');\r\n\t\tif(opt == optNode && nodes[t]!=elem)\r\n\t\t\tnodes[t][valueField] = value;\r\n\t}\r\n};\r\n\r\nconfig.macros.option.handler = function(place,macroName,params,wikifier,paramString)\r\n{\r\n\tparams = paramString.parseParams('anon',null,true,false,false);\r\n\tvar opt = (params[1] && params[1].name == 'anon') ? params[1].value : getParam(params,'name',null);\r\n\tvar className = (params[2] && params[2].name == 'anon') ? params[2].value : getParam(params,'class',null);\r\n\tvar desc = getParam(params,'desc','no');\r\n\tvar type = opt.substr(0,3);\r\n\tvar h = config.macros.option.types[type];\r\n\tif(h && h.create)\r\n\t\th.create(place,type,opt,className,desc);\r\n};\r\n\r\nconfig.macros.options.handler = function(place,macroName,params,wikifier,paramString)\r\n{\r\n\tparams = paramString.parseParams('anon',null,true,false,false);\r\n\tvar showUnknown = getParam(params,'showUnknown','no');\r\n\tvar wizard = new Wizard();\r\n\twizard.createWizard(place,this.wizardTitle);\r\n\twizard.addStep(this.step1Title,this.step1Html);\r\n\tvar markList = wizard.getElement('markList');\r\n\tvar chkUnknown = wizard.getElement('chkUnknown');\r\n\tchkUnknown.checked = showUnknown == 'yes';\r\n\tchkUnknown.onchange = this.onChangeUnknown;\r\n\tvar listWrapper = document.createElement('div');\r\n\tmarkList.parentNode.insertBefore(listWrapper,markList);\r\n\twizard.setValue('listWrapper',listWrapper);\r\n\tthis.refreshOptions(listWrapper,showUnknown == 'yes');\r\n};\r\n\r\nconfig.macros.options.refreshOptions = function(listWrapper,showUnknown)\r\n{\r\n\tvar n,opts = [];\r\n\tfor(n in config.options) {\r\n\t\tvar opt = {};\r\n\t\topt.option = '';\r\n\t\topt.name = n;\r\n\t\topt.lowlight = !config.optionsDesc[n];\r\n\t\topt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];\r\n\t\tif(!opt.lowlight || showUnknown)\r\n\t\t\topts.push(opt);\r\n\t}\r\n\topts.sort(function(a,b) {return a.name.substr(3) < b.name.substr(3) ? -1 : (a.name.substr(3) == b.name.substr(3) ? 0 : +1);});\r\n\tListView.create(listWrapper,opts,this.listViewTemplate);\r\n\tfor(n=0; n<opts.length; n++) {\r\n\t\tvar type = opts[n].name.substr(0,3);\r\n\t\tvar h = config.macros.option.types[type];\r\n\t\tif(h && h.create) {\r\n\t\t\th.create(opts[n].colElements['option'],type,opts[n].name,null,'no');\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconfig.macros.options.onChangeUnknown = function(e)\r\n{\r\n\tvar wizard = new Wizard(this);\r\n\tvar listWrapper = wizard.getValue('listWrapper');\r\n\tjQuery(listWrapper).empty();\r\n\tconfig.macros.options.refreshOptions(listWrapper,this.checked);\r\n\treturn false;\r\n};\r\n\r\n//--\r\n//-- Saving\r\n//--\r\n\r\nvar saveUsingSafari = false;\r\n\r\nvar startSaveArea = '<div id=\"' + 'storeArea\">'; // Split up into two so that indexOf() of this source doesn't find it\r\nvar startSaveAreaRE = /<((div)|(DIV)) ((id)|(ID))=[\"']?storeArea['\"]?>/; // Used for IE6\r\nvar endSaveArea = '</d' + 'iv>';\r\nvar endSaveAreaCaps = '</D' + 'IV>';\r\n\r\n// If there are unsaved changes, force the user to confirm before exitting\r\nfunction confirmExit()\r\n{\r\n\thadConfirmExit = true;\r\n\tif((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))\r\n\t\treturn config.messages.confirmExit;\r\n}\r\n\r\n// Give the user a chance to save changes before exitting\r\nfunction checkUnsavedChanges()\r\n{\r\n\tif(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {\r\n\t\tif(confirm(config.messages.unsavedChangesWarning))\r\n\t\t\tsaveChanges();\r\n\t}\r\n}\r\n\r\nfunction updateLanguageAttribute(s)\r\n{\r\n\tif(config.locale) {\r\n\t\tvar mRE = /(<html(?:.*?)?)(?: xml:lang\\=\"([a-z]+)\")?(?: lang\\=\"([a-z]+)\")?>/;\r\n\t\tvar m = mRE.exec(s);\r\n\t\tif(m) {\r\n\t\t\tvar t = m[1];\r\n\t\t\tif(m[2])\r\n\t\t\t\tt += ' xml:lang=\"' + config.locale + '\"';\r\n\t\t\tif(m[3])\r\n\t\t\t\tt += ' lang=\"' + config.locale + '\"';\r\n\t\t\tt += \">\";\r\n\t\t\ts = s.substr(0,m.index) + t + s.substr(m.index+m[0].length);\r\n\t\t}\r\n\t}\r\n\treturn s;\r\n}\r\n\r\nfunction updateMarkupBlock(s,blockName,tiddlerName)\r\n{\r\n\treturn s.replaceChunk(\r\n\t\t\t\"<!--%0-START-->\".format([blockName]),\r\n\t\t\t\"<!--%0-END-->\".format([blockName]),\r\n\t\t\t\"\\n\" + convertUnicodeToFileFormat(store.getRecursiveTiddlerText(tiddlerName,\"\")) + \"\\n\");\r\n}\r\n\r\nfunction updateOriginal(original,posDiv,localPath)\r\n{\r\n\tif(!posDiv)\r\n\t\tposDiv = locateStoreArea(original);\r\n\tif(!posDiv) {\r\n\t\talert(config.messages.invalidFileError.format([localPath]));\r\n\t\treturn null;\r\n\t}\r\n\tvar revised = original.substr(0,posDiv[0] + startSaveArea.length) + \"\\n\" +\r\n\t\t\t\tconvertUnicodeToFileFormat(store.allTiddlersAsHtml()) + \"\\n\" +\r\n\t\t\t\toriginal.substr(posDiv[1]);\r\n\tvar newSiteTitle = convertUnicodeToFileFormat(getPageTitle()).htmlEncode();\r\n\trevised = revised.replaceChunk(\"<title\"+\">\",\"</title\"+\">\",\" \" + newSiteTitle + \" \");\r\n\trevised = updateLanguageAttribute(revised);\r\n\trevised = updateMarkupBlock(revised,\"PRE-HEAD\",\"MarkupPreHead\");\r\n\trevised = updateMarkupBlock(revised,\"POST-HEAD\",\"MarkupPostHead\");\r\n\trevised = updateMarkupBlock(revised,\"PRE-BODY\",\"MarkupPreBody\");\r\n\trevised = updateMarkupBlock(revised,\"POST-SCRIPT\",\"MarkupPostBody\");\r\n\treturn revised;\r\n}\r\n\r\nfunction locateStoreArea(original)\r\n{\r\n\t// Locate the storeArea divs\r\n\tif(!original)\r\n\t\treturn null;\r\n\tvar posOpeningDiv = original.search(startSaveAreaRE);\r\n\tvar limitClosingDiv = original.indexOf(\"<\"+\"!--POST-STOREAREA--\"+\">\");\r\n\tif(limitClosingDiv == -1)\r\n\t\tlimitClosingDiv = original.indexOf(\"<\"+\"!--POST-BODY-START--\"+\">\");\r\n\tvar start = limitClosingDiv == -1 ? original.length : limitClosingDiv;\r\n\tvar posClosingDiv = original.lastIndexOf(endSaveArea,start);\r\n\tif(posClosingDiv == -1)\r\n\t\tposClosingDiv = original.lastIndexOf(endSaveAreaCaps,start);\r\n\treturn (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv,posClosingDiv] : null;\r\n}\r\n\r\nfunction autoSaveChanges(onlyIfDirty,tiddlers)\r\n{\r\n\tif(config.options.chkAutoSave)\r\n\t\tsaveChanges(onlyIfDirty,tiddlers);\r\n}\r\n\r\nfunction loadOriginal(localPath)\r\n{\r\n\tvar content=loadFile(localPath);\r\n\tif (!content) content=window.originalHTML||recreateOriginal();\r\n\treturn content;\r\n}\r\n\r\nfunction recreateOriginal()\r\n{\r\n\t// construct doctype\r\n\tvar content = \"<!DOCTYPE \";\r\n\tvar t=document.doctype;\r\n\tif (!t) \r\n\t\tcontent+=\"html\"\r\n\telse {\r\n\t\tcontent+=t.name;\r\n\t\tif      (t.publicId)\t\tcontent+=' PUBLIC \"'+t.publicId+'\"';\r\n\t\telse if (t.systemId)\t\tcontent+=' SYSTEM \"'+t.systemId+'\"';\r\n\t}\r\n\tcontent+=' \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\"';\r\n\tcontent+='>\\n';\r\n\r\n\t// append current document content\r\n\tcontent+=document.documentElement.outerHTML;\r\n\r\n\tcontent=content.replace(/<div id=\"saveTest\">savetest<\\/div>/,'<div id=\"saveTest\"></div>');\r\n\tcontent=content.replace(/script><applet [^\\>]*><\\/applet>/g,'script>');\r\n\tcontent=content.replace(/><head>/,'>\\n<head>');\r\n\tcontent=content.replace(/\\n\\n<\\/body><\\/html>$/,'</body>\\n</html>\\n');\r\n\tcontent=content.replace(/(<(meta) [^\\>]*[^\\/])>/g,'$1 />');\r\n\tcontent=content.replace(/<noscript>[^\\<]*<\\/noscript>/,\r\n\t\tfunction(m){return m.replace(/&lt;/g,'<').replace(/&gt;/g,'>');});\r\n\tcontent=content.replace(/<div id=\"copyright\">[^\\<]*<\\/div>/,\r\n\t\tfunction(m){return m.replace(/\\xA9/g,'&copy;');});\r\n\r\n\treturn content;\r\n}\r\n\r\n// Save this tiddlywiki with the pending changes\r\nfunction saveChanges(onlyIfDirty,tiddlers)\r\n{\r\n\tif(onlyIfDirty && !store.isDirty())\r\n\t\treturn;\r\n\tclearMessage();\r\n\tvar t0 = new Date();\r\n\tvar msg = config.messages;\r\n\tvar originalPath = document.location.toString();\r\n\tif(!window.allowSave()) {\r\n\t\talert(msg.notFileUrlError);\r\n\t\tif(store.tiddlerExists(msg.saveInstructions))\r\n\t\t\tstory.displayTiddler(null,msg.saveInstructions);\r\n\t\treturn;\r\n\t}\r\n\tvar localPath = getLocalPath(originalPath);\r\n\tvar original = loadOriginal(localPath);\r\n\tif(original == null) {\r\n\t\talert(msg.cantSaveError);\r\n\t\tif(store.tiddlerExists(msg.saveInstructions))\r\n\t\t\tstory.displayTiddler(null,msg.saveInstructions);\r\n\t\treturn;\r\n\t}\r\n\tvar posDiv = locateStoreArea(original);\r\n\tif(!posDiv) {\r\n\t\talert(msg.invalidFileError.format([localPath]));\r\n\t\treturn;\r\n\t}\r\n\tvar co=config.options; //# abbreviation\r\n\tconfig.saveByDownload=false;\r\n\tconfig.saveByManualDownload=false;\r\n\tsaveMain(localPath,original,posDiv);\r\n\tif (!config.saveByDownload && !config.saveByManualDownload) {\r\n\t\tif(co.chkSaveBackups)\r\n\t\t\tsaveBackup(localPath,original);\r\n\t\tif(co.chkSaveEmptyTemplate)\r\n\t\t\tsaveEmpty(localPath,original,posDiv);\r\n\t\tif(co.chkGenerateAnRssFeed && saveRss instanceof Function)\r\n\t\t\tsaveRss(localPath);\r\n\t}\r\n\tif(co.chkDisplayInstrumentation)\r\n\t\tdisplayMessage(\"saveChanges \" + (new Date()-t0) + \" ms\");\r\n}\r\n\r\n\r\nfunction saveMain(localPath,original,posDiv)\r\n{\r\n\tvar save;\r\n\ttry {\r\n\t\tvar revised = updateOriginal(original,posDiv,localPath);\r\n\t\tsave = saveFile(localPath,revised);\r\n\t} catch (ex) {\r\n\t\tshowException(ex);\r\n\t}\r\n\tif(save) {\r\n\t\tif (!config.saveByManualDownload) {\r\n\t\t\tif (config.saveByDownload) { //# set by HTML5DownloadSaveFile()\r\n\t\t\t\tvar link = getDataURI(revised);\r\n\t\t\t\tvar msg  = config.messages.mainDownload;\r\n\t\t\t} else {\r\n\t\t\t\tvar link = \"file://\" + localPath;\r\n\t\t\t\tvar msg  = config.messages.mainSaved;\r\n\t\t\t}\r\n\t\t\tdisplayMessage(msg,link);\r\n\t\t}\r\n\t\tstore.setDirty(false);\r\n\t} else {\r\n\t\talert(config.messages.mainFailed);\r\n\t}\r\n}\r\n\r\nfunction saveBackup(localPath,original)\r\n{\r\n\tvar backupPath = getBackupPath(localPath);\r\n\tvar backup = copyFile(backupPath,localPath);\r\n\tif(!backup)\r\n\t\tbackup = saveFile(backupPath,original);\r\n\tif(backup)\r\n\t\tdisplayMessage(config.messages.backupSaved,\"file://\" + backupPath);\r\n\telse\r\n\t\talert(config.messages.backupFailed);\r\n}\r\n\r\nfunction saveEmpty(localPath,original,posDiv)\r\n{\r\n\tvar emptyPath,p;\r\n\tif((p = localPath.lastIndexOf(\"/\")) != -1)\r\n\t\temptyPath = localPath.substr(0,p) + \"/\";\r\n\telse if((p = localPath.lastIndexOf(\"\\\\\")) != -1)\r\n\t\temptyPath = localPath.substr(0,p) + \"\\\\\";\r\n\telse\r\n\t\temptyPath = localPath + \".\";\r\n\temptyPath += \"empty.html\";\r\n\tvar empty = original.substr(0,posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);\r\n\tvar emptySave = saveFile(emptyPath,empty);\r\n\tif(emptySave)\r\n\t\tdisplayMessage(config.messages.emptySaved,\"file://\" + emptyPath);\r\n\telse\r\n\t\talert(config.messages.emptyFailed);\r\n}\r\n\r\n// Translate URL to local path [Preemption]\r\nwindow.getLocalPath = window.getLocalPath || function(origPath)\r\n{\r\n\tvar originalPath = convertUriToUTF8(origPath,config.options.txtFileSystemCharSet);\r\n\t// Remove any location or query part of the URL\r\n\tvar argPos = originalPath.indexOf(\"?\");\r\n\tif(argPos != -1)\r\n\t\toriginalPath = originalPath.substr(0,argPos);\r\n\tvar hashPos = originalPath.indexOf(\"#\");\r\n\tif(hashPos != -1)\r\n\t\toriginalPath = originalPath.substr(0,hashPos);\r\n\t// Convert file://localhost/ to file:///\r\n\tif(originalPath.indexOf(\"file://localhost/\") == 0)\r\n\t\toriginalPath = \"file://\" + originalPath.substr(16);\r\n\t// Convert to a native file format\r\n\tvar localPath;\r\n\tif(originalPath.charAt(9) == \":\") // pc local file\r\n\t\tlocalPath = unescape(originalPath.substr(8)).replace(new RegExp(\"/\",\"g\"),\"\\\\\");\r\n\telse if(originalPath.indexOf(\"file://///\") == 0) // FireFox pc network file\r\n\t\tlocalPath = \"\\\\\\\\\" + unescape(originalPath.substr(10)).replace(new RegExp(\"/\",\"g\"),\"\\\\\");\r\n\telse if(originalPath.indexOf(\"file:///\") == 0) // mac/unix local file\r\n\t\tlocalPath = unescape(originalPath.substr(7));\r\n\telse if(originalPath.indexOf(\"file:/\") == 0) // mac/unix local file\r\n\t\tlocalPath = unescape(originalPath.substr(5));\r\n\telse // pc network file\r\n\t\tlocalPath = \"\\\\\\\\\" + unescape(originalPath.substr(7)).replace(new RegExp(\"/\",\"g\"),\"\\\\\");\r\n\treturn localPath;\r\n}\r\n\r\nfunction getBackupPath(localPath,title,extension)\r\n{\r\n\tvar slash = \"\\\\\";\r\n\tvar dirPathPos = localPath.lastIndexOf(\"\\\\\");\r\n\tif(dirPathPos == -1) {\r\n\t\tdirPathPos = localPath.lastIndexOf(\"/\");\r\n\t\tslash = \"/\";\r\n\t}\r\n\tvar backupFolder = config.options.txtBackupFolder;\r\n\tif(!backupFolder || backupFolder == \"\")\r\n\t\tbackupFolder = \".\";\r\n\tvar backupPath = localPath.substr(0,dirPathPos) + slash + backupFolder + localPath.substr(dirPathPos);\r\n\tbackupPath = backupPath.substr(0,backupPath.lastIndexOf(\".\")) + \".\";\r\n\tif(title)\r\n\t\tbackupPath += title.replace(/[\\\\\\/\\*\\?\\\":<> ]/g,\"_\") + \".\";\r\n\tbackupPath += (new Date()).convertToYYYYMMDDHHMMSSMMM() + \".\" + (extension || \"html\");\r\n\treturn backupPath;\r\n}\r\n\r\n//--\r\n//-- RSS Saving\r\n//--\r\n\r\nfunction saveRss(localPath)\r\n{\r\n\tvar rssPath = localPath.substr(0,localPath.lastIndexOf(\".\")) + \".xml\";\r\n\tif(saveFile(rssPath,convertUnicodeToFileFormat(generateRss())))\r\n\t\tdisplayMessage(config.messages.rssSaved,\"file://\" + rssPath);\r\n\telse\r\n\t\talert(config.messages.rssFailed);\r\n}\r\n\r\ntiddlerToRssItem = function(tiddler,uri)\r\n{\r\n\tvar s = \"<title\" + \">\" + tiddler.title.htmlEncode() + \"</title\" + \">\\n\";\r\n\ts += \"<description>\" + wikifyStatic(tiddler.text,null,tiddler).htmlEncode() + \"</description>\\n\";\r\n\tvar i;\r\n\tfor(i=0; i<tiddler.tags.length; i++)\r\n\t\ts += \"<category>\" + tiddler.tags[i] + \"</category>\\n\";\r\n\ts += \"<link>\" + uri + \"#\" + encodeURIComponent(String.encodeTiddlyLink(tiddler.title)) + \"</link>\\n\";\r\n\ts +=\"<pubDate>\" + tiddler.modified.toGMTString() + \"</pubDate>\\n\";\r\n\treturn s;\r\n};\r\n\r\nfunction generateRss()\r\n{\r\n\tvar s = [];\r\n\tvar d = new Date();\r\n\tvar u = store.getTiddlerText(\"SiteUrl\");\r\n\t// Assemble the header\r\n\ts.push(\"<\" + \"?xml version=\\\"1.0\\\"?\" + \">\");\r\n\ts.push(\"<rss version=\\\"2.0\\\">\");\r\n\ts.push(\"<channel>\");\r\n\ts.push(\"<title\" + \">\" + wikifyPlainText(store.getTiddlerText(\"SiteTitle\",\"\"),null,tiddler).htmlEncode() + \"</title\" + \">\");\r\n\tif(u)\r\n\t\ts.push(\"<link>\" + u.htmlEncode() + \"</link>\");\r\n\ts.push(\"<description>\" + wikifyPlainText(store.getTiddlerText(\"SiteSubtitle\",\"\"),null,tiddler).htmlEncode() + \"</description>\");\r\n\ts.push(\"<language>\" + config.locale + \"</language>\");\r\n\ts.push(\"<copyright>Copyright \" + d.getFullYear() + \" \" + config.options.txtUserName.htmlEncode() + \"</copyright>\");\r\n\ts.push(\"<pubDate>\" + d.toGMTString() + \"</pubDate>\");\r\n\ts.push(\"<lastBuildDate>\" + d.toGMTString() + \"</lastBuildDate>\");\r\n\ts.push(\"<docs>http://blogs.law.harvard.edu/tech/rss</docs>\");\r\n\ts.push(\"<generator>TiddlyWiki \" + formatVersion() + \"</generator>\");\r\n\t// The body\r\n\tvar tiddlers = store.getTiddlers(\"modified\",\"excludeLists\");\r\n\tvar i,n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;\r\n\tfor(i=tiddlers.length-1; i>=n; i--) {\r\n\t\ts.push(\"<item>\\n\" + tiddlerToRssItem(tiddlers[i],u) + \"\\n</item>\");\r\n\t}\r\n\t// And footer\r\n\ts.push(\"</channel>\");\r\n\ts.push(\"</rss>\");\r\n\t// Save it all\r\n\treturn s.join(\"\\n\");\r\n}\r\n\r\n//--\r\n//-- Filesystem code\r\n//--\r\n\r\n// Copy a file in filesystem [Preemption]\r\nwindow.copyFile = window.copyFile || function(dest,source)\r\n{\r\n\treturn config.browser.isIE ? ieCopyFile(dest,source) : false;\r\n}\r\n\r\n\r\n// Save a file in filesystem [Preemption]\r\nwindow.saveFile = window.saveFile || function(fileUrl,content)\r\n{\r\n\tvar r = mozillaSaveFile(fileUrl,content);\r\n\tif(!r)\r\n\t\tr = ieSaveFile(fileUrl,content);\r\n\tif(!r)\r\n\t\tr = javaSaveFile(fileUrl,content);\r\n\tif(!r)\r\n\t\tr = HTML5DownloadSaveFile(fileUrl,content);\r\n\tif(!r)\r\n\t\tr = manualSaveFile(fileUrl,content);\r\n\treturn r;\r\n}\r\n\r\n// Load a file from filesystem [Preemption]\r\nwindow.loadFile = window.loadFile || function(fileUrl)\r\n{\r\n\tvar r = mozillaLoadFile(fileUrl);\r\n\tif((r == null) || (r == false))\r\n\t\tr = ieLoadFile(fileUrl);\r\n\tif((r == null) || (r == false))\r\n\t\tr = javaLoadFile(fileUrl);\r\n\treturn r;\r\n}\r\n\r\nfunction ieCreatePath(path)\r\n{\r\n\ttry {\r\n\t\tvar fso = new ActiveXObject(\"Scripting.FileSystemObject\");\r\n\t} catch(ex) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tvar pos = path.lastIndexOf(\"\\\\\");\r\n\tif(pos==-1)\r\n\t\tpos = path.lastIndexOf(\"/\");\r\n\tif(pos!=-1)\r\n\t\tpath = path.substring(0,pos+1);\r\n\r\n\tvar scan = [path];\r\n\tvar parent = fso.GetParentFolderName(path);\r\n\twhile(parent && !fso.FolderExists(parent)) {\r\n\t\tscan.push(parent);\r\n\t\tparent = fso.GetParentFolderName(parent);\r\n\t}\r\n\r\n\tfor(i=scan.length-1;i>=0;i--) {\r\n\t\tif(!fso.FolderExists(scan[i])) {\r\n\t\t\tfso.CreateFolder(scan[i]);\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n\r\n// Returns null if it can't do it, false if there's an error, true if it saved OK\r\nfunction ieSaveFile(filePath,content)\r\n{\r\n\tieCreatePath(filePath);\r\n\ttry {\r\n\t\tvar fso = new ActiveXObject(\"Scripting.FileSystemObject\");\r\n\t} catch(ex) {\r\n\t\treturn null;\r\n\t}\r\n\tvar file = fso.OpenTextFile(filePath,2,-1,0);\r\n\tfile.Write(content);\r\n\tfile.Close();\r\n\treturn true;\r\n}\r\n\r\n// Returns null if it can't do it, false if there's an error, or a string of the content if successful\r\nfunction ieLoadFile(filePath)\r\n{\r\n\ttry {\r\n\t\tvar fso = new ActiveXObject(\"Scripting.FileSystemObject\");\r\n\t\tvar file = fso.OpenTextFile(filePath,1);\r\n\t\tvar content = file.ReadAll();\r\n\t\tfile.Close();\r\n\t} catch(ex) {\r\n\t\treturn null;\r\n\t}\r\n\treturn content;\r\n}\r\n\r\nfunction ieCopyFile(dest,source)\r\n{\r\n\tieCreatePath(dest);\r\n\ttry {\r\n\t\tvar fso = new ActiveXObject(\"Scripting.FileSystemObject\");\r\n\t\tfso.GetFile(source).Copy(dest);\r\n\t} catch(ex) {\r\n\t\treturn false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\n// Returns null if it can't do it, false if there's an error, true if it saved OK\r\nfunction mozillaSaveFile(filePath,content)\r\n{\r\n\tif(window.Components) {\r\n\t\ttry {\r\n\t\t\tnetscape.security.PrivilegeManager.enablePrivilege(\"UniversalXPConnect\");\r\n\t\t\tvar file = Components.classes[\"@mozilla.org/file/local;1\"].createInstance(Components.interfaces.nsILocalFile);\r\n\t\t\tfile.initWithPath(filePath);\r\n\t\t\tif(!file.exists())\r\n\t\t\t\tfile.create(0,0x01B4);// 0x01B4 = 0664\r\n\t\t\tvar out = Components.classes[\"@mozilla.org/network/file-output-stream;1\"].createInstance(Components.interfaces.nsIFileOutputStream);\r\n\t\t\tout.init(file,0x22,0x04,null);\r\n\t\t\tout.write(content,content.length);\r\n\t\t\tout.flush();\r\n\t\t\tout.close();\r\n\t\t\treturn true;\r\n\t\t} catch(ex) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\n// Returns null if it can't do it, false if there's an error, or a string of the content if successful\r\nfunction mozillaLoadFile(filePath)\r\n{\r\n\tif(window.Components) {\r\n\t\ttry {\r\n\t\t\tnetscape.security.PrivilegeManager.enablePrivilege(\"UniversalXPConnect\");\r\n\t\t\tvar file = Components.classes[\"@mozilla.org/file/local;1\"].createInstance(Components.interfaces.nsILocalFile);\r\n\t\t\tfile.initWithPath(filePath);\r\n\t\t\tif(!file.exists())\r\n\t\t\t\treturn null;\r\n\t\t\tvar inputStream = Components.classes[\"@mozilla.org/network/file-input-stream;1\"].createInstance(Components.interfaces.nsIFileInputStream);\r\n\t\t\tinputStream.init(file,0x01,0x04,null);\r\n\t\t\tvar sInputStream = Components.classes[\"@mozilla.org/scriptableinputstream;1\"].createInstance(Components.interfaces.nsIScriptableInputStream);\r\n\t\t\tsInputStream.init(inputStream);\r\n\t\t\tvar contents = sInputStream.read(sInputStream.available());\r\n\t\t\tsInputStream.close();\r\n\t\t\tinputStream.close();\r\n\t\t\treturn contents;\r\n\t\t} catch(ex) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction javaUrlToFilename(url)\r\n{\r\n\tvar f = \"//localhost\";\r\n\tif(url.indexOf(f) == 0)\r\n\t\treturn url.substring(f.length);\r\n\tvar i = url.indexOf(\":\");\r\n\treturn i > 0 ? url.substring(i-1) : url;\r\n}\r\n\r\n/*\r\n *\r\n * in between when the applet has been started\r\n * and the user has given permission to run the applet\r\n * we get an applet object, but it doesn't have the methods\r\n * we expect yet.\r\n *\r\n */\r\nvar LOG_TIDDLYSAVER = true;\r\nfunction logTiddlySaverException(msg, ex) {\r\n\tvar applet = document.applets['TiddlySaver'];\r\n\tconsole.log(msg + \": \" + ex);\r\n\tif (LOG_TIDDLYSAVER && applet) {\r\n\t\ttry {\r\n\t\t\tconsole.log(msg + \": \" + applet.getLastErrorMsg());\r\n\t\t\tconsole.log(msg + \": \" + applet.getLastErrorStackTrace());\r\n\t\t} catch (ex) {}\r\n\t}\r\n}\r\n\r\nfunction javaDebugInformation () {\r\n\tvar applet = document.applets['TiddlySaver'];\r\n\tvar what = [\r\n\t\t[\"Java Version\", applet.getJavaVersion],\r\n\t\t[\"Last Exception\", applet.getLastErrorMessage],\r\n\t\t[\"Last Exception Stack Trace\", applet.getLastErrorStackTrace],\r\n\t\t[\"System Properties\", applet.getSystemProperties] ];\r\n\r\n\tfunction formatItem (description, method) {\r\n\t\ttry {\r\n\t\t\t result = String(method.call(applet));\r\n\t\t} catch (ex) {\r\n\t\t\t result = String(ex)\r\n\t\t}\r\n\t\treturn description + \": \" + result\r\n\t}\r\n\r\n\treturn jQuery.map(what, function (item) { return formatItem.apply(this, item) })\r\n\t\t\t.join('\\n\\n')\r\n}\r\n\r\nfunction javaSaveFile(filePath,content)\r\n{\r\n\tvar applet = document.applets['TiddlySaver'];\r\n\ttry {\r\n\t\tif (applet && filePath) \r\n\t\t\treturn applet.saveFile(javaUrlToFilename(filePath), \"UTF-8\", content);\r\n\t} catch(ex) {\r\n\t\tlogTiddlySaverException(\"javaSaveFile\", ex);\r\n\t}\r\n\t// is this next block working anywhere ? -- grmble\r\n\ttry {\r\n\t\tvar s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));\r\n\t\ts.print(content);\r\n\t\ts.close();\r\n\t} catch(ex2) {\r\n\t\treturn null;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nfunction javaLoadFile(filePath)\r\n{\r\n\tvar applet = document.applets['TiddlySaver'];\r\n\ttry {\r\n\t\tif (applet && filePath) {\r\n\t\t\tvar ret = applet.loadFile(javaUrlToFilename(filePath),\"UTF-8\");\r\n\t\t\tif(!ret)\r\n\t\t\t\treturn null;\r\n\t\t\treturn String(ret);\r\n\t\t}\r\n\t} catch(ex) {\r\n\t\tlogTiddlySaverException(\"javaLoadFile\", ex);\r\n\t}\r\n\t// is this next block working anywhere ? -- grmble\r\n\tvar content = [];\r\n\ttry {\r\n\t\tvar r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));\r\n\t\tvar line;\r\n\t\twhile((line = r.readLine()) != null)\r\n\t\t\tcontent.push(String(line));\r\n\t\tr.close();\r\n\t} catch(ex2) {\r\n\t\treturn null;\r\n\t}\r\n\treturn content.join(\"\\n\");\r\n}\r\n\r\nfunction HTML5DownloadSaveFile(filePath,content)\r\n{\r\n\tif(document.createElement(\"a\").download !== undefined) {\r\n\t\tconfig.saveByDownload=true;\r\n\t\tvar slashpos=filePath.lastIndexOf(\"/\");\r\n\t\tif (slashpos==-1) slashpos=filePath.lastIndexOf(\"\\\\\"); \r\n\t\tvar filename=filePath.substr(slashpos+1);\r\n\t\tvar uri = getDataURI(content);\r\n\t\tvar link = document.createElement(\"a\");\r\n\t\tlink.setAttribute(\"target\",\"_blank\");\r\n\t\tlink.setAttribute(\"href\",uri);\r\n\t\tlink.setAttribute(\"download\",filename);\r\n\t\tdocument.body.appendChild(link); link.click(); document.body.removeChild(link);\r\n\t\treturn true;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\n// Returns null if it can't do it, false if there's an error, true if it saved OK\r\nfunction manualSaveFile(filePath,content)\r\n{\r\n\t// FALLBACK for showing a link to data: URI\r\n\tconfig.saveByManualDownload=true;\r\n\tvar slashpos=filePath.lastIndexOf(\"/\");\r\n\tif (slashpos==-1) slashpos=filePath.lastIndexOf(\"\\\\\"); \r\n\tvar filename=filePath.substr(slashpos+1);\r\n\tvar uri = getDataURI(content);\r\n\tdisplayMessage(config.messages.mainDownloadManual,uri);\r\n\treturn true;\r\n}\r\n\r\n// construct data URI (using base64 encoding to preserve multi-byte encodings)\r\nfunction getDataURI(data) {\r\n\tif (config.browser.isIE)\r\n\t\treturn \"data:text/html,\"+encodeURIComponent(data);\r\n\telse\r\n\t\treturn \"data:text/html;base64,\"+encodeBase64(data);\r\n}\r\n\r\nfunction encodeBase64(data) {\r\n\tif (!data) return \"\";\r\n\tvar keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\n\tvar out = \"\";\r\n\tvar chr1,chr2,chr3=\"\";\r\n\tvar enc1,enc2,enc3,enc4=\"\";\r\n\tfor (var count=0,i=0; i<data.length; ) {\r\n\t\tchr1=data.charCodeAt(i++);\r\n\t\tchr2=data.charCodeAt(i++);\r\n\t\tchr3=data.charCodeAt(i++);\r\n\t\tenc1=chr1 >> 2;\r\n\t\tenc2=((chr1 & 3) << 4) | (chr2 >> 4);\r\n\t\tenc3=((chr2 & 15) << 2) | (chr3 >> 6);\r\n\t\tenc4=chr3 & 63;\r\n\t\tif (isNaN(chr2)) enc3=enc4=64;\r\n\t\telse if (isNaN(chr3)) enc4=64;\r\n\t\tout+=keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4);\r\n\t\tchr1=chr2=chr3=enc1=enc2=enc3=enc4=\"\";\r\n\t}\r\n\treturn out;\r\n}//--\r\n//-- Filesystem utilities\r\n//--\r\n\r\nfunction convertUTF8ToUnicode(u)\r\n{\r\n\treturn config.browser.isOpera || !window.netscape ? manualConvertUTF8ToUnicode(u) : mozConvertUTF8ToUnicode(u);\r\n}\r\n\r\n\r\nfunction manualConvertUTF8ToUnicode(utf)\r\n{\r\n\tvar uni = utf;\r\n\tvar src = 0;\r\n\tvar dst = 0;\r\n\tvar b1, b2, b3;\r\n\tvar c;\r\n\twhile(src < utf.length) {\r\n\t\tb1 = utf.charCodeAt(src++);\r\n\t\tif(b1 < 0x80) {\r\n\t\t\tdst++;\r\n\t\t} else if(b1 < 0xE0) {\r\n\t\t\tb2 = utf.charCodeAt(src++);\r\n\t\t\tc = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));\r\n\t\t\tuni = uni.substring(0,dst++).concat(c,utf.substr(src));\r\n\t\t} else {\r\n\t\t\tb2 = utf.charCodeAt(src++);\r\n\t\t\tb3 = utf.charCodeAt(src++);\r\n\t\t\tc = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));\r\n\t\t\tuni = uni.substring(0,dst++).concat(c,utf.substr(src));\r\n\t\t}\r\n\t}\r\n\treturn uni;\r\n}\r\n\r\nfunction mozConvertUTF8ToUnicode(u)\r\n{\r\n\ttry {\r\n\t\tnetscape.security.PrivilegeManager.enablePrivilege(\"UniversalXPConnect\");\r\n\t\tvar converter = Components.classes[\"@mozilla.org/intl/scriptableunicodeconverter\"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);\r\n\t\tconverter.charset = \"UTF-8\";\r\n\t} catch(ex) {\r\n\t\treturn manualConvertUTF8ToUnicode(u);\r\n\t} // fallback\r\n\tvar s = converter.ConvertToUnicode(u);\r\n\tvar fin = converter.Finish();\r\n\treturn fin.length > 0 ? s+fin : s;\r\n}\r\n\r\nfunction convertUnicodeToFileFormat(s)\r\n{\r\n\treturn config.browser.isOpera || !window.netscape ? (config.browser.isIE ? convertUnicodeToHtmlEntities(s) : s) : mozConvertUnicodeToUTF8(s);\r\n}\r\n\r\nfunction convertUnicodeToHtmlEntities(s)\r\n{\r\n\tvar re = /[^\\u0000-\\u007F]/g;\r\n\treturn s.replace(re,function($0) {return \"&#\" + $0.charCodeAt(0).toString() + \";\";});\r\n}\r\n\r\nfunction convertUnicodeToUTF8(s)\r\n{\r\n// return convertUnicodeToFileFormat to allow plugin migration\r\n\treturn convertUnicodeToFileFormat(s);\r\n}\r\n\r\nfunction manualConvertUnicodeToUTF8(s)\r\n{\r\n\treturn unescape(encodeURIComponent(s));\r\n}\r\n\r\nfunction mozConvertUnicodeToUTF8(s)\r\n{\r\n\ttry {\r\n\t\tnetscape.security.PrivilegeManager.enablePrivilege(\"UniversalXPConnect\");\r\n\t\tvar converter = Components.classes[\"@mozilla.org/intl/scriptableunicodeconverter\"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);\r\n\t\tconverter.charset = \"UTF-8\";\r\n\t} catch(ex) {\r\n\t\treturn manualConvertUnicodeToUTF8(s);\r\n\t} // fallback\r\n\tvar u = converter.ConvertFromUnicode(s);\r\n\tvar fin = converter.Finish();\r\n\treturn fin.length > 0 ? u + fin : u;\r\n}\r\n\r\nfunction convertUriToUTF8(uri,charSet)\r\n{\r\n\tif(window.netscape == undefined || charSet == undefined || charSet == \"\")\r\n\t\treturn uri;\r\n\ttry {\r\n\t\tnetscape.security.PrivilegeManager.enablePrivilege(\"UniversalXPConnect\");\r\n\t\tvar converter = Components.classes[\"@mozilla.org/intl/utf8converterservice;1\"].getService(Components.interfaces.nsIUTF8ConverterService);\r\n\t} catch(ex) {\r\n\t\treturn uri;\r\n\t}\r\n\treturn converter.convertURISpecToUTF8(uri,charSet);\r\n}\r\n//--\r\n//-- Server adaptor base class\r\n//--\r\n\r\nfunction AdaptorBase()\r\n{\r\n\tthis.host = null;\r\n\tthis.store = null;\r\n\treturn this;\r\n}\r\n\r\nAdaptorBase.prototype.close = function()\r\n{\r\n\treturn true;\r\n};\r\n\r\nAdaptorBase.prototype.fullHostName = function(host)\r\n{\r\n\tif(!host)\r\n\t\treturn '';\r\n\thost = host.trim();\r\n\tif(!host.match(/:\\/\\//))\r\n\t\thost = 'http://' + host;\r\n\tif(host.substr(host.length-1) == '/')\r\n\t\thost = host.substr(0,host.length-1);\r\n\treturn host;\r\n};\r\n\r\nAdaptorBase.minHostName = function(host)\r\n{\r\n\treturn host;\r\n};\r\n\r\nAdaptorBase.prototype.setContext = function(context,userParams,callback)\r\n{\r\n\tif(!context) context = {};\r\n\tcontext.userParams = userParams;\r\n\tif(callback) context.callback = callback;\r\n\tcontext.adaptor = this;\r\n\tif(!context.host)\r\n\t\tcontext.host = this.host;\r\n\tcontext.host = this.fullHostName(context.host);\r\n\tif(!context.workspace)\r\n\t\tcontext.workspace = this.workspace;\r\n\treturn context;\r\n};\r\n\r\n// Open the specified host\r\nAdaptorBase.prototype.openHost = function(host,context,userParams,callback)\r\n{\r\n\tthis.host = host;\r\n\tcontext = this.setContext(context,userParams,callback);\r\n\tcontext.status = true;\r\n\tif(callback)\r\n\t\twindow.setTimeout(function() {context.callback(context,userParams);},10);\r\n\treturn true;\r\n};\r\n\r\n// Open the specified workspace\r\nAdaptorBase.prototype.openWorkspace = function(workspace,context,userParams,callback)\r\n{\r\n\tthis.workspace = workspace;\r\n\tcontext = this.setContext(context,userParams,callback);\r\n\tcontext.status = true;\r\n\tif(callback)\r\n\t\twindow.setTimeout(function() {callback(context,userParams);},10);\r\n\treturn true;\r\n};\r\n\r\n//--\r\n//-- Server adaptor for talking to static TiddlyWiki files\r\n//--\r\n\r\nfunction FileAdaptor()\r\n{\r\n}\r\n\r\nFileAdaptor.prototype = new AdaptorBase();\r\n\r\nFileAdaptor.serverType = 'file';\r\nFileAdaptor.serverLabel = 'TiddlyWiki';\r\n\r\nFileAdaptor.loadTiddlyWikiSuccess = function(context,jqXHR)\r\n{\r\n\tcontext.status = true;\r\n\tcontext.adaptor.store = new TiddlyWiki();\r\n\tif(!context.adaptor.store.importTiddlyWiki(jqXHR.responseText)) {\r\n\t\tcontext.statusText = config.messages.invalidFileError.format([context.host]);\r\n\t\tcontext.status = false;\r\n\t}\r\n\tcontext.complete(context,context.userParams);\r\n};\r\n\r\nFileAdaptor.loadTiddlyWikiError = function(context,jqXHR)\r\n{\r\n\tcontext.status = false;\r\n\tcontext.statusText = jqXHR.message;\r\n\tcontext.complete(context,context.userParams);\r\n};\r\n\r\n// Get the list of workspaces on a given server\r\nFileAdaptor.prototype.getWorkspaceList = function(context,userParams,callback)\r\n{\r\n\tcontext = this.setContext(context,userParams,callback);\r\n\tcontext.workspaces = [{title:\"(default)\"}];\r\n\tcontext.status = true;\r\n\tif(callback)\r\n\t\twindow.setTimeout(function() {callback(context,userParams);},10);\r\n\treturn true;\r\n};\r\n\r\n// Gets the list of tiddlers within a given workspace\r\nFileAdaptor.prototype.getTiddlerList = function(context,userParams,callback,filter)\r\n{\r\n\tcontext = this.setContext(context,userParams,callback);\r\n\tif(!context.filter)\r\n\t\tcontext.filter = filter;\r\n\tcontext.complete = FileAdaptor.getTiddlerListComplete;\r\n\tif(this.store) {\r\n\t\treturn context.complete(context,context.userParams);\r\n\t}\r\n\tvar options = {\r\n\t\ttype:\"GET\",\r\n\t\turl:context.host,\r\n\t\tfile:context.file, // for HTML5 FileReader\r\n\t\tprocessData:false,\r\n\t\tsuccess:function(data,textStatus,jqXHR) {\r\n\t\t\tFileAdaptor.loadTiddlyWikiSuccess(context,jqXHR);\r\n\t\t},\r\n\t\terror:function(jqXHR,textStatus,errorThrown) {\r\n\t\t\tcontext.xhr = jqXHR;\r\n\t\t\tFileAdaptor.loadTiddlyWikiError(context,jqXHR);\r\n\t\t}\r\n\t};\r\n\treturn ajaxReq(options);\r\n};\r\n\r\nFileAdaptor.getTiddlerListComplete = function(context,userParams)\r\n{\r\n\tif(context.status) {\r\n\t\tif(context.filter) {\r\n\t\t\tcontext.tiddlers = context.adaptor.store.filterTiddlers(context.filter);\r\n\t\t} else {\r\n\t\t\tcontext.tiddlers = [];\r\n\t\t\tcontext.adaptor.store.forEachTiddler(function(title,tiddler) {context.tiddlers.push(tiddler);});\r\n\t\t}\r\n\t\tvar i;\r\n\t\tfor(i=0; i<context.tiddlers.length; i++) {\r\n\t\t\tcontext.tiddlers[i].fields['server.type'] = FileAdaptor.serverType;\r\n\t\t\tcontext.tiddlers[i].fields['server.host'] = AdaptorBase.minHostName(context.host);\r\n\t\t\tcontext.tiddlers[i].fields['server.page.revision'] = context.tiddlers[i].modified.convertToYYYYMMDDHHMM();\r\n\t\t}\r\n\t\tcontext.status = true;\r\n\t}\r\n\tif(context.callback) {\r\n\t\twindow.setTimeout(function() {context.callback(context,userParams);},10);\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nFileAdaptor.prototype.generateTiddlerInfo = function(tiddler)\r\n{\r\n\tvar info = {};\r\n\tinfo.uri = tiddler.fields['server.host'] + \"#\" + tiddler.title;\r\n\treturn info;\r\n};\r\n\r\n// Retrieve a tiddler from a given workspace on a given server\r\nFileAdaptor.prototype.getTiddler = function(title,context,userParams,callback)\r\n{\r\n\tcontext = this.setContext(context,userParams,callback);\r\n\tcontext.title = title;\r\n\tcontext.complete = FileAdaptor.getTiddlerComplete;\r\n\tif(context.adaptor.store) {\r\n\t\treturn context.complete(context,context.userParams);\r\n\t}\r\n\tvar options = {\r\n\t\ttype:\"GET\",\r\n\t\turl:context.host,\r\n\t\tprocessData:false,\r\n\t\tsuccess:function(data,textStatus,jqXHR) {\r\n\t\t\tFileAdaptor.loadTiddlyWikiSuccess(context,jqXHR);\r\n\t\t},\r\n\t\terror:function(jqXHR,textStatus,errorThrown) {\r\n\t\t\tFileAdaptor.loadTiddlyWikiError(context,jqXHR);\r\n\t\t}\r\n\t};\r\n\treturn ajaxReq(options);\r\n};\r\n\r\nFileAdaptor.getTiddlerComplete = function(context,userParams)\r\n{\r\n\tvar t = context.adaptor.store.fetchTiddler(context.title);\r\n\tif(t) {\r\n\t\tt.fields['server.type'] = FileAdaptor.serverType;\r\n\t\tt.fields['server.host'] = AdaptorBase.minHostName(context.host);\r\n\t\tt.fields['server.page.revision'] = t.modified.convertToYYYYMMDDHHMM();\r\n\t\tcontext.tiddler = t;\r\n\t\tcontext.status = true;\r\n\t} else { //# tiddler does not exist in document\r\n\t\tcontext.status = false;\r\n\t}\r\n\tif(context.allowSynchronous) {\r\n\t\tcontext.isSynchronous = true;\r\n\t\tcontext.callback(context,userParams);\r\n\t} else {\r\n\t\twindow.setTimeout(function() {context.callback(context,userParams);},10);\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nFileAdaptor.prototype.close = function()\r\n{\r\n\tthis.store = null;\r\n};\r\n\r\nconfig.adaptors[FileAdaptor.serverType] = FileAdaptor;\r\n\r\nconfig.defaultAdaptor = FileAdaptor.serverType;\r\n\r\n//--\r\n//-- HTTP request code\r\n//--\r\n\r\nfunction ajaxReq(args)\r\n{\r\n\tif (args.file || args.url.startsWith(\"file\"))  // LOCAL FILE\r\n\t\treturn localAjax(args);\r\n\treturn jQuery.ajax(args);\r\n}\r\n\r\nfunction localAjax(args)\r\n{\r\n\tvar success=function(data)\r\n\t\t{ args.success(data,\"success\",{ responseText:data }); }\r\n\tvar failure=function(who)\r\n\t\t{ args.error({ message:who+\": cannot read local file\" },\"error\",0); }\r\n\r\n\tif (args.file) try { // HTML5 FileReader (Chrome, FF20+, Safari, etc.)\r\n\t\tvar reader=new FileReader();\r\n\t\treader.onload=function(e)  { success(e.target.result); }\r\n\t\treader.onerror=function(e) { failure(\"FileReader\"); }\r\n\t\treader.readAsText(args.file);\r\n\t\treturn true;\r\n\t} catch (ex) { ; }\r\n\r\n\ttry { // local file I/O (IE, FF with TiddlyFox, Chrome/Safari with TiddlySaver, etc.)\r\n\t\tvar data=loadFile(getLocalPath(args.url));\r\n\t\tif (data) success(data);\r\n\t\telse failure(\"loadFile\");\r\n\t\treturn true;\r\n\t} catch (ex) { ; }\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache)\r\n{\r\n\tvar httpSuccess = function(xhr) {\r\n\t\ttry {\r\n\t\t\t// IE error sometimes returns 1223 when it should be 204 so treat it as success, see #1450\r\n\t\t\treturn (!xhr.status && location.protocol === \"file:\") ||\r\n\t\t\t\t(xhr.status >= 200 && xhr.status < 300) ||\r\n\t\t\t\txhr.status === 304 || xhr.status === 1223;\r\n\t\t} catch(e) {}\r\n\t\treturn false;\r\n\t};\r\n\r\n\tvar options = {\r\n\t\ttype:type,\r\n\t\turl:url,\r\n\t\tprocessData:false,\r\n\t\tdata:data,\r\n\t\tcache:!!allowCache,\r\n\t\tbeforeSend: function(xhr) {\r\n\t\t\tvar i;\r\n\t\t\tfor(i in headers)\r\n\t\t\t\txhr.setRequestHeader(i,headers[i]);\r\n\t\t}\r\n\t};\r\n\r\n\tif(callback) {\r\n\t\toptions.complete = function(xhr,textStatus) {\r\n\t\t\tif(httpSuccess(xhr))\r\n\t\t\t\tcallback(true,params,xhr.responseText,url,xhr);\r\n\t\t\telse\r\n\t\t\t\tcallback(false,params,null,url,xhr);\r\n\t\t};\r\n\t}\r\n\tif(contentType)\r\n\t\toptions.contentType = contentType;\r\n\tif(username)\r\n\t\toptions.username = username;\r\n\tif(password)\r\n\t\toptions.password = password;\r\n\ttry {\r\n\t\tif(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf(\"http\") == -1)\r\n\t\t\twindow.netscape.security.PrivilegeManager.enablePrivilege(\"UniversalBrowserRead\");\r\n\t} catch (ex) {\r\n\t}\r\n\treturn jQuery.ajax(options);\r\n}\r\n//--\r\n//-- TiddlyWiki-specific utility functions\r\n//--\r\n\r\n// Returns TiddlyWiki version string\r\nfunction formatVersion(v)\r\n{\r\n\tv = v || version;\r\n\treturn v.major + \".\" + v.minor + \".\" + v.revision +\r\n\t\t(v.alpha ? \" (alpha \" + v.alpha + \")\" : \"\") +\r\n\t\t(v.beta ? \" (beta \" + v.beta + \")\" : \"\");\r\n}\r\n\r\nfunction compareVersions(v1,v2)\r\n{\r\n\tvar x1,x2,i,a = [\"major\",\"minor\",\"revision\"];\r\n\tfor(i = 0; i<a.length; i++) {\r\n\t\tx1 = v1[a[i]] || 0;\r\n\t\tx2 = v2[a[i]] || 0;\r\n\t\tif(x1<x2)\r\n\t\t\treturn 1;\r\n\t\tif(x1>x2)\r\n\t\t\treturn -1;\r\n\t}\r\n\tx1 = v1.beta || 9999;\r\n\tx2 = v2.beta || 9999;\r\n\tif(x1<x2)\r\n\t\treturn 1;\r\n\treturn x1 > x2 ? -1 : 0;\r\n}\r\n\r\nfunction merge(dst,src,preserveExisting)\r\n{\r\n\tvar i;\r\n\tfor(i in src) {\r\n\t\tif(!preserveExisting || dst[i] === undefined)\r\n\t\t\tdst[i] = src[i];\r\n\t}\r\n\treturn dst;\r\n}\r\n\r\n// Resolve the target object of an event\r\nfunction resolveTarget(e)\r\n{\r\n\tvar obj;\r\n\tif(e.target)\r\n\t\tobj = e.target;\r\n\telse if(e.srcElement)\r\n\t\tobj = e.srcElement;\r\n\tif(obj.nodeType == 3) // defeat Safari bug\r\n\t\tobj = obj.parentNode;\r\n\treturn obj;\r\n}\r\n\r\n// Returns a string containing the description of an exception, optionally prepended by a message\r\nfunction exceptionText(e,message)\r\n{\r\n\tvar s = e.description || e.toString();\r\n\treturn message ? \"%0:\\n%1\".format([message,s]) : s;\r\n}\r\n\r\n// Displays an alert of an exception description with optional message\r\nfunction showException(e,message)\r\n{\r\n\talert(exceptionText(e,message));\r\n}\r\n\r\nfunction alertAndThrow(m)\r\n{\r\n\talert(m);\r\n\tthrow(m);\r\n}\r\n\r\nfunction glyph(name)\r\n{\r\n\tvar g = config.glyphs;\r\n\tvar b = g.currBrowser;\r\n\tif(b == null) {\r\n\t\tb = 0;\r\n\t\twhile(b < g.browsers.length-1 && !g.browsers[b]())\r\n\t\t\tb++;\r\n\t\tg.currBrowser = b;\r\n\t}\r\n\tif(!g.codes[name])\r\n\t\treturn \"\";\r\n\treturn g.codes[name][b];\r\n}\r\n\r\nfunction createTiddlyText(parent,text)\r\n{\r\n\treturn parent.appendChild(document.createTextNode(text));\r\n}\r\n\r\nfunction createTiddlyCheckbox(parent,caption,checked,onChange)\r\n{\r\n\tvar cb = document.createElement(\"input\");\r\n\tcb.setAttribute(\"type\",\"checkbox\");\r\n\tcb.onclick = onChange;\r\n\tparent.appendChild(cb);\r\n\tcb.checked = checked;\r\n\tcb.className = \"chkOptionInput\";\r\n\tif(caption)\r\n\t\twikify(caption,parent);\r\n\treturn cb;\r\n}\r\n\r\nfunction createTiddlyElement(parent,element,id,className,text,attribs)\r\n{\r\n\tvar n,e = document.createElement(element);\r\n\tif(className != null)\r\n\t\te.className = className;\r\n\tif(id != null)\r\n\t\te.setAttribute(\"id\",id);\r\n\tif(text != null)\r\n\t\te.appendChild(document.createTextNode(text));\r\n\tif(attribs) {\r\n\t\tfor(n in attribs) {\r\n\t\t\te.setAttribute(n,attribs[n]);\r\n\t\t}\r\n\t}\r\n\tif(parent != null)\r\n\t\tparent.appendChild(e);\r\n\treturn e;\r\n}\r\n\r\nfunction createTiddlyButton(parent,text,tooltip,action,className,id,accessKey,attribs)\r\n{\r\n\tvar i,btn = document.createElement(\"a\");\r\n\tbtn.setAttribute(\"href\",\"javascript:;\");\r\n\tif(action) {\r\n\t\tbtn.onclick = action;\r\n\t}\r\n\tif(tooltip)\r\n\t\tbtn.setAttribute(\"title\",tooltip);\r\n\tif(text)\r\n\t\tbtn.appendChild(document.createTextNode(text));\r\n\tbtn.className = className || \"button\";\r\n\tif(id)\r\n\t\tbtn.id = id;\r\n\tif(attribs) {\r\n\t\tfor(i in attribs) {\r\n\t\t\tbtn.setAttribute(i,attribs[i]);\r\n\t\t}\r\n\t}\r\n\tif(parent)\r\n\t\tparent.appendChild(btn);\r\n\tif(accessKey)\r\n\t\tbtn.setAttribute(\"accessKey\",accessKey);\r\n\treturn btn;\r\n}\r\n\r\nfunction createExternalLink(place,url,label)\r\n{\r\n\tvar link = document.createElement(\"a\");\r\n\tlink.className = \"externalLink\";\r\n\tlink.href = url;\r\n\tvar f = config.messages.externalLinkTooltip;\r\n\tlink.title = f ? f.format([url]) : url;\r\n\tif(config.options.chkOpenInNewWindow)\r\n\t\tlink.target = \"_blank\";\r\n\tplace.appendChild(link);\r\n\tif(label)\r\n\t\tcreateTiddlyText(link, label);\r\n\treturn link;\r\n}\r\n\r\nfunction getTiddlyLinkInfo(title,currClasses)\r\n{\r\n\tvar classes = currClasses ? currClasses.split(\" \") : [];\r\n\tclasses.pushUnique(\"tiddlyLink\");\r\n\tvar tiddler = store.fetchTiddler(title);\r\n\tvar subTitle;\r\n\tif(tiddler) {\r\n\t\tsubTitle = tiddler.getSubtitle();\r\n\t\tclasses.pushUnique(\"tiddlyLinkExisting\");\r\n\t\tclasses.remove(\"tiddlyLinkNonExisting\");\r\n\t\tclasses.remove(\"shadow\");\r\n\t} else {\r\n\t    var f;\r\n\t\tclasses.remove(\"tiddlyLinkExisting\");\r\n\t\tclasses.pushUnique(\"tiddlyLinkNonExisting\");\r\n\t\tif(store.isShadowTiddler(title)) {\r\n\t\t\tf = config.messages.shadowedTiddlerToolTip;\r\n\t\t\tclasses.pushUnique(\"shadow\");\r\n\t\t} else {\r\n\t\t\tf = config.messages.undefinedTiddlerToolTip;\r\n\t\t\tclasses.remove(\"shadow\");\r\n\t\t}\r\n\t\tsubTitle = f ? f.format([title]) : \"\";\r\n\t}\r\n\tif(typeof config.annotations[title]==\"string\")\r\n\t\tsubTitle = config.annotations[title];\r\n\treturn {classes: classes.join(\" \"),subTitle: subTitle};\r\n}\r\n\r\n// Event handler for clicking on a tiddly link\r\nfunction onClickTiddlerLink(ev)\r\n{\r\n\tvar e = ev || window.event;\r\n\tvar target = resolveTarget(e);\r\n\tvar link = target;\r\n\tvar title = null;\r\n\tvar fields = null;\r\n\tvar noToggle = null;\r\n\tdo {\r\n\t\ttitle = link.getAttribute(\"tiddlyLink\");\r\n\t\tfields = link.getAttribute(\"tiddlyFields\");\r\n\t\tnoToggle = link.getAttribute(\"noToggle\");\r\n\t\tlink = link.parentNode;\r\n\t} while(title == null && link != null);\r\n\tif(!store.isShadowTiddler(title)) {\r\n\t\tvar f = fields ? fields.decodeHashMap() : {};\r\n\t\tfields = String.encodeHashMap(merge(f,config.defaultCustomFields,true));\r\n\t}\r\n\tif(title) {\r\n\t\tvar toggling = e.metaKey || e.ctrlKey;\r\n\t\tif(config.options.chkToggleLinks)\r\n\t\t\ttoggling = !toggling;\r\n\t\tif(noToggle)\r\n\t\t\ttoggling = false;\r\n\t\tif(store.getTiddler(title))\r\n\t\t\tfields = null;\r\n\t\tstory.displayTiddler(target,title,null,true,null,fields,toggling);\r\n\t}\r\n\tclearMessage();\r\n\treturn false;\r\n}\r\n\r\nfunction createTiddlyLink(place,title,includeText,className,isStatic,linkedFromTiddler,noToggle)\r\n{\r\n\tvar title = jQuery.trim(title);\r\n\tvar text = includeText ? title : null;\r\n\tvar i = getTiddlyLinkInfo(title,className);\r\n\tvar btn = isStatic ? createExternalLink(place,store.getTiddlerText(\"SiteUrl\",null) + \"#\" + title) : createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);\r\n\tif(isStatic)\r\n\t\tbtn.className += ' ' + className;\r\n\tbtn.setAttribute(\"refresh\",\"link\");\r\n\tbtn.setAttribute(\"tiddlyLink\",title);\r\n\tif(noToggle)\r\n\t\tbtn.setAttribute(\"noToggle\",\"true\");\r\n\tif(linkedFromTiddler) {\r\n\t\tvar fields = linkedFromTiddler.getInheritedFields();\r\n\t\tif(fields)\r\n\t\t\tbtn.setAttribute(\"tiddlyFields\",fields);\r\n\t}\r\n\treturn btn;\r\n}\r\n\r\nfunction refreshTiddlyLink(e,title)\r\n{\r\n\tvar i = getTiddlyLinkInfo(title,e.className);\r\n\te.className = i.classes;\r\n\te.title = i.subTitle;\r\n}\r\n\r\nfunction createTiddlyDropDown(place,onchange,options,defaultValue)\r\n{\r\n\tvar sel = createTiddlyElement(place,\"select\");\r\n\tsel.onchange = onchange;\r\n\tvar t;\r\n\tfor(t=0; t<options.length; t++) {\r\n\t\tvar e = createTiddlyElement(sel,\"option\",null,null,options[t].caption);\r\n\t\te.value = options[t].name;\r\n\t\tif(options[t].name == defaultValue)\r\n\t\t\te.selected = true;\r\n\t}\r\n\treturn sel;\r\n}\r\n\r\n//--\r\n//-- TiddlyWiki-specific popup utility functions\r\n//--\r\n\r\n// Event handler for 'open all' on a tiddler popup\r\nfunction onClickTagOpenAll(ev)\r\n{\r\n\tvar tiddlers = store.getTaggedTiddlers(this.getAttribute(\"tag\"));\r\n\tvar sortby = this.getAttribute(\"sortby\");\r\n\tif(sortby&&sortby.length) {\r\n\t\tstore.sortTiddlers(tiddlers,sortby);\r\n\t}\r\n\tstory.displayTiddlers(this,tiddlers);\r\n\treturn false;\r\n}\r\n\r\n// Event handler for clicking on a tiddler tag\r\nfunction onClickTag(ev)\r\n{\r\n\tvar e = ev || window.event;\r\n\tvar popup = Popup.create(this);\r\n\tjQuery(popup).addClass(\"taggedTiddlerList\");\r\n\tvar tag = this.getAttribute(\"tag\");\r\n\tvar title = this.getAttribute(\"tiddler\");\r\n\tif(popup && tag) {\r\n\t\tvar tagged = tag.indexOf(\"[\")==-1 ? store.getTaggedTiddlers(tag) : store.filterTiddlers(tag);\r\n\t\tvar sortby = this.getAttribute(\"sortby\");\r\n\t\tif(sortby&&sortby.length) {\r\n\t\t\tstore.sortTiddlers(tagged,sortby);\r\n\t\t}\r\n\t\tvar titles = [];\r\n\t\tvar r;\r\n\t\tfor(r=0;r<tagged.length;r++) {\r\n\t\t\tif(tagged[r].title != title)\r\n\t\t\t\ttitles.push(tagged[r].title);\r\n\t\t}\r\n\t\tvar lingo = config.views.wikified.tag;\r\n\t\tif(titles.length > 0) {\r\n\t\t\tvar openAll = createTiddlyButton(createTiddlyElement(popup,\"li\"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);\r\n\t\t\topenAll.setAttribute(\"tag\",tag);\r\n\t\t\topenAll.setAttribute(\"sortby\",sortby);\r\n\t\t\tcreateTiddlyElement(createTiddlyElement(popup,\"li\",null,\"listBreak\"),\"div\");\r\n\t\t\tfor(r=0; r<titles.length; r++) {\r\n\t\t\t\tcreateTiddlyLink(createTiddlyElement(popup,\"li\"),titles[r],true);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcreateTiddlyElement(popup,\"li\",null,\"disabled\",lingo.popupNone.format([tag]));\r\n\t\t}\r\n\t\tcreateTiddlyElement(createTiddlyElement(popup,\"li\",null,\"listBreak\"),\"div\");\r\n\t\tvar h = createTiddlyLink(createTiddlyElement(popup,\"li\"),tag,false);\r\n\t\tcreateTiddlyText(h,lingo.openTag.format([tag]));\r\n\t}\r\n\tPopup.show();\r\n\te.cancelBubble = true;\r\n\tif(e.stopPropagation) e.stopPropagation();\r\n\treturn false;\r\n}\r\n\r\n// Create a button for a tag with a popup listing all the tiddlers that it tags\r\nfunction createTagButton(place,tag,excludeTiddler,title,tooltip)\r\n{\r\n\tvar btn = createTiddlyButton(place,title||tag,(tooltip||config.views.wikified.tag.tooltip).format([tag]),onClickTag);\r\n\tbtn.setAttribute(\"tag\",tag);\r\n\tif(excludeTiddler)\r\n\t\tbtn.setAttribute(\"tiddler\",excludeTiddler);\r\n\treturn btn;\r\n}\r\n\r\nfunction onClickTiddlyPopup(ev)\r\n{\r\n\tvar e = ev || window.event;\r\n\tvar tiddler = this.tiddler;\r\n\tif(tiddler.text) {\r\n\t\tvar popup = Popup.create(this,\"div\",\"popupTiddler\");\r\n\t\twikify(tiddler.text,popup,null,tiddler);\r\n\t\tPopup.show();\r\n\t}\r\n\tif(e) e.cancelBubble = true;\r\n\tif(e && e.stopPropagation) e.stopPropagation();\r\n\treturn false;\r\n}\r\n\r\nfunction createTiddlyPopup(place,caption,tooltip,tiddler)\r\n{\r\n\tif(tiddler.text) {\r\n\t\tcreateTiddlyLink(place,caption,true);\r\n\t\tvar btn = createTiddlyButton(place,glyph(\"downArrow\"),tooltip,onClickTiddlyPopup,\"tiddlerPopupButton\");\r\n\t\tbtn.tiddler = tiddler;\r\n\t} else {\r\n\t\tcreateTiddlyText(place,caption);\r\n\t}\r\n}\r\n\r\nfunction onClickError(ev)\r\n{\r\n\tvar e = ev || window.event;\r\n\tvar popup = Popup.create(this);\r\n\tvar lines = this.getAttribute(\"errorText\").split(\"\\n\");\r\n\tvar t;\r\n\tfor(t=0; t<lines.length; t++)\r\n\t\tcreateTiddlyElement(popup,\"li\",null,null,lines[t]);\r\n\tPopup.show();\r\n\te.cancelBubble = true;\r\n\tif(e.stopPropagation) e.stopPropagation();\r\n\treturn false;\r\n}\r\n\r\nfunction createTiddlyError(place,title,text)\r\n{\r\n\tvar btn = createTiddlyButton(place,title,null,onClickError,\"errorButton\");\r\n\tif(text) btn.setAttribute(\"errorText\",text);\r\n}\r\n//-\r\n//- Animation engine\r\n//-\r\n\r\nfunction Animator()\r\n{\r\n\tthis.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled\r\n\tthis.timerID = 0; // ID of the timer used for animating\r\n\tthis.animations = []; // List of animations in progress\r\n\treturn this;\r\n}\r\n\r\n// Start animation engine\r\nAnimator.prototype.startAnimating = function() //# Variable number of arguments\r\n{\r\n\tvar t;\r\n\tfor(t=0; t<arguments.length; t++)\r\n\t\tthis.animations.push(arguments[t]);\r\n\tif(this.running == 0) {\r\n\t\tvar me = this;\r\n\t\tthis.timerID = window.setInterval(function() {me.doAnimate(me);},10);\r\n\t}\r\n\tthis.running += arguments.length;\r\n};\r\n\r\n// Perform an animation engine tick, calling each of the known animation modules\r\nAnimator.prototype.doAnimate = function(me)\r\n{\r\n\tvar a = 0;\r\n\twhile(a < me.animations.length) {\r\n\t\tvar animation = me.animations[a];\r\n\t\tif(animation.tick()) {\r\n\t\t\ta++;\r\n\t\t} else {\r\n\t\t\tme.animations.splice(a,1);\r\n\t\t\tif(--me.running == 0)\r\n\t\t\t\twindow.clearInterval(me.timerID);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nAnimator.slowInSlowOut = function(progress)\r\n{\r\n\treturn(1-((Math.cos(progress * Math.PI)+1)/2));\r\n};\r\n\r\n//--\r\n//-- Morpher animation\r\n//--\r\n\r\n// Animate a set of properties of an element\r\nfunction Morpher(element,duration,properties,callback)\r\n{\r\n\tthis.element = element;\r\n\tthis.duration = duration;\r\n\tthis.properties = properties;\r\n\tthis.startTime = new Date();\r\n\tthis.endTime = Number(this.startTime) + duration;\r\n\tthis.callback = callback;\r\n\tthis.tick();\r\n\treturn this;\r\n}\r\n\r\nMorpher.prototype.assignStyle = function(element,style,value)\r\n{\r\n\tswitch(style) {\r\n\tcase \"-tw-vertScroll\":\r\n\t\twindow.scrollTo(findScrollX(),value);\r\n\t\tbreak;\r\n\tcase \"-tw-horizScroll\":\r\n\t\twindow.scrollTo(value,findScrollY());\r\n\t\tbreak;\r\n\tdefault:\r\n\t\telement.style[style] = value;\r\n\t\tbreak;\r\n\t}\r\n};\r\n\r\nMorpher.prototype.stop = function()\r\n{\r\n\tvar t;\r\n\tfor(t=0; t<this.properties.length; t++) {\r\n\t\tvar p = this.properties[t];\r\n\t\tif(p.atEnd !== undefined) {\r\n\t\t\tthis.assignStyle(this.element,p.style,p.atEnd);\r\n\t\t}\r\n\t}\r\n\tif(this.callback)\r\n\t\tthis.callback(this.element,this.properties);\r\n};\r\n\r\nMorpher.prototype.tick = function()\r\n{\r\n\tvar currTime = Number(new Date());\r\n\tvar t,progress = Animator.slowInSlowOut(Math.min(1,(currTime-this.startTime)/this.duration));\r\n\tfor(t=0; t<this.properties.length; t++) {\r\n\t\tvar p = this.properties[t];\r\n\t\tif(p.start !== undefined && p.end !== undefined) {\r\n\t\t\tvar template = p.template || \"%0\";\r\n\t\t\tswitch(p.format) {\r\n\t\t\tcase undefined:\r\n\t\t\tcase \"style\":\r\n\t\t\t\tvar v = p.start + (p.end-p.start) * progress;\r\n\t\t\t\tthis.assignStyle(this.element,p.style,template.format([v]));\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"color\":\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif(currTime >= this.endTime) {\r\n\t\tthis.stop();\r\n\t\treturn false;\r\n\t}\r\n\treturn true;\r\n};\r\n\r\n//--\r\n//-- Zoomer animation\r\n//--\r\n\r\nfunction Zoomer(text,startElement,targetElement,unused)\r\n{\r\n\tvar e = createTiddlyElement(document.body,\"div\",null,\"zoomer\");\r\n\tcreateTiddlyElement(e,\"div\",null,null,text);\r\n\tvar winWidth = findWindowWidth();\r\n\tvar winHeight = findWindowHeight();\r\n\tvar p = [\r\n\t\t{style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px'},\r\n\t\t{style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px'},\r\n\t\t{style: 'width', start: Math.min(startElement.scrollWidth,winWidth), end: Math.min(targetElement.scrollWidth,winWidth), template: '%0px', atEnd: 'auto'},\r\n\t\t{style: 'height', start: Math.min(startElement.scrollHeight,winHeight), end: Math.min(targetElement.scrollHeight,winHeight), template: '%0px', atEnd: 'auto'},\r\n\t\t{style: 'fontSize', start: 8, end: 24, template: '%0pt'}\r\n\t];\r\n\tvar c = function(element,properties) {jQuery(element).remove();};\r\n\treturn new Morpher(e,config.animDuration,p,c);\r\n}\r\n\r\n//--\r\n//-- Scroller animation\r\n//--\r\n\r\nfunction Scroller(targetElement)\r\n{\r\n\tvar p = [{style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)}];\r\n\treturn new Morpher(targetElement,config.animDuration,p);\r\n}\r\n\r\n//--\r\n//-- Slider animation\r\n//--\r\n\r\n// deleteMode - \"none\", \"all\" [delete target element and it's children], [only] \"children\" [but not the target element]\r\nfunction Slider(element,opening,unused,deleteMode)\r\n{\r\n\telement.style.overflow = 'hidden';\r\n\tif(opening)\r\n\t\telement.style.height = '0px'; // Resolves a Firefox flashing bug\r\n\telement.style.display = 'block';\r\n\tvar height = element.scrollHeight;\r\n\tvar p = [];\r\n\tvar c = null;\r\n\tif(opening) {\r\n\t\tp.push({style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto'});\r\n\t\tp.push({style: 'opacity', start: 0, end: 1, template: '%0'});\r\n\t\tp.push({style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)'});\r\n\t} else {\r\n\t\tp.push({style: 'height', start: height, end: 0, template: '%0px'});\r\n\t\tp.push({style: 'display', atEnd: 'none'});\r\n\t\tp.push({style: 'opacity', start: 1, end: 0, template: '%0'});\r\n\t\tp.push({style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)'});\r\n\t\tswitch(deleteMode) {\r\n\t\tcase \"all\":\r\n\t\t\tc = function(element,properties) {jQuery(element).remove();};\r\n\t\t\tbreak;\r\n\t\tcase \"children\":\r\n\t\t\tc = function(element,properties) {jQuery(element).empty();};\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn new Morpher(element,config.animDuration,p,c);\r\n}\r\n\r\n//--\r\n//-- Popup menu\r\n//--\r\n\r\nvar Popup = {\r\n\tstack: [] // Array of objects with members root: and popup:\r\n\t};\r\n\r\nPopup.create = function(root,elem,className)\r\n{\r\n\tvar stackPosition = this.find(root,\"popup\");\r\n\tPopup.remove(stackPosition+1);\r\n\tvar popup = createTiddlyElement(document.body,elem || \"ol\",\"popup\",className || \"popup\");\r\n\tpopup.stackPosition = stackPosition;\r\n\tPopup.stack.push({root: root, popup: popup});\r\n\treturn popup;\r\n};\r\n\r\nPopup.onDocumentClick = function(ev)\r\n{\r\n\tvar e = ev || window.event;\r\n\tif(e.eventPhase == undefined)\r\n\t\tPopup.remove();\r\n\telse if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)\r\n\t\tPopup.remove();\r\n\treturn true;\r\n};\r\n\r\nPopup.show = function(valign,halign,offset)\r\n{\r\n\tvar curr = Popup.stack[Popup.stack.length-1];\r\n\tthis.place(curr.root,curr.popup,valign,halign,offset);\r\n\tjQuery(curr.root).addClass(\"highlight\");\r\n\tif(config.options.chkAnimate && anim && typeof Scroller == \"function\")\r\n\t\tanim.startAnimating(new Scroller(curr.popup));\r\n\telse\r\n\t\twindow.scrollTo(0,ensureVisible(curr.popup));\r\n};\r\n\r\nPopup.place = function(root,popup,valign,halign,offset)\r\n{\r\n\tif(!offset)\r\n\t\toffset = {x:0,y:0};\r\n\tif(popup.stackPosition >= 0 && !valign && !halign) {\r\n\t\toffset.x = offset.x + root.offsetWidth;\r\n\t} else {\r\n\t\toffset.x = (halign == \"right\") ? offset.x + root.offsetWidth : offset.x;\r\n\t\toffset.y = (valign == \"top\") ? offset.y : offset.y + root.offsetHeight;\r\n\t}\r\n\tvar rootLeft = findPosX(root);\r\n\tvar rootTop = findPosY(root);\r\n\tvar popupLeft = rootLeft + offset.x;\r\n\tvar popupTop = rootTop + offset.y;\r\n\tvar winWidth = findWindowWidth();\r\n\tif(popup.offsetWidth > winWidth*0.75)\r\n\t\tpopup.style.width = winWidth*0.75 + \"px\";\r\n\tvar popupWidth = popup.offsetWidth;\r\n\tvar scrollWidth = winWidth - document.body.offsetWidth;\r\n\tif(popupLeft + popupWidth > winWidth - scrollWidth - 1) {\r\n\t\tif(halign == \"right\")\r\n\t\t\tpopupLeft = popupLeft - root.offsetWidth - popupWidth;\r\n\t\telse\r\n\t\t\tpopupLeft = winWidth - popupWidth - scrollWidth - 1;\r\n\t}\r\n\tpopup.style.left = popupLeft + \"px\";\r\n\tpopup.style.top = popupTop + \"px\";\r\n\tpopup.style.display = \"block\";\r\n};\r\n\r\nPopup.find = function(e)\r\n{\r\n\tvar t,pos = -1;\r\n\tfor(t=this.stack.length-1; t>=0; t--) {\r\n\t\tif(isDescendant(e,this.stack[t].popup))\r\n\t\t\tpos = t;\r\n\t}\r\n\treturn pos;\r\n};\r\n\r\nPopup.remove = function(pos)\r\n{\r\n\tif(!pos) pos = 0;\r\n\tif(Popup.stack.length > pos) {\r\n\t\tPopup.removeFrom(pos);\r\n\t}\r\n};\r\n\r\nPopup.removeFrom = function(from)\r\n{\r\n\tvar t;\r\n\tfor(t=Popup.stack.length-1; t>=from; t--) {\r\n\t\tvar p = Popup.stack[t];\r\n\t\tjQuery(p.root).removeClass(\"highlight\");\r\n\t\tjQuery(p.popup).remove();\r\n\t}\r\n\tPopup.stack = Popup.stack.slice(0,from);\r\n};\r\n\r\n//--\r\n//-- Wizard support\r\n//--\r\n\r\nfunction Wizard(elem)\r\n{\r\n\tif(elem) {\r\n\t\tthis.formElem = findRelated(elem,\"wizard\",\"className\");\r\n\t\tthis.bodyElem = findRelated(this.formElem.firstChild,\"wizardBody\",\"className\",\"nextSibling\");\r\n\t\tthis.footElem = findRelated(this.formElem.firstChild,\"wizardFooter\",\"className\",\"nextSibling\");\r\n\t} else {\r\n\t\tthis.formElem = null;\r\n\t\tthis.bodyElem = null;\r\n\t\tthis.footElem = null;\r\n\t}\r\n}\r\n\r\nWizard.prototype.setValue = function(name,value)\r\n{\r\n\tjQuery(this.formElem).data(name, value);\r\n};\r\n\r\nWizard.prototype.getValue = function(name)\r\n{\r\n\treturn this.formElem ? jQuery(this.formElem).data(name) : null;\r\n};\r\n\r\nWizard.prototype.createWizard = function(place,title)\r\n{\r\n\tthis.formElem = createTiddlyElement(place,\"form\",null,\"wizard\");\r\n\tcreateTiddlyElement(this.formElem,\"h1\",null,null,title);\r\n\tthis.bodyElem = createTiddlyElement(this.formElem,\"div\",null,\"wizardBody\");\r\n\tthis.footElem = createTiddlyElement(this.formElem,\"div\",null,\"wizardFooter\");\r\n\treturn this.formElem;\r\n};\r\n\r\nWizard.prototype.clear = function()\r\n{\r\n\tjQuery(this.bodyElem).empty();\r\n};\r\n\r\nWizard.prototype.setButtons = function(buttonInfo,status)\r\n{\r\n\tjQuery(this.footElem).empty();\r\n\tvar t;\r\n\tfor(t=0; t<buttonInfo.length; t++) {\r\n\t\tcreateTiddlyButton(this.footElem,buttonInfo[t].caption,buttonInfo[t].tooltip,buttonInfo[t].onClick);\r\n\t\tinsertSpacer(this.footElem);\r\n\t\t}\r\n\tif(typeof status == \"string\") {\r\n\t\tcreateTiddlyElement(this.footElem,\"span\",null,\"status\",status);\r\n\t}\r\n};\r\n\r\nWizard.prototype.addStep = function(stepTitle,html)\r\n{\r\n\tjQuery(this.bodyElem).empty();\r\n\tvar w = createTiddlyElement(this.bodyElem,\"div\");\r\n\tcreateTiddlyElement(w,\"h2\",null,null,stepTitle);\r\n\tvar step = createTiddlyElement(w,\"div\",null,\"wizardStep\");\r\n\tstep.innerHTML = html;\r\n\tapplyHtmlMacros(step,tiddler);\r\n};\r\n\r\nWizard.prototype.getElement = function(name)\r\n{\r\n\treturn this.formElem.elements[name];\r\n};\r\n\r\n//--\r\n//-- ListView gadget\r\n//--\r\n\r\nvar ListView = {};\r\n\r\n// Create a listview\r\nListView.create = function(place,listObject,listTemplate,callback,className)\r\n{\r\n\tvar table = createTiddlyElement(place,\"table\",null,className || \"listView twtable\");\r\n\tvar thead = createTiddlyElement(table,\"thead\");\r\n\tvar t,r = createTiddlyElement(thead,\"tr\");\r\n\tfor(t=0; t<listTemplate.columns.length; t++) {\r\n\t\tvar columnTemplate = listTemplate.columns[t];\r\n\t\tvar c = createTiddlyElement(r,\"th\");\r\n\t\tvar colType = ListView.columnTypes[columnTemplate.type];\r\n\t\tif(colType && colType.createHeader) {\r\n\t\t\tcolType.createHeader(c,columnTemplate,t);\r\n\t\t\tif(columnTemplate.className)\r\n\t\t\t\tjQuery(c).addClass(columnTemplate.className);\r\n\t\t}\r\n\t}\r\n\tvar rc,tbody = createTiddlyElement(table,\"tbody\");\r\n\tfor(rc=0; rc<listObject.length; rc++) {\r\n\t\tvar rowObject = listObject[rc];\r\n\t\tr = createTiddlyElement(tbody,\"tr\");\r\n\t\tfor(c=0; c<listTemplate.rowClasses.length; c++) {\r\n\t\t\tif(rowObject[listTemplate.rowClasses[c].field])\r\n\t\t\t\tjQuery(r).addClass(listTemplate.rowClasses[c].className);\r\n\t\t}\r\n\t\trowObject.rowElement = r;\r\n\t\trowObject.colElements = {};\r\n\t\tvar cc;\r\n\t\tfor(cc=0; cc<listTemplate.columns.length; cc++) {\r\n\t\t\tc = createTiddlyElement(r,\"td\");\r\n\t\t\tcolumnTemplate = listTemplate.columns[cc];\r\n\t\t\tvar field = columnTemplate.field;\r\n\t\t\tcolType = ListView.columnTypes[columnTemplate.type];\r\n\t\t\tif(colType && colType.createItem) {\r\n\t\t\t\tcolType.createItem(c,rowObject,field,columnTemplate,cc,rc);\r\n\t\t\t\tif(columnTemplate.className)\r\n\t\t\t\t\tjQuery(c).addClass(columnTemplate.className);\r\n\t\t\t}\r\n\t\t\trowObject.colElements[field] = c;\r\n\t\t}\r\n\t}\r\n\tif(callback && listTemplate.actions)\r\n\t\tcreateTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);\r\n\tif(callback && listTemplate.buttons) {\r\n\t\tfor(t=0; t<listTemplate.buttons.length; t++) {\r\n\t\t\tvar a = listTemplate.buttons[t];\r\n\t\t\tif(a && a.name != \"\")\r\n\t\t\t\tcreateTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));\r\n\t\t}\r\n\t}\r\n\treturn table;\r\n};\r\n\r\nListView.getCommandHandler = function(callback,name,allowEmptySelection)\r\n{\r\n\treturn function(e) {\r\n\t\tvar view = findRelated(this,\"TABLE\",null,\"previousSibling\");\r\n\t\tvar tiddlers = [];\r\n\t\tListView.forEachSelector(view,function(e,rowName) {\r\n\t\t\t\t\tif(e.checked)\r\n\t\t\t\t\t\ttiddlers.push(rowName);\r\n\t\t\t\t\t});\r\n\t\tif(tiddlers.length == 0 && !allowEmptySelection) {\r\n\t\t\talert(config.messages.nothingSelected);\r\n\t\t} else {\r\n\t\t\tif(this.nodeName.toLowerCase() == \"select\") {\r\n\t\t\t\tcallback(view,this.value,tiddlers);\r\n\t\t\t\tthis.selectedIndex = 0;\r\n\t\t\t} else {\r\n\t\t\t\tcallback(view,name,tiddlers);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};\r\n\r\n// Invoke a callback for each selector checkbox in the listview\r\nListView.forEachSelector = function(view,callback)\r\n{\r\n\tvar checkboxes = view.getElementsByTagName(\"input\");\r\n\tvar t,hadOne = false;\r\n\tfor(t=0; t<checkboxes.length; t++) {\r\n\t\tvar cb = checkboxes[t];\r\n\t\tif(cb.getAttribute(\"type\") == \"checkbox\") {\r\n\t\t\tvar rn = cb.getAttribute(\"rowName\");\r\n\t\t\tif(rn) {\r\n\t\t\t\tcallback(cb,rn);\r\n\t\t\t\thadOne = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn hadOne;\r\n};\r\n\r\nListView.getSelectedRows = function(view)\r\n{\r\n\tvar rowNames = [];\r\n\tListView.forEachSelector(view,function(e,rowName) {\r\n\t\t\t\tif(e.checked)\r\n\t\t\t\t\trowNames.push(rowName);\r\n\t\t\t\t});\r\n\treturn rowNames;\r\n};\r\n\r\nListView.columnTypes = {};\r\n\r\nListView.columnTypes.String = {\r\n\tcreateHeader: function(place,columnTemplate,col)\r\n\t\t{\r\n\t\t\tcreateTiddlyText(place,columnTemplate.title);\r\n\t\t},\r\n\tcreateItem: function(place,listObject,field,columnTemplate,col,row)\r\n\t\t{\r\n\t\t\tvar v = listObject[field];\r\n\t\t\tif(v != undefined)\r\n\t\t\t\tcreateTiddlyText(place,v);\r\n\t\t}\r\n};\r\n\r\nListView.columnTypes.WikiText = {\r\n\tcreateHeader: ListView.columnTypes.String.createHeader,\r\n\tcreateItem: function(place,listObject,field,columnTemplate,col,row)\r\n\t\t{\r\n\t\t\tvar v = listObject[field];\r\n\t\t\tif(v != undefined)\r\n\t\t\t\twikify(v,place,null,null);\r\n\t\t}\r\n};\r\n\r\nListView.columnTypes.Tiddler = {\r\n\tcreateHeader: ListView.columnTypes.String.createHeader,\r\n\tcreateItem: function(place,listObject,field,columnTemplate,col,row)\r\n\t\t{\r\n\t\t\tvar v = listObject[field];\r\n\t\t\tif(v != undefined && v.title)\r\n\t\t\t\tcreateTiddlyPopup(place,v.title,config.messages.listView.tiddlerTooltip,v);\r\n\t\t}\r\n};\r\n\r\nListView.columnTypes.Size = {\r\n\tcreateHeader: ListView.columnTypes.String.createHeader,\r\n\tcreateItem: function(place,listObject,field,columnTemplate,col,row)\r\n\t\t{\r\n\t\t\tvar msg = config.messages.sizeTemplates;\r\n\t\t\tvar v = listObject[field];\r\n\t\t\tif(v != undefined) {\r\n\t\t\t\tvar t = 0;\r\n\t\t\t\twhile(t<msg.length-1 && v<msg[t].unit)\r\n\t\t\t\t\tt++;\r\n\t\t\t\tcreateTiddlyText(place,msg[t].template.format([Math.round(v/msg[t].unit)]));\r\n\t\t\t}\r\n\t\t}\r\n};\r\n\r\nListView.columnTypes.Link = {\r\n\tcreateHeader: ListView.columnTypes.String.createHeader,\r\n\tcreateItem: function(place,listObject,field,columnTemplate,col,row)\r\n\t\t{\r\n\t\t\tvar v = listObject[field];\r\n\t\t\tvar c = columnTemplate.text;\r\n\t\t\tif(v != undefined)\r\n\t\t\t\tcreateExternalLink(place,v,c || v);\r\n\t\t}\r\n};\r\n\r\nListView.columnTypes.Date = {\r\n\tcreateHeader: ListView.columnTypes.String.createHeader,\r\n\tcreateItem: function(place,listObject,field,columnTemplate,col,row)\r\n\t\t{\r\n\t\t\tvar v = listObject[field];\r\n\t\t\tif(v != undefined)\r\n\t\t\t\tcreateTiddlyText(place,v.formatString(columnTemplate.dateFormat));\r\n\t\t}\r\n};\r\n\r\nListView.columnTypes.StringList = {\r\n\tcreateHeader: ListView.columnTypes.String.createHeader,\r\n\tcreateItem: function(place,listObject,field,columnTemplate,col,row)\r\n\t\t{\r\n\t\t\tvar v = listObject[field];\r\n\t\t\tif(v != undefined) {\r\n\t\t\t\tvar t;\r\n\t\t\t\tfor(t=0; t<v.length; t++) {\r\n\t\t\t\t\tcreateTiddlyText(place,v[t]);\r\n\t\t\t\t\tcreateTiddlyElement(place,\"br\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n};\r\n\r\nListView.columnTypes.Selector = {\r\n\tcreateHeader: function(place,columnTemplate,col)\r\n\t\t{\r\n\t\t\tcreateTiddlyCheckbox(place,null,false,this.onHeaderChange);\r\n\t\t},\r\n\tcreateItem: function(place,listObject,field,columnTemplate,col,row)\r\n\t\t{\r\n\t\t\tvar e = createTiddlyCheckbox(place,null,listObject[field],null);\r\n\t\t\te.setAttribute(\"rowName\",listObject[columnTemplate.rowName]);\r\n\t\t},\r\n\tonHeaderChange: function(e)\r\n\t\t{\r\n\t\t\tvar state = this.checked;\r\n\t\t\tvar view = findRelated(this,\"TABLE\");\r\n\t\t\tif(!view)\r\n\t\t\t\treturn;\r\n\t\t\tListView.forEachSelector(view,function(e,rowName) {\r\n\t\t\t\t\t\t\t\te.checked = state;\r\n\t\t\t\t\t\t\t});\r\n\t\t}\r\n};\r\n\r\nListView.columnTypes.Tags = {\r\n\tcreateHeader: ListView.columnTypes.String.createHeader,\r\n\tcreateItem: function(place,listObject,field,columnTemplate,col,row)\r\n\t\t{\r\n\t\t\tvar tags = listObject[field];\r\n\t\t\tcreateTiddlyText(place,String.encodeTiddlyLinkList(tags));\r\n\t\t}\r\n};\r\n\r\nListView.columnTypes.Boolean = {\r\n\tcreateHeader: ListView.columnTypes.String.createHeader,\r\n\tcreateItem: function(place,listObject,field,columnTemplate,col,row)\r\n\t\t{\r\n\t\t\tif(listObject[field] == true)\r\n\t\t\t\tcreateTiddlyText(place,columnTemplate.trueText);\r\n\t\t\tif(listObject[field] == false)\r\n\t\t\t\tcreateTiddlyText(place,columnTemplate.falseText);\r\n\t\t}\r\n};\r\n\r\nListView.columnTypes.TagCheckbox = {\r\n\tcreateHeader: ListView.columnTypes.String.createHeader,\r\n\tcreateItem: function(place,listObject,field,columnTemplate,col,row)\r\n\t\t{\r\n\t\t\tvar e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);\r\n\t\t\te.setAttribute(\"tiddler\",listObject.title);\r\n\t\t\te.setAttribute(\"tag\",columnTemplate.tag);\r\n\t\t},\r\n\tonChange : function(e)\r\n\t\t{\r\n\t\t\tvar tag = this.getAttribute(\"tag\");\r\n\t\t\tvar tiddler = this.getAttribute(\"tiddler\");\r\n\t\t\tstore.setTiddlerTag(tiddler,this.checked,tag);\r\n\t\t}\r\n};\r\n\r\nListView.columnTypes.TiddlerLink = {\r\n\tcreateHeader: ListView.columnTypes.String.createHeader,\r\n\tcreateItem: function(place,listObject,field,columnTemplate,col,row)\r\n\t\t{\r\n\t\t\tvar v = listObject[field];\r\n\t\t\tif(v != undefined) {\r\n\t\t\t\tvar link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);\r\n\t\t\t\tcreateTiddlyText(link,listObject[field]);\r\n\t\t\t}\r\n\t\t}\r\n};\r\n\r\n//--\r\n//-- Augmented methods for the JavaScript Array() object\r\n//--\r\n\r\n// Add indexOf function if browser does not support it\r\nif(!Array.indexOf) {\r\nArray.prototype.indexOf = function(item,from)\r\n{\r\n\tif(!from)\r\n\t\tfrom = 0;\r\n\tvar i;\r\n\tfor(i=from; i<this.length; i++) {\r\n\t\tif(this[i] === item)\r\n\t\t\treturn i;\r\n\t}\r\n\treturn -1;\r\n};}\r\n\r\n// Find an entry in a given field of the members of an array\r\nArray.prototype.findByField = function(field,value)\r\n{\r\n\tvar t;\r\n\tfor(t=0; t<this.length; t++) {\r\n\t\tif(this[t][field] === value)\r\n\t\t\treturn t;\r\n\t}\r\n\treturn null;\r\n};\r\n\r\n// Return whether an entry exists in an array\r\nArray.prototype.contains = function(item)\r\n{\r\n\treturn this.indexOf(item) != -1;\r\n};\r\n\r\n// Adds, removes or toggles a particular value within an array\r\n//  value - value to add\r\n//  mode - +1 to add value, -1 to remove value, 0 to toggle it\r\nArray.prototype.setItem = function(value,mode)\r\n{\r\n\tvar p = this.indexOf(value);\r\n\tif(mode == 0)\r\n\t\tmode = (p == -1) ? +1 : -1;\r\n\tif(mode == +1) {\r\n\t\tif(p == -1)\r\n\t\t\tthis.push(value);\r\n\t} else if(mode == -1) {\r\n\t\tif(p != -1)\r\n\t\t\tthis.splice(p,1);\r\n\t}\r\n};\r\n\r\n// Return whether one of a list of values exists in an array\r\nArray.prototype.containsAny = function(items)\r\n{\r\n\tvar i;\r\n\tfor(i=0; i<items.length; i++) {\r\n\t\tif(this.indexOf(items[i]) != -1)\r\n\t\t\treturn true;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n// Return whether all of a list of values exists in an array\r\nArray.prototype.containsAll = function(items)\r\n{\r\n\tvar i;\r\n\tfor(i = 0; i<items.length; i++) {\r\n\t\tif(this.indexOf(items[i]) == -1)\r\n\t\t\treturn false;\r\n\t}\r\n\treturn true;\r\n};\r\n\r\n// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push\r\nArray.prototype.pushUnique = function(item,unique)\r\n{\r\n\tif(unique === false) {\r\n\t\tthis.push(item);\r\n\t} else {\r\n\t\tif(this.indexOf(item) == -1)\r\n\t\t\tthis.push(item);\r\n\t}\r\n};\r\n\r\nArray.prototype.remove = function(item)\r\n{\r\n\tvar p = this.indexOf(item);\r\n\tif(p != -1)\r\n\t\tthis.splice(p,1);\r\n};\r\n\r\nif(!Array.prototype.map) {\r\nArray.prototype.map = function(fn,thisObj)\r\n{\r\n\tvar scope = thisObj || window;\r\n\tvar i,j,a = [];\r\n\tfor(i=0, j=this.length; i < j; ++i) {\r\n\t\ta.push(fn.call(scope,this[i],i,this));\r\n\t}\r\n\treturn a;\r\n};}\r\n\r\n//--\r\n//-- Augmented methods for the JavaScript String() object\r\n//--\r\n\r\n// Get characters from the right end of a string\r\nString.prototype.right = function(n)\r\n{\r\n\treturn n < this.length ? this.slice(this.length-n) : this;\r\n};\r\n\r\n// Trim whitespace from both ends of a string\r\nString.prototype.trim = function()\r\n{\r\n\treturn this.replace(/^\\s*|\\s*$/g,\"\");\r\n};\r\n\r\n// Convert a string from a CSS style property name to a JavaScript style name (\"background-color\" -> \"backgroundColor\")\r\nString.prototype.unDash = function()\r\n{\r\n\tvar t,s = this.split(\"-\");\r\n\tif(s.length > 1) {\r\n\t\tfor(t=1; t<s.length; t++)\r\n\t\t\ts[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);\r\n\t}\r\n\treturn s.join(\"\");\r\n};\r\n\r\n// Substitute substrings from an array into a format string that includes '%1'-type specifiers\r\nString.prototype.format = function(s)\r\n{\r\n\tvar substrings = s && s.constructor == Array ? s : arguments;\r\n\tvar subRegExp = /(?:%(\\d+))/mg;\r\n\tvar currPos = 0;\r\n\tvar match,r = [];\r\n\tdo {\r\n\t\tmatch = subRegExp.exec(this);\r\n\t\tif(match && match[1]) {\r\n\t\t\tif(match.index > currPos)\r\n\t\t\t\tr.push(this.substring(currPos,match.index));\r\n\t\t\tr.push(substrings[parseInt(match[1],10)]);\r\n\t\t\tcurrPos = subRegExp.lastIndex;\r\n\t\t}\r\n\t} while(match);\r\n\tif(currPos < this.length)\r\n\t\tr.push(this.substring(currPos,this.length));\r\n\treturn r.join(\"\");\r\n};\r\n\r\n// Escape any special RegExp characters with that character preceded by a backslash\r\nString.prototype.escapeRegExp = function()\r\n{\r\n\tvar s = \"\\\\^$*+?()=!|,{}[].\";\r\n\tvar t,c = this;\r\n\tfor(t=0; t<s.length; t++)\r\n\t\tc = c.replace(new RegExp(\"\\\\\" + s.substr(t,1),\"g\"),\"\\\\\" + s.substr(t,1));\r\n\treturn c;\r\n};\r\n\r\n// Convert \"\\\" to \"\\s\", newlines to \"\\n\" (and remove carriage returns)\r\nString.prototype.escapeLineBreaks = function()\r\n{\r\n\treturn this.replace(/\\\\/mg,\"\\\\s\").replace(/\\n/mg,\"\\\\n\").replace(/\\r/mg,\"\");\r\n};\r\n\r\n// Convert \"\\n\" to newlines, \"\\b\" to \" \", \"\\s\" to \"\\\" (and remove carriage returns)\r\nString.prototype.unescapeLineBreaks = function()\r\n{\r\n\treturn this.replace(/\\\\n/mg,\"\\n\").replace(/\\\\b/mg,\" \").replace(/\\\\s/mg,\"\\\\\").replace(/\\r/mg,\"\");\r\n};\r\n\r\n// Convert & to \"&amp;\", < to \"&lt;\", > to \"&gt;\" and \" to \"&quot;\"\r\nString.prototype.htmlEncode = function()\r\n{\r\n\treturn this.replace(/&/mg,\"&amp;\").replace(/</mg,\"&lt;\").replace(/>/mg,\"&gt;\").replace(/\\\"/mg,\"&quot;\");\r\n};\r\n\r\n// Convert \"&amp;\" to &, \"&lt;\" to <, \"&gt;\" to > and \"&quot;\" to \"\r\nString.prototype.htmlDecode = function()\r\n{\r\n\treturn this.replace(/&lt;/mg,\"<\").replace(/&gt;/mg,\">\").replace(/&quot;/mg,\"\\\"\").replace(/&amp;/mg,\"&\");\r\n};\r\n\r\n// Parse a space-separated string of name:value parameters\r\n// The result is an array of objects:\r\n//   result[0] = object with a member for each parameter name, value of that member being an array of values\r\n//   result[1..n] = one object for each parameter, with 'name' and 'value' members\r\nString.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)\r\n{\r\n\tvar parseToken = function(match,p) {\r\n\t\tvar n;\r\n\t\tif(match[p]) // Double quoted\r\n\t\t\tn = match[p];\r\n\t\telse if(match[p+1]) // Single quoted\r\n\t\t\tn = match[p+1];\r\n\t\telse if(match[p+2]) // Double-square-bracket quoted\r\n\t\t\tn = match[p+2];\r\n\t\telse if(match[p+3]) // Double-brace quoted\r\n\t\t\ttry {\r\n\t\t\t\tn = match[p+3];\r\n\t\t\t\tif(allowEval && config.evaluateMacroParameters != \"none\") {\r\n\t\t\t\t\tif(config.evaluateMacroParameters == \"restricted\") {\r\n\t\t\t\t\t\tif(window.restrictedEval) {\r\n\t\t\t\t\t\t\tn = window.restrictedEval(n);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tn = window.eval(n);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} catch(ex) {\r\n\t\t\t\tthrow \"Unable to evaluate {{\" + match[p+3] + \"}}: \" + exceptionText(ex);\r\n\t\t\t}\r\n\t\telse if(match[p+4]) // Unquoted\r\n\t\t\tn = match[p+4];\r\n\t\telse if(match[p+5]) // empty quote\r\n\t\t\tn = \"\";\r\n\t\treturn n;\r\n\t};\r\n\tvar r = [{}];\r\n\tvar dblQuote = \"(?:\\\"((?:(?:\\\\\\\\\\\")|[^\\\"])+)\\\")\";\r\n\tvar sngQuote = \"(?:'((?:(?:\\\\\\\\\\')|[^'])+)')\";\r\n\tvar dblSquare = \"(?:\\\\[\\\\[((?:\\\\s|\\\\S)*?)\\\\]\\\\])\";\r\n\tvar dblBrace = \"(?:\\\\{\\\\{((?:\\\\s|\\\\S)*?)\\\\}\\\\})\";\r\n\tvar unQuoted = noNames ? \"([^\\\"'\\\\s]\\\\S*)\" : \"([^\\\"':\\\\s][^\\\\s:]*)\";\r\n\tvar emptyQuote = \"((?:\\\"\\\")|(?:''))\";\r\n\tvar skipSpace = \"(?:\\\\s*)\";\r\n\tvar token = \"(?:\" + dblQuote + \"|\" + sngQuote + \"|\" + dblSquare + \"|\" + dblBrace + \"|\" + unQuoted + \"|\" + emptyQuote + \")\";\r\n\tvar re = noNames ? new RegExp(token,\"mg\") : new RegExp(skipSpace + token + skipSpace + \"(?:(\\\\:)\" + skipSpace + token + \")?\",\"mg\");\r\n\tvar match;\r\n\tdo {\r\n\t\tmatch = re.exec(this);\r\n\t\tif(match) {\r\n\t\t\tvar n = parseToken(match,1);\r\n\t\t\tif(noNames) {\r\n\t\t\t\tr.push({name:\"\",value:n});\r\n\t\t\t} else {\r\n\t\t\t\tvar v = parseToken(match,8);\r\n\t\t\t\tif(v == null && defaultName) {\r\n\t\t\t\t\tv = n;\r\n\t\t\t\t\tn = defaultName;\r\n\t\t\t\t} else if(v == null && defaultValue) {\r\n\t\t\t\t\tv = defaultValue;\r\n\t\t\t\t}\r\n\t\t\t\tr.push({name:n,value:v});\r\n\t\t\t\tif(cascadeDefaults) {\r\n\t\t\t\t\tdefaultName = n;\r\n\t\t\t\t\tdefaultValue = v;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} while(match);\r\n\t// Summarise parameters into first element\r\n\tvar t;\r\n\tfor(t=1; t<r.length; t++) {\r\n\t\tif(r[0][r[t].name])\r\n\t\t\tr[0][r[t].name].push(r[t].value);\r\n\t\telse\r\n\t\t\tr[0][r[t].name] = [r[t].value];\r\n\t}\r\n\treturn r;\r\n};\r\n\r\n// Process a string list of macro parameters into an array. Parameters can be quoted with \"\", '',\r\n// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in\r\n// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.\r\nString.prototype.readMacroParams = function(notAllowEval)\r\n{\r\n\tvar p = this.parseParams(\"list\",null,!notAllowEval,true);\r\n\tvar t,n = [];\r\n\tfor(t=1; t<p.length; t++)\r\n\t\tn.push(p[t].value);\r\n\treturn n;\r\n};\r\n\r\n// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]\r\nString.prototype.readBracketedList = function(unique)\r\n{\r\n\tvar p = this.parseParams(\"list\",null,false,true);\r\n\tvar t,n = [];\r\n\tfor(t=1; t<p.length; t++) {\r\n\t\tif(p[t].value)\r\n\t\t\tn.pushUnique(p[t].value,unique);\r\n\t}\r\n\treturn n;\r\n};\r\n\r\n// Returns array with start and end index of chunk between given start and end marker, or undefined.\r\nString.prototype.getChunkRange = function(start,end)\r\n{\r\n\tvar s = this.indexOf(start);\r\n\tif(s != -1) {\r\n\t\ts += start.length;\r\n\t\tvar e = this.indexOf(end,s);\r\n\t\tif(e != -1)\r\n\t\t\treturn [s,e];\r\n\t}\r\n};\r\n\r\n// Replace a chunk of a string given start and end markers\r\nString.prototype.replaceChunk = function(start,end,sub)\r\n{\r\n\tvar r = this.getChunkRange(start,end);\r\n\treturn r ? this.substring(0,r[0]) + sub + this.substring(r[1]) : this;\r\n};\r\n\r\n// Returns a chunk of a string between start and end markers, or undefined\r\nString.prototype.getChunk = function(start,end)\r\n{\r\n\tvar r = this.getChunkRange(start,end);\r\n\tif(r)\r\n\t\treturn this.substring(r[0],r[1]);\r\n};\r\n\r\n\r\n// Static method to bracket a string with double square brackets if it contains a space\r\nString.encodeTiddlyLink = function(title)\r\n{\r\n\treturn title.indexOf(\" \") == -1 ? title : \"[[\" + title + \"]]\";\r\n};\r\n\r\n// Static method to encodeTiddlyLink for every item in an array and join them with spaces\r\nString.encodeTiddlyLinkList = function(list)\r\n{\r\n\tif(list) {\r\n\t\tvar t,results = [];\r\n\t\tfor(t=0; t<list.length; t++)\r\n\t\t\tresults.push(String.encodeTiddlyLink(list[t]));\r\n\t\treturn results.join(\" \");\r\n\t} else {\r\n\t\treturn \"\";\r\n\t}\r\n};\r\n\r\n// Convert a string as a sequence of name:\"value\" pairs into a hashmap\r\nString.prototype.decodeHashMap = function()\r\n{\r\n\tvar fields = this.parseParams(\"anon\",\"\",false);\r\n\tvar t,r = {};\r\n\tfor(t=1; t<fields.length; t++)\r\n\t\tr[fields[t].name] = fields[t].value;\r\n\treturn r;\r\n};\r\n\r\n// Static method to encode a hashmap into a name:\"value\"... string\r\nString.encodeHashMap = function(hashmap)\r\n{\r\n\tvar t,r = [];\r\n\tfor(t in hashmap)\r\n\t\tr.push(t + ':\"' + hashmap[t] + '\"');\r\n\treturn r.join(\" \");\r\n};\r\n\r\n// Static method to left-pad a string with 0s to a certain width\r\nString.zeroPad = function(n,d)\r\n{\r\n\tvar s = n.toString();\r\n\tif(s.length < d)\r\n\t\ts = \"000000000000000000000000000\".substr(0,d-s.length) + s;\r\n\treturn s;\r\n};\r\n\r\nString.prototype.startsWith = function(prefix)\r\n{\r\n\treturn !prefix || this.substring(0,prefix.length) == prefix;\r\n};\r\n\r\n// Returns the first value of the given named parameter.\r\nfunction getParam(params,name,defaultValue)\r\n{\r\n\tif(!params)\r\n\t\treturn defaultValue;\r\n\tvar p = params[0][name];\r\n\treturn p ? p[0] : defaultValue;\r\n}\r\n\r\n// Returns the first value of the given boolean named parameter.\r\nfunction getFlag(params,name,defaultValue)\r\n{\r\n\treturn !!getParam(params,name,defaultValue);\r\n}\r\n\r\n//--\r\n//-- Augmented methods for the JavaScript Date() object\r\n//--\r\n\r\n// Substitute date components into a string\r\nDate.prototype.formatString = function(template)\r\n{\r\n\tvar t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));\r\n\tt = t.replace(/hh12/g,this.getHours12());\r\n\tt = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));\r\n\tt = t.replace(/hh/g,this.getHours());\r\n\tt = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);\r\n\tt = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));\r\n\tt = t.replace(/mm/g,this.getMinutes());\r\n\tt = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));\r\n\tt = t.replace(/ss/g,this.getSeconds());\r\n\tt = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());\r\n\tt = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());\r\n\tt = t.replace(/wYYYY/g,this.getYearForWeekNo());\r\n\tt = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));\r\n\tt = t.replace(/YYYY/g,this.getFullYear());\r\n\tt = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));\r\n\tt = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);\r\n\tt = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));\r\n\tt = t.replace(/MM/g,this.getMonth()+1);\r\n\tt = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));\r\n\tt = t.replace(/WW/g,this.getWeek());\r\n\tt = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);\r\n\tt = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);\r\n\tt = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));\r\n\tt = t.replace(/DDth/g,this.getDate()+this.daySuffix());\r\n\tt = t.replace(/DD/g,this.getDate());\r\n\tvar tz = this.getTimezoneOffset();\r\n\tvar atz = Math.abs(tz);\r\n\tt = t.replace(/TZD/g,(tz < 0 ? '+' : '-') + String.zeroPad(Math.floor(atz / 60),2) + ':' + String.zeroPad(atz % 60,2));\r\n\tt = t.replace(/\\\\/g,\"\");\r\n\treturn t;\r\n};\r\n\r\nDate.prototype.getWeek = function()\r\n{\r\n\tvar dt = new Date(this.getTime());\r\n\tvar d = dt.getDay();\r\n\tif(d==0) d=7;// JavaScript Sun=0, ISO Sun=7\r\n\tdt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo\r\n\tvar n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);\r\n\treturn Math.floor(n/7)+1;\r\n};\r\n\r\nDate.prototype.getYearForWeekNo = function()\r\n{\r\n\tvar dt = new Date(this.getTime());\r\n\tvar d = dt.getDay();\r\n\tif(d==0) d=7;// JavaScript Sun=0, ISO Sun=7\r\n\tdt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week\r\n\treturn dt.getFullYear();\r\n};\r\n\r\nDate.prototype.getHours12 = function()\r\n{\r\n\tvar h = this.getHours();\r\n\treturn h > 12 ? h-12 : ( h > 0 ? h : 12 );\r\n};\r\n\r\nDate.prototype.getAmPm = function()\r\n{\r\n\treturn this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;\r\n};\r\n\r\nDate.prototype.daySuffix = function()\r\n{\r\n\treturn config.messages.dates.daySuffixes[this.getDate()-1];\r\n};\r\n\r\n// Convert a date to local YYYYMMDDHHMM string format\r\nDate.prototype.convertToLocalYYYYMMDDHHMM = function()\r\n{\r\n\treturn this.getFullYear() + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2);\r\n};\r\n\r\n// Convert a date to UTC YYYYMMDDHHMM string format\r\nDate.prototype.convertToYYYYMMDDHHMM = function()\r\n{\r\n\treturn this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2);\r\n};\r\n\r\n// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format\r\nDate.prototype.convertToYYYYMMDDHHMMSSMMM = function()\r\n{\r\n\treturn this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + \".\" + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),3) +\"0\";\r\n};\r\n\r\n// Static method to create a date from a UTC YYYYMMDDHHMM format string\r\nDate.convertFromYYYYMMDDHHMM = function(d)\r\n{\r\n\td = d?d.replace(/[^0-9]/g, \"\"):\"\";\r\n\treturn Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,12));\r\n};\r\n\r\n// Static method to create a date from a UTC YYYYMMDDHHMMSS format string\r\nDate.convertFromYYYYMMDDHHMMSS = function(d)\r\n{\r\n\td = d?d.replace(/[^0-9]/g, \"\"):\"\";\r\n\treturn Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,14));\r\n};\r\n\r\n// Static method to create a date from a UTC YYYYMMDDHHMMSSMMM format string\r\nDate.convertFromYYYYMMDDHHMMSSMMM = function(d)\r\n{\r\n\td = d ? d.replace(/[^0-9]/g, \"\") : \"\";\r\n\treturn new Date(Date.UTC(parseInt(d.substr(0,4),10),\r\n\t\t\tparseInt(d.substr(4,2),10)-1,\r\n\t\t\tparseInt(d.substr(6,2),10),\r\n\t\t\tparseInt(d.substr(8,2)||\"00\",10),\r\n\t\t\tparseInt(d.substr(10,2)||\"00\",10),\r\n\t\t\tparseInt(d.substr(12,2)||\"00\",10),\r\n\t\t\tparseInt(d.substr(14,3)||\"000\",10)));\r\n};\r\n\r\n//--\r\n//-- RGB colour object\r\n//--\r\n\r\n// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values\r\nfunction RGB(r,g,b)\r\n{\r\n\tthis.r = 0;\r\n\tthis.g = 0;\r\n\tthis.b = 0;\r\n\tif(typeof r == \"string\") {\r\n\t\tif(r.substr(0,1) == \"#\") {\r\n\t\t\tif(r.length == 7) {\r\n\t\t\t\tthis.r = parseInt(r.substr(1,2),16)/255;\r\n\t\t\t\tthis.g = parseInt(r.substr(3,2),16)/255;\r\n\t\t\t\tthis.b = parseInt(r.substr(5,2),16)/255;\r\n\t\t\t} else {\r\n\t\t\t\tthis.r = parseInt(r.substr(1,1),16)/15;\r\n\t\t\t\tthis.g = parseInt(r.substr(2,1),16)/15;\r\n\t\t\t\tthis.b = parseInt(r.substr(3,1),16)/15;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar rgbPattern = /rgb\\s*\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*\\)/;\r\n\t\t\tvar c = r.match(rgbPattern);\r\n\t\t\tif(c) {\r\n\t\t\t\tthis.r = parseInt(c[1],10)/255;\r\n\t\t\t\tthis.g = parseInt(c[2],10)/255;\r\n\t\t\t\tthis.b = parseInt(c[3],10)/255;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tthis.r = r;\r\n\t\tthis.g = g;\r\n\t\tthis.b = b;\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n// Mixes this colour with another in a specified proportion\r\n// c = other colour to mix\r\n// f = 0..1 where 0 is this colour and 1 is the new colour\r\n// Returns an RGB object\r\nRGB.prototype.mix = function(c,f)\r\n{\r\n\treturn new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);\r\n};\r\n\r\n// Return an rgb colour as a #rrggbb format hex string\r\nRGB.prototype.toString = function()\r\n{\r\n\tvar clamp = function(x,min,max) {\r\n\t\treturn x < min ? min : (x > max ? max : x);\r\n\t};\r\n\treturn \"#\" +\r\n\t\t\t(\"0\" + Math.floor(clamp(this.r,0,1) * 255).toString(16)).right(2) +\r\n\t\t\t(\"0\" + Math.floor(clamp(this.g,0,1) * 255).toString(16)).right(2) +\r\n\t\t\t(\"0\" + Math.floor(clamp(this.b,0,1) * 255).toString(16)).right(2);\r\n};\r\n\r\n//--\r\n//-- DOM utilities - many derived from www.quirksmode.org\r\n//--\r\n\r\nfunction drawGradient(place,horiz,locolors,hicolors)\r\n{\r\n\tif(!hicolors)\r\n\t\thicolors = locolors;\r\n\tvar t;\r\n\tfor(t=0; t<= 100; t+=2) {\r\n\t\tvar bar = document.createElement(\"div\");\r\n\t\tplace.appendChild(bar);\r\n\t\tbar.style.position = \"absolute\";\r\n\t\tbar.style.left = horiz ? t + \"%\" : 0;\r\n\t\tbar.style.top = horiz ? 0 : t + \"%\";\r\n\t\tbar.style.width = horiz ? (101-t) + \"%\" : \"100%\";\r\n\t\tbar.style.height = horiz ? \"100%\" : (101-t) + \"%\";\r\n\t\tbar.style.zIndex = -1;\r\n\t\tvar p = t/100*(locolors.length-1);\r\n\t\tvar hc = hicolors[Math.floor(p)];\r\n\t\tif(typeof hc == \"string\")\r\n\t\t\thc = new RGB(hc);\r\n\t\tvar lc = locolors[Math.ceil(p)];\r\n\t\tif(typeof lc == \"string\")\r\n\t\t\tlc = new RGB(lc);\r\n\t\tbar.style.backgroundColor = hc.mix(lc,p-Math.floor(p)).toString();\r\n\t}\r\n}\r\n\r\nfunction addEvent(obj,type,fn)\r\n{\r\n\tif(obj.attachEvent) {\r\n\t\tobj[\"e\"+type+fn] = fn;\r\n\t\tobj[type+fn] = function(){obj[\"e\"+type+fn](window.event);};\r\n\t\tobj.attachEvent(\"on\"+type,obj[type+fn]);\r\n\t} else {\r\n\t\tobj.addEventListener(type,fn,false);\r\n\t}\r\n}\r\n\r\nfunction removeEvent(obj,type,fn)\r\n{\r\n\tif(obj.detachEvent) {\r\n\t\tobj.detachEvent(\"on\"+type,obj[type+fn]);\r\n\t\tobj[type+fn] = null;\r\n\t} else {\r\n\t\tobj.removeEventListener(type,fn,false);\r\n\t}\r\n}\r\n\r\n// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)\r\nfunction findRelated(e,value,name,relative)\r\n{\r\n\tname = name || \"tagName\";\r\n\trelative = relative || \"parentNode\";\r\n\tif(name == \"className\") {\r\n\t\twhile(e && !jQuery(e).hasClass(value)) {\r\n\t\t\te = e[relative];\r\n\t\t}\r\n\t} else {\r\n\t\twhile(e && e[name] != value) {\r\n\t\t\te = e[relative];\r\n\t\t}\r\n\t}\r\n\treturn e;\r\n}\r\n\r\n// Get the scroll position for window.scrollTo necessary to scroll a given element into view\r\nfunction ensureVisible(e)\r\n{\r\n\tvar posTop = findPosY(e);\r\n\tvar posBot = posTop + e.offsetHeight;\r\n\tvar winTop = findScrollY();\r\n\tvar winHeight = findWindowHeight();\r\n\tvar winBot = winTop + winHeight;\r\n\tif(posTop < winTop) {\r\n\t\treturn posTop;\r\n\t} else if(posBot > winBot) {\r\n\t\tif(e.offsetHeight < winHeight)\r\n\t\t\treturn posTop - (winHeight - e.offsetHeight);\r\n\t\telse\r\n\t\t\treturn posTop;\r\n\t} else {\r\n\t\treturn winTop;\r\n\t}\r\n}\r\n\r\n// Get the current width of the display window\r\nfunction findWindowWidth()\r\n{\r\n\treturn window.innerWidth || document.documentElement.clientWidth;\r\n}\r\n\r\n// Get the current height of the display window\r\nfunction findWindowHeight()\r\n{\r\n\treturn window.innerHeight || document.documentElement.clientHeight;\r\n}\r\n\r\n// Get the current height of the document\r\nfunction findDocHeight() {\r\n    var D = document;\r\n    return Math.max(\r\n        Math.max(D.body.scrollHeight, D.documentElement.scrollHeight),\r\n        Math.max(D.body.offsetHeight, D.documentElement.offsetHeight),\r\n        Math.max(D.body.clientHeight, D.documentElement.clientHeight)\r\n    );\r\n}\r\n\r\n// Get the current horizontal page scroll position\r\nfunction findScrollX()\r\n{\r\n\treturn window.scrollX || document.documentElement.scrollLeft;\r\n}\r\n\r\n// Get the current vertical page scroll position\r\nfunction findScrollY()\r\n{\r\n\treturn window.scrollY || document.documentElement.scrollTop;\r\n}\r\n\r\nfunction findPosX(obj)\r\n{\r\n\tvar curleft = 0;\r\n\twhile(obj.offsetParent) {\r\n\t\tcurleft += obj.offsetLeft;\r\n\t\tobj = obj.offsetParent;\r\n\t}\r\n\treturn curleft;\r\n}\r\n\r\nfunction findPosY(obj)\r\n{\r\n\tvar curtop = 0;\r\n\twhile(obj.offsetParent) {\r\n\t\tcurtop += obj.offsetTop;\r\n\t\tobj = obj.offsetParent;\r\n\t}\r\n\treturn curtop;\r\n}\r\n\r\n// Blur a particular element\r\nfunction blurElement(e)\r\n{\r\n\tif(e && e.focus && e.blur) {\r\n\t\te.focus();\r\n\t\te.blur();\r\n\t}\r\n}\r\n\r\n// Create a non-breaking space\r\nfunction insertSpacer(place)\r\n{\r\n\tvar e = document.createTextNode(String.fromCharCode(160));\r\n\tif(place)\r\n\t\tplace.appendChild(e);\r\n\treturn e;\r\n}\r\n\r\n// Replace the current selection of a textarea or text input and scroll it into view\r\nfunction replaceSelection(e,text)\r\n{\r\n\tif(e.setSelectionRange) {\r\n\t\tvar oldpos = e.selectionStart;\r\n\t\tvar isRange = e.selectionEnd > e.selectionStart;\r\n\t\te.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionEnd);\r\n\t\te.setSelectionRange(isRange ? oldpos : oldpos + text.length,oldpos + text.length);\r\n\t\tvar linecount = e.value.split(\"\\n\").length;\r\n\t\tvar thisline = e.value.substr(0,e.selectionStart).split(\"\\n\").length-1;\r\n\t\te.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);\r\n\t} else if(document.selection) {\r\n\t\tvar range = document.selection.createRange();\r\n\t\tif(range.parentElement() == e) {\r\n\t\t\tvar isCollapsed = range.text == \"\";\r\n\t\t\trange.text = text;\r\n\t\t\tif(!isCollapsed) {\r\n\t\t\t\trange.moveStart(\"character\", -text.length);\r\n\t\t\t\trange.select();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Set the caret position in a text area\r\nfunction setCaretPosition(e,pos)\r\n{\r\n\tif(e.selectionStart || e.selectionStart == '0') {\r\n\t\te.selectionStart = pos;\r\n\t\te.selectionEnd = pos;\r\n\t\te.focus();\r\n\t} else if(document.selection) {\r\n\t\t// IE support\r\n\t\te.focus ();\r\n\t\tvar sel = document.selection.createRange();\r\n\t\tsel.moveStart('character', -e.value.length);\r\n\t\tsel.moveStart('character',pos);\r\n\t\tsel.moveEnd('character',0);\r\n\t\tsel.select();\r\n\t}\r\n}\r\n\r\n// Returns the text of the given (text) node, possibly merging subsequent text nodes\r\nfunction getNodeText(e)\r\n{\r\n\tvar t = \"\";\r\n\twhile(e && e.nodeName == \"#text\") {\r\n\t\tt += e.nodeValue;\r\n\t\te = e.nextSibling;\r\n\t}\r\n\treturn t;\r\n}\r\n\r\n// Returns true if the element e has a given ancestor element\r\nfunction isDescendant(e,ancestor)\r\n{\r\n\twhile(e) {\r\n\t\tif(e === ancestor)\r\n\t\t\treturn true;\r\n\t\te = e.parentNode;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n\r\n// deprecate the following...\r\n\r\n// Prevent an event from bubbling\r\nfunction stopEvent(e)\r\n{\r\n\tvar ev = e || window.event;\r\n\tev.cancelBubble = true;\r\n\tif(ev.stopPropagation) ev.stopPropagation();\r\n\treturn false;\r\n}\r\n\r\n// Remove any event handlers or non-primitve custom attributes\r\nfunction scrubNode(e)\r\n{\r\n\tif(!config.browser.isIE)\r\n\t\treturn;\r\n\tvar att = e.attributes;\r\n\tif(att) {\r\n\t\tvar t;\r\n\t\tfor(t=0; t<att.length; t++) {\r\n\t\t\tvar n = att[t].name;\r\n\t\t\tif(n !== \"style\" && (typeof e[n] === \"function\" || (typeof e[n] === \"object\" && e[n] != null))) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\te[n] = null;\r\n\t\t\t\t} catch(ex) {\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tvar c = e.firstChild;\r\n\twhile(c) {\r\n\t\tscrubNode(c);\r\n\t\tc = c.nextSibling;\r\n\t}\r\n}\r\n\r\nfunction setStylesheet(s,id,doc)\r\n{\r\n\tjQuery.twStylesheet(s,{id:id,doc:doc});\r\n}\r\n\r\nfunction removeStyleSheet(id)\r\n{\r\n\tjQuery.twStylesheet.remove({id:id});\r\n}\r\n\r\n//--\r\n//-- LoaderBase and SaverBase\r\n//--\r\n\r\nfunction LoaderBase() {}\r\n\r\nLoaderBase.prototype.loadTiddler = function(store,node,tiddlers)\r\n{\r\n\tvar title = this.getTitle(store,node);\r\n\tif(safeMode && store.isShadowTiddler(title))\r\n\t\treturn;\r\n\tif(title) {\r\n\t\tvar tiddler = store.createTiddler(title);\r\n\t\tthis.internalizeTiddler(store,tiddler,title,node);\r\n\t\ttiddlers.push(tiddler);\r\n\t}\r\n};\r\n\r\nLoaderBase.prototype.loadTiddlers = function(store,nodes)\r\n{\r\n\tvar t,tiddlers = [];\r\n\tfor(t = 0; t < nodes.length; t++) {\r\n\t\ttry {\r\n\t\t\tthis.loadTiddler(store,nodes[t],tiddlers);\r\n\t\t} catch(ex) {\r\n\t\t\tshowException(ex,config.messages.tiddlerLoadError.format([this.getTitle(store,nodes[t])]));\r\n\t\t}\r\n\t}\r\n\treturn tiddlers;\r\n};\r\n\r\nfunction SaverBase() {}\r\n\r\nSaverBase.prototype.externalize = function(store)\r\n{\r\n\tvar results = [];\r\n\tvar t,tiddlers = store.getTiddlers(\"title\");\r\n\tfor(t = 0; t < tiddlers.length; t++) {\r\n\t\tif(!tiddlers[t].doNotSave())\r\n\t\t\tresults.push(this.externalizeTiddler(store, tiddlers[t]));\r\n\t}\r\n\treturn results.join(\"\\n\");\r\n};\r\n\r\n//--\r\n//-- TW21Loader (inherits from LoaderBase)\r\n//--\r\n\r\nfunction TW21Loader() {}\r\n\r\nTW21Loader.prototype = new LoaderBase();\r\n\r\nTW21Loader.prototype.getTitle = function(store,node)\r\n{\r\n\tvar title = null;\r\n\tif(node.getAttribute) {\r\n\t\ttitle = node.getAttribute(\"title\");\r\n\t\tif(!title)\r\n\t\t\ttitle = node.getAttribute(\"tiddler\");\r\n\t}\r\n\tif(!title && node.id) {\r\n\t\tvar lenPrefix = store.idPrefix.length;\r\n\t\tif(node.id.substr(0,lenPrefix) == store.idPrefix)\r\n\t\t\ttitle = node.id.substr(lenPrefix);\r\n\t}\r\n\treturn title;\r\n};\r\n\r\nTW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,node)\r\n{\r\n\tvar e = node.firstChild;\r\n\tvar text = null;\r\n\tif(node.getAttribute(\"tiddler\")) {\r\n\t\ttext = getNodeText(e).unescapeLineBreaks();\r\n\t} else {\r\n\t\twhile(e.nodeName!=\"PRE\" && e.nodeName!=\"pre\") {\r\n\t\t\te = e.nextSibling;\r\n\t\t}\r\n\t\ttext = e.innerHTML.replace(/\\r/mg,\"\").htmlDecode();\r\n\t}\r\n\tvar creator = node.getAttribute(\"creator\");\r\n\tvar modifier = node.getAttribute(\"modifier\");\r\n\tvar c = node.getAttribute(\"created\");\r\n\tvar m = node.getAttribute(\"modified\");\r\n\tvar created = c ? Date.convertFromYYYYMMDDHHMMSS(c) : version.date;\r\n\tvar modified = m ? Date.convertFromYYYYMMDDHHMMSS(m) : created;\r\n\tvar tags = node.getAttribute(\"tags\");\r\n\tvar fields = {};\r\n\tvar i,attrs = node.attributes;\r\n\tfor(i = attrs.length-1; i >= 0; i--) {\r\n\t\tvar name = attrs[i].name;\r\n\t\tif(attrs[i].specified && !TiddlyWiki.isStandardField(name)) {\r\n\t\t\tfields[name] = attrs[i].value.unescapeLineBreaks();\r\n\t\t}\r\n\t}\r\n\ttiddler.assign(title,text,modifier,modified,tags,created,fields,creator);\r\n\treturn tiddler;\r\n};\r\n\r\n//--\r\n//-- TW21Saver (inherits from SaverBase)\r\n//--\r\n\r\nfunction TW21Saver() {}\r\n\r\nTW21Saver.prototype = new SaverBase();\r\n\r\nTW21Saver.prototype.externalizeTiddler = function(store,tiddler)\r\n{\r\n\ttry {\r\n\t\tvar extendedAttributes = \"\";\r\n\t\tvar usePre = config.options.chkUsePreForStorage;\r\n\t\tstore.forEachField(tiddler,\r\n\t\t\tfunction(tiddler,fieldName,value) {\r\n\t\t\t\t// don't store stuff from the temp namespace\r\n\t\t\t\tif(typeof value != \"string\")\r\n\t\t\t\t\tvalue = \"\";\r\n\t\t\t\tif(!fieldName.match(/^temp\\./))\r\n\t\t\t\t\textendedAttributes += ' %0=\"%1\"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);\r\n\t\t\t},true);\r\n\t\tvar created = tiddler.created;\r\n\t\tvar modified = tiddler.modified;\r\n\t\tvar attributes = tiddler.creator ? ' creator=\"' + tiddler.creator.htmlEncode() + '\"' : \"\";\r\n\t\tattributes += tiddler.modifier ? ' modifier=\"' + tiddler.modifier.htmlEncode() + '\"' : \"\";\r\n\t\tattributes += (usePre && created == version.date) ? \"\" :' created=\"' + created.convertToYYYYMMDDHHMM() + '\"';\r\n\t\tattributes += (usePre && modified == created) ? \"\" : ' modified=\"' + modified.convertToYYYYMMDDHHMM() +'\"';\r\n\t\tvar tags = tiddler.getTags();\r\n\t\tif(!usePre || tags)\r\n\t\t\tattributes += ' tags=\"' + tags.htmlEncode() + '\"';\r\n\t\treturn ('<div %0=\"%1\"%2%3>%4</'+'div>').format([\r\n\t\t\t\tusePre ? \"title\" : \"tiddler\",\r\n\t\t\t\ttiddler.title.htmlEncode(),\r\n\t\t\t\tattributes,\r\n\t\t\t\textendedAttributes,\r\n\t\t\t\tusePre ? \"\\n<pre>\" + tiddler.text.htmlEncode() + \"</pre>\\n\" : tiddler.text.escapeLineBreaks().htmlEncode()\r\n\t\t\t]);\r\n\t} catch (ex) {\r\n\t\tthrow exceptionText(ex,config.messages.tiddlerSaveError.format([tiddler.title]));\r\n\t}\r\n};\r\n\r\n\r\n\r\n//]]>\r\n</script>\r\n\r\n<script id=\"jsdeprecatedArea\" type=\"text/javascript\">\r\n//<![CDATA[\r\n//--\r\n//-- Deprecated Crypto functions and associated conversion routines.\r\n//-- Use the jQuery.encoding functions directly instead.\r\n//--\r\n\r\n// Crypto 'namespace'\r\nfunction Crypto() {}\r\n\r\n// Convert a string to an array of big-endian 32-bit words\r\nCrypto.strToBe32s = function(str)\r\n{\r\n\treturn jQuery.encoding.strToBe32s(str);\r\n};\r\n\r\n// Convert an array of big-endian 32-bit words to a string\r\nCrypto.be32sToStr = function(be)\r\n{\r\n\treturn jQuery.encoding.be32sToStr(be);\r\n};\r\n\r\n// Convert an array of big-endian 32-bit words to a hex string\r\nCrypto.be32sToHex = function(be)\r\n{\r\n\treturn jQuery.encoding.be32sToHex(be);\r\n};\r\n\r\n// Return, in hex, the SHA-1 hash of a string\r\nCrypto.hexSha1Str = function(str)\r\n{\r\n\treturn jQuery.encoding.digests.hexSha1Str(str);\r\n};\r\n\r\n// Return the SHA-1 hash of a string\r\nCrypto.sha1Str = function(str)\r\n{\r\n\treturn jQuery.encoding.digests.sha1Str(str);\r\n};\r\n\r\n// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words\r\nCrypto.sha1 = function(x,blen)\r\n{\r\n\treturn jQuery.encoding.digests.sha1(x,blen);\r\n};\r\n\r\n//--\r\n//-- Deprecated code\r\n//--\r\n\r\n// @Deprecated: Use createElementAndWikify and this.termRegExp instead\r\nconfig.formatterHelpers.charFormatHelper = function(w)\r\n{\r\n\tw.subWikify(createTiddlyElement(w.output,this.element),this.terminator);\r\n};\r\n\r\n// @Deprecated: Use enclosedTextHelper and this.lookaheadRegExp instead\r\nconfig.formatterHelpers.monospacedByLineHelper = function(w)\r\n{\r\n\tvar lookaheadRegExp = new RegExp(this.lookahead,\"mg\");\r\n\tlookaheadRegExp.lastIndex = w.matchStart;\r\n\tvar lookaheadMatch = lookaheadRegExp.exec(w.source);\r\n\tif(lookaheadMatch && lookaheadMatch.index == w.matchStart) {\r\n\t\tvar text = lookaheadMatch[1];\r\n\t\tif(config.browser.isIE)\r\n\t\t\ttext = text.replace(/\\n/g,\"\\r\");\r\n\t\tcreateTiddlyElement(w.output,\"pre\",null,null,text);\r\n\t\tw.nextMatch = lookaheadRegExp.lastIndex;\r\n\t}\r\n};\r\n\r\n// @Deprecated: Use <br> or <br /> instead of <<br>>\r\nconfig.macros.br = {};\r\nconfig.macros.br.handler = function(place)\r\n{\r\n\tcreateTiddlyElement(place,\"br\");\r\n};\r\n\r\n// Find an entry in an array. Returns the array index or null\r\n// @Deprecated: Use indexOf instead\r\nArray.prototype.find = function(item)\r\n{\r\n\tvar i = this.indexOf(item);\r\n\treturn i == -1 ? null : i;\r\n};\r\n\r\n// Load a tiddler from an HTML DIV. The caller should make sure to later call Tiddler.changed()\r\n// @Deprecated: Use store.getLoader().internalizeTiddler instead\r\nTiddler.prototype.loadFromDiv = function(divRef,title)\r\n{\r\n\treturn store.getLoader().internalizeTiddler(store,this,title,divRef);\r\n};\r\n\r\n// Format the text for storage in an HTML DIV\r\n// @Deprecated Use store.getSaver().externalizeTiddler instead.\r\nTiddler.prototype.saveToDiv = function()\r\n{\r\n\treturn store.getSaver().externalizeTiddler(store,this);\r\n};\r\n\r\n// @Deprecated: Use store.allTiddlersAsHtml() instead\r\nfunction allTiddlersAsHtml()\r\n{\r\n\treturn store.allTiddlersAsHtml();\r\n}\r\n\r\n// @Deprecated: Use refreshPageTemplate instead\r\nfunction applyPageTemplate(title)\r\n{\r\n\trefreshPageTemplate(title);\r\n}\r\n\r\n// @Deprecated: Use story.displayTiddlers instead\r\nfunction displayTiddlers(srcElement,titles,template,unused1,unused2,animate,unused3)\r\n{\r\n\tstory.displayTiddlers(srcElement,titles,template,animate);\r\n}\r\n\r\n// @Deprecated: Use story.displayTiddler instead\r\nfunction displayTiddler(srcElement,title,template,unused1,unused2,animate,unused3)\r\n{\r\n\tstory.displayTiddler(srcElement,title,template,animate);\r\n}\r\n\r\n// @Deprecated: Use functions on right hand side directly instead\r\nvar createTiddlerPopup = Popup.create;\r\nvar scrollToTiddlerPopup = Popup.show;\r\nvar hideTiddlerPopup = Popup.remove;\r\n\r\n// @Deprecated: Use right hand side directly instead\r\nvar regexpBackSlashEn = new RegExp(\"\\\\\\\\n\",\"mg\");\r\nvar regexpBackSlash = new RegExp(\"\\\\\\\\\",\"mg\");\r\nvar regexpBackSlashEss = new RegExp(\"\\\\\\\\s\",\"mg\");\r\nvar regexpNewLine = new RegExp(\"\\n\",\"mg\");\r\nvar regexpCarriageReturn = new RegExp(\"\\r\",\"mg\");\r\n\r\n//--\r\n//-- Deprecated FileAdaptor functions\r\n//--\r\n\r\nFileAdaptor.loadTiddlyWikiCallback = function(status,context,responseText,url,xhr)\r\n{\r\n\tcontext.status = status;\r\n\tif(!status) {\r\n\t\tcontext.statusText = \"Error reading file\";\r\n\t} else {\r\n\t\tcontext.adaptor.store = new TiddlyWiki();\r\n\t\tif(!context.adaptor.store.importTiddlyWiki(responseText)) {\r\n\t\t\tcontext.statusText = config.messages.invalidFileError.format([url]);\r\n\t\t\tcontext.status = false;\r\n\t\t}\r\n\t}\r\n\tcontext.complete(context,context.userParams);\r\n};\r\n\r\n//--\r\n//-- Deprecated HTTP request code\r\n//-- Use the jQuery ajax functions directly instead\r\n//--\r\n\r\nfunction loadRemoteFile(url,callback,params)\r\n{\r\n\treturn httpReq(\"GET\",url,callback,params);\r\n}\r\n\r\nfunction doHttp(type,url,data,contentType,username,password,callback,params,headers,allowCache)\r\n{\r\n\treturn httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache);\r\n}\r\n\r\n//--\r\n//-- Deprecated String functions\r\n//--\r\n\r\n// @Deprecated: no direct replacement, since not used in core code\r\nString.prototype.toJSONString = function()\r\n{\r\n\t// Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org\r\n\tvar m = {\r\n\t\t'\\b': '\\\\b',\r\n\t\t'\\f': '\\\\f',\r\n\t\t'\\n': '\\\\n',\r\n\t\t'\\r': '\\\\r',\r\n\t\t'\\t': '\\\\t',\r\n\t\t'\"' : '\\\\\"',\r\n\t\t'\\\\': '\\\\\\\\'\r\n\t\t};\r\n\tvar replaceFn = function(a,b) {\r\n\t\tvar c = m[b];\r\n\t\tif(c)\r\n\t\t\treturn c;\r\n\t\tc = b.charCodeAt();\r\n\t\treturn '\\\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);\r\n\t\t};\r\n\tif(/[\"\\\\\\x00-\\x1f]/.test(this))\r\n\t\treturn '\"' + this.replace(/([\\x00-\\x1f\\\\\"])/g,replaceFn) + '\"';\r\n\treturn '\"' + this + '\"';\r\n};\r\n\r\n//--\r\n//-- Deprecated Tiddler code\r\n//--\r\n\r\n// @Deprecated: Use tiddlerToRssItem(tiddler,uri) instead\r\nTiddler.prototype.toRssItem = function(uri)\r\n{\r\n\treturn tiddlerToRssItem(this,uri);\r\n};\r\n\r\n// @Deprecated: Use \"<item>\\n\" + tiddlerToRssItem(tiddler,uri)  + \"\\n</item>\" instead\r\nTiddler.prototype.saveToRss = function(uri)\r\n{\r\n\treturn \"<item>\\n\" + tiddlerToRssItem(this,uri) + \"\\n</item>\";\r\n};\r\n\r\n// @Deprecated: Use jQuery.encoding.digests.hexSha1Str instead\r\nTiddler.prototype.generateFingerprint = function()\r\n{\r\n\treturn \"0x\" + Crypto.hexSha1Str(this.text);\r\n};\r\n\r\n//--\r\n//-- Deprecated Number functions\r\n//--\r\n\r\n// @Deprecated: no direct replacement, since not used in core code\r\n// Clamp a number to a range\r\nNumber.prototype.clamp = function(min,max)\r\n{\r\n\tvar c = this;\r\n\tif(c < min)\r\n\t\tc = min;\r\n\tif(c > max)\r\n\t\tc = max;\r\n\treturn Number(c);\r\n};\r\n\r\n//--\r\n//-- Deprecated utility functions\r\n//-- Use the jQuery functions directly instead\r\n//--\r\n\r\n// Remove all children of a node\r\nfunction removeChildren(e)\r\n{\r\n\tjQuery(e).empty();\r\n}\r\n\r\n// Remove a node and all it's children\r\nfunction removeNode(e)\r\n{\r\n\tjQuery(e).remove();\r\n}\r\n\r\n// Return the content of an element as plain text with no formatting\r\nfunction getPlainText(e)\r\n{\r\n\treturn jQuery(e).text();\r\n}\r\n\r\nfunction addClass(e,className)\r\n{\r\n\tjQuery(e).addClass(className);\r\n}\r\n\r\nfunction removeClass(e,className)\r\n{\r\n\tjQuery(e).removeClass(className);\r\n}\r\n\r\nfunction hasClass(e,className)\r\n{\r\n\treturn jQuery(e).hasClass(className);\r\n}\r\n\r\n//--\r\n//-- Deprecated Wikifier code\r\n//--\r\n\r\nfunction wikifyPlain(title,theStore,limit)\r\n{\r\n\tif(!theStore)\r\n\t\ttheStore = store;\r\n\tif(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {\r\n\t\treturn wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);\r\n\t} else {\r\n\t\treturn \"\";\r\n\t}\r\n}\r\n\r\n\r\n//]]>\r\n</script>\r\n<script id=\"jslibArea\" type=\"text/javascript\">\r\n//<![CDATA[\r\n/*! jQuery v1.8.3 jquery.com | jquery.org/license */\r\n(function(e,t){function _(e){var t=M[e]={};return v.each(e.split(y),function(e,n){t[n]=!0}),t}function H(e,n,r){if(r===t&&e.nodeType===1){var i=\"data-\"+n.replace(P,\"-$1\").toLowerCase();r=e.getAttribute(i);if(typeof r==\"string\"){try{r=r===\"true\"?!0:r===\"false\"?!1:r===\"null\"?null:+r+\"\"===r?+r:D.test(r)?v.parseJSON(r):r}catch(s){}v.data(e,n,r)}else r=t}return r}function B(e){var t;for(t in e){if(t===\"data\"&&v.isEmptyObject(e[t]))continue;if(t!==\"toJSON\")return!1}return!0}function et(){return!1}function tt(){return!0}function ut(e){return!e||!e.parentNode||e.parentNode.nodeType===11}function at(e,t){do e=e[t];while(e&&e.nodeType!==1);return e}function ft(e,t,n){t=t||0;if(v.isFunction(t))return v.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return v.grep(e,function(e,r){return e===t===n});if(typeof t==\"string\"){var r=v.grep(e,function(e){return e.nodeType===1});if(it.test(t))return v.filter(t,r,!n);t=v.filter(t,r)}return v.grep(e,function(e,r){return v.inArray(e,t)>=0===n})}function lt(e){var t=ct.split(\"|\"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function Lt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function At(e,t){if(t.nodeType!==1||!v.hasData(e))return;var n,r,i,s=v._data(e),o=v._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;r<i;r++)v.event.add(t,n,u[n][r])}o.data&&(o.data=v.extend({},o.data))}function Ot(e,t){var n;if(t.nodeType!==1)return;t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),n=t.nodeName.toLowerCase(),n===\"object\"?(t.parentNode&&(t.outerHTML=e.outerHTML),v.support.html5Clone&&e.innerHTML&&!v.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):n===\"input\"&&Et.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):n===\"option\"?t.selected=e.defaultSelected:n===\"input\"||n===\"textarea\"?t.defaultValue=e.defaultValue:n===\"script\"&&t.text!==e.text&&(t.text=e.text),t.removeAttribute(v.expando)}function Mt(e){return typeof e.getElementsByTagName!=\"undefined\"?e.getElementsByTagName(\"*\"):typeof e.querySelectorAll!=\"undefined\"?e.querySelectorAll(\"*\"):[]}function _t(e){Et.test(e.type)&&(e.defaultChecked=e.checked)}function Qt(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Jt.length;while(i--){t=Jt[i]+n;if(t in e)return t}return r}function Gt(e,t){return e=t||e,v.css(e,\"display\")===\"none\"||!v.contains(e.ownerDocument,e)}function Yt(e,t){var n,r,i=[],s=0,o=e.length;for(;s<o;s++){n=e[s];if(!n.style)continue;i[s]=v._data(n,\"olddisplay\"),t?(!i[s]&&n.style.display===\"none\"&&(n.style.display=\"\"),n.style.display===\"\"&&Gt(n)&&(i[s]=v._data(n,\"olddisplay\",nn(n.nodeName)))):(r=Dt(n,\"display\"),!i[s]&&r!==\"none\"&&v._data(n,\"olddisplay\",r))}for(s=0;s<o;s++){n=e[s];if(!n.style)continue;if(!t||n.style.display===\"none\"||n.style.display===\"\")n.style.display=t?i[s]||\"\":\"none\"}return e}function Zt(e,t,n){var r=Rt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||\"px\"):t}function en(e,t,n,r){var i=n===(r?\"border\":\"content\")?4:t===\"width\"?1:0,s=0;for(;i<4;i+=2)n===\"margin\"&&(s+=v.css(e,n+$t[i],!0)),r?(n===\"content\"&&(s-=parseFloat(Dt(e,\"padding\"+$t[i]))||0),n!==\"margin\"&&(s-=parseFloat(Dt(e,\"border\"+$t[i]+\"Width\"))||0)):(s+=parseFloat(Dt(e,\"padding\"+$t[i]))||0,n!==\"padding\"&&(s+=parseFloat(Dt(e,\"border\"+$t[i]+\"Width\"))||0));return s}function tn(e,t,n){var r=t===\"width\"?e.offsetWidth:e.offsetHeight,i=!0,s=v.support.boxSizing&&v.css(e,\"boxSizing\")===\"border-box\";if(r<=0||r==null){r=Dt(e,t);if(r<0||r==null)r=e.style[t];if(Ut.test(r))return r;i=s&&(v.support.boxSizingReliable||r===e.style[t]),r=parseFloat(r)||0}return r+en(e,t,n||(s?\"border\":\"content\"),i)+\"px\"}function nn(e){if(Wt[e])return Wt[e];var t=v(\"<\"+e+\">\").appendTo(i.body),n=t.css(\"display\");t.remove();if(n===\"none\"||n===\"\"){Pt=i.body.appendChild(Pt||v.extend(i.createElement(\"iframe\"),{frameBorder:0,width:0,height:0}));if(!Ht||!Pt.createElement)Ht=(Pt.contentWindow||Pt.contentDocument).document,Ht.write(\"<!doctype html><html><body>\"),Ht.close();t=Ht.body.appendChild(Ht.createElement(e)),n=Dt(t,\"display\"),i.body.removeChild(Pt)}return Wt[e]=n,n}function fn(e,t,n,r){var i;if(v.isArray(t))v.each(t,function(t,i){n||sn.test(e)?r(e,i):fn(e+\"[\"+(typeof i==\"object\"?t:\"\")+\"]\",i,n,r)});else if(!n&&v.type(t)===\"object\")for(i in t)fn(e+\"[\"+i+\"]\",t[i],n,r);else r(e,t)}function Cn(e){return function(t,n){typeof t!=\"string\"&&(n=t,t=\"*\");var r,i,s,o=t.toLowerCase().split(y),u=0,a=o.length;if(v.isFunction(n))for(;u<a;u++)r=o[u],s=/^\\+/.test(r),s&&(r=r.substr(1)||\"*\"),i=e[r]=e[r]||[],i[s?\"unshift\":\"push\"](n)}}function kn(e,n,r,i,s,o){s=s||n.dataTypes[0],o=o||{},o[s]=!0;var u,a=e[s],f=0,l=a?a.length:0,c=e===Sn;for(;f<l&&(c||!u);f++)u=a[f](n,r,i),typeof u==\"string\"&&(!c||o[u]?u=t:(n.dataTypes.unshift(u),u=kn(e,n,r,i,u,o)));return(c||!u)&&!o[\"*\"]&&(u=kn(e,n,r,i,\"*\",o)),u}function Ln(e,n){var r,i,s=v.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((s[r]?e:i||(i={}))[r]=n[r]);i&&v.extend(!0,e,i)}function An(e,n,r){var i,s,o,u,a=e.contents,f=e.dataTypes,l=e.responseFields;for(s in l)s in r&&(n[l[s]]=r[s]);while(f[0]===\"*\")f.shift(),i===t&&(i=e.mimeType||n.getResponseHeader(\"content-type\"));if(i)for(s in a)if(a[s]&&a[s].test(i)){f.unshift(s);break}if(f[0]in r)o=f[0];else{for(s in r){if(!f[0]||e.converters[s+\" \"+f[0]]){o=s;break}u||(u=s)}o=o||u}if(o)return o!==f[0]&&f.unshift(o),r[o]}function On(e,t){var n,r,i,s,o=e.dataTypes.slice(),u=o[0],a={},f=0;e.dataFilter&&(t=e.dataFilter(t,e.dataType));if(o[1])for(n in e.converters)a[n.toLowerCase()]=e.converters[n];for(;i=o[++f];)if(i!==\"*\"){if(u!==\"*\"&&u!==i){n=a[u+\" \"+i]||a[\"* \"+i];if(!n)for(r in a){s=r.split(\" \");if(s[1]===i){n=a[u+\" \"+s[0]]||a[\"* \"+s[0]];if(n){n===!0?n=a[r]:a[r]!==!0&&(i=s[0],o.splice(f--,0,i));break}}}if(n!==!0)if(n&&e[\"throws\"])t=n(t);else try{t=n(t)}catch(l){return{state:\"parsererror\",error:n?l:\"No conversion from \"+u+\" to \"+i}}}u=i}return{state:\"success\",data:t}}function Fn(){try{return new e.XMLHttpRequest}catch(t){}}function In(){try{return new e.ActiveXObject(\"Microsoft.XMLHTTP\")}catch(t){}}function $n(){return setTimeout(function(){qn=t},0),qn=v.now()}function Jn(e,t){v.each(t,function(t,n){var r=(Vn[t]||[]).concat(Vn[\"*\"]),i=0,s=r.length;for(;i<s;i++)if(r[i].call(e,t,n))return})}function Kn(e,t,n){var r,i=0,s=0,o=Xn.length,u=v.Deferred().always(function(){delete a.elem}),a=function(){var t=qn||$n(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,i=1-r,s=0,o=f.tweens.length;for(;s<o;s++)f.tweens[s].run(i);return u.notifyWith(e,[f,i,n]),i<1&&o?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:v.extend({},t),opts:v.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:qn||$n(),duration:n.duration,tweens:[],createTween:function(t,n,r){var i=v.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(i),i},stop:function(t){var n=0,r=t?f.tweens.length:0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;Qn(l,f.opts.specialEasing);for(;i<o;i++){r=Xn[i].call(f,e,l,f.opts);if(r)return r}return Jn(f,l),v.isFunction(f.opts.start)&&f.opts.start.call(e,f),v.fx.timer(v.extend(a,{anim:f,queue:f.opts.queue,elem:e})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function Qn(e,t){var n,r,i,s,o;for(n in e){r=v.camelCase(n),i=t[r],s=e[n],v.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=v.cssHooks[r];if(o&&\"expand\"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function Gn(e,t,n){var r,i,s,o,u,a,f,l,c,h=this,p=e.style,d={},m=[],g=e.nodeType&&Gt(e);n.queue||(l=v._queueHooks(e,\"fx\"),l.unqueued==null&&(l.unqueued=0,c=l.empty.fire,l.empty.fire=function(){l.unqueued||c()}),l.unqueued++,h.always(function(){h.always(function(){l.unqueued--,v.queue(e,\"fx\").length||l.empty.fire()})})),e.nodeType===1&&(\"height\"in t||\"width\"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],v.css(e,\"display\")===\"inline\"&&v.css(e,\"float\")===\"none\"&&(!v.support.inlineBlockNeedsLayout||nn(e.nodeName)===\"inline\"?p.display=\"inline-block\":p.zoom=1)),n.overflow&&(p.overflow=\"hidden\",v.support.shrinkWrapBlocks||h.done(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t){s=t[r];if(Un.exec(s)){delete t[r],a=a||s===\"toggle\";if(s===(g?\"hide\":\"show\"))continue;m.push(r)}}o=m.length;if(o){u=v._data(e,\"fxshow\")||v._data(e,\"fxshow\",{}),\"hidden\"in u&&(g=u.hidden),a&&(u.hidden=!g),g?v(e).show():h.done(function(){v(e).hide()}),h.done(function(){var t;v.removeData(e,\"fxshow\",!0);for(t in d)v.style(e,t,d[t])});for(r=0;r<o;r++)i=m[r],f=h.createTween(i,g?u[i]:0),d[i]=u[i]||v.style(e,i),i in u||(u[i]=f.start,g&&(f.end=f.start,f.start=i===\"width\"||i===\"height\"?1:0))}}function Yn(e,t,n,r,i){return new Yn.prototype.init(e,t,n,r,i)}function Zn(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=$t[i],r[\"margin\"+n]=r[\"padding\"+n]=e;return t&&(r.opacity=r.width=e),r}function tr(e){return v.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n,r,i=e.document,s=e.location,o=e.navigator,u=e.jQuery,a=e.$,f=Array.prototype.push,l=Array.prototype.slice,c=Array.prototype.indexOf,h=Object.prototype.toString,p=Object.prototype.hasOwnProperty,d=String.prototype.trim,v=function(e,t){return new v.fn.init(e,t,n)},m=/[\\-+]?(?:\\d*\\.|)\\d+(?:[eE][\\-+]?\\d+|)/.source,g=/\\S/,y=/\\s+/,b=/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g,w=/^(?:[^#<]*(<[\\w\\W]+>)[^>]*$|#([\\w\\-]*)$)/,E=/^<(\\w+)\\s*\\/?>(?:<\\/\\1>|)$/,S=/^[\\],:{}\\s]*$/,x=/(?:^|:|,)(?:\\s*\\[)+/g,T=/\\\\(?:[\"\\\\\\/bfnrt]|u[\\da-fA-F]{4})/g,N=/\"[^\"\\\\\\r\\n]*\"|true|false|null|-?(?:\\d\\d*\\.|)\\d+(?:[eE][\\-+]?\\d+|)/g,C=/^-ms-/,k=/-([\\da-z])/gi,L=function(e,t){return(t+\"\").toUpperCase()},A=function(){i.addEventListener?(i.removeEventListener(\"DOMContentLoaded\",A,!1),v.ready()):i.readyState===\"complete\"&&(i.detachEvent(\"onreadystatechange\",A),v.ready())},O={};v.fn=v.prototype={constructor:v,init:function(e,n,r){var s,o,u,a;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if(typeof e==\"string\"){e.charAt(0)===\"<\"&&e.charAt(e.length-1)===\">\"&&e.length>=3?s=[null,e,null]:s=w.exec(e);if(s&&(s[1]||!n)){if(s[1])return n=n instanceof v?n[0]:n,a=n&&n.nodeType?n.ownerDocument||n:i,e=v.parseHTML(s[1],a,!0),E.test(s[1])&&v.isPlainObject(n)&&this.attr.call(e,n,!0),v.merge(this,e);o=i.getElementById(s[2]);if(o&&o.parentNode){if(o.id!==s[2])return r.find(e);this.length=1,this[0]=o}return this.context=i,this.selector=e,this}return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e)}return v.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),v.makeArray(e,this))},selector:\"\",jquery:\"1.8.3\",length:0,size:function(){return this.length},toArray:function(){return l.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var r=v.merge(this.constructor(),e);return r.prevObject=this,r.context=this.context,t===\"find\"?r.selector=this.selector+(this.selector?\" \":\"\")+n:t&&(r.selector=this.selector+\".\"+t+\"(\"+n+\")\"),r},each:function(e,t){return v.each(this,e,t)},ready:function(e){return v.ready.promise().done(e),this},eq:function(e){return e=+e,e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(l.apply(this,arguments),\"slice\",l.call(arguments).join(\",\"))},map:function(e){return this.pushStack(v.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:[].sort,splice:[].splice},v.fn.init.prototype=v.fn,v.extend=v.fn.extend=function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;typeof u==\"boolean\"&&(l=u,u=arguments[1]||{},a=2),typeof u!=\"object\"&&!v.isFunction(u)&&(u={}),f===a&&(u=this,--a);for(;a<f;a++)if((e=arguments[a])!=null)for(n in e){r=u[n],i=e[n];if(u===i)continue;l&&i&&(v.isPlainObject(i)||(s=v.isArray(i)))?(s?(s=!1,o=r&&v.isArray(r)?r:[]):o=r&&v.isPlainObject(r)?r:{},u[n]=v.extend(l,o,i)):i!==t&&(u[n]=i)}return u},v.extend({noConflict:function(t){return e.$===v&&(e.$=a),t&&e.jQuery===v&&(e.jQuery=u),v},isReady:!1,readyWait:1,holdReady:function(e){e?v.readyWait++:v.ready(!0)},ready:function(e){if(e===!0?--v.readyWait:v.isReady)return;if(!i.body)return setTimeout(v.ready,1);v.isReady=!0;if(e!==!0&&--v.readyWait>0)return;r.resolveWith(i,[v]),v.fn.trigger&&v(i).trigger(\"ready\").off(\"ready\")},isFunction:function(e){return v.type(e)===\"function\"},isArray:Array.isArray||function(e){return v.type(e)===\"array\"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):O[h.call(e)]||\"object\"},isPlainObject:function(e){if(!e||v.type(e)!==\"object\"||e.nodeType||v.isWindow(e))return!1;try{if(e.constructor&&!p.call(e,\"constructor\")&&!p.call(e.constructor.prototype,\"isPrototypeOf\"))return!1}catch(n){return!1}var r;for(r in e);return r===t||p.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){var r;return!e||typeof e!=\"string\"?null:(typeof t==\"boolean\"&&(n=t,t=0),t=t||i,(r=E.exec(e))?[t.createElement(r[1])]:(r=v.buildFragment([e],t,n?null:[]),v.merge([],(r.cacheable?v.clone(r.fragment):r.fragment).childNodes)))},parseJSON:function(t){if(!t||typeof t!=\"string\")return null;t=v.trim(t);if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(S.test(t.replace(T,\"@\").replace(N,\"]\").replace(x,\"\")))return(new Function(\"return \"+t))();v.error(\"Invalid JSON: \"+t)},parseXML:function(n){var r,i;if(!n||typeof n!=\"string\")return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,\"text/xml\")):(r=new ActiveXObject(\"Microsoft.XMLDOM\"),r.async=\"false\",r.loadXML(n))}catch(s){r=t}return(!r||!r.documentElement||r.getElementsByTagName(\"parsererror\").length)&&v.error(\"Invalid XML: \"+n),r},noop:function(){},globalEval:function(t){t&&g.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(C,\"ms-\").replace(k,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,n,r){var i,s=0,o=e.length,u=o===t||v.isFunction(e);if(r){if(u){for(i in e)if(n.apply(e[i],r)===!1)break}else for(;s<o;)if(n.apply(e[s++],r)===!1)break}else if(u){for(i in e)if(n.call(e[i],i,e[i])===!1)break}else for(;s<o;)if(n.call(e[s],s,e[s++])===!1)break;return e},trim:d&&!d.call(\"\\ufeff\\u00a0\")?function(e){return e==null?\"\":d.call(e)}:function(e){return e==null?\"\":(e+\"\").replace(b,\"\")},makeArray:function(e,t){var n,r=t||[];return e!=null&&(n=v.type(e),e.length==null||n===\"string\"||n===\"function\"||n===\"regexp\"||v.isWindow(e)?f.call(r,e):v.merge(r,e)),r},inArray:function(e,t,n){var r;if(t){if(c)return c.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,s=0;if(typeof r==\"number\")for(;s<r;s++)e[i++]=n[s];else while(n[s]!==t)e[i++]=n[s++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,n,r){var i,s,o=[],u=0,a=e.length,f=e instanceof v||a!==t&&typeof a==\"number\"&&(a>0&&e[0]&&e[a-1]||a===0||v.isArray(e));if(f)for(;u<a;u++)i=n(e[u],u,r),i!=null&&(o[o.length]=i);else for(s in e)i=n(e[s],s,r),i!=null&&(o[o.length]=i);return o.concat.apply([],o)},guid:1,proxy:function(e,n){var r,i,s;return typeof n==\"string\"&&(r=e[n],n=e,e=r),v.isFunction(e)?(i=l.call(arguments,2),s=function(){return e.apply(n,i.concat(l.call(arguments)))},s.guid=e.guid=e.guid||v.guid++,s):t},access:function(e,n,r,i,s,o,u){var a,f=r==null,l=0,c=e.length;if(r&&typeof r==\"object\"){for(l in r)v.access(e,n,l,r[l],1,o,i);s=1}else if(i!==t){a=u===t&&v.isFunction(i),f&&(a?(a=n,n=function(e,t,n){return a.call(v(e),n)}):(n.call(e,i),n=null));if(n)for(;l<c;l++)n(e[l],r,a?i.call(e[l],l,n(e[l],r)):i,u);s=1}return s?e:f?n.call(e):c?n(e[0],r):o},now:function(){return(new Date).getTime()}}),v.ready.promise=function(t){if(!r){r=v.Deferred();if(i.readyState===\"complete\")setTimeout(v.ready,1);else if(i.addEventListener)i.addEventListener(\"DOMContentLoaded\",A,!1),e.addEventListener(\"load\",v.ready,!1);else{i.attachEvent(\"onreadystatechange\",A),e.attachEvent(\"onload\",v.ready);var n=!1;try{n=e.frameElement==null&&i.documentElement}catch(s){}n&&n.doScroll&&function o(){if(!v.isReady){try{n.doScroll(\"left\")}catch(e){return setTimeout(o,50)}v.ready()}}()}}return r.promise(t)},v.each(\"Boolean Number String Function Array Date RegExp Object\".split(\" \"),function(e,t){O[\"[object \"+t+\"]\"]=t.toLowerCase()}),n=v(i);var M={};v.Callbacks=function(e){e=typeof e==\"string\"?M[e]||_(e):v.extend({},e);var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){n=e.memory&&t,r=!0,u=s||0,s=0,o=a.length,i=!0;for(;a&&u<o;u++)if(a[u].apply(t[0],t[1])===!1&&e.stopOnFalse){n=!1;break}i=!1,a&&(f?f.length&&l(f.shift()):n?a=[]:c.disable())},c={add:function(){if(a){var t=a.length;(function r(t){v.each(t,function(t,n){var i=v.type(n);i===\"function\"?(!e.unique||!c.has(n))&&a.push(n):n&&n.length&&i!==\"string\"&&r(n)})})(arguments),i?o=a.length:n&&(s=t,l(n))}return this},remove:function(){return a&&v.each(arguments,function(e,t){var n;while((n=v.inArray(t,a,n))>-1)a.splice(n,1),i&&(n<=o&&o--,n<=u&&u--)}),this},has:function(e){return v.inArray(e,a)>-1},empty:function(){return a=[],this},disable:function(){return a=f=n=t,this},disabled:function(){return!a},lock:function(){return f=t,n||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],a&&(!r||f)&&(i?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},v.extend({Deferred:function(e){var t=[[\"resolve\",\"done\",v.Callbacks(\"once memory\"),\"resolved\"],[\"reject\",\"fail\",v.Callbacks(\"once memory\"),\"rejected\"],[\"notify\",\"progress\",v.Callbacks(\"memory\")]],n=\"pending\",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return v.Deferred(function(n){v.each(t,function(t,r){var s=r[0],o=e[t];i[r[1]](v.isFunction(o)?function(){var e=o.apply(this,arguments);e&&v.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s+\"With\"](this===i?n:this,[e])}:n[s])}),e=null}).promise()},promise:function(e){return e!=null?v.extend(e,r):r}},i={};return r.pipe=r.then,v.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=o.fire,i[s[0]+\"With\"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=l.call(arguments),r=n.length,i=r!==1||e&&v.isFunction(e.promise)?r:0,s=i===1?e:v.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?l.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&v.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}}),v.support=function(){var t,n,r,s,o,u,a,f,l,c,h,p=i.createElement(\"div\");p.setAttribute(\"className\",\"t\"),p.innerHTML=\"  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>\",n=p.getElementsByTagName(\"*\"),r=p.getElementsByTagName(\"a\")[0];if(!n||!r||!n.length)return{};s=i.createElement(\"select\"),o=s.appendChild(i.createElement(\"option\")),u=p.getElementsByTagName(\"input\")[0],r.style.cssText=\"top:1px;float:left;opacity:.5\",t={leadingWhitespace:p.firstChild.nodeType===3,tbody:!p.getElementsByTagName(\"tbody\").length,htmlSerialize:!!p.getElementsByTagName(\"link\").length,style:/top/.test(r.getAttribute(\"style\")),hrefNormalized:r.getAttribute(\"href\")===\"/a\",opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:u.value===\"on\",optSelected:o.selected,getSetAttribute:p.className!==\"t\",enctype:!!i.createElement(\"form\").enctype,html5Clone:i.createElement(\"nav\").cloneNode(!0).outerHTML!==\"<:nav></:nav>\",boxModel:i.compatMode===\"CSS1Compat\",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},u.checked=!0,t.noCloneChecked=u.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!o.disabled;try{delete p.test}catch(d){t.deleteExpando=!1}!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent(\"onclick\",h=function(){t.noCloneEvent=!1}),p.cloneNode(!0).fireEvent(\"onclick\"),p.detachEvent(\"onclick\",h)),u=i.createElement(\"input\"),u.value=\"t\",u.setAttribute(\"type\",\"radio\"),t.radioValue=u.value===\"t\",u.setAttribute(\"checked\",\"checked\"),u.setAttribute(\"name\",\"t\"),p.appendChild(u),a=i.createDocumentFragment(),a.appendChild(p.lastChild),t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=u.checked,a.removeChild(u),a.appendChild(p);if(p.attachEvent)for(l in{submit:!0,change:!0,focusin:!0})f=\"on\"+l,c=f in p,c||(p.setAttribute(f,\"return;\"),c=typeof p[f]==\"function\"),t[l+\"Bubbles\"]=c;return v(function(){var n,r,s,o,u=\"padding:0;margin:0;border:0;display:block;overflow:hidden;\",a=i.getElementsByTagName(\"body\")[0];if(!a)return;n=i.createElement(\"div\"),n.style.cssText=\"visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px\",a.insertBefore(n,a.firstChild),r=i.createElement(\"div\"),n.appendChild(r),r.innerHTML=\"<table><tr><td></td><td>t</td></tr></table>\",s=r.getElementsByTagName(\"td\"),s[0].style.cssText=\"padding:0;margin:0;border:0;display:none\",c=s[0].offsetHeight===0,s[0].style.display=\"\",s[1].style.display=\"none\",t.reliableHiddenOffsets=c&&s[0].offsetHeight===0,r.innerHTML=\"\",r.style.cssText=\"box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;\",t.boxSizing=r.offsetWidth===4,t.doesNotIncludeMarginInBodyOffset=a.offsetTop!==1,e.getComputedStyle&&(t.pixelPosition=(e.getComputedStyle(r,null)||{}).top!==\"1%\",t.boxSizingReliable=(e.getComputedStyle(r,null)||{width:\"4px\"}).width===\"4px\",o=i.createElement(\"div\"),o.style.cssText=r.style.cssText=u,o.style.marginRight=o.style.width=\"0\",r.style.width=\"1px\",r.appendChild(o),t.reliableMarginRight=!parseFloat((e.getComputedStyle(o,null)||{}).marginRight)),typeof r.style.zoom!=\"undefined\"&&(r.innerHTML=\"\",r.style.cssText=u+\"width:1px;padding:1px;display:inline;zoom:1\",t.inlineBlockNeedsLayout=r.offsetWidth===3,r.style.display=\"block\",r.style.overflow=\"visible\",r.innerHTML=\"<div></div>\",r.firstChild.style.width=\"5px\",t.shrinkWrapBlocks=r.offsetWidth!==3,n.style.zoom=1),a.removeChild(n),n=r=s=o=null}),a.removeChild(p),n=r=s=o=u=a=p=null,t}();var D=/(?:\\{[\\s\\S]*\\}|\\[[\\s\\S]*\\])$/,P=/([A-Z])/g;v.extend({cache:{},deletedIds:[],uuid:0,expando:\"jQuery\"+(v.fn.jquery+Math.random()).replace(/\\D/g,\"\"),noData:{embed:!0,object:\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\",applet:!0},hasData:function(e){return e=e.nodeType?v.cache[e[v.expando]]:e[v.expando],!!e&&!B(e)},data:function(e,n,r,i){if(!v.acceptData(e))return;var s,o,u=v.expando,a=typeof n==\"string\",f=e.nodeType,l=f?v.cache:e,c=f?e[u]:e[u]&&u;if((!c||!l[c]||!i&&!l[c].data)&&a&&r===t)return;c||(f?e[u]=c=v.deletedIds.pop()||v.guid++:c=u),l[c]||(l[c]={},f||(l[c].toJSON=v.noop));if(typeof n==\"object\"||typeof n==\"function\")i?l[c]=v.extend(l[c],n):l[c].data=v.extend(l[c].data,n);return s=l[c],i||(s.data||(s.data={}),s=s.data),r!==t&&(s[v.camelCase(n)]=r),a?(o=s[n],o==null&&(o=s[v.camelCase(n)])):o=s,o},removeData:function(e,t,n){if(!v.acceptData(e))return;var r,i,s,o=e.nodeType,u=o?v.cache:e,a=o?e[v.expando]:v.expando;if(!u[a])return;if(t){r=n?u[a]:u[a].data;if(r){v.isArray(t)||(t in r?t=[t]:(t=v.camelCase(t),t in r?t=[t]:t=t.split(\" \")));for(i=0,s=t.length;i<s;i++)delete r[t[i]];if(!(n?B:v.isEmptyObject)(r))return}}if(!n){delete u[a].data;if(!B(u[a]))return}o?v.cleanData([e],!0):v.support.deleteExpando||u!=u.window?delete u[a]:u[a]=null},_data:function(e,t,n){return v.data(e,t,n,!0)},acceptData:function(e){var t=e.nodeName&&v.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute(\"classid\")===t}}),v.fn.extend({data:function(e,n){var r,i,s,o,u,a=this[0],f=0,l=null;if(e===t){if(this.length){l=v.data(a);if(a.nodeType===1&&!v._data(a,\"parsedAttrs\")){s=a.attributes;for(u=s.length;f<u;f++)o=s[f].name,o.indexOf(\"data-\")||(o=v.camelCase(o.substring(5)),H(a,o,l[o]));v._data(a,\"parsedAttrs\",!0)}}return l}return typeof e==\"object\"?this.each(function(){v.data(this,e)}):(r=e.split(\".\",2),r[1]=r[1]?\".\"+r[1]:\"\",i=r[1]+\"!\",v.access(this,function(n){if(n===t)return l=this.triggerHandler(\"getData\"+i,[r[0]]),l===t&&a&&(l=v.data(a,e),l=H(a,e,l)),l===t&&r[1]?this.data(r[0]):l;r[1]=n,this.each(function(){var t=v(this);t.triggerHandler(\"setData\"+i,r),v.data(this,e,n),t.triggerHandler(\"changeData\"+i,r)})},null,n,arguments.length>1,null,!1))},removeData:function(e){return this.each(function(){v.removeData(this,e)})}}),v.extend({queue:function(e,t,n){var r;if(e)return t=(t||\"fx\")+\"queue\",r=v._data(e,t),n&&(!r||v.isArray(n)?r=v._data(e,t,v.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||\"fx\";var n=v.queue(e,t),r=n.length,i=n.shift(),s=v._queueHooks(e,t),o=function(){v.dequeue(e,t)};i===\"inprogress\"&&(i=n.shift(),r--),i&&(t===\"fx\"&&n.unshift(\"inprogress\"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+\"queueHooks\";return v._data(e,n)||v._data(e,n,{empty:v.Callbacks(\"once memory\").add(function(){v.removeData(e,t+\"queue\",!0),v.removeData(e,n,!0)})})}}),v.fn.extend({queue:function(e,n){var r=2;return typeof e!=\"string\"&&(n=e,e=\"fx\",r--),arguments.length<r?v.queue(this[0],e):n===t?this:this.each(function(){var t=v.queue(this,e,n);v._queueHooks(this,e),e===\"fx\"&&t[0]!==\"inprogress\"&&v.dequeue(this,e)})},dequeue:function(e){return this.each(function(){v.dequeue(this,e)})},delay:function(e,t){return e=v.fx?v.fx.speeds[e]||e:e,t=t||\"fx\",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||\"fx\",[])},promise:function(e,n){var r,i=1,s=v.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};typeof e!=\"string\"&&(n=e,e=t),e=e||\"fx\";while(u--)r=v._data(o[u],e+\"queueHooks\"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(n)}});var j,F,I,q=/[\\t\\r\\n]/g,R=/\\r/g,U=/^(?:button|input)$/i,z=/^(?:button|input|object|select|textarea)$/i,W=/^a(?:rea|)$/i,X=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,V=v.support.getSetAttribute;v.fn.extend({attr:function(e,t){return v.access(this,v.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){v.removeAttr(this,e)})},prop:function(e,t){return v.access(this,v.prop,e,t,arguments.length>1)},removeProp:function(e){return e=v.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o,u;if(v.isFunction(e))return this.each(function(t){v(this).addClass(e.call(this,t,this.className))});if(e&&typeof e==\"string\"){t=e.split(y);for(n=0,r=this.length;n<r;n++){i=this[n];if(i.nodeType===1)if(!i.className&&t.length===1)i.className=e;else{s=\" \"+i.className+\" \";for(o=0,u=t.length;o<u;o++)s.indexOf(\" \"+t[o]+\" \")<0&&(s+=t[o]+\" \");i.className=v.trim(s)}}}return this},removeClass:function(e){var n,r,i,s,o,u,a;if(v.isFunction(e))return this.each(function(t){v(this).removeClass(e.call(this,t,this.className))});if(e&&typeof e==\"string\"||e===t){n=(e||\"\").split(y);for(u=0,a=this.length;u<a;u++){i=this[u];if(i.nodeType===1&&i.className){r=(\" \"+i.className+\" \").replace(q,\" \");for(s=0,o=n.length;s<o;s++)while(r.indexOf(\" \"+n[s]+\" \")>=0)r=r.replace(\" \"+n[s]+\" \",\" \");i.className=e?v.trim(r):\"\"}}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t==\"boolean\";return v.isFunction(e)?this.each(function(n){v(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n===\"string\"){var i,s=0,o=v(this),u=t,a=e.split(y);while(i=a[s++])u=r?u:!o.hasClass(i),o[u?\"addClass\":\"removeClass\"](i)}else if(n===\"undefined\"||n===\"boolean\")this.className&&v._data(this,\"__className__\",this.className),this.className=this.className||e===!1?\"\":v._data(this,\"__className__\")||\"\"})},hasClass:function(e){var t=\" \"+e+\" \",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(\" \"+this[n].className+\" \").replace(q,\" \").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,s=this[0];if(!arguments.length){if(s)return n=v.valHooks[s.type]||v.valHooks[s.nodeName.toLowerCase()],n&&\"get\"in n&&(r=n.get(s,\"value\"))!==t?r:(r=s.value,typeof r==\"string\"?r.replace(R,\"\"):r==null?\"\":r);return}return i=v.isFunction(e),this.each(function(r){var s,o=v(this);if(this.nodeType!==1)return;i?s=e.call(this,r,o.val()):s=e,s==null?s=\"\":typeof s==\"number\"?s+=\"\":v.isArray(s)&&(s=v.map(s,function(e){return e==null?\"\":e+\"\"})),n=v.valHooks[this.type]||v.valHooks[this.nodeName.toLowerCase()];if(!n||!(\"set\"in n)||n.set(this,s,\"value\")===t)this.value=s})}}),v.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type===\"select-one\"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(v.support.optDisabled?!n.disabled:n.getAttribute(\"disabled\")===null)&&(!n.parentNode.disabled||!v.nodeName(n.parentNode,\"optgroup\"))){t=v(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n=v.makeArray(t);return v(e).find(\"option\").each(function(){this.selected=v.inArray(v(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attrFn:{},attr:function(e,n,r,i){var s,o,u,a=e.nodeType;if(!e||a===3||a===8||a===2)return;if(i&&v.isFunction(v.fn[n]))return v(e)[n](r);if(typeof e.getAttribute==\"undefined\")return v.prop(e,n,r);u=a!==1||!v.isXMLDoc(e),u&&(n=n.toLowerCase(),o=v.attrHooks[n]||(X.test(n)?F:j));if(r!==t){if(r===null){v.removeAttr(e,n);return}return o&&\"set\"in o&&u&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+\"\"),r)}return o&&\"get\"in o&&u&&(s=o.get(e,n))!==null?s:(s=e.getAttribute(n),s===null?t:s)},removeAttr:function(e,t){var n,r,i,s,o=0;if(t&&e.nodeType===1){r=t.split(y);for(;o<r.length;o++)i=r[o],i&&(n=v.propFix[i]||i,s=X.test(i),s||v.attr(e,i,\"\"),e.removeAttribute(V?i:n),s&&n in e&&(e[n]=!1))}},attrHooks:{type:{set:function(e,t){if(U.test(e.nodeName)&&e.parentNode)v.error(\"type property can't be changed\");else if(!v.support.radioValue&&t===\"radio\"&&v.nodeName(e,\"input\")){var n=e.value;return e.setAttribute(\"type\",t),n&&(e.value=n),t}}},value:{get:function(e,t){return j&&v.nodeName(e,\"button\")?j.get(e,t):t in e?e.value:null},set:function(e,t,n){if(j&&v.nodeName(e,\"button\"))return j.set(e,t,n);e.value=t}}},propFix:{tabindex:\"tabIndex\",readonly:\"readOnly\",\"for\":\"htmlFor\",\"class\":\"className\",maxlength:\"maxLength\",cellspacing:\"cellSpacing\",cellpadding:\"cellPadding\",rowspan:\"rowSpan\",colspan:\"colSpan\",usemap:\"useMap\",frameborder:\"frameBorder\",contenteditable:\"contentEditable\"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(!e||u===3||u===8||u===2)return;return o=u!==1||!v.isXMLDoc(e),o&&(n=v.propFix[n]||n,s=v.propHooks[n]),r!==t?s&&\"set\"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&\"get\"in s&&(i=s.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode(\"tabindex\");return n&&n.specified?parseInt(n.value,10):z.test(e.nodeName)||W.test(e.nodeName)&&e.href?0:t}}}}),F={get:function(e,n){var r,i=v.prop(e,n);return i===!0||typeof i!=\"boolean\"&&(r=e.getAttributeNode(n))&&r.nodeValue!==!1?n.toLowerCase():t},set:function(e,t,n){var r;return t===!1?v.removeAttr(e,n):(r=v.propFix[n]||n,r in e&&(e[r]=!0),e.setAttribute(n,n.toLowerCase())),n}},V||(I={name:!0,id:!0,coords:!0},j=v.valHooks.button={get:function(e,n){var r;return r=e.getAttributeNode(n),r&&(I[n]?r.value!==\"\":r.specified)?r.value:t},set:function(e,t,n){var r=e.getAttributeNode(n);return r||(r=i.createAttribute(n),e.setAttributeNode(r)),r.value=t+\"\"}},v.each([\"width\",\"height\"],function(e,t){v.attrHooks[t]=v.extend(v.attrHooks[t],{set:function(e,n){if(n===\"\")return e.setAttribute(t,\"auto\"),n}})}),v.attrHooks.contenteditable={get:j.get,set:function(e,t,n){t===\"\"&&(t=\"false\"),j.set(e,t,n)}}),v.support.hrefNormalized||v.each([\"href\",\"src\",\"width\",\"height\"],function(e,n){v.attrHooks[n]=v.extend(v.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r===null?t:r}})}),v.support.style||(v.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=t+\"\"}}),v.support.optSelected||(v.propHooks.selected=v.extend(v.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),v.support.enctype||(v.propFix.enctype=\"encoding\"),v.support.checkOn||v.each([\"radio\",\"checkbox\"],function(){v.valHooks[this]={get:function(e){return e.getAttribute(\"value\")===null?\"on\":e.value}}}),v.each([\"radio\",\"checkbox\"],function(){v.valHooks[this]=v.extend(v.valHooks[this],{set:function(e,t){if(v.isArray(t))return e.checked=v.inArray(v(e).val(),t)>=0}})});var $=/^(?:textarea|input|select)$/i,J=/^([^\\.]*|)(?:\\.(.+)|)$/,K=/(?:^|\\s)hover(\\.\\S+|)\\b/,Q=/^key/,G=/^(?:mouse|contextmenu)|click/,Y=/^(?:focusinfocus|focusoutblur)$/,Z=function(e){return v.event.special.hover?e:e.replace(K,\"mouseenter$1 mouseleave$1\")};v.event={add:function(e,n,r,i,s){var o,u,a,f,l,c,h,p,d,m,g;if(e.nodeType===3||e.nodeType===8||!n||!r||!(o=v._data(e)))return;r.handler&&(d=r,r=d.handler,s=d.selector),r.guid||(r.guid=v.guid++),a=o.events,a||(o.events=a={}),u=o.handle,u||(o.handle=u=function(e){return typeof v==\"undefined\"||!!e&&v.event.triggered===e.type?t:v.event.dispatch.apply(u.elem,arguments)},u.elem=e),n=v.trim(Z(n)).split(\" \");for(f=0;f<n.length;f++){l=J.exec(n[f])||[],c=l[1],h=(l[2]||\"\").split(\".\").sort(),g=v.event.special[c]||{},c=(s?g.delegateType:g.bindType)||c,g=v.event.special[c]||{},p=v.extend({type:c,origType:l[1],data:i,handler:r,guid:r.guid,selector:s,needsContext:s&&v.expr.match.needsContext.test(s),namespace:h.join(\".\")},d),m=a[c];if(!m){m=a[c]=[],m.delegateCount=0;if(!g.setup||g.setup.call(e,i,h,u)===!1)e.addEventListener?e.addEventListener(c,u,!1):e.attachEvent&&e.attachEvent(\"on\"+c,u)}g.add&&(g.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),s?m.splice(m.delegateCount++,0,p):m.push(p),v.event.global[c]=!0}e=null},global:{},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,m,g=v.hasData(e)&&v._data(e);if(!g||!(h=g.events))return;t=v.trim(Z(t||\"\")).split(\" \");for(s=0;s<t.length;s++){o=J.exec(t[s])||[],u=a=o[1],f=o[2];if(!u){for(u in h)v.event.remove(e,u+t[s],n,r,!0);continue}p=v.event.special[u]||{},u=(r?p.delegateType:p.bindType)||u,d=h[u]||[],l=d.length,f=f?new RegExp(\"(^|\\\\.)\"+f.split(\".\").sort().join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"):null;for(c=0;c<d.length;c++)m=d[c],(i||a===m.origType)&&(!n||n.guid===m.guid)&&(!f||f.test(m.namespace))&&(!r||r===m.selector||r===\"**\"&&m.selector)&&(d.splice(c--,1),m.selector&&d.delegateCount--,p.remove&&p.remove.call(e,m));d.length===0&&l!==d.length&&((!p.teardown||p.teardown.call(e,f,g.handle)===!1)&&v.removeEvent(e,u,g.handle),delete h[u])}v.isEmptyObject(h)&&(delete g.handle,v.removeData(e,\"events\",!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,r,s,o){if(!s||s.nodeType!==3&&s.nodeType!==8){var u,a,f,l,c,h,p,d,m,g,y=n.type||n,b=[];if(Y.test(y+v.event.triggered))return;y.indexOf(\"!\")>=0&&(y=y.slice(0,-1),a=!0),y.indexOf(\".\")>=0&&(b=y.split(\".\"),y=b.shift(),b.sort());if((!s||v.event.customEvent[y])&&!v.event.global[y])return;n=typeof n==\"object\"?n[v.expando]?n:new v.Event(y,n):new v.Event(y),n.type=y,n.isTrigger=!0,n.exclusive=a,n.namespace=b.join(\".\"),n.namespace_re=n.namespace?new RegExp(\"(^|\\\\.)\"+b.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"):null,h=y.indexOf(\":\")<0?\"on\"+y:\"\";if(!s){u=v.cache;for(f in u)u[f].events&&u[f].events[y]&&v.event.trigger(n,r,u[f].handle.elem,!0);return}n.result=t,n.target||(n.target=s),r=r!=null?v.makeArray(r):[],r.unshift(n),p=v.event.special[y]||{};if(p.trigger&&p.trigger.apply(s,r)===!1)return;m=[[s,p.bindType||y]];if(!o&&!p.noBubble&&!v.isWindow(s)){g=p.delegateType||y,l=Y.test(g+y)?s:s.parentNode;for(c=s;l;l=l.parentNode)m.push([l,g]),c=l;c===(s.ownerDocument||i)&&m.push([c.defaultView||c.parentWindow||e,g])}for(f=0;f<m.length&&!n.isPropagationStopped();f++)l=m[f][0],n.type=m[f][1],d=(v._data(l,\"events\")||{})[n.type]&&v._data(l,\"handle\"),d&&d.apply(l,r),d=h&&l[h],d&&v.acceptData(l)&&d.apply&&d.apply(l,r)===!1&&n.preventDefault();return n.type=y,!o&&!n.isDefaultPrevented()&&(!p._default||p._default.apply(s.ownerDocument,r)===!1)&&(y!==\"click\"||!v.nodeName(s,\"a\"))&&v.acceptData(s)&&h&&s[y]&&(y!==\"focus\"&&y!==\"blur\"||n.target.offsetWidth!==0)&&!v.isWindow(s)&&(c=s[h],c&&(s[h]=null),v.event.triggered=y,s[y](),v.event.triggered=t,c&&(s[h]=c)),n.result}return},dispatch:function(n){n=v.event.fix(n||e.event);var r,i,s,o,u,a,f,c,h,p,d=(v._data(this,\"events\")||{})[n.type]||[],m=d.delegateCount,g=l.call(arguments),y=!n.exclusive&&!n.namespace,b=v.event.special[n.type]||{},w=[];g[0]=n,n.delegateTarget=this;if(b.preDispatch&&b.preDispatch.call(this,n)===!1)return;if(m&&(!n.button||n.type!==\"click\"))for(s=n.target;s!=this;s=s.parentNode||this)if(s.disabled!==!0||n.type!==\"click\"){u={},f=[];for(r=0;r<m;r++)c=d[r],h=c.selector,u[h]===t&&(u[h]=c.needsContext?v(h,this).index(s)>=0:v.find(h,this,null,[s]).length),u[h]&&f.push(c);f.length&&w.push({elem:s,matches:f})}d.length>m&&w.push({elem:this,matches:d.slice(m)});for(r=0;r<w.length&&!n.isPropagationStopped();r++){a=w[r],n.currentTarget=a.elem;for(i=0;i<a.matches.length&&!n.isImmediatePropagationStopped();i++){c=a.matches[i];if(y||!n.namespace&&!c.namespace||n.namespace_re&&n.namespace_re.test(c.namespace))n.data=c.data,n.handleObj=c,o=((v.event.special[c.origType]||{}).handle||c.handler).apply(a.elem,g),o!==t&&(n.result=o,o===!1&&(n.preventDefault(),n.stopPropagation()))}}return b.postDispatch&&b.postDispatch.call(this,n),n.result},props:\"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which\".split(\" \"),fixHooks:{},keyHooks:{props:\"char charCode key keyCode\".split(\" \"),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:\"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement\".split(\" \"),filter:function(e,n){var r,s,o,u=n.button,a=n.fromElement;return e.pageX==null&&n.clientX!=null&&(r=e.target.ownerDocument||i,s=r.documentElement,o=r.body,e.pageX=n.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=n.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0),e}},fix:function(e){if(e[v.expando])return e;var t,n,r=e,s=v.event.fixHooks[e.type]||{},o=s.props?this.props.concat(s.props):this.props;e=v.Event(r);for(t=o.length;t;)n=o[--t],e[n]=r[n];return e.target||(e.target=r.srcElement||i),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,r):e},special:{load:{noBubble:!0},focus:{delegateType:\"focusin\"},blur:{delegateType:\"focusout\"},beforeunload:{setup:function(e,t,n){v.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,r){var i=v.extend(new v.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?v.event.trigger(i,null,t):v.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},v.event.handle=v.event.dispatch,v.removeEvent=i.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r=\"on\"+t;e.detachEvent&&(typeof e[r]==\"undefined\"&&(e[r]=null),e.detachEvent(r,n))},v.Event=function(e,t){if(!(this instanceof v.Event))return new v.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?tt:et):this.type=e,t&&v.extend(this,t),this.timeStamp=e&&e.timeStamp||v.now(),this[v.expando]=!0},v.Event.prototype={preventDefault:function(){this.isDefaultPrevented=tt;var e=this.originalEvent;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=tt;var e=this.originalEvent;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=tt,this.stopPropagation()},isDefaultPrevented:et,isPropagationStopped:et,isImmediatePropagationStopped:et},v.each({mouseenter:\"mouseover\",mouseleave:\"mouseout\"},function(e,t){v.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj,o=s.selector;if(!i||i!==r&&!v.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),v.support.submitBubbles||(v.event.special.submit={setup:function(){if(v.nodeName(this,\"form\"))return!1;v.event.add(this,\"click._submit keypress._submit\",function(e){var n=e.target,r=v.nodeName(n,\"input\")||v.nodeName(n,\"button\")?n.form:t;r&&!v._data(r,\"_submit_attached\")&&(v.event.add(r,\"submit._submit\",function(e){e._submit_bubble=!0}),v._data(r,\"_submit_attached\",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&v.event.simulate(\"submit\",this.parentNode,e,!0))},teardown:function(){if(v.nodeName(this,\"form\"))return!1;v.event.remove(this,\"._submit\")}}),v.support.changeBubbles||(v.event.special.change={setup:function(){if($.test(this.nodeName)){if(this.type===\"checkbox\"||this.type===\"radio\")v.event.add(this,\"propertychange._change\",function(e){e.originalEvent.propertyName===\"checked\"&&(this._just_changed=!0)}),v.event.add(this,\"click._change\",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),v.event.simulate(\"change\",this,e,!0)});return!1}v.event.add(this,\"beforeactivate._change\",function(e){var t=e.target;$.test(t.nodeName)&&!v._data(t,\"_change_attached\")&&(v.event.add(t,\"change._change\",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&v.event.simulate(\"change\",this.parentNode,e,!0)}),v._data(t,\"_change_attached\",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!==\"radio\"&&t.type!==\"checkbox\")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return v.event.remove(this,\"._change\"),!$.test(this.nodeName)}}),v.support.focusinBubbles||v.each({focus:\"focusin\",blur:\"focusout\"},function(e,t){var n=0,r=function(e){v.event.simulate(t,e.target,v.event.fix(e),!0)};v.event.special[t]={setup:function(){n++===0&&i.addEventListener(e,r,!0)},teardown:function(){--n===0&&i.removeEventListener(e,r,!0)}}}),v.fn.extend({on:function(e,n,r,i,s){var o,u;if(typeof e==\"object\"){typeof n!=\"string\"&&(r=r||n,n=t);for(u in e)this.on(u,n,r,e[u],s);return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n==\"string\"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1)i=et;else if(!i)return this;return s===1&&(o=i,i=function(e){return v().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=v.guid++)),this.each(function(){v.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,v(e.delegateTarget).off(i.namespace?i.origType+\".\"+i.namespace:i.origType,i.selector,i.handler),this;if(typeof e==\"object\"){for(s in e)this.off(s,n,e[s]);return this}if(n===!1||typeof n==\"function\")r=n,n=t;return r===!1&&(r=et),this.each(function(){v.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){return v(this.context).on(e,this.selector,t,n),this},die:function(e,t){return v(this.context).off(e,this.selector||\"**\",t),this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,\"**\"):this.off(t,e||\"**\",n)},trigger:function(e,t){return this.each(function(){v.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return v.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,n=e.guid||v.guid++,r=0,i=function(n){var i=(v._data(this,\"lastToggle\"+e.guid)||0)%r;return v._data(this,\"lastToggle\"+e.guid,i+1),n.preventDefault(),t[i].apply(this,arguments)||!1};i.guid=n;while(r<t.length)t[r++].guid=n;return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),v.each(\"blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu\".split(\" \"),function(e,t){v.fn[t]=function(e,n){return n==null&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)},Q.test(t)&&(v.event.fixHooks[t]=v.event.keyHooks),G.test(t)&&(v.event.fixHooks[t]=v.event.mouseHooks)}),function(e,t){function nt(e,t,n,r){n=n||[],t=t||g;var i,s,a,f,l=t.nodeType;if(!e||typeof e!=\"string\")return n;if(l!==1&&l!==9)return[];a=o(t);if(!a&&!r)if(i=R.exec(e))if(f=i[1]){if(l===9){s=t.getElementById(f);if(!s||!s.parentNode)return n;if(s.id===f)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(f))&&u(t,s)&&s.id===f)return n.push(s),n}else{if(i[2])return S.apply(n,x.call(t.getElementsByTagName(e),0)),n;if((f=i[3])&&Z&&t.getElementsByClassName)return S.apply(n,x.call(t.getElementsByClassName(f),0)),n}return vt(e.replace(j,\"$1\"),t,n,r,a)}function rt(e){return function(t){var n=t.nodeName.toLowerCase();return n===\"input\"&&t.type===e}}function it(e){return function(t){var n=t.nodeName.toLowerCase();return(n===\"input\"||n===\"button\")&&t.type===e}}function st(e){return N(function(t){return t=+t,N(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function ot(e,t,n){if(e===t)return n;var r=e.nextSibling;while(r){if(r===t)return-1;r=r.nextSibling}return 1}function ut(e,t){var n,r,s,o,u,a,f,l=L[d][e+\" \"];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){if(!n||(r=F.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(s=[]);n=!1;if(r=I.exec(u))s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=r[0].replace(j,\" \");for(o in i.filter)(r=J[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=o,n.matches=r);if(!n)break}return t?u.length:u?nt.error(e):L(e,a).slice(0)}function at(e,t,r){var i=t.dir,s=r&&t.dir===\"parentNode\",o=w++;return t.first?function(t,n,r){while(t=t[i])if(s||t.nodeType===1)return e(t,n,r)}:function(t,r,u){if(!u){var a,f=b+\" \"+o+\" \",l=f+n;while(t=t[i])if(s||t.nodeType===1){if((a=t[d])===l)return t.sizset;if(typeof a==\"string\"&&a.indexOf(f)===0){if(t.sizset)return t}else{t[d]=l;if(e(t,r,u))return t.sizset=!0,t;t.sizset=!1}}}else while(t=t[i])if(s||t.nodeType===1)if(e(t,r,u))return t}}function ft(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function lt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function ct(e,t,n,r,i,s){return r&&!r[d]&&(r=ct(r)),i&&!i[d]&&(i=ct(i,s)),N(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||dt(t||\"*\",u.nodeType?[u]:u,[]),m=e&&(s||!t)?lt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=lt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?T.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=lt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):S.apply(o,g)})}function ht(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[\" \"],a=o?1:0,f=at(function(e){return e===t},u,!0),l=at(function(e){return T.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==c)||((t=n).nodeType?f(e,n,r):l(e,n,r))}];for(;a<s;a++)if(n=i.relative[e[a].type])h=[at(ft(h),n)];else{n=i.filter[e[a].type].apply(null,e[a].matches);if(n[d]){r=++a;for(;r<s;r++)if(i.relative[e[r].type])break;return ct(a>1&&ft(h),a>1&&e.slice(0,a-1).join(\"\").replace(j,\"$1\"),n,a<r&&ht(e.slice(a,r)),r<s&&ht(e=e.slice(r)),r<s&&e.join(\"\"))}h.push(n)}return ft(h)}function pt(e,t){var r=t.length>0,s=e.length>0,o=function(u,a,f,l,h){var p,d,v,m=[],y=0,w=\"0\",x=u&&[],T=h!=null,N=c,C=u||s&&i.find.TAG(\"*\",h&&a.parentNode||a),k=b+=N==null?1:Math.E;T&&(c=a!==g&&a,n=o.el);for(;(p=C[w])!=null;w++){if(s&&p){for(d=0;v=e[d];d++)if(v(p,a,f)){l.push(p);break}T&&(b=k,n=++o.el)}r&&((p=!v&&p)&&y--,u&&x.push(p))}y+=w;if(r&&w!==y){for(d=0;v=t[d];d++)v(x,m,a,f);if(u){if(y>0)while(w--)!x[w]&&!m[w]&&(m[w]=E.call(l));m=lt(m)}S.apply(l,m),T&&!u&&m.length>0&&y+t.length>1&&nt.uniqueSort(l)}return T&&(b=k,c=N),x};return o.el=0,r?N(o):o}function dt(e,t,n){var r=0,i=t.length;for(;r<i;r++)nt(e,t[r],n);return n}function vt(e,t,n,r,s){var o,u,f,l,c,h=ut(e),p=h.length;if(!r&&h.length===1){u=h[0]=h[0].slice(0);if(u.length>2&&(f=u[0]).type===\"ID\"&&t.nodeType===9&&!s&&i.relative[u[1].type]){t=i.find.ID(f.matches[0].replace($,\"\"),t,s)[0];if(!t)return n;e=e.slice(u.shift().length)}for(o=J.POS.test(e)?-1:u.length-1;o>=0;o--){f=u[o];if(i.relative[l=f.type])break;if(c=i.find[l])if(r=c(f.matches[0].replace($,\"\"),z.test(u[0].type)&&t.parentNode||t,s)){u.splice(o,1),e=r.length&&u.join(\"\");if(!e)return S.apply(n,x.call(r,0)),n;break}}}return a(e,h)(r,t,s,n,z.test(e)),n}function mt(){}var n,r,i,s,o,u,a,f,l,c,h=!0,p=\"undefined\",d=(\"sizcache\"+Math.random()).replace(\".\",\"\"),m=String,g=e.document,y=g.documentElement,b=0,w=0,E=[].pop,S=[].push,x=[].slice,T=[].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},N=function(e,t){return e[d]=t==null||t,e},C=function(){var e={},t=[];return N(function(n,r){return t.push(n)>i.cacheLength&&delete e[t.shift()],e[n+\" \"]=r},e)},k=C(),L=C(),A=C(),O=\"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",M=\"(?:\\\\\\\\.|[-\\\\w]|[^\\\\x00-\\\\xa0])+\",_=M.replace(\"w\",\"w#\"),D=\"([*^$|!~]?=)\",P=\"\\\\[\"+O+\"*(\"+M+\")\"+O+\"*(?:\"+D+O+\"*(?:(['\\\"])((?:\\\\\\\\.|[^\\\\\\\\])*?)\\\\3|(\"+_+\")|)|)\"+O+\"*\\\\]\",H=\":(\"+M+\")(?:\\\\((?:(['\\\"])((?:\\\\\\\\.|[^\\\\\\\\])*?)\\\\2|([^()[\\\\]]*|(?:(?:\"+P+\")|[^:]|\\\\\\\\.)*|.*))\\\\)|)\",B=\":(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\"+O+\"*((?:-\\\\d)?\\\\d*)\"+O+\"*\\\\)|)(?=[^-]|$)\",j=new RegExp(\"^\"+O+\"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\"+O+\"+$\",\"g\"),F=new RegExp(\"^\"+O+\"*,\"+O+\"*\"),I=new RegExp(\"^\"+O+\"*([\\\\x20\\\\t\\\\r\\\\n\\\\f>+~])\"+O+\"*\"),q=new RegExp(H),R=/^(?:#([\\w\\-]+)|(\\w+)|\\.([\\w\\-]+))$/,U=/^:not/,z=/[\\x20\\t\\r\\n\\f]*[+~]/,W=/:not\\($/,X=/h\\d/i,V=/input|select|textarea|button/i,$=/\\\\(?!\\\\)/g,J={ID:new RegExp(\"^#(\"+M+\")\"),CLASS:new RegExp(\"^\\\\.(\"+M+\")\"),NAME:new RegExp(\"^\\\\[name=['\\\"]?(\"+M+\")['\\\"]?\\\\]\"),TAG:new RegExp(\"^(\"+M.replace(\"w\",\"w*\")+\")\"),ATTR:new RegExp(\"^\"+P),PSEUDO:new RegExp(\"^\"+H),POS:new RegExp(B,\"i\"),CHILD:new RegExp(\"^:(only|nth|first|last)-child(?:\\\\(\"+O+\"*(even|odd|(([+-]|)(\\\\d*)n|)\"+O+\"*(?:([+-]|)\"+O+\"*(\\\\d+)|))\"+O+\"*\\\\)|)\",\"i\"),needsContext:new RegExp(\"^\"+O+\"*[>+~]|\"+B,\"i\")},K=function(e){var t=g.createElement(\"div\");try{return e(t)}catch(n){return!1}finally{t=null}},Q=K(function(e){return e.appendChild(g.createComment(\"\")),!e.getElementsByTagName(\"*\").length}),G=K(function(e){return e.innerHTML=\"<a href='#'></a>\",e.firstChild&&typeof e.firstChild.getAttribute!==p&&e.firstChild.getAttribute(\"href\")===\"#\"}),Y=K(function(e){e.innerHTML=\"<select></select>\";var t=typeof e.lastChild.getAttribute(\"multiple\");return t!==\"boolean\"&&t!==\"string\"}),Z=K(function(e){return e.innerHTML=\"<div class='hidden e'></div><div class='hidden'></div>\",!e.getElementsByClassName||!e.getElementsByClassName(\"e\").length?!1:(e.lastChild.className=\"e\",e.getElementsByClassName(\"e\").length===2)}),et=K(function(e){e.id=d+0,e.innerHTML=\"<a name='\"+d+\"'></a><div name='\"+d+\"'></div>\",y.insertBefore(e,y.firstChild);var t=g.getElementsByName&&g.getElementsByName(d).length===2+g.getElementsByName(d+0).length;return r=!g.getElementById(d),y.removeChild(e),t});try{x.call(y.childNodes,0)[0].nodeType}catch(tt){x=function(e){var t,n=[];for(;t=this[e];e++)n.push(t);return n}}nt.matches=function(e,t){return nt(e,null,null,t)},nt.matchesSelector=function(e,t){return nt(t,null,null,[e]).length>0},s=nt.getText=function(e){var t,n=\"\",r=0,i=e.nodeType;if(i){if(i===1||i===9||i===11){if(typeof e.textContent==\"string\")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(i===3||i===4)return e.nodeValue}else for(;t=e[r];r++)n+=s(t);return n},o=nt.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!==\"HTML\":!1},u=nt.contains=y.contains?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!(r&&r.nodeType===1&&n.contains&&n.contains(r))}:y.compareDocumentPosition?function(e,t){return t&&!!(e.compareDocumentPosition(t)&16)}:function(e,t){while(t=t.parentNode)if(t===e)return!0;return!1},nt.attr=function(e,t){var n,r=o(e);return r||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):r||Y?e.getAttribute(t):(n=e.getAttributeNode(t),n?typeof e[t]==\"boolean\"?e[t]?t:null:n.specified?n.value:null:null)},i=nt.selectors={cacheLength:50,createPseudo:N,match:J,attrHandle:G?{}:{href:function(e){return e.getAttribute(\"href\",2)},type:function(e){return e.getAttribute(\"type\")}},find:{ID:r?function(e,t,n){if(typeof t.getElementById!==p&&!n){var r=t.getElementById(e);return r&&r.parentNode?[r]:[]}}:function(e,n,r){if(typeof n.getElementById!==p&&!r){var i=n.getElementById(e);return i?i.id===e||typeof i.getAttributeNode!==p&&i.getAttributeNode(\"id\").value===e?[i]:t:[]}},TAG:Q?function(e,t){if(typeof t.getElementsByTagName!==p)return t.getElementsByTagName(e)}:function(e,t){var n=t.getElementsByTagName(e);if(e===\"*\"){var r,i=[],s=0;for(;r=n[s];s++)r.nodeType===1&&i.push(r);return i}return n},NAME:et&&function(e,t){if(typeof t.getElementsByName!==p)return t.getElementsByName(name)},CLASS:Z&&function(e,t,n){if(typeof t.getElementsByClassName!==p&&!n)return t.getElementsByClassName(e)}},relative:{\">\":{dir:\"parentNode\",first:!0},\" \":{dir:\"parentNode\"},\"+\":{dir:\"previousSibling\",first:!0},\"~\":{dir:\"previousSibling\"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace($,\"\"),e[3]=(e[4]||e[5]||\"\").replace($,\"\"),e[2]===\"~=\"&&(e[3]=\" \"+e[3]+\" \"),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1]===\"nth\"?(e[2]||nt.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*(e[2]===\"even\"||e[2]===\"odd\")),e[4]=+(e[6]+e[7]||e[2]===\"odd\")):e[2]&&nt.error(e[0]),e},PSEUDO:function(e){var t,n;if(J.CHILD.test(e[0]))return null;if(e[3])e[2]=e[3];else if(t=e[4])q.test(t)&&(n=ut(t,!0))&&(n=t.indexOf(\")\",t.length-n)-t.length)&&(t=t.slice(0,n),e[0]=e[0].slice(0,n)),e[2]=t;return e.slice(0,3)}},filter:{ID:r?function(e){return e=e.replace($,\"\"),function(t){return t.getAttribute(\"id\")===e}}:function(e){return e=e.replace($,\"\"),function(t){var n=typeof t.getAttributeNode!==p&&t.getAttributeNode(\"id\");return n&&n.value===e}},TAG:function(e){return e===\"*\"?function(){return!0}:(e=e.replace($,\"\").toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=k[d][e+\" \"];return t||(t=new RegExp(\"(^|\"+O+\")\"+e+\"(\"+O+\"|$)\"))&&k(e,function(e){return t.test(e.className||typeof e.getAttribute!==p&&e.getAttribute(\"class\")||\"\")})},ATTR:function(e,t,n){return function(r,i){var s=nt.attr(r,e);return s==null?t===\"!=\":t?(s+=\"\",t===\"=\"?s===n:t===\"!=\"?s!==n:t===\"^=\"?n&&s.indexOf(n)===0:t===\"*=\"?n&&s.indexOf(n)>-1:t===\"$=\"?n&&s.substr(s.length-n.length)===n:t===\"~=\"?(\" \"+s+\" \").indexOf(n)>-1:t===\"|=\"?s===n||s.substr(0,n.length+1)===n+\"-\":!1):!0}},CHILD:function(e,t,n,r){return e===\"nth\"?function(e){var t,i,s=e.parentNode;if(n===1&&r===0)return!0;if(s){i=0;for(t=s.firstChild;t;t=t.nextSibling)if(t.nodeType===1){i++;if(e===t)break}}return i-=r,i===n||i%n===0&&i/n>=0}:function(t){var n=t;switch(e){case\"only\":case\"first\":while(n=n.previousSibling)if(n.nodeType===1)return!1;if(e===\"first\")return!0;n=t;case\"last\":while(n=n.nextSibling)if(n.nodeType===1)return!1;return!0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||nt.error(\"unsupported pseudo: \"+e);return r[d]?r(t):r.length>1?(n=[e,e,\"\",t],i.setFilters.hasOwnProperty(e.toLowerCase())?N(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=T.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:N(function(e){var t=[],n=[],r=a(e.replace(j,\"$1\"));return r[d]?N(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:N(function(e){return function(t){return nt(e,t).length>0}}),contains:N(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t===\"input\"&&!!e.checked||t===\"option\"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!i.pseudos.empty(e)},empty:function(e){var t;e=e.firstChild;while(e){if(e.nodeName>\"@\"||(t=e.nodeType)===3||t===4)return!1;e=e.nextSibling}return!0},header:function(e){return X.test(e.nodeName)},text:function(e){var t,n;return e.nodeName.toLowerCase()===\"input\"&&(t=e.type)===\"text\"&&((n=e.getAttribute(\"type\"))==null||n.toLowerCase()===t)},radio:rt(\"radio\"),checkbox:rt(\"checkbox\"),file:rt(\"file\"),password:rt(\"password\"),image:rt(\"image\"),submit:it(\"submit\"),reset:it(\"reset\"),button:function(e){var t=e.nodeName.toLowerCase();return t===\"input\"&&e.type===\"button\"||t===\"button\"},input:function(e){return V.test(e.nodeName)},focus:function(e){var t=e.ownerDocument;return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},active:function(e){return e===e.ownerDocument.activeElement},first:st(function(){return[0]}),last:st(function(e,t){return[t-1]}),eq:st(function(e,t,n){return[n<0?n+t:n]}),even:st(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:st(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:st(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:st(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}},f=y.compareDocumentPosition?function(e,t){return e===t?(l=!0,0):(!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition:e.compareDocumentPosition(t)&4)?-1:1}:function(e,t){if(e===t)return l=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],s=[],o=e.parentNode,u=t.parentNode,a=o;if(o===u)return ot(e,t);if(!o)return-1;if(!u)return 1;while(a)i.unshift(a),a=a.parentNode;a=u;while(a)s.unshift(a),a=a.parentNode;n=i.length,r=s.length;for(var f=0;f<n&&f<r;f++)if(i[f]!==s[f])return ot(i[f],s[f]);return f===n?ot(e,s[f],-1):ot(i[f],t,1)},[0,0].sort(f),h=!l,nt.uniqueSort=function(e){var t,n=[],r=1,i=0;l=h,e.sort(f);if(l){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e},nt.error=function(e){throw new Error(\"Syntax error, unrecognized expression: \"+e)},a=nt.compile=function(e,t){var n,r=[],i=[],s=A[d][e+\" \"];if(!s){t||(t=ut(e)),n=t.length;while(n--)s=ht(t[n]),s[d]?r.push(s):i.push(s);s=A(e,pt(i,r))}return s},g.querySelectorAll&&function(){var e,t=vt,n=/'|\\\\/g,r=/\\=[\\x20\\t\\r\\n\\f]*([^'\"\\]]*)[\\x20\\t\\r\\n\\f]*\\]/g,i=[\":focus\"],s=[\":active\"],u=y.matchesSelector||y.mozMatchesSelector||y.webkitMatchesSelector||y.oMatchesSelector||y.msMatchesSelector;K(function(e){e.innerHTML=\"<select><option selected=''></option></select>\",e.querySelectorAll(\"[selected]\").length||i.push(\"\\\\[\"+O+\"*(?:checked|disabled|ismap|multiple|readonly|selected|value)\"),e.querySelectorAll(\":checked\").length||i.push(\":checked\")}),K(function(e){e.innerHTML=\"<p test=''></p>\",e.querySelectorAll(\"[test^='']\").length&&i.push(\"[*^$]=\"+O+\"*(?:\\\"\\\"|'')\"),e.innerHTML=\"<input type='hidden'/>\",e.querySelectorAll(\":enabled\").length||i.push(\":enabled\",\":disabled\")}),i=new RegExp(i.join(\"|\")),vt=function(e,r,s,o,u){if(!o&&!u&&!i.test(e)){var a,f,l=!0,c=d,h=r,p=r.nodeType===9&&e;if(r.nodeType===1&&r.nodeName.toLowerCase()!==\"object\"){a=ut(e),(l=r.getAttribute(\"id\"))?c=l.replace(n,\"\\\\$&\"):r.setAttribute(\"id\",c),c=\"[id='\"+c+\"'] \",f=a.length;while(f--)a[f]=c+a[f].join(\"\");h=z.test(e)&&r.parentNode||r,p=a.join(\",\")}if(p)try{return S.apply(s,x.call(h.querySelectorAll(p),0)),s}catch(v){}finally{l||r.removeAttribute(\"id\")}}return t(e,r,s,o,u)},u&&(K(function(t){e=u.call(t,\"div\");try{u.call(t,\"[test!='']:sizzle\"),s.push(\"!=\",H)}catch(n){}}),s=new RegExp(s.join(\"|\")),nt.matchesSelector=function(t,n){n=n.replace(r,\"='$1']\");if(!o(t)&&!s.test(n)&&!i.test(n))try{var a=u.call(t,n);if(a||e||t.document&&t.document.nodeType!==11)return a}catch(f){}return nt(n,null,null,[t]).length>0})}(),i.pseudos.nth=i.pseudos.eq,i.filters=mt.prototype=i.pseudos,i.setFilters=new mt,nt.attr=v.attr,v.find=nt,v.expr=nt.selectors,v.expr[\":\"]=v.expr.pseudos,v.unique=nt.uniqueSort,v.text=nt.getText,v.isXMLDoc=nt.isXML,v.contains=nt.contains}(e);var nt=/Until$/,rt=/^(?:parents|prev(?:Until|All))/,it=/^.[^:#\\[\\.,]*$/,st=v.expr.match.needsContext,ot={children:!0,contents:!0,next:!0,prev:!0};v.fn.extend({find:function(e){var t,n,r,i,s,o,u=this;if(typeof e!=\"string\")return v(e).filter(function(){for(t=0,n=u.length;t<n;t++)if(v.contains(u[t],this))return!0});o=this.pushStack(\"\",\"find\",e);for(t=0,n=this.length;t<n;t++){r=o.length,v.find(e,this[t],o);if(t>0)for(i=r;i<o.length;i++)for(s=0;s<r;s++)if(o[s]===o[i]){o.splice(i--,1);break}}return o},has:function(e){var t,n=v(e,this),r=n.length;return this.filter(function(){for(t=0;t<r;t++)if(v.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e,!1),\"not\",e)},filter:function(e){return this.pushStack(ft(this,e,!0),\"filter\",e)},is:function(e){return!!e&&(typeof e==\"string\"?st.test(e)?v(e,this.context).index(this[0])>=0:v.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,s=[],o=st.test(e)||typeof e!=\"string\"?v(e,t||this.context):0;for(;r<i;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&n.nodeType!==11){if(o?o.index(n)>-1:v.find.matchesSelector(n,e)){s.push(n);break}n=n.parentNode}}return s=s.length>1?v.unique(s):s,this.pushStack(s,\"closest\",e)},index:function(e){return e?typeof e==\"string\"?v.inArray(this[0],v(e)):v.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n=typeof e==\"string\"?v(e,t):v.makeArray(e&&e.nodeType?[e]:e),r=v.merge(this.get(),n);return this.pushStack(ut(n[0])||ut(r[0])?r:v.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),v.fn.andSelf=v.fn.addBack,v.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return v.dir(e,\"parentNode\")},parentsUntil:function(e,t,n){return v.dir(e,\"parentNode\",n)},next:function(e){return at(e,\"nextSibling\")},prev:function(e){return at(e,\"previousSibling\")},nextAll:function(e){return v.dir(e,\"nextSibling\")},prevAll:function(e){return v.dir(e,\"previousSibling\")},nextUntil:function(e,t,n){return v.dir(e,\"nextSibling\",n)},prevUntil:function(e,t,n){return v.dir(e,\"previousSibling\",n)},siblings:function(e){return v.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return v.sibling(e.firstChild)},contents:function(e){return v.nodeName(e,\"iframe\")?e.contentDocument||e.contentWindow.document:v.merge([],e.childNodes)}},function(e,t){v.fn[e]=function(n,r){var i=v.map(this,t,n);return nt.test(e)||(r=n),r&&typeof r==\"string\"&&(i=v.filter(r,i)),i=this.length>1&&!ot[e]?v.unique(i):i,this.length>1&&rt.test(e)&&(i=i.reverse()),this.pushStack(i,e,l.call(arguments).join(\",\"))}}),v.extend({filter:function(e,t,n){return n&&(e=\":not(\"+e+\")\"),t.length===1?v.find.matchesSelector(t[0],e)?[t[0]]:[]:v.find.matches(e,t)},dir:function(e,n,r){var i=[],s=e[n];while(s&&s.nodeType!==9&&(r===t||s.nodeType!==1||!v(s).is(r)))s.nodeType===1&&i.push(s),s=s[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var ct=\"abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video\",ht=/ jQuery\\d+=\"(?:null|\\d+)\"/g,pt=/^\\s+/,dt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>/gi,vt=/<([\\w:]+)/,mt=/<tbody/i,gt=/<|&#?\\w+;/,yt=/<(?:script|style|link)/i,bt=/<(?:script|object|embed|option|style)/i,wt=new RegExp(\"<(?:\"+ct+\")[\\\\s/>]\",\"i\"),Et=/^(?:checkbox|radio)$/,St=/checked\\s*(?:[^=]|=\\s*.checked.)/i,xt=/\\/(java|ecma)script/i,Tt=/^\\s*<!(?:\\[CDATA\\[|\\-\\-)|[\\]\\-]{2}>\\s*$/g,Nt={option:[1,\"<select multiple='multiple'>\",\"</select>\"],legend:[1,\"<fieldset>\",\"</fieldset>\"],thead:[1,\"<table>\",\"</table>\"],tr:[2,\"<table><tbody>\",\"</tbody></table>\"],td:[3,\"<table><tbody><tr>\",\"</tr></tbody></table>\"],col:[2,\"<table><tbody></tbody><colgroup>\",\"</colgroup></table>\"],area:[1,\"<map>\",\"</map>\"],_default:[0,\"\",\"\"]},Ct=lt(i),kt=Ct.appendChild(i.createElement(\"div\"));Nt.optgroup=Nt.option,Nt.tbody=Nt.tfoot=Nt.colgroup=Nt.caption=Nt.thead,Nt.th=Nt.td,v.support.htmlSerialize||(Nt._default=[1,\"X<div>\",\"</div>\"]),v.fn.extend({text:function(e){return v.access(this,function(e){return e===t?v.text(this):this.empty().append((this[0]&&this[0].ownerDocument||i).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(v.isFunction(e))return this.each(function(t){v(this).wrapAll(e.call(this,t))});if(this[0]){var t=v(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return v.isFunction(e)?this.each(function(t){v(this).wrapInner(e.call(this,t))}):this.each(function(){var t=v(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=v.isFunction(e);return this.each(function(n){v(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){v.nodeName(this,\"body\")||v(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(e,this.firstChild)})},before:function(){if(!ut(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=v.clean(arguments);return this.pushStack(v.merge(e,this),\"before\",this.selector)}},after:function(){if(!ut(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=v.clean(arguments);return this.pushStack(v.merge(this,e),\"after\",this.selector)}},remove:function(e,t){var n,r=0;for(;(n=this[r])!=null;r++)if(!e||v.filter(e,[n]).length)!t&&n.nodeType===1&&(v.cleanData(n.getElementsByTagName(\"*\")),v.cleanData([n])),n.parentNode&&n.parentNode.removeChild(n);return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){e.nodeType===1&&v.cleanData(e.getElementsByTagName(\"*\"));while(e.firstChild)e.removeChild(e.firstChild)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return v.clone(this,e,t)})},html:function(e){return v.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return n.nodeType===1?n.innerHTML.replace(ht,\"\"):t;if(typeof e==\"string\"&&!yt.test(e)&&(v.support.htmlSerialize||!wt.test(e))&&(v.support.leadingWhitespace||!pt.test(e))&&!Nt[(vt.exec(e)||[\"\",\"\"])[1].toLowerCase()]){e=e.replace(dt,\"<$1></$2>\");try{for(;r<i;r++)n=this[r]||{},n.nodeType===1&&(v.cleanData(n.getElementsByTagName(\"*\")),n.innerHTML=e);n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){return ut(this[0])?this.length?this.pushStack(v(v.isFunction(e)?e():e),\"replaceWith\",e):this:v.isFunction(e)?this.each(function(t){var n=v(this),r=n.html();n.replaceWith(e.call(this,t,r))}):(typeof e!=\"string\"&&(e=v(e).detach()),this.each(function(){var t=this.nextSibling,n=this.parentNode;v(this).remove(),t?v(t).before(e):v(n).append(e)}))},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=[].concat.apply([],e);var i,s,o,u,a=0,f=e[0],l=[],c=this.length;if(!v.support.checkClone&&c>1&&typeof f==\"string\"&&St.test(f))return this.each(function(){v(this).domManip(e,n,r)});if(v.isFunction(f))return this.each(function(i){var s=v(this);e[0]=f.call(this,i,n?s.html():t),s.domManip(e,n,r)});if(this[0]){i=v.buildFragment(e,this,l),o=i.fragment,s=o.firstChild,o.childNodes.length===1&&(o=s);if(s){n=n&&v.nodeName(s,\"tr\");for(u=i.cacheable||c-1;a<c;a++)r.call(n&&v.nodeName(this[a],\"table\")?Lt(this[a],\"tbody\"):this[a],a===u?o:v.clone(o,!0,!0))}o=s=null,l.length&&v.each(l,function(e,t){t.src?v.ajax?v.ajax({url:t.src,type:\"GET\",dataType:\"script\",async:!1,global:!1,\"throws\":!0}):v.error(\"no ajax\"):v.globalEval((t.text||t.textContent||t.innerHTML||\"\").replace(Tt,\"\")),t.parentNode&&t.parentNode.removeChild(t)})}return this}}),v.buildFragment=function(e,n,r){var s,o,u,a=e[0];return n=n||i,n=!n.nodeType&&n[0]||n,n=n.ownerDocument||n,e.length===1&&typeof a==\"string\"&&a.length<512&&n===i&&a.charAt(0)===\"<\"&&!bt.test(a)&&(v.support.checkClone||!St.test(a))&&(v.support.html5Clone||!wt.test(a))&&(o=!0,s=v.fragments[a],u=s!==t),s||(s=n.createDocumentFragment(),v.clean(e,n,s,r),o&&(v.fragments[a]=u&&s)),{fragment:s,cacheable:o}},v.fragments={},v.each({appendTo:\"append\",prependTo:\"prepend\",insertBefore:\"before\",insertAfter:\"after\",replaceAll:\"replaceWith\"},function(e,t){v.fn[e]=function(n){var r,i=0,s=[],o=v(n),u=o.length,a=this.length===1&&this[0].parentNode;if((a==null||a&&a.nodeType===11&&a.childNodes.length===1)&&u===1)return o[t](this[0]),this;for(;i<u;i++)r=(i>0?this.clone(!0):this).get(),v(o[i])[t](r),s=s.concat(r);return this.pushStack(s,e,o.selector)}}),v.extend({clone:function(e,t,n){var r,i,s,o;v.support.html5Clone||v.isXMLDoc(e)||!wt.test(\"<\"+e.nodeName+\">\")?o=e.cloneNode(!0):(kt.innerHTML=e.outerHTML,kt.removeChild(o=kt.firstChild));if((!v.support.noCloneEvent||!v.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!v.isXMLDoc(e)){Ot(e,o),r=Mt(e),i=Mt(o);for(s=0;r[s];++s)i[s]&&Ot(r[s],i[s])}if(t){At(e,o);if(n){r=Mt(e),i=Mt(o);for(s=0;r[s];++s)At(r[s],i[s])}}return r=i=null,o},clean:function(e,t,n,r){var s,o,u,a,f,l,c,h,p,d,m,g,y=t===i&&Ct,b=[];if(!t||typeof t.createDocumentFragment==\"undefined\")t=i;for(s=0;(u=e[s])!=null;s++){typeof u==\"number\"&&(u+=\"\");if(!u)continue;if(typeof u==\"string\")if(!gt.test(u))u=t.createTextNode(u);else{y=y||lt(t),c=t.createElement(\"div\"),y.appendChild(c),u=u.replace(dt,\"<$1></$2>\"),a=(vt.exec(u)||[\"\",\"\"])[1].toLowerCase(),f=Nt[a]||Nt._default,l=f[0],c.innerHTML=f[1]+u+f[2];while(l--)c=c.lastChild;if(!v.support.tbody){h=mt.test(u),p=a===\"table\"&&!h?c.firstChild&&c.firstChild.childNodes:f[1]===\"<table>\"&&!h?c.childNodes:[];for(o=p.length-1;o>=0;--o)v.nodeName(p[o],\"tbody\")&&!p[o].childNodes.length&&p[o].parentNode.removeChild(p[o])}!v.support.leadingWhitespace&&pt.test(u)&&c.insertBefore(t.createTextNode(pt.exec(u)[0]),c.firstChild),u=c.childNodes,c.parentNode.removeChild(c)}u.nodeType?b.push(u):v.merge(b,u)}c&&(u=c=y=null);if(!v.support.appendChecked)for(s=0;(u=b[s])!=null;s++)v.nodeName(u,\"input\")?_t(u):typeof u.getElementsByTagName!=\"undefined\"&&v.grep(u.getElementsByTagName(\"input\"),_t);if(n){m=function(e){if(!e.type||xt.test(e.type))return r?r.push(e.parentNode?e.parentNode.removeChild(e):e):n.appendChild(e)};for(s=0;(u=b[s])!=null;s++)if(!v.nodeName(u,\"script\")||!m(u))n.appendChild(u),typeof u.getElementsByTagName!=\"undefined\"&&(g=v.grep(v.merge([],u.getElementsByTagName(\"script\")),m),b.splice.apply(b,[s+1,0].concat(g)),s+=g.length)}return b},cleanData:function(e,t){var n,r,i,s,o=0,u=v.expando,a=v.cache,f=v.support.deleteExpando,l=v.event.special;for(;(i=e[o])!=null;o++)if(t||v.acceptData(i)){r=i[u],n=r&&a[r];if(n){if(n.events)for(s in n.events)l[s]?v.event.remove(i,s):v.removeEvent(i,s,n.handle);a[r]&&(delete a[r],f?delete i[u]:i.removeAttribute?i.removeAttribute(u):i[u]=null,v.deletedIds.push(r))}}}}),function(){var e,t;v.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \\/]([\\w.]+)/.exec(e)||/(webkit)[ \\/]([\\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \\/]([\\w.]+)/.exec(e)||/(msie) ([\\w.]+)/.exec(e)||e.indexOf(\"compatible\")<0&&/(mozilla)(?:.*? rv:([\\w.]+)|)/.exec(e)||[];return{browser:t[1]||\"\",version:t[2]||\"0\"}},e=v.uaMatch(o.userAgent),t={},e.browser&&(t[e.browser]=!0,t.version=e.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),v.browser=t,v.sub=function(){function e(t,n){return new e.fn.init(t,n)}v.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(r,i){return i&&i instanceof v&&!(i instanceof e)&&(i=e(i)),v.fn.init.call(this,r,i,t)},e.fn.init.prototype=e.fn;var t=e(i);return e}}();var Dt,Pt,Ht,Bt=/alpha\\([^)]*\\)/i,jt=/opacity=([^)]*)/,Ft=/^(top|right|bottom|left)$/,It=/^(none|table(?!-c[ea]).+)/,qt=/^margin/,Rt=new RegExp(\"^(\"+m+\")(.*)$\",\"i\"),Ut=new RegExp(\"^(\"+m+\")(?!px)[a-z%]+$\",\"i\"),zt=new RegExp(\"^([-+])=(\"+m+\")\",\"i\"),Wt={BODY:\"block\"},Xt={position:\"absolute\",visibility:\"hidden\",display:\"block\"},Vt={letterSpacing:0,fontWeight:400},$t=[\"Top\",\"Right\",\"Bottom\",\"Left\"],Jt=[\"Webkit\",\"O\",\"Moz\",\"ms\"],Kt=v.fn.toggle;v.fn.extend({css:function(e,n){return v.access(this,function(e,n,r){return r!==t?v.style(e,n,r):v.css(e,n)},e,n,arguments.length>1)},show:function(){return Yt(this,!0)},hide:function(){return Yt(this)},toggle:function(e,t){var n=typeof e==\"boolean\";return v.isFunction(e)&&v.isFunction(t)?Kt.apply(this,arguments):this.each(function(){(n?e:Gt(this))?v(this).show():v(this).hide()})}}),v.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Dt(e,\"opacity\");return n===\"\"?\"1\":n}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{\"float\":v.support.cssFloat?\"cssFloat\":\"styleFloat\"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var s,o,u,a=v.camelCase(n),f=e.style;n=v.cssProps[a]||(v.cssProps[a]=Qt(f,a)),u=v.cssHooks[n]||v.cssHooks[a];if(r===t)return u&&\"get\"in u&&(s=u.get(e,!1,i))!==t?s:f[n];o=typeof r,o===\"string\"&&(s=zt.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(v.css(e,n)),o=\"number\");if(r==null||o===\"number\"&&isNaN(r))return;o===\"number\"&&!v.cssNumber[a]&&(r+=\"px\");if(!u||!(\"set\"in u)||(r=u.set(e,r,i))!==t)try{f[n]=r}catch(l){}},css:function(e,n,r,i){var s,o,u,a=v.camelCase(n);return n=v.cssProps[a]||(v.cssProps[a]=Qt(e.style,a)),u=v.cssHooks[n]||v.cssHooks[a],u&&\"get\"in u&&(s=u.get(e,!0,i)),s===t&&(s=Dt(e,n)),s===\"normal\"&&n in Vt&&(s=Vt[n]),r||i!==t?(o=parseFloat(s),r||v.isNumeric(o)?o||0:s):s},swap:function(e,t,n){var r,i,s={};for(i in t)s[i]=e.style[i],e.style[i]=t[i];r=n.call(e);for(i in t)e.style[i]=s[i];return r}}),e.getComputedStyle?Dt=function(t,n){var r,i,s,o,u=e.getComputedStyle(t,null),a=t.style;return u&&(r=u.getPropertyValue(n)||u[n],r===\"\"&&!v.contains(t.ownerDocument,t)&&(r=v.style(t,n)),Ut.test(r)&&qt.test(n)&&(i=a.width,s=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=r,r=u.width,a.width=i,a.minWidth=s,a.maxWidth=o)),r}:i.documentElement.currentStyle&&(Dt=function(e,t){var n,r,i=e.currentStyle&&e.currentStyle[t],s=e.style;return i==null&&s&&s[t]&&(i=s[t]),Ut.test(i)&&!Ft.test(t)&&(n=s.left,r=e.runtimeStyle&&e.runtimeStyle.left,r&&(e.runtimeStyle.left=e.currentStyle.left),s.left=t===\"fontSize\"?\"1em\":i,i=s.pixelLeft+\"px\",s.left=n,r&&(e.runtimeStyle.left=r)),i===\"\"?\"auto\":i}),v.each([\"height\",\"width\"],function(e,t){v.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&It.test(Dt(e,\"display\"))?v.swap(e,Xt,function(){return tn(e,t,r)}):tn(e,t,r)},set:function(e,n,r){return Zt(e,n,r?en(e,t,r,v.support.boxSizing&&v.css(e,\"boxSizing\")===\"border-box\"):0)}}}),v.support.opacity||(v.cssHooks.opacity={get:function(e,t){return jt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||\"\")?.01*parseFloat(RegExp.$1)+\"\":t?\"1\":\"\"},set:function(e,t){var n=e.style,r=e.currentStyle,i=v.isNumeric(t)?\"alpha(opacity=\"+t*100+\")\":\"\",s=r&&r.filter||n.filter||\"\";n.zoom=1;if(t>=1&&v.trim(s.replace(Bt,\"\"))===\"\"&&n.removeAttribute){n.removeAttribute(\"filter\");if(r&&!r.filter)return}n.filter=Bt.test(s)?s.replace(Bt,i):s+\" \"+i}}),v(function(){v.support.reliableMarginRight||(v.cssHooks.marginRight={get:function(e,t){return v.swap(e,{display:\"inline-block\"},function(){if(t)return Dt(e,\"marginRight\")})}}),!v.support.pixelPosition&&v.fn.position&&v.each([\"top\",\"left\"],function(e,t){v.cssHooks[t]={get:function(e,n){if(n){var r=Dt(e,t);return Ut.test(r)?v(e).position()[t]+\"px\":r}}}})}),v.expr&&v.expr.filters&&(v.expr.filters.hidden=function(e){return e.offsetWidth===0&&e.offsetHeight===0||!v.support.reliableHiddenOffsets&&(e.style&&e.style.display||Dt(e,\"display\"))===\"none\"},v.expr.filters.visible=function(e){return!v.expr.filters.hidden(e)}),v.each({margin:\"\",padding:\"\",border:\"Width\"},function(e,t){v.cssHooks[e+t]={expand:function(n){var r,i=typeof n==\"string\"?n.split(\" \"):[n],s={};for(r=0;r<4;r++)s[e+$t[r]+t]=i[r]||i[r-2]||i[0];return s}},qt.test(e)||(v.cssHooks[e+t].set=Zt)});var rn=/%20/g,sn=/\\[\\]$/,on=/\\r?\\n/g,un=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,an=/^(?:select|textarea)/i;v.fn.extend({serialize:function(){return v.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?v.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||an.test(this.nodeName)||un.test(this.type))}).map(function(e,t){var n=v(this).val();return n==null?null:v.isArray(n)?v.map(n,function(e,n){return{name:t.name,value:e.replace(on,\"\\r\\n\")}}):{name:t.name,value:n.replace(on,\"\\r\\n\")}}).get()}}),v.param=function(e,n){var r,i=[],s=function(e,t){t=v.isFunction(t)?t():t==null?\"\":t,i[i.length]=encodeURIComponent(e)+\"=\"+encodeURIComponent(t)};n===t&&(n=v.ajaxSettings&&v.ajaxSettings.traditional);if(v.isArray(e)||e.jquery&&!v.isPlainObject(e))v.each(e,function(){s(this.name,this.value)});else for(r in e)fn(r,e[r],n,s);return i.join(\"&\").replace(rn,\"+\")};var ln,cn,hn=/#.*$/,pn=/^(.*?):[ \\t]*([^\\r\\n]*)\\r?$/mg,dn=/^(?:about|app|app\\-storage|.+\\-extension|file|res|widget):$/,vn=/^(?:GET|HEAD)$/,mn=/^\\/\\//,gn=/\\?/,yn=/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi,bn=/([?&])_=[^&]*/,wn=/^([\\w\\+\\.\\-]+:)(?:\\/\\/([^\\/?#:]*)(?::(\\d+)|)|)/,En=v.fn.load,Sn={},xn={},Tn=[\"*/\"]+[\"*\"];try{cn=s.href}catch(Nn){cn=i.createElement(\"a\"),cn.href=\"\",cn=cn.href}ln=wn.exec(cn.toLowerCase())||[],v.fn.load=function(e,n,r){if(typeof e!=\"string\"&&En)return En.apply(this,arguments);if(!this.length)return this;var i,s,o,u=this,a=e.indexOf(\" \");return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),v.isFunction(n)?(r=n,n=t):n&&typeof n==\"object\"&&(s=\"POST\"),v.ajax({url:e,type:s,dataType:\"html\",data:n,complete:function(e,t){r&&u.each(r,o||[e.responseText,t,e])}}).done(function(e){o=arguments,u.html(i?v(\"<div>\").append(e.replace(yn,\"\")).find(i):e)}),this},v.each(\"ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend\".split(\" \"),function(e,t){v.fn[t]=function(e){return this.on(t,e)}}),v.each([\"get\",\"post\"],function(e,n){v[n]=function(e,r,i,s){return v.isFunction(r)&&(s=s||i,i=r,r=t),v.ajax({type:n,url:e,data:r,success:i,dataType:s})}}),v.extend({getScript:function(e,n){return v.get(e,t,n,\"script\")},getJSON:function(e,t,n){return v.get(e,t,n,\"json\")},ajaxSetup:function(e,t){return t?Ln(e,v.ajaxSettings):(t=e,e=v.ajaxSettings),Ln(e,t),e},ajaxSettings:{url:cn,isLocal:dn.test(ln[1]),global:!0,type:\"GET\",contentType:\"application/x-www-form-urlencoded; charset=UTF-8\",processData:!0,async:!0,accepts:{xml:\"application/xml, text/xml\",html:\"text/html\",text:\"text/plain\",json:\"application/json, text/javascript\",\"*\":Tn},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:\"responseXML\",text:\"responseText\"},converters:{\"* text\":e.String,\"text html\":!0,\"text json\":v.parseJSON,\"text xml\":v.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:Cn(Sn),ajaxTransport:Cn(xn),ajax:function(e,n){function T(e,n,s,a){var l,y,b,w,S,T=n;if(E===2)return;E=2,u&&clearTimeout(u),o=t,i=a||\"\",x.readyState=e>0?4:0,s&&(w=An(c,x,s));if(e>=200&&e<300||e===304)c.ifModified&&(S=x.getResponseHeader(\"Last-Modified\"),S&&(v.lastModified[r]=S),S=x.getResponseHeader(\"Etag\"),S&&(v.etag[r]=S)),e===304?(T=\"notmodified\",l=!0):(l=On(c,w),T=l.state,y=l.data,b=l.error,l=!b);else{b=T;if(!T||e)T=\"error\",e<0&&(e=0)}x.status=e,x.statusText=(n||T)+\"\",l?d.resolveWith(h,[y,T,x]):d.rejectWith(h,[x,T,b]),x.statusCode(g),g=t,f&&p.trigger(\"ajax\"+(l?\"Success\":\"Error\"),[x,c,l?y:b]),m.fireWith(h,[x,T]),f&&(p.trigger(\"ajaxComplete\",[x,c]),--v.active||v.event.trigger(\"ajaxStop\"))}typeof e==\"object\"&&(n=e,e=t),n=n||{};var r,i,s,o,u,a,f,l,c=v.ajaxSetup({},n),h=c.context||c,p=h!==c&&(h.nodeType||h instanceof v)?v(h):v.event,d=v.Deferred(),m=v.Callbacks(\"once memory\"),g=c.statusCode||{},b={},w={},E=0,S=\"canceled\",x={readyState:0,setRequestHeader:function(e,t){if(!E){var n=e.toLowerCase();e=w[n]=w[n]||e,b[e]=t}return this},getAllResponseHeaders:function(){return E===2?i:null},getResponseHeader:function(e){var n;if(E===2){if(!s){s={};while(n=pn.exec(i))s[n[1].toLowerCase()]=n[2]}n=s[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){return E||(c.mimeType=e),this},abort:function(e){return e=e||S,o&&o.abort(e),T(0,e),this}};d.promise(x),x.success=x.done,x.error=x.fail,x.complete=m.add,x.statusCode=function(e){if(e){var t;if(E<2)for(t in e)g[t]=[g[t],e[t]];else t=e[x.status],x.always(t)}return this},c.url=((e||c.url)+\"\").replace(hn,\"\").replace(mn,ln[1]+\"//\"),c.dataTypes=v.trim(c.dataType||\"*\").toLowerCase().split(y),c.crossDomain==null&&(a=wn.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===ln[1]&&a[2]===ln[2]&&(a[3]||(a[1]===\"http:\"?80:443))==(ln[3]||(ln[1]===\"http:\"?80:443)))),c.data&&c.processData&&typeof c.data!=\"string\"&&(c.data=v.param(c.data,c.traditional)),kn(Sn,c,n,x);if(E===2)return x;f=c.global,c.type=c.type.toUpperCase(),c.hasContent=!vn.test(c.type),f&&v.active++===0&&v.event.trigger(\"ajaxStart\");if(!c.hasContent){c.data&&(c.url+=(gn.test(c.url)?\"&\":\"?\")+c.data,delete c.data),r=c.url;if(c.cache===!1){var N=v.now(),C=c.url.replace(bn,\"$1_=\"+N);c.url=C+(C===c.url?(gn.test(c.url)?\"&\":\"?\")+\"_=\"+N:\"\")}}(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader(\"Content-Type\",c.contentType),c.ifModified&&(r=r||c.url,v.lastModified[r]&&x.setRequestHeader(\"If-Modified-Since\",v.lastModified[r]),v.etag[r]&&x.setRequestHeader(\"If-None-Match\",v.etag[r])),x.setRequestHeader(\"Accept\",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+(c.dataTypes[0]!==\"*\"?\", \"+Tn+\"; q=0.01\":\"\"):c.accepts[\"*\"]);for(l in c.headers)x.setRequestHeader(l,c.headers[l]);if(!c.beforeSend||c.beforeSend.call(h,x,c)!==!1&&E!==2){S=\"abort\";for(l in{success:1,error:1,complete:1})x[l](c[l]);o=kn(xn,c,n,x);if(!o)T(-1,\"No Transport\");else{x.readyState=1,f&&p.trigger(\"ajaxSend\",[x,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){x.abort(\"timeout\")},c.timeout));try{E=1,o.send(b,T)}catch(k){if(!(E<2))throw k;T(-1,k)}}return x}return x.abort()},active:0,lastModified:{},etag:{}});var Mn=[],_n=/\\?/,Dn=/(=)\\?(?=&|$)|\\?\\?/,Pn=v.now();v.ajaxSetup({jsonp:\"callback\",jsonpCallback:function(){var e=Mn.pop()||v.expando+\"_\"+Pn++;return this[e]=!0,e}}),v.ajaxPrefilter(\"json jsonp\",function(n,r,i){var s,o,u,a=n.data,f=n.url,l=n.jsonp!==!1,c=l&&Dn.test(f),h=l&&!c&&typeof a==\"string\"&&!(n.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&Dn.test(a);if(n.dataTypes[0]===\"jsonp\"||c||h)return s=n.jsonpCallback=v.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,o=e[s],c?n.url=f.replace(Dn,\"$1\"+s):h?n.data=a.replace(Dn,\"$1\"+s):l&&(n.url+=(_n.test(f)?\"&\":\"?\")+n.jsonp+\"=\"+s),n.converters[\"script json\"]=function(){return u||v.error(s+\" was not called\"),u[0]},n.dataTypes[0]=\"json\",e[s]=function(){u=arguments},i.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,Mn.push(s)),u&&v.isFunction(o)&&o(u[0]),u=o=t}),\"script\"}),v.ajaxSetup({accepts:{script:\"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript\"},contents:{script:/javascript|ecmascript/},converters:{\"text script\":function(e){return v.globalEval(e),e}}}),v.ajaxPrefilter(\"script\",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type=\"GET\",e.global=!1)}),v.ajaxTransport(\"script\",function(e){if(e.crossDomain){var n,r=i.head||i.getElementsByTagName(\"head\")[0]||i.documentElement;return{send:function(s,o){n=i.createElement(\"script\"),n.async=\"async\",e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,i){if(i||!n.readyState||/loaded|complete/.test(n.readyState))n.onload=n.onreadystatechange=null,r&&n.parentNode&&r.removeChild(n),n=t,i||o(200,\"success\")},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(0,1)}}}});var Hn,Bn=e.ActiveXObject?function(){for(var e in Hn)Hn[e](0,1)}:!1,jn=0;v.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&Fn()||In()}:Fn,function(e){v.extend(v.support,{ajax:!!e,cors:!!e&&\"withCredentials\"in e})}(v.ajaxSettings.xhr()),v.support.ajax&&v.ajaxTransport(function(n){if(!n.crossDomain||v.support.cors){var r;return{send:function(i,s){var o,u,a=n.xhr();n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async);if(n.xhrFields)for(u in n.xhrFields)a[u]=n.xhrFields[u];n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),!n.crossDomain&&!i[\"X-Requested-With\"]&&(i[\"X-Requested-With\"]=\"XMLHttpRequest\");try{for(u in i)a.setRequestHeader(u,i[u])}catch(f){}a.send(n.hasContent&&n.data||null),r=function(e,i){var u,f,l,c,h;try{if(r&&(i||a.readyState===4)){r=t,o&&(a.onreadystatechange=v.noop,Bn&&delete Hn[o]);if(i)a.readyState!==4&&a.abort();else{u=a.status,l=a.getAllResponseHeaders(),c={},h=a.responseXML,h&&h.documentElement&&(c.xml=h);try{c.text=a.responseText}catch(p){}try{f=a.statusText}catch(p){f=\"\"}!u&&n.isLocal&&!n.crossDomain?u=c.text?200:404:u===1223&&(u=204)}}}catch(d){i||s(-1,d)}c&&s(u,f,c,l)},n.async?a.readyState===4?setTimeout(r,0):(o=++jn,Bn&&(Hn||(Hn={},v(e).unload(Bn)),Hn[o]=r),a.onreadystatechange=r):r()},abort:function(){r&&r(0,1)}}}});var qn,Rn,Un=/^(?:toggle|show|hide)$/,zn=new RegExp(\"^(?:([-+])=|)(\"+m+\")([a-z%]*)$\",\"i\"),Wn=/queueHooks$/,Xn=[Gn],Vn={\"*\":[function(e,t){var n,r,i=this.createTween(e,t),s=zn.exec(t),o=i.cur(),u=+o||0,a=1,f=20;if(s){n=+s[2],r=s[3]||(v.cssNumber[e]?\"\":\"px\");if(r!==\"px\"&&u){u=v.css(i.elem,e,!0)||n||1;do a=a||\".5\",u/=a,v.style(i.elem,e,u+r);while(a!==(a=i.cur()/o)&&a!==1&&--f)}i.unit=r,i.start=u,i.end=s[1]?u+(s[1]+1)*n:n}return i}]};v.Animation=v.extend(Kn,{tweener:function(e,t){v.isFunction(e)?(t=e,e=[\"*\"]):e=e.split(\" \");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],Vn[n]=Vn[n]||[],Vn[n].unshift(t)},prefilter:function(e,t){t?Xn.unshift(e):Xn.push(e)}}),v.Tween=Yn,Yn.prototype={constructor:Yn,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||\"swing\",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(v.cssNumber[n]?\"\":\"px\")},cur:function(){var e=Yn.propHooks[this.prop];return e&&e.get?e.get(this):Yn.propHooks._default.get(this)},run:function(e){var t,n=Yn.propHooks[this.prop];return this.options.duration?this.pos=t=v.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Yn.propHooks._default.set(this),this}},Yn.prototype.init.prototype=Yn.prototype,Yn.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=v.css(e.elem,e.prop,!1,\"\"),!t||t===\"auto\"?0:t):e.elem[e.prop]},set:function(e){v.fx.step[e.prop]?v.fx.step[e.prop](e):e.elem.style&&(e.elem.style[v.cssProps[e.prop]]!=null||v.cssHooks[e.prop])?v.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Yn.propHooks.scrollTop=Yn.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},v.each([\"toggle\",\"show\",\"hide\"],function(e,t){var n=v.fn[t];v.fn[t]=function(r,i,s){return r==null||typeof r==\"boolean\"||!e&&v.isFunction(r)&&v.isFunction(i)?n.apply(this,arguments):this.animate(Zn(t,!0),r,i,s)}}),v.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Gt).css(\"opacity\",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=v.isEmptyObject(e),s=v.speed(t,n,r),o=function(){var t=Kn(this,v.extend({},e),s);i&&t.stop(!0)};return i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return typeof e!=\"string\"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||\"fx\",[]),this.each(function(){var t=!0,n=e!=null&&e+\"queueHooks\",s=v.timers,o=v._data(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&Wn.test(n)&&i(o[n]);for(n=s.length;n--;)s[n].elem===this&&(e==null||s[n].queue===e)&&(s[n].anim.stop(r),t=!1,s.splice(n,1));(t||!r)&&v.dequeue(this,e)})}}),v.each({slideDown:Zn(\"show\"),slideUp:Zn(\"hide\"),slideToggle:Zn(\"toggle\"),fadeIn:{opacity:\"show\"},fadeOut:{opacity:\"hide\"},fadeToggle:{opacity:\"toggle\"}},function(e,t){v.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),v.speed=function(e,t,n){var r=e&&typeof e==\"object\"?v.extend({},e):{complete:n||!n&&t||v.isFunction(e)&&e,duration:e,easing:n&&t||t&&!v.isFunction(t)&&t};r.duration=v.fx.off?0:typeof r.duration==\"number\"?r.duration:r.duration in v.fx.speeds?v.fx.speeds[r.duration]:v.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue=\"fx\";return r.old=r.complete,r.complete=function(){v.isFunction(r.old)&&r.old.call(this),r.queue&&v.dequeue(this,r.queue)},r},v.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},v.timers=[],v.fx=Yn.prototype.init,v.fx.tick=function(){var e,n=v.timers,r=0;qn=v.now();for(;r<n.length;r++)e=n[r],!e()&&n[r]===e&&n.splice(r--,1);n.length||v.fx.stop(),qn=t},v.fx.timer=function(e){e()&&v.timers.push(e)&&!Rn&&(Rn=setInterval(v.fx.tick,v.fx.interval))},v.fx.interval=13,v.fx.stop=function(){clearInterval(Rn),Rn=null},v.fx.speeds={slow:600,fast:200,_default:400},v.fx.step={},v.expr&&v.expr.filters&&(v.expr.filters.animated=function(e){return v.grep(v.timers,function(t){return e===t.elem}).length});var er=/^(?:body|html)$/i;v.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){v.offset.setOffset(this,e,t)});var n,r,i,s,o,u,a,f={top:0,left:0},l=this[0],c=l&&l.ownerDocument;if(!c)return;return(r=c.body)===l?v.offset.bodyOffset(l):(n=c.documentElement,v.contains(n,l)?(typeof l.getBoundingClientRect!=\"undefined\"&&(f=l.getBoundingClientRect()),i=tr(c),s=n.clientTop||r.clientTop||0,o=n.clientLeft||r.clientLeft||0,u=i.pageYOffset||n.scrollTop,a=i.pageXOffset||n.scrollLeft,{top:f.top+u-s,left:f.left+a-o}):f)},v.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;return v.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(v.css(e,\"marginTop\"))||0,n+=parseFloat(v.css(e,\"marginLeft\"))||0),{top:t,left:n}},setOffset:function(e,t,n){var r=v.css(e,\"position\");r===\"static\"&&(e.style.position=\"relative\");var i=v(e),s=i.offset(),o=v.css(e,\"top\"),u=v.css(e,\"left\"),a=(r===\"absolute\"||r===\"fixed\")&&v.inArray(\"auto\",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),v.isFunction(t)&&(t=t.call(e,n,s)),t.top!=null&&(f.top=t.top-s.top+c),t.left!=null&&(f.left=t.left-s.left+h),\"using\"in t?t.using.call(e,f):i.css(f)}},v.fn.extend({position:function(){if(!this[0])return;var e=this[0],t=this.offsetParent(),n=this.offset(),r=er.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(v.css(e,\"marginTop\"))||0,n.left-=parseFloat(v.css(e,\"marginLeft\"))||0,r.top+=parseFloat(v.css(t[0],\"borderTopWidth\"))||0,r.left+=parseFloat(v.css(t[0],\"borderLeftWidth\"))||0,{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||i.body;while(e&&!er.test(e.nodeName)&&v.css(e,\"position\")===\"static\")e=e.offsetParent;return e||i.body})}}),v.each({scrollLeft:\"pageXOffset\",scrollTop:\"pageYOffset\"},function(e,n){var r=/Y/.test(n);v.fn[e]=function(i){return v.access(this,function(e,i,s){var o=tr(e);if(s===t)return o?n in o?o[n]:o.document.documentElement[i]:e[i];o?o.scrollTo(r?v(o).scrollLeft():s,r?s:v(o).scrollTop()):e[i]=s},e,i,arguments.length,null)}}),v.each({Height:\"height\",Width:\"width\"},function(e,n){v.each({padding:\"inner\"+e,content:n,\"\":\"outer\"+e},function(r,i){v.fn[i]=function(i,s){var o=arguments.length&&(r||typeof i!=\"boolean\"),u=r||(i===!0||s===!0?\"margin\":\"border\");return v.access(this,function(n,r,i){var s;return v.isWindow(n)?n.document.documentElement[\"client\"+e]:n.nodeType===9?(s=n.documentElement,Math.max(n.body[\"scroll\"+e],s[\"scroll\"+e],n.body[\"offset\"+e],s[\"offset\"+e],s[\"client\"+e])):i===t?v.css(n,r,i,u):v.style(n,r,i,u)},n,o?i:t,o,null)}})}),e.jQuery=e.$=v,typeof define==\"function\"&&define.amd&&define.amd.jQuery&&define(\"jquery\",[],function(){return v})})(window);\r\n//]]>\r\n</script>\r\n<script id=\"jqueryArea\" type=\"text/javascript\">\r\n//<![CDATA[\r\n/*\r\njQuery.encoding.digests.sha1.js\r\n\r\nSHA-1 digest and associated utility functions\r\n\r\nCopyright (c) UnaMesa Association 2009\r\n\r\nDual licensed under the MIT and GPL licenses:\r\n  http://www.opensource.org/licenses/mit-license.php\r\n  http://www.gnu.org/licenses/gpl.html\r\n*/\r\n\r\n(function($) {\r\n\r\nif(!$.encoding)\r\n\t$.encoding = {};\r\n\t$.extend($.encoding,{\r\n\t\tstrToBe32s: function(str) {\r\n\t\t\t// Convert a string to an array of big-endian 32-bit words\r\n\t\t\tvar be=[];\r\n\t\t\tvar len=Math.floor(str.length/4);\r\n\t\t\tvar i, j;\r\n\t\t\tfor(i=0, j=0; i<len; i++, j+=4) {\r\n\t\t\t\tbe[i]=((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);\r\n\t\t\t}\r\n\t\t\twhile(j<str.length) {\r\n\t\t\t\tbe[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);\r\n\t\t\t\tj++;\r\n\t\t\t}\r\n\t\t\treturn be;\r\n\t\t},\r\n\t\tbe32sToStr: function(be) {\r\n\t\t\t// Convert an array of big-endian 32-bit words to a string\r\n\t\t\tvar str='';\r\n\t\t\tfor(var i=0;i<be.length*32;i+=8) {\r\n\t\t\t\tstr += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);\r\n\t\t\t}\r\n\t\t\treturn str;\r\n\t\t},\r\n\t\tbe32sToHex: function(be) {\r\n\t\t\t// Convert an array of big-endian 32-bit words to a hex string\r\n\t\t\tvar hex='0123456789ABCDEF';\r\n\t\t\tvar str='';\r\n\t\t\tfor(var i=0;i<be.length*4;i++) {\r\n\t\t\t\tstr += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);\r\n\t\t\t}\r\n\t\t\treturn str;\r\n\t\t}\r\n\t});\r\n})(jQuery);\r\n\r\n\r\n(function($) {\r\n\r\nif(!$.encoding.digests)\r\n\t$.encoding.digests = {};\r\n\t$.extend($.encoding.digests,{\r\n\t\thexSha1Str: function(str) {\r\n\t\t\t// Return, in hex, the SHA-1 hash of a string\r\n\t\t\treturn $.encoding.be32sToHex($.encoding.digests.sha1Str(str));\r\n\t\t},\r\n\t\tsha1Str: function(str) {\r\n\t\t\t// Return the SHA-1 hash of a string\r\n\t\t\treturn sha1($.encoding.strToBe32s(str),str.length);\r\n\t\t},\r\n\t\tsha1: function(x,blen) {\r\n\t\t\t// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words\r\n\t\t\treturn sha1($.encoding.strToBe32s(str),str.length);\r\n\t\t}\r\n\t});\r\n\r\n\t// Private functions.\r\n\tfunction sha1(x,blen) {\r\n\t\t// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words\r\n\t\tfunction add32(a,b) {\r\n\t\t\t// Add 32-bit integers, wrapping at 32 bits\r\n\t\t\t// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.\r\n\t\t\tvar lsw=(a&0xFFFF)+(b&0xFFFF);\r\n\t\t\tvar msw=(a>>16)+(b>>16)+(lsw>>16);\r\n\t\t\treturn (msw<<16)|(lsw&0xFFFF);\r\n\t\t}\r\n\t\tfunction AA(a,b,c,d,e) {\r\n\t\t\t// Cryptographic round helper function. Add five 32-bit integers, wrapping at 32 bits, second parameter is rotated left 5 bits before the addition\r\n\t\t\t// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.\r\n\t\t\tb=(b>>>27)|(b<<5);\r\n\t\t\tvar lsw=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);\r\n\t\t\tvar msw=(a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);\r\n\t\t\treturn (msw<<16)|(lsw&0xFFFF);\r\n\t\t}\r\n\t\tfunction RR(w,j) {\r\n\t\t\t// Cryptographic round helper function.\r\n\t\t\tvar n=w[j-3]^w[j-8]^w[j-14]^w[j-16];\r\n\t\t\treturn (n>>>31)|(n<<1);\r\n\t\t}\r\n\r\n\t\tvar len=blen*8;\r\n\t\tx[len>>5] |= 0x80 << (24-len%32);\r\n\t\tx[((len+64>>9)<<4)+15]=len;\r\n\t\tvar w=new Array(80);\r\n\r\n\t\tvar k1=0x5A827999;\r\n\t\tvar k2=0x6ED9EBA1;\r\n\t\tvar k3=0x8F1BBCDC;\r\n\t\tvar k4=0xCA62C1D6;\r\n\r\n\t\tvar h0=0x67452301;\r\n\t\tvar h1=0xEFCDAB89;\r\n\t\tvar h2=0x98BADCFE;\r\n\t\tvar h3=0x10325476;\r\n\t\tvar h4=0xC3D2E1F0;\r\n\r\n\t\tfor(var i=0;i<x.length;i+=16) {\r\n\t\t\tvar j=0;\r\n\t\t\tvar t;\r\n\t\t\tvar a=h0;\r\n\t\t\tvar b=h1;\r\n\t\t\tvar c=h2;\r\n\t\t\tvar d=h3;\r\n\t\t\tvar e=h4;\r\n\t\t\twhile(j<16) {\r\n\t\t\t\tw[j]=x[i+j];\r\n\t\t\t\tt=AA(e,a,d^(b&(c^d)),w[j],k1);\r\n\t\t\t\te=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;\r\n\t\t\t}\r\n\t\t\twhile(j<20) {\r\n\t\t\t\tw[j]=RR(w,j);\r\n\t\t\t\tt=AA(e,a,d^(b&(c^d)),w[j],k1);\r\n\t\t\t\te=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;\r\n\t\t\t}\r\n\t\t\twhile(j<40) {\r\n\t\t\t\tw[j]=RR(w,j);\r\n\t\t\t\tt=AA(e,a,b^c^d,w[j],k2);\r\n\t\t\t\te=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;\r\n\t\t\t}\r\n\t\t\twhile(j<60) {\r\n\t\t\t\tw[j]=RR(w,j);\r\n\t\t\t\tt=AA(e,a,(b&c)|(d&(b|c)),w[j],k3);\r\n\t\t\t\te=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;\r\n\t\t\t}\r\n\t\t\twhile(j<80) {\r\n\t\t\t\tw[j]=RR(w,j);\r\n\t\t\t\tt=AA(e,a,b^c^d,w[j],k4);\r\n\t\t\t\te=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;\r\n\t\t\t}\r\n\t\t\th0=add32(h0,a);\r\n\t\t\th1=add32(h1,b);\r\n\t\t\th2=add32(h2,c);\r\n\t\t\th3=add32(h3,d);\r\n\t\t\th4=add32(h4,e);\r\n\t\t}\r\n\t\treturn [h0,h1,h2,h3,h4];\r\n\t}\r\n})(jQuery);\r\n/*\r\njQuery.twStylesheet.js\r\n\r\njQuery plugin to dynamically insert CSS rules into a document\r\n\r\nUsage:\r\n  jQuery.twStylesheet applies style definitions\r\n  jQuery.twStylesheet.remove neutralizes style definitions\r\n\r\nCopyright (c) UnaMesa Association 2009\r\n\r\nTriple licensed under the BSD, MIT and GPL licenses:\r\n  http://www.opensource.org/licenses/bsd-license.php\r\n  http://www.opensource.org/licenses/mit-license.php\r\n  http://www.gnu.org/licenses/gpl.html\r\n*/\r\n\r\n(function($) {\r\n\r\nvar defaultId = \"customStyleSheet\"; // XXX: rename to dynamicStyleSheet?\r\n\r\n// Add or replace a style sheet\r\n// css argument is a string of CSS rule sets\r\n// options.id is an optional name identifying the style sheet\r\n// options.doc is an optional document reference\r\n// N.B.: Uses DOM methods instead of jQuery to ensure cross-browser comaptibility.\r\n$.twStylesheet = function(css, options) {\r\n\toptions = options || {};\r\n\tvar id = options.id || defaultId;\r\n\tvar doc = options.doc || document;\r\n\tvar el = doc.getElementById(id);\r\n\tif(doc.createStyleSheet) { // IE-specific handling\r\n\t\tif(el) {\r\n\t\t\tel.parentNode.removeChild(el);\r\n\t\t}\r\n\t\tdoc.getElementsByTagName(\"head\")[0].insertAdjacentHTML(\"beforeEnd\",\r\n\t\t\t'&nbsp;<style id=\"' + id + '\" type=\"text/css\">' + css + '</style>'); // fails without &nbsp;\r\n\t} else { // modern browsers\r\n\t\tif(el) {\r\n\t\t\tel.replaceChild(doc.createTextNode(css), el.firstChild);\r\n\t\t} else {\r\n\t\t\tel = doc.createElement(\"style\");\r\n\t\t\tel.type = \"text/css\";\r\n\t\t\tel.id = id;\r\n\t\t\tel.appendChild(doc.createTextNode(css));\r\n\t\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(el);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n// Remove existing style sheet\r\n// options.id is an optional name identifying the style sheet\r\n// options.doc is an optional document reference\r\n$.twStylesheet.remove = function(options) {\r\n\toptions = options || {};\r\n\tvar id = options.id || defaultId;\r\n\tvar doc = options.doc || document;\r\n\tvar el = doc.getElementById(id);\r\n\tif(el) {\r\n\t\tel.parentNode.removeChild(el);\r\n\t}\r\n};\r\n\r\n})(jQuery);\r\n\r\n//]]>\r\n</script>\r\n<script type=\"text/javascript\">\r\n//<![CDATA[\r\nif(useJavaSaver)\r\n\tdocument.write(\"<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>\");\r\n//]]>\r\n</script>\r\n<!--POST-SCRIPT-START-->\r\n\r\n<!--POST-SCRIPT-END-->\r\n</body>\r\n</html>\r\n\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}